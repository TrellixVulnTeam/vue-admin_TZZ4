{"remainingRequest":"/home/mengy/develop/iwork/kafo/vue-admin/node_modules/babel-loader/lib/index.js!/home/mengy/develop/iwork/kafo/vue-admin/src/proto/js/cmstype_pb.js","dependencies":[{"path":"/home/mengy/develop/iwork/kafo/vue-admin/src/proto/js/cmstype_pb.js","mtime":1632377195947},{"path":"/home/mengy/develop/iwork/kafo/vue-admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/mengy/develop/iwork/kafo/vue-admin/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8gc291cmNlOiBjbXN0eXBlLnByb3RvCgovKioKICogQGZpbGVvdmVydmlldwogKiBAZW5oYW5jZWFibGUKICogQHN1cHByZXNzIHttaXNzaW5nUmVxdWlyZX0gcmVwb3J0cyBlcnJvciBvbiBpbXBsaWNpdCB0eXBlIHVzYWdlcy4KICogQHN1cHByZXNzIHttZXNzYWdlQ29udmVudGlvbnN9IEpTIENvbXBpbGVyIHJlcG9ydHMgYW4gZXJyb3IgaWYgYSB2YXJpYWJsZSBvcgogKiAgICAgZmllbGQgc3RhcnRzIHdpdGggJ01TR18nIGFuZCBpc24ndCBhIHRyYW5zbGF0YWJsZSBtZXNzYWdlLgogKiBAcHVibGljCiAqLwovLyBHRU5FUkFURUQgQ09ERSAtLSBETyBOT1QgRURJVCEKCi8qIGVzbGludC1kaXNhYmxlICovCi8vIEB0cy1ub2NoZWNrCnZhciBqc3BiID0gcmVxdWlyZSgnZ29vZ2xlLXByb3RvYnVmJyk7Cgp2YXIgZ29vZyA9IGpzcGI7CnZhciBnbG9iYWwgPSBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpOwoKdmFyIHVzZXJ0eXBlX3BiID0gcmVxdWlyZSgnLi91c2VydHlwZV9wYi5qcycpOwoKZ29vZy5vYmplY3QuZXh0ZW5kKHByb3RvLCB1c2VydHlwZV9wYik7Cmdvb2cuZXhwb3J0U3ltYm9sKCdwcm90by5wYi5BY3Rpb25UeXBlJywgbnVsbCwgZ2xvYmFsKTsKZ29vZy5leHBvcnRTeW1ib2woJ3Byb3RvLnBiLkFkanVzdFJlY29yZCcsIG51bGwsIGdsb2JhbCk7Cmdvb2cuZXhwb3J0U3ltYm9sKCdwcm90by5wYi5BZG1pbicsIG51bGwsIGdsb2JhbCk7Cmdvb2cuZXhwb3J0U3ltYm9sKCdwcm90by5wYi5BZ29yYUNvbmZpZycsIG51bGwsIGdsb2JhbCk7Cmdvb2cuZXhwb3J0U3ltYm9sKCdwcm90by5wYi5BbmNob3JTdGF0JywgbnVsbCwgZ2xvYmFsKTsKZ29vZy5leHBvcnRTeW1ib2woJ3Byb3RvLnBiLkFwcCcsIG51bGwsIGdsb2JhbCk7Cmdvb2cuZXhwb3J0U3ltYm9sKCdwcm90by5wYi5BcmVhQ29uZmlnJywgbnVsbCwgZ2xvYmFsKTsKZ29vZy5leHBvcnRTeW1ib2woJ3Byb3RvLnBiLkFyZWFTdGF0JywgbnVsbCwgZ2xvYmFsKTsKZ29vZy5leHBvcnRTeW1ib2woJ3Byb3RvLnBiLkF1dG9NZXNzYWdlJywgbnVsbCwgZ2xvYmFsKTsKZ29vZy5leHBvcnRTeW1ib2woJ3Byb3RvLnBiLkNoYXRNZXNzYWdlJywgbnVsbCwgZ2xvYmFsKTsKZ29vZy5leHBvcnRTeW1ib2woJ3Byb3RvLnBiLkdyZWVuQ29uZmlnJywgbnVsbCwgZ2xvYmFsKTsKZ29vZy5leHBvcnRTeW1ib2woJ3Byb3RvLnBiLkd1aWxkJywgbnVsbCwgZ2xvYmFsKTsKZ29vZy5leHBvcnRTeW1ib2woJ3Byb3RvLnBiLkluc3RhbGwnLCBudWxsLCBnbG9iYWwpOwpnb29nLmV4cG9ydFN5bWJvbCgncHJvdG8ucGIuTG9jYWxpemF0aW9uJywgbnVsbCwgZ2xvYmFsKTsKZ29vZy5leHBvcnRTeW1ib2woJ3Byb3RvLnBiLk1lc3NhZ2VEaXJlY3Rpb24nLCBudWxsLCBnbG9iYWwpOwpnb29nLmV4cG9ydFN5bWJvbCgncHJvdG8ucGIuTWVzc2FnZVR5cGUnLCBudWxsLCBnbG9iYWwpOwpnb29nLmV4cG9ydFN5bWJvbCgncHJvdG8ucGIuTW9kdWxlJywgbnVsbCwgZ2xvYmFsKTsKZ29vZy5leHBvcnRTeW1ib2woJ3Byb3RvLnBiLk9wUmVjb3JkJywgbnVsbCwgZ2xvYmFsKTsKZ29vZy5leHBvcnRTeW1ib2woJ3Byb3RvLnBiLk9zc0NvbmZpZycsIG51bGwsIGdsb2JhbCk7Cmdvb2cuZXhwb3J0U3ltYm9sKCdwcm90by5wYi5QYXlDb25maWcnLCBudWxsLCBnbG9iYWwpOwpnb29nLmV4cG9ydFN5bWJvbCgncHJvdG8ucGIuUm9ib3RNZXNzYWdlJywgbnVsbCwgZ2xvYmFsKTsKZ29vZy5leHBvcnRTeW1ib2woJ3Byb3RvLnBiLlJvbmdjbG91ZENvbmZpZycsIG51bGwsIGdsb2JhbCk7Cmdvb2cuZXhwb3J0U3ltYm9sKCdwcm90by5wYi5TdGF0SW50ZXJ2YWwnLCBudWxsLCBnbG9iYWwpOwpnb29nLmV4cG9ydFN5bWJvbCgncHJvdG8ucGIuVXBncmFkZScsIG51bGwsIGdsb2JhbCk7Cmdvb2cuZXhwb3J0U3ltYm9sKCdwcm90by5wYi5Vc2VyU3RhdCcsIG51bGwsIGdsb2JhbCk7Cmdvb2cuZXhwb3J0U3ltYm9sKCdwcm90by5wYi5WZXJzaW9uJywgbnVsbCwgZ2xvYmFsKTsKLyoqCiAqIEdlbmVyYXRlZCBieSBKc1BiQ29kZUdlbmVyYXRvci4KICogQHBhcmFtIHtBcnJheT19IG9wdF9kYXRhIE9wdGlvbmFsIGluaXRpYWwgZGF0YSBhcnJheSwgdHlwaWNhbGx5IGZyb20gYQogKiBzZXJ2ZXIgcmVzcG9uc2UsIG9yIGNvbnN0cnVjdGVkIGRpcmVjdGx5IGluIEphdmFzY3JpcHQuIFRoZSBhcnJheSBpcyB1c2VkCiAqIGluIHBsYWNlIGFuZCBiZWNvbWVzIHBhcnQgb2YgdGhlIGNvbnN0cnVjdGVkIG9iamVjdC4gSXQgaXMgbm90IGNsb25lZC4KICogSWYgbm8gZGF0YSBpcyBwcm92aWRlZCwgdGhlIGNvbnN0cnVjdGVkIG9iamVjdCB3aWxsIGJlIGVtcHR5LCBidXQgc3RpbGwKICogdmFsaWQuCiAqIEBleHRlbmRzIHtqc3BiLk1lc3NhZ2V9CiAqIEBjb25zdHJ1Y3RvcgogKi8KCnByb3RvLnBiLkFkbWluID0gZnVuY3Rpb24gKG9wdF9kYXRhKSB7CiAganNwYi5NZXNzYWdlLmluaXRpYWxpemUodGhpcywgb3B0X2RhdGEsIDAsIC0xLCBwcm90by5wYi5BZG1pbi5yZXBlYXRlZEZpZWxkc18sIG51bGwpOwp9OwoKZ29vZy5pbmhlcml0cyhwcm90by5wYi5BZG1pbiwganNwYi5NZXNzYWdlKTsKCmlmIChnb29nLkRFQlVHICYmICFDT01QSUxFRCkgewogIC8qKgogICAqIEBwdWJsaWMKICAgKiBAb3ZlcnJpZGUKICAgKi8KICBwcm90by5wYi5BZG1pbi5kaXNwbGF5TmFtZSA9ICdwcm90by5wYi5BZG1pbic7Cn0KLyoqCiAqIEdlbmVyYXRlZCBieSBKc1BiQ29kZUdlbmVyYXRvci4KICogQHBhcmFtIHtBcnJheT19IG9wdF9kYXRhIE9wdGlvbmFsIGluaXRpYWwgZGF0YSBhcnJheSwgdHlwaWNhbGx5IGZyb20gYQogKiBzZXJ2ZXIgcmVzcG9uc2UsIG9yIGNvbnN0cnVjdGVkIGRpcmVjdGx5IGluIEphdmFzY3JpcHQuIFRoZSBhcnJheSBpcyB1c2VkCiAqIGluIHBsYWNlIGFuZCBiZWNvbWVzIHBhcnQgb2YgdGhlIGNvbnN0cnVjdGVkIG9iamVjdC4gSXQgaXMgbm90IGNsb25lZC4KICogSWYgbm8gZGF0YSBpcyBwcm92aWRlZCwgdGhlIGNvbnN0cnVjdGVkIG9iamVjdCB3aWxsIGJlIGVtcHR5LCBidXQgc3RpbGwKICogdmFsaWQuCiAqIEBleHRlbmRzIHtqc3BiLk1lc3NhZ2V9CiAqIEBjb25zdHJ1Y3RvcgogKi8KCgpwcm90by5wYi5Nb2R1bGUgPSBmdW5jdGlvbiAob3B0X2RhdGEpIHsKICBqc3BiLk1lc3NhZ2UuaW5pdGlhbGl6ZSh0aGlzLCBvcHRfZGF0YSwgMCwgLTEsIHByb3RvLnBiLk1vZHVsZS5yZXBlYXRlZEZpZWxkc18sIG51bGwpOwp9OwoKZ29vZy5pbmhlcml0cyhwcm90by5wYi5Nb2R1bGUsIGpzcGIuTWVzc2FnZSk7CgppZiAoZ29vZy5ERUJVRyAmJiAhQ09NUElMRUQpIHsKICAvKioKICAgKiBAcHVibGljCiAgICogQG92ZXJyaWRlCiAgICovCiAgcHJvdG8ucGIuTW9kdWxlLmRpc3BsYXlOYW1lID0gJ3Byb3RvLnBiLk1vZHVsZSc7Cn0KLyoqCiAqIEdlbmVyYXRlZCBieSBKc1BiQ29kZUdlbmVyYXRvci4KICogQHBhcmFtIHtBcnJheT19IG9wdF9kYXRhIE9wdGlvbmFsIGluaXRpYWwgZGF0YSBhcnJheSwgdHlwaWNhbGx5IGZyb20gYQogKiBzZXJ2ZXIgcmVzcG9uc2UsIG9yIGNvbnN0cnVjdGVkIGRpcmVjdGx5IGluIEphdmFzY3JpcHQuIFRoZSBhcnJheSBpcyB1c2VkCiAqIGluIHBsYWNlIGFuZCBiZWNvbWVzIHBhcnQgb2YgdGhlIGNvbnN0cnVjdGVkIG9iamVjdC4gSXQgaXMgbm90IGNsb25lZC4KICogSWYgbm8gZGF0YSBpcyBwcm92aWRlZCwgdGhlIGNvbnN0cnVjdGVkIG9iamVjdCB3aWxsIGJlIGVtcHR5LCBidXQgc3RpbGwKICogdmFsaWQuCiAqIEBleHRlbmRzIHtqc3BiLk1lc3NhZ2V9CiAqIEBjb25zdHJ1Y3RvcgogKi8KCgpwcm90by5wYi5PcFJlY29yZCA9IGZ1bmN0aW9uIChvcHRfZGF0YSkgewogIGpzcGIuTWVzc2FnZS5pbml0aWFsaXplKHRoaXMsIG9wdF9kYXRhLCAwLCAtMSwgbnVsbCwgbnVsbCk7Cn07Cgpnb29nLmluaGVyaXRzKHByb3RvLnBiLk9wUmVjb3JkLCBqc3BiLk1lc3NhZ2UpOwoKaWYgKGdvb2cuREVCVUcgJiYgIUNPTVBJTEVEKSB7CiAgLyoqCiAgICogQHB1YmxpYwogICAqIEBvdmVycmlkZQogICAqLwogIHByb3RvLnBiLk9wUmVjb3JkLmRpc3BsYXlOYW1lID0gJ3Byb3RvLnBiLk9wUmVjb3JkJzsKfQovKioKICogR2VuZXJhdGVkIGJ5IEpzUGJDb2RlR2VuZXJhdG9yLgogKiBAcGFyYW0ge0FycmF5PX0gb3B0X2RhdGEgT3B0aW9uYWwgaW5pdGlhbCBkYXRhIGFycmF5LCB0eXBpY2FsbHkgZnJvbSBhCiAqIHNlcnZlciByZXNwb25zZSwgb3IgY29uc3RydWN0ZWQgZGlyZWN0bHkgaW4gSmF2YXNjcmlwdC4gVGhlIGFycmF5IGlzIHVzZWQKICogaW4gcGxhY2UgYW5kIGJlY29tZXMgcGFydCBvZiB0aGUgY29uc3RydWN0ZWQgb2JqZWN0LiBJdCBpcyBub3QgY2xvbmVkLgogKiBJZiBubyBkYXRhIGlzIHByb3ZpZGVkLCB0aGUgY29uc3RydWN0ZWQgb2JqZWN0IHdpbGwgYmUgZW1wdHksIGJ1dCBzdGlsbAogKiB2YWxpZC4KICogQGV4dGVuZHMge2pzcGIuTWVzc2FnZX0KICogQGNvbnN0cnVjdG9yCiAqLwoKCnByb3RvLnBiLkluc3RhbGwgPSBmdW5jdGlvbiAob3B0X2RhdGEpIHsKICBqc3BiLk1lc3NhZ2UuaW5pdGlhbGl6ZSh0aGlzLCBvcHRfZGF0YSwgMCwgLTEsIG51bGwsIG51bGwpOwp9OwoKZ29vZy5pbmhlcml0cyhwcm90by5wYi5JbnN0YWxsLCBqc3BiLk1lc3NhZ2UpOwoKaWYgKGdvb2cuREVCVUcgJiYgIUNPTVBJTEVEKSB7CiAgLyoqCiAgICogQHB1YmxpYwogICAqIEBvdmVycmlkZQogICAqLwogIHByb3RvLnBiLkluc3RhbGwuZGlzcGxheU5hbWUgPSAncHJvdG8ucGIuSW5zdGFsbCc7Cn0KLyoqCiAqIEdlbmVyYXRlZCBieSBKc1BiQ29kZUdlbmVyYXRvci4KICogQHBhcmFtIHtBcnJheT19IG9wdF9kYXRhIE9wdGlvbmFsIGluaXRpYWwgZGF0YSBhcnJheSwgdHlwaWNhbGx5IGZyb20gYQogKiBzZXJ2ZXIgcmVzcG9uc2UsIG9yIGNvbnN0cnVjdGVkIGRpcmVjdGx5IGluIEphdmFzY3JpcHQuIFRoZSBhcnJheSBpcyB1c2VkCiAqIGluIHBsYWNlIGFuZCBiZWNvbWVzIHBhcnQgb2YgdGhlIGNvbnN0cnVjdGVkIG9iamVjdC4gSXQgaXMgbm90IGNsb25lZC4KICogSWYgbm8gZGF0YSBpcyBwcm92aWRlZCwgdGhlIGNvbnN0cnVjdGVkIG9iamVjdCB3aWxsIGJlIGVtcHR5LCBidXQgc3RpbGwKICogdmFsaWQuCiAqIEBleHRlbmRzIHtqc3BiLk1lc3NhZ2V9CiAqIEBjb25zdHJ1Y3RvcgogKi8KCgpwcm90by5wYi5HdWlsZCA9IGZ1bmN0aW9uIChvcHRfZGF0YSkgewogIGpzcGIuTWVzc2FnZS5pbml0aWFsaXplKHRoaXMsIG9wdF9kYXRhLCAwLCAtMSwgbnVsbCwgbnVsbCk7Cn07Cgpnb29nLmluaGVyaXRzKHByb3RvLnBiLkd1aWxkLCBqc3BiLk1lc3NhZ2UpOwoKaWYgKGdvb2cuREVCVUcgJiYgIUNPTVBJTEVEKSB7CiAgLyoqCiAgICogQHB1YmxpYwogICAqIEBvdmVycmlkZQogICAqLwogIHByb3RvLnBiLkd1aWxkLmRpc3BsYXlOYW1lID0gJ3Byb3RvLnBiLkd1aWxkJzsKfQovKioKICogR2VuZXJhdGVkIGJ5IEpzUGJDb2RlR2VuZXJhdG9yLgogKiBAcGFyYW0ge0FycmF5PX0gb3B0X2RhdGEgT3B0aW9uYWwgaW5pdGlhbCBkYXRhIGFycmF5LCB0eXBpY2FsbHkgZnJvbSBhCiAqIHNlcnZlciByZXNwb25zZSwgb3IgY29uc3RydWN0ZWQgZGlyZWN0bHkgaW4gSmF2YXNjcmlwdC4gVGhlIGFycmF5IGlzIHVzZWQKICogaW4gcGxhY2UgYW5kIGJlY29tZXMgcGFydCBvZiB0aGUgY29uc3RydWN0ZWQgb2JqZWN0LiBJdCBpcyBub3QgY2xvbmVkLgogKiBJZiBubyBkYXRhIGlzIHByb3ZpZGVkLCB0aGUgY29uc3RydWN0ZWQgb2JqZWN0IHdpbGwgYmUgZW1wdHksIGJ1dCBzdGlsbAogKiB2YWxpZC4KICogQGV4dGVuZHMge2pzcGIuTWVzc2FnZX0KICogQGNvbnN0cnVjdG9yCiAqLwoKCnByb3RvLnBiLkFwcCA9IGZ1bmN0aW9uIChvcHRfZGF0YSkgewogIGpzcGIuTWVzc2FnZS5pbml0aWFsaXplKHRoaXMsIG9wdF9kYXRhLCAwLCAtMSwgcHJvdG8ucGIuQXBwLnJlcGVhdGVkRmllbGRzXywgbnVsbCk7Cn07Cgpnb29nLmluaGVyaXRzKHByb3RvLnBiLkFwcCwganNwYi5NZXNzYWdlKTsKCmlmIChnb29nLkRFQlVHICYmICFDT01QSUxFRCkgewogIC8qKgogICAqIEBwdWJsaWMKICAgKiBAb3ZlcnJpZGUKICAgKi8KICBwcm90by5wYi5BcHAuZGlzcGxheU5hbWUgPSAncHJvdG8ucGIuQXBwJzsKfQovKioKICogR2VuZXJhdGVkIGJ5IEpzUGJDb2RlR2VuZXJhdG9yLgogKiBAcGFyYW0ge0FycmF5PX0gb3B0X2RhdGEgT3B0aW9uYWwgaW5pdGlhbCBkYXRhIGFycmF5LCB0eXBpY2FsbHkgZnJvbSBhCiAqIHNlcnZlciByZXNwb25zZSwgb3IgY29uc3RydWN0ZWQgZGlyZWN0bHkgaW4gSmF2YXNjcmlwdC4gVGhlIGFycmF5IGlzIHVzZWQKICogaW4gcGxhY2UgYW5kIGJlY29tZXMgcGFydCBvZiB0aGUgY29uc3RydWN0ZWQgb2JqZWN0LiBJdCBpcyBub3QgY2xvbmVkLgogKiBJZiBubyBkYXRhIGlzIHByb3ZpZGVkLCB0aGUgY29uc3RydWN0ZWQgb2JqZWN0IHdpbGwgYmUgZW1wdHksIGJ1dCBzdGlsbAogKiB2YWxpZC4KICogQGV4dGVuZHMge2pzcGIuTWVzc2FnZX0KICogQGNvbnN0cnVjdG9yCiAqLwoKCnByb3RvLnBiLkFnb3JhQ29uZmlnID0gZnVuY3Rpb24gKG9wdF9kYXRhKSB7CiAganNwYi5NZXNzYWdlLmluaXRpYWxpemUodGhpcywgb3B0X2RhdGEsIDAsIC0xLCBudWxsLCBudWxsKTsKfTsKCmdvb2cuaW5oZXJpdHMocHJvdG8ucGIuQWdvcmFDb25maWcsIGpzcGIuTWVzc2FnZSk7CgppZiAoZ29vZy5ERUJVRyAmJiAhQ09NUElMRUQpIHsKICAvKioKICAgKiBAcHVibGljCiAgICogQG92ZXJyaWRlCiAgICovCiAgcHJvdG8ucGIuQWdvcmFDb25maWcuZGlzcGxheU5hbWUgPSAncHJvdG8ucGIuQWdvcmFDb25maWcnOwp9Ci8qKgogKiBHZW5lcmF0ZWQgYnkgSnNQYkNvZGVHZW5lcmF0b3IuCiAqIEBwYXJhbSB7QXJyYXk9fSBvcHRfZGF0YSBPcHRpb25hbCBpbml0aWFsIGRhdGEgYXJyYXksIHR5cGljYWxseSBmcm9tIGEKICogc2VydmVyIHJlc3BvbnNlLCBvciBjb25zdHJ1Y3RlZCBkaXJlY3RseSBpbiBKYXZhc2NyaXB0LiBUaGUgYXJyYXkgaXMgdXNlZAogKiBpbiBwbGFjZSBhbmQgYmVjb21lcyBwYXJ0IG9mIHRoZSBjb25zdHJ1Y3RlZCBvYmplY3QuIEl0IGlzIG5vdCBjbG9uZWQuCiAqIElmIG5vIGRhdGEgaXMgcHJvdmlkZWQsIHRoZSBjb25zdHJ1Y3RlZCBvYmplY3Qgd2lsbCBiZSBlbXB0eSwgYnV0IHN0aWxsCiAqIHZhbGlkLgogKiBAZXh0ZW5kcyB7anNwYi5NZXNzYWdlfQogKiBAY29uc3RydWN0b3IKICovCgoKcHJvdG8ucGIuT3NzQ29uZmlnID0gZnVuY3Rpb24gKG9wdF9kYXRhKSB7CiAganNwYi5NZXNzYWdlLmluaXRpYWxpemUodGhpcywgb3B0X2RhdGEsIDAsIC0xLCBudWxsLCBudWxsKTsKfTsKCmdvb2cuaW5oZXJpdHMocHJvdG8ucGIuT3NzQ29uZmlnLCBqc3BiLk1lc3NhZ2UpOwoKaWYgKGdvb2cuREVCVUcgJiYgIUNPTVBJTEVEKSB7CiAgLyoqCiAgICogQHB1YmxpYwogICAqIEBvdmVycmlkZQogICAqLwogIHByb3RvLnBiLk9zc0NvbmZpZy5kaXNwbGF5TmFtZSA9ICdwcm90by5wYi5Pc3NDb25maWcnOwp9Ci8qKgogKiBHZW5lcmF0ZWQgYnkgSnNQYkNvZGVHZW5lcmF0b3IuCiAqIEBwYXJhbSB7QXJyYXk9fSBvcHRfZGF0YSBPcHRpb25hbCBpbml0aWFsIGRhdGEgYXJyYXksIHR5cGljYWxseSBmcm9tIGEKICogc2VydmVyIHJlc3BvbnNlLCBvciBjb25zdHJ1Y3RlZCBkaXJlY3RseSBpbiBKYXZhc2NyaXB0LiBUaGUgYXJyYXkgaXMgdXNlZAogKiBpbiBwbGFjZSBhbmQgYmVjb21lcyBwYXJ0IG9mIHRoZSBjb25zdHJ1Y3RlZCBvYmplY3QuIEl0IGlzIG5vdCBjbG9uZWQuCiAqIElmIG5vIGRhdGEgaXMgcHJvdmlkZWQsIHRoZSBjb25zdHJ1Y3RlZCBvYmplY3Qgd2lsbCBiZSBlbXB0eSwgYnV0IHN0aWxsCiAqIHZhbGlkLgogKiBAZXh0ZW5kcyB7anNwYi5NZXNzYWdlfQogKiBAY29uc3RydWN0b3IKICovCgoKcHJvdG8ucGIuUm9uZ2Nsb3VkQ29uZmlnID0gZnVuY3Rpb24gKG9wdF9kYXRhKSB7CiAganNwYi5NZXNzYWdlLmluaXRpYWxpemUodGhpcywgb3B0X2RhdGEsIDAsIC0xLCBudWxsLCBudWxsKTsKfTsKCmdvb2cuaW5oZXJpdHMocHJvdG8ucGIuUm9uZ2Nsb3VkQ29uZmlnLCBqc3BiLk1lc3NhZ2UpOwoKaWYgKGdvb2cuREVCVUcgJiYgIUNPTVBJTEVEKSB7CiAgLyoqCiAgICogQHB1YmxpYwogICAqIEBvdmVycmlkZQogICAqLwogIHByb3RvLnBiLlJvbmdjbG91ZENvbmZpZy5kaXNwbGF5TmFtZSA9ICdwcm90by5wYi5Sb25nY2xvdWRDb25maWcnOwp9Ci8qKgogKiBHZW5lcmF0ZWQgYnkgSnNQYkNvZGVHZW5lcmF0b3IuCiAqIEBwYXJhbSB7QXJyYXk9fSBvcHRfZGF0YSBPcHRpb25hbCBpbml0aWFsIGRhdGEgYXJyYXksIHR5cGljYWxseSBmcm9tIGEKICogc2VydmVyIHJlc3BvbnNlLCBvciBjb25zdHJ1Y3RlZCBkaXJlY3RseSBpbiBKYXZhc2NyaXB0LiBUaGUgYXJyYXkgaXMgdXNlZAogKiBpbiBwbGFjZSBhbmQgYmVjb21lcyBwYXJ0IG9mIHRoZSBjb25zdHJ1Y3RlZCBvYmplY3QuIEl0IGlzIG5vdCBjbG9uZWQuCiAqIElmIG5vIGRhdGEgaXMgcHJvdmlkZWQsIHRoZSBjb25zdHJ1Y3RlZCBvYmplY3Qgd2lsbCBiZSBlbXB0eSwgYnV0IHN0aWxsCiAqIHZhbGlkLgogKiBAZXh0ZW5kcyB7anNwYi5NZXNzYWdlfQogKiBAY29uc3RydWN0b3IKICovCgoKcHJvdG8ucGIuR3JlZW5Db25maWcgPSBmdW5jdGlvbiAob3B0X2RhdGEpIHsKICBqc3BiLk1lc3NhZ2UuaW5pdGlhbGl6ZSh0aGlzLCBvcHRfZGF0YSwgMCwgLTEsIG51bGwsIG51bGwpOwp9OwoKZ29vZy5pbmhlcml0cyhwcm90by5wYi5HcmVlbkNvbmZpZywganNwYi5NZXNzYWdlKTsKCmlmIChnb29nLkRFQlVHICYmICFDT01QSUxFRCkgewogIC8qKgogICAqIEBwdWJsaWMKICAgKiBAb3ZlcnJpZGUKICAgKi8KICBwcm90by5wYi5HcmVlbkNvbmZpZy5kaXNwbGF5TmFtZSA9ICdwcm90by5wYi5HcmVlbkNvbmZpZyc7Cn0KLyoqCiAqIEdlbmVyYXRlZCBieSBKc1BiQ29kZUdlbmVyYXRvci4KICogQHBhcmFtIHtBcnJheT19IG9wdF9kYXRhIE9wdGlvbmFsIGluaXRpYWwgZGF0YSBhcnJheSwgdHlwaWNhbGx5IGZyb20gYQogKiBzZXJ2ZXIgcmVzcG9uc2UsIG9yIGNvbnN0cnVjdGVkIGRpcmVjdGx5IGluIEphdmFzY3JpcHQuIFRoZSBhcnJheSBpcyB1c2VkCiAqIGluIHBsYWNlIGFuZCBiZWNvbWVzIHBhcnQgb2YgdGhlIGNvbnN0cnVjdGVkIG9iamVjdC4gSXQgaXMgbm90IGNsb25lZC4KICogSWYgbm8gZGF0YSBpcyBwcm92aWRlZCwgdGhlIGNvbnN0cnVjdGVkIG9iamVjdCB3aWxsIGJlIGVtcHR5LCBidXQgc3RpbGwKICogdmFsaWQuCiAqIEBleHRlbmRzIHtqc3BiLk1lc3NhZ2V9CiAqIEBjb25zdHJ1Y3RvcgogKi8KCgpwcm90by5wYi5BcmVhQ29uZmlnID0gZnVuY3Rpb24gKG9wdF9kYXRhKSB7CiAganNwYi5NZXNzYWdlLmluaXRpYWxpemUodGhpcywgb3B0X2RhdGEsIDAsIC0xLCBwcm90by5wYi5BcmVhQ29uZmlnLnJlcGVhdGVkRmllbGRzXywgbnVsbCk7Cn07Cgpnb29nLmluaGVyaXRzKHByb3RvLnBiLkFyZWFDb25maWcsIGpzcGIuTWVzc2FnZSk7CgppZiAoZ29vZy5ERUJVRyAmJiAhQ09NUElMRUQpIHsKICAvKioKICAgKiBAcHVibGljCiAgICogQG92ZXJyaWRlCiAgICovCiAgcHJvdG8ucGIuQXJlYUNvbmZpZy5kaXNwbGF5TmFtZSA9ICdwcm90by5wYi5BcmVhQ29uZmlnJzsKfQovKioKICogR2VuZXJhdGVkIGJ5IEpzUGJDb2RlR2VuZXJhdG9yLgogKiBAcGFyYW0ge0FycmF5PX0gb3B0X2RhdGEgT3B0aW9uYWwgaW5pdGlhbCBkYXRhIGFycmF5LCB0eXBpY2FsbHkgZnJvbSBhCiAqIHNlcnZlciByZXNwb25zZSwgb3IgY29uc3RydWN0ZWQgZGlyZWN0bHkgaW4gSmF2YXNjcmlwdC4gVGhlIGFycmF5IGlzIHVzZWQKICogaW4gcGxhY2UgYW5kIGJlY29tZXMgcGFydCBvZiB0aGUgY29uc3RydWN0ZWQgb2JqZWN0LiBJdCBpcyBub3QgY2xvbmVkLgogKiBJZiBubyBkYXRhIGlzIHByb3ZpZGVkLCB0aGUgY29uc3RydWN0ZWQgb2JqZWN0IHdpbGwgYmUgZW1wdHksIGJ1dCBzdGlsbAogKiB2YWxpZC4KICogQGV4dGVuZHMge2pzcGIuTWVzc2FnZX0KICogQGNvbnN0cnVjdG9yCiAqLwoKCnByb3RvLnBiLlBheUNvbmZpZyA9IGZ1bmN0aW9uIChvcHRfZGF0YSkgewogIGpzcGIuTWVzc2FnZS5pbml0aWFsaXplKHRoaXMsIG9wdF9kYXRhLCAwLCAtMSwgbnVsbCwgbnVsbCk7Cn07Cgpnb29nLmluaGVyaXRzKHByb3RvLnBiLlBheUNvbmZpZywganNwYi5NZXNzYWdlKTsKCmlmIChnb29nLkRFQlVHICYmICFDT01QSUxFRCkgewogIC8qKgogICAqIEBwdWJsaWMKICAgKiBAb3ZlcnJpZGUKICAgKi8KICBwcm90by5wYi5QYXlDb25maWcuZGlzcGxheU5hbWUgPSAncHJvdG8ucGIuUGF5Q29uZmlnJzsKfQovKioKICogR2VuZXJhdGVkIGJ5IEpzUGJDb2RlR2VuZXJhdG9yLgogKiBAcGFyYW0ge0FycmF5PX0gb3B0X2RhdGEgT3B0aW9uYWwgaW5pdGlhbCBkYXRhIGFycmF5LCB0eXBpY2FsbHkgZnJvbSBhCiAqIHNlcnZlciByZXNwb25zZSwgb3IgY29uc3RydWN0ZWQgZGlyZWN0bHkgaW4gSmF2YXNjcmlwdC4gVGhlIGFycmF5IGlzIHVzZWQKICogaW4gcGxhY2UgYW5kIGJlY29tZXMgcGFydCBvZiB0aGUgY29uc3RydWN0ZWQgb2JqZWN0LiBJdCBpcyBub3QgY2xvbmVkLgogKiBJZiBubyBkYXRhIGlzIHByb3ZpZGVkLCB0aGUgY29uc3RydWN0ZWQgb2JqZWN0IHdpbGwgYmUgZW1wdHksIGJ1dCBzdGlsbAogKiB2YWxpZC4KICogQGV4dGVuZHMge2pzcGIuTWVzc2FnZX0KICogQGNvbnN0cnVjdG9yCiAqLwoKCnByb3RvLnBiLlZlcnNpb24gPSBmdW5jdGlvbiAob3B0X2RhdGEpIHsKICBqc3BiLk1lc3NhZ2UuaW5pdGlhbGl6ZSh0aGlzLCBvcHRfZGF0YSwgMCwgLTEsIG51bGwsIG51bGwpOwp9OwoKZ29vZy5pbmhlcml0cyhwcm90by5wYi5WZXJzaW9uLCBqc3BiLk1lc3NhZ2UpOwoKaWYgKGdvb2cuREVCVUcgJiYgIUNPTVBJTEVEKSB7CiAgLyoqCiAgICogQHB1YmxpYwogICAqIEBvdmVycmlkZQogICAqLwogIHByb3RvLnBiLlZlcnNpb24uZGlzcGxheU5hbWUgPSAncHJvdG8ucGIuVmVyc2lvbic7Cn0KLyoqCiAqIEdlbmVyYXRlZCBieSBKc1BiQ29kZUdlbmVyYXRvci4KICogQHBhcmFtIHtBcnJheT19IG9wdF9kYXRhIE9wdGlvbmFsIGluaXRpYWwgZGF0YSBhcnJheSwgdHlwaWNhbGx5IGZyb20gYQogKiBzZXJ2ZXIgcmVzcG9uc2UsIG9yIGNvbnN0cnVjdGVkIGRpcmVjdGx5IGluIEphdmFzY3JpcHQuIFRoZSBhcnJheSBpcyB1c2VkCiAqIGluIHBsYWNlIGFuZCBiZWNvbWVzIHBhcnQgb2YgdGhlIGNvbnN0cnVjdGVkIG9iamVjdC4gSXQgaXMgbm90IGNsb25lZC4KICogSWYgbm8gZGF0YSBpcyBwcm92aWRlZCwgdGhlIGNvbnN0cnVjdGVkIG9iamVjdCB3aWxsIGJlIGVtcHR5LCBidXQgc3RpbGwKICogdmFsaWQuCiAqIEBleHRlbmRzIHtqc3BiLk1lc3NhZ2V9CiAqIEBjb25zdHJ1Y3RvcgogKi8KCgpwcm90by5wYi5Mb2NhbGl6YXRpb24gPSBmdW5jdGlvbiAob3B0X2RhdGEpIHsKICBqc3BiLk1lc3NhZ2UuaW5pdGlhbGl6ZSh0aGlzLCBvcHRfZGF0YSwgMCwgLTEsIG51bGwsIG51bGwpOwp9OwoKZ29vZy5pbmhlcml0cyhwcm90by5wYi5Mb2NhbGl6YXRpb24sIGpzcGIuTWVzc2FnZSk7CgppZiAoZ29vZy5ERUJVRyAmJiAhQ09NUElMRUQpIHsKICAvKioKICAgKiBAcHVibGljCiAgICogQG92ZXJyaWRlCiAgICovCiAgcHJvdG8ucGIuTG9jYWxpemF0aW9uLmRpc3BsYXlOYW1lID0gJ3Byb3RvLnBiLkxvY2FsaXphdGlvbic7Cn0KLyoqCiAqIEdlbmVyYXRlZCBieSBKc1BiQ29kZUdlbmVyYXRvci4KICogQHBhcmFtIHtBcnJheT19IG9wdF9kYXRhIE9wdGlvbmFsIGluaXRpYWwgZGF0YSBhcnJheSwgdHlwaWNhbGx5IGZyb20gYQogKiBzZXJ2ZXIgcmVzcG9uc2UsIG9yIGNvbnN0cnVjdGVkIGRpcmVjdGx5IGluIEphdmFzY3JpcHQuIFRoZSBhcnJheSBpcyB1c2VkCiAqIGluIHBsYWNlIGFuZCBiZWNvbWVzIHBhcnQgb2YgdGhlIGNvbnN0cnVjdGVkIG9iamVjdC4gSXQgaXMgbm90IGNsb25lZC4KICogSWYgbm8gZGF0YSBpcyBwcm92aWRlZCwgdGhlIGNvbnN0cnVjdGVkIG9iamVjdCB3aWxsIGJlIGVtcHR5LCBidXQgc3RpbGwKICogdmFsaWQuCiAqIEBleHRlbmRzIHtqc3BiLk1lc3NhZ2V9CiAqIEBjb25zdHJ1Y3RvcgogKi8KCgpwcm90by5wYi5VcGdyYWRlID0gZnVuY3Rpb24gKG9wdF9kYXRhKSB7CiAganNwYi5NZXNzYWdlLmluaXRpYWxpemUodGhpcywgb3B0X2RhdGEsIDAsIC0xLCBwcm90by5wYi5VcGdyYWRlLnJlcGVhdGVkRmllbGRzXywgbnVsbCk7Cn07Cgpnb29nLmluaGVyaXRzKHByb3RvLnBiLlVwZ3JhZGUsIGpzcGIuTWVzc2FnZSk7CgppZiAoZ29vZy5ERUJVRyAmJiAhQ09NUElMRUQpIHsKICAvKioKICAgKiBAcHVibGljCiAgICogQG92ZXJyaWRlCiAgICovCiAgcHJvdG8ucGIuVXBncmFkZS5kaXNwbGF5TmFtZSA9ICdwcm90by5wYi5VcGdyYWRlJzsKfQovKioKICogR2VuZXJhdGVkIGJ5IEpzUGJDb2RlR2VuZXJhdG9yLgogKiBAcGFyYW0ge0FycmF5PX0gb3B0X2RhdGEgT3B0aW9uYWwgaW5pdGlhbCBkYXRhIGFycmF5LCB0eXBpY2FsbHkgZnJvbSBhCiAqIHNlcnZlciByZXNwb25zZSwgb3IgY29uc3RydWN0ZWQgZGlyZWN0bHkgaW4gSmF2YXNjcmlwdC4gVGhlIGFycmF5IGlzIHVzZWQKICogaW4gcGxhY2UgYW5kIGJlY29tZXMgcGFydCBvZiB0aGUgY29uc3RydWN0ZWQgb2JqZWN0LiBJdCBpcyBub3QgY2xvbmVkLgogKiBJZiBubyBkYXRhIGlzIHByb3ZpZGVkLCB0aGUgY29uc3RydWN0ZWQgb2JqZWN0IHdpbGwgYmUgZW1wdHksIGJ1dCBzdGlsbAogKiB2YWxpZC4KICogQGV4dGVuZHMge2pzcGIuTWVzc2FnZX0KICogQGNvbnN0cnVjdG9yCiAqLwoKCnByb3RvLnBiLlJvYm90TWVzc2FnZSA9IGZ1bmN0aW9uIChvcHRfZGF0YSkgewogIGpzcGIuTWVzc2FnZS5pbml0aWFsaXplKHRoaXMsIG9wdF9kYXRhLCAwLCAtMSwgbnVsbCwgbnVsbCk7Cn07Cgpnb29nLmluaGVyaXRzKHByb3RvLnBiLlJvYm90TWVzc2FnZSwganNwYi5NZXNzYWdlKTsKCmlmIChnb29nLkRFQlVHICYmICFDT01QSUxFRCkgewogIC8qKgogICAqIEBwdWJsaWMKICAgKiBAb3ZlcnJpZGUKICAgKi8KICBwcm90by5wYi5Sb2JvdE1lc3NhZ2UuZGlzcGxheU5hbWUgPSAncHJvdG8ucGIuUm9ib3RNZXNzYWdlJzsKfQovKioKICogR2VuZXJhdGVkIGJ5IEpzUGJDb2RlR2VuZXJhdG9yLgogKiBAcGFyYW0ge0FycmF5PX0gb3B0X2RhdGEgT3B0aW9uYWwgaW5pdGlhbCBkYXRhIGFycmF5LCB0eXBpY2FsbHkgZnJvbSBhCiAqIHNlcnZlciByZXNwb25zZSwgb3IgY29uc3RydWN0ZWQgZGlyZWN0bHkgaW4gSmF2YXNjcmlwdC4gVGhlIGFycmF5IGlzIHVzZWQKICogaW4gcGxhY2UgYW5kIGJlY29tZXMgcGFydCBvZiB0aGUgY29uc3RydWN0ZWQgb2JqZWN0LiBJdCBpcyBub3QgY2xvbmVkLgogKiBJZiBubyBkYXRhIGlzIHByb3ZpZGVkLCB0aGUgY29uc3RydWN0ZWQgb2JqZWN0IHdpbGwgYmUgZW1wdHksIGJ1dCBzdGlsbAogKiB2YWxpZC4KICogQGV4dGVuZHMge2pzcGIuTWVzc2FnZX0KICogQGNvbnN0cnVjdG9yCiAqLwoKCnByb3RvLnBiLkF1dG9NZXNzYWdlID0gZnVuY3Rpb24gKG9wdF9kYXRhKSB7CiAganNwYi5NZXNzYWdlLmluaXRpYWxpemUodGhpcywgb3B0X2RhdGEsIDAsIC0xLCBudWxsLCBudWxsKTsKfTsKCmdvb2cuaW5oZXJpdHMocHJvdG8ucGIuQXV0b01lc3NhZ2UsIGpzcGIuTWVzc2FnZSk7CgppZiAoZ29vZy5ERUJVRyAmJiAhQ09NUElMRUQpIHsKICAvKioKICAgKiBAcHVibGljCiAgICogQG92ZXJyaWRlCiAgICovCiAgcHJvdG8ucGIuQXV0b01lc3NhZ2UuZGlzcGxheU5hbWUgPSAncHJvdG8ucGIuQXV0b01lc3NhZ2UnOwp9Ci8qKgogKiBHZW5lcmF0ZWQgYnkgSnNQYkNvZGVHZW5lcmF0b3IuCiAqIEBwYXJhbSB7QXJyYXk9fSBvcHRfZGF0YSBPcHRpb25hbCBpbml0aWFsIGRhdGEgYXJyYXksIHR5cGljYWxseSBmcm9tIGEKICogc2VydmVyIHJlc3BvbnNlLCBvciBjb25zdHJ1Y3RlZCBkaXJlY3RseSBpbiBKYXZhc2NyaXB0LiBUaGUgYXJyYXkgaXMgdXNlZAogKiBpbiBwbGFjZSBhbmQgYmVjb21lcyBwYXJ0IG9mIHRoZSBjb25zdHJ1Y3RlZCBvYmplY3QuIEl0IGlzIG5vdCBjbG9uZWQuCiAqIElmIG5vIGRhdGEgaXMgcHJvdmlkZWQsIHRoZSBjb25zdHJ1Y3RlZCBvYmplY3Qgd2lsbCBiZSBlbXB0eSwgYnV0IHN0aWxsCiAqIHZhbGlkLgogKiBAZXh0ZW5kcyB7anNwYi5NZXNzYWdlfQogKiBAY29uc3RydWN0b3IKICovCgoKcHJvdG8ucGIuQ2hhdE1lc3NhZ2UgPSBmdW5jdGlvbiAob3B0X2RhdGEpIHsKICBqc3BiLk1lc3NhZ2UuaW5pdGlhbGl6ZSh0aGlzLCBvcHRfZGF0YSwgMCwgLTEsIG51bGwsIG51bGwpOwp9OwoKZ29vZy5pbmhlcml0cyhwcm90by5wYi5DaGF0TWVzc2FnZSwganNwYi5NZXNzYWdlKTsKCmlmIChnb29nLkRFQlVHICYmICFDT01QSUxFRCkgewogIC8qKgogICAqIEBwdWJsaWMKICAgKiBAb3ZlcnJpZGUKICAgKi8KICBwcm90by5wYi5DaGF0TWVzc2FnZS5kaXNwbGF5TmFtZSA9ICdwcm90by5wYi5DaGF0TWVzc2FnZSc7Cn0KLyoqCiAqIEdlbmVyYXRlZCBieSBKc1BiQ29kZUdlbmVyYXRvci4KICogQHBhcmFtIHtBcnJheT19IG9wdF9kYXRhIE9wdGlvbmFsIGluaXRpYWwgZGF0YSBhcnJheSwgdHlwaWNhbGx5IGZyb20gYQogKiBzZXJ2ZXIgcmVzcG9uc2UsIG9yIGNvbnN0cnVjdGVkIGRpcmVjdGx5IGluIEphdmFzY3JpcHQuIFRoZSBhcnJheSBpcyB1c2VkCiAqIGluIHBsYWNlIGFuZCBiZWNvbWVzIHBhcnQgb2YgdGhlIGNvbnN0cnVjdGVkIG9iamVjdC4gSXQgaXMgbm90IGNsb25lZC4KICogSWYgbm8gZGF0YSBpcyBwcm92aWRlZCwgdGhlIGNvbnN0cnVjdGVkIG9iamVjdCB3aWxsIGJlIGVtcHR5LCBidXQgc3RpbGwKICogdmFsaWQuCiAqIEBleHRlbmRzIHtqc3BiLk1lc3NhZ2V9CiAqIEBjb25zdHJ1Y3RvcgogKi8KCgpwcm90by5wYi5BZGp1c3RSZWNvcmQgPSBmdW5jdGlvbiAob3B0X2RhdGEpIHsKICBqc3BiLk1lc3NhZ2UuaW5pdGlhbGl6ZSh0aGlzLCBvcHRfZGF0YSwgMCwgLTEsIG51bGwsIG51bGwpOwp9OwoKZ29vZy5pbmhlcml0cyhwcm90by5wYi5BZGp1c3RSZWNvcmQsIGpzcGIuTWVzc2FnZSk7CgppZiAoZ29vZy5ERUJVRyAmJiAhQ09NUElMRUQpIHsKICAvKioKICAgKiBAcHVibGljCiAgICogQG92ZXJyaWRlCiAgICovCiAgcHJvdG8ucGIuQWRqdXN0UmVjb3JkLmRpc3BsYXlOYW1lID0gJ3Byb3RvLnBiLkFkanVzdFJlY29yZCc7Cn0KLyoqCiAqIEdlbmVyYXRlZCBieSBKc1BiQ29kZUdlbmVyYXRvci4KICogQHBhcmFtIHtBcnJheT19IG9wdF9kYXRhIE9wdGlvbmFsIGluaXRpYWwgZGF0YSBhcnJheSwgdHlwaWNhbGx5IGZyb20gYQogKiBzZXJ2ZXIgcmVzcG9uc2UsIG9yIGNvbnN0cnVjdGVkIGRpcmVjdGx5IGluIEphdmFzY3JpcHQuIFRoZSBhcnJheSBpcyB1c2VkCiAqIGluIHBsYWNlIGFuZCBiZWNvbWVzIHBhcnQgb2YgdGhlIGNvbnN0cnVjdGVkIG9iamVjdC4gSXQgaXMgbm90IGNsb25lZC4KICogSWYgbm8gZGF0YSBpcyBwcm92aWRlZCwgdGhlIGNvbnN0cnVjdGVkIG9iamVjdCB3aWxsIGJlIGVtcHR5LCBidXQgc3RpbGwKICogdmFsaWQuCiAqIEBleHRlbmRzIHtqc3BiLk1lc3NhZ2V9CiAqIEBjb25zdHJ1Y3RvcgogKi8KCgpwcm90by5wYi5BcmVhU3RhdCA9IGZ1bmN0aW9uIChvcHRfZGF0YSkgewogIGpzcGIuTWVzc2FnZS5pbml0aWFsaXplKHRoaXMsIG9wdF9kYXRhLCAwLCAtMSwgbnVsbCwgbnVsbCk7Cn07Cgpnb29nLmluaGVyaXRzKHByb3RvLnBiLkFyZWFTdGF0LCBqc3BiLk1lc3NhZ2UpOwoKaWYgKGdvb2cuREVCVUcgJiYgIUNPTVBJTEVEKSB7CiAgLyoqCiAgICogQHB1YmxpYwogICAqIEBvdmVycmlkZQogICAqLwogIHByb3RvLnBiLkFyZWFTdGF0LmRpc3BsYXlOYW1lID0gJ3Byb3RvLnBiLkFyZWFTdGF0JzsKfQovKioKICogR2VuZXJhdGVkIGJ5IEpzUGJDb2RlR2VuZXJhdG9yLgogKiBAcGFyYW0ge0FycmF5PX0gb3B0X2RhdGEgT3B0aW9uYWwgaW5pdGlhbCBkYXRhIGFycmF5LCB0eXBpY2FsbHkgZnJvbSBhCiAqIHNlcnZlciByZXNwb25zZSwgb3IgY29uc3RydWN0ZWQgZGlyZWN0bHkgaW4gSmF2YXNjcmlwdC4gVGhlIGFycmF5IGlzIHVzZWQKICogaW4gcGxhY2UgYW5kIGJlY29tZXMgcGFydCBvZiB0aGUgY29uc3RydWN0ZWQgb2JqZWN0LiBJdCBpcyBub3QgY2xvbmVkLgogKiBJZiBubyBkYXRhIGlzIHByb3ZpZGVkLCB0aGUgY29uc3RydWN0ZWQgb2JqZWN0IHdpbGwgYmUgZW1wdHksIGJ1dCBzdGlsbAogKiB2YWxpZC4KICogQGV4dGVuZHMge2pzcGIuTWVzc2FnZX0KICogQGNvbnN0cnVjdG9yCiAqLwoKCnByb3RvLnBiLkFuY2hvclN0YXQgPSBmdW5jdGlvbiAob3B0X2RhdGEpIHsKICBqc3BiLk1lc3NhZ2UuaW5pdGlhbGl6ZSh0aGlzLCBvcHRfZGF0YSwgMCwgLTEsIG51bGwsIG51bGwpOwp9OwoKZ29vZy5pbmhlcml0cyhwcm90by5wYi5BbmNob3JTdGF0LCBqc3BiLk1lc3NhZ2UpOwoKaWYgKGdvb2cuREVCVUcgJiYgIUNPTVBJTEVEKSB7CiAgLyoqCiAgICogQHB1YmxpYwogICAqIEBvdmVycmlkZQogICAqLwogIHByb3RvLnBiLkFuY2hvclN0YXQuZGlzcGxheU5hbWUgPSAncHJvdG8ucGIuQW5jaG9yU3RhdCc7Cn0KLyoqCiAqIEdlbmVyYXRlZCBieSBKc1BiQ29kZUdlbmVyYXRvci4KICogQHBhcmFtIHtBcnJheT19IG9wdF9kYXRhIE9wdGlvbmFsIGluaXRpYWwgZGF0YSBhcnJheSwgdHlwaWNhbGx5IGZyb20gYQogKiBzZXJ2ZXIgcmVzcG9uc2UsIG9yIGNvbnN0cnVjdGVkIGRpcmVjdGx5IGluIEphdmFzY3JpcHQuIFRoZSBhcnJheSBpcyB1c2VkCiAqIGluIHBsYWNlIGFuZCBiZWNvbWVzIHBhcnQgb2YgdGhlIGNvbnN0cnVjdGVkIG9iamVjdC4gSXQgaXMgbm90IGNsb25lZC4KICogSWYgbm8gZGF0YSBpcyBwcm92aWRlZCwgdGhlIGNvbnN0cnVjdGVkIG9iamVjdCB3aWxsIGJlIGVtcHR5LCBidXQgc3RpbGwKICogdmFsaWQuCiAqIEBleHRlbmRzIHtqc3BiLk1lc3NhZ2V9CiAqIEBjb25zdHJ1Y3RvcgogKi8KCgpwcm90by5wYi5Vc2VyU3RhdCA9IGZ1bmN0aW9uIChvcHRfZGF0YSkgewogIGpzcGIuTWVzc2FnZS5pbml0aWFsaXplKHRoaXMsIG9wdF9kYXRhLCAwLCAtMSwgbnVsbCwgbnVsbCk7Cn07Cgpnb29nLmluaGVyaXRzKHByb3RvLnBiLlVzZXJTdGF0LCBqc3BiLk1lc3NhZ2UpOwoKaWYgKGdvb2cuREVCVUcgJiYgIUNPTVBJTEVEKSB7CiAgLyoqCiAgICogQHB1YmxpYwogICAqIEBvdmVycmlkZQogICAqLwogIHByb3RvLnBiLlVzZXJTdGF0LmRpc3BsYXlOYW1lID0gJ3Byb3RvLnBiLlVzZXJTdGF0JzsKfQovKioKICogTGlzdCBvZiByZXBlYXRlZCBmaWVsZHMgd2l0aGluIHRoaXMgbWVzc2FnZSB0eXBlLgogKiBAcHJpdmF0ZSB7IUFycmF5PG51bWJlcj59CiAqIEBjb25zdAogKi8KCgpwcm90by5wYi5BZG1pbi5yZXBlYXRlZEZpZWxkc18gPSBbNywgOCwgOV07CgppZiAoanNwYi5NZXNzYWdlLkdFTkVSQVRFX1RPX09CSkVDVCkgewogIC8qKgogICAqIENyZWF0ZXMgYW4gb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgcHJvdG8uCiAgICogRmllbGQgbmFtZXMgdGhhdCBhcmUgcmVzZXJ2ZWQgaW4gSmF2YVNjcmlwdCBhbmQgd2lsbCBiZSByZW5hbWVkIHRvIHBiX25hbWUuCiAgICogT3B0aW9uYWwgZmllbGRzIHRoYXQgYXJlIG5vdCBzZXQgd2lsbCBiZSBzZXQgdG8gdW5kZWZpbmVkLgogICAqIFRvIGFjY2VzcyBhIHJlc2VydmVkIGZpZWxkIHVzZSwgZm9vLnBiXzxuYW1lPiwgZWcsIGZvby5wYl9kZWZhdWx0LgogICAqIEZvciB0aGUgbGlzdCBvZiByZXNlcnZlZCBuYW1lcyBwbGVhc2Ugc2VlOgogICAqICAgICBuZXQvcHJvdG8yL2NvbXBpbGVyL2pzL2ludGVybmFsL2dlbmVyYXRvci5jYyNrS2V5d29yZC4KICAgKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfaW5jbHVkZUluc3RhbmNlIERlcHJlY2F0ZWQuIHdoZXRoZXIgdG8gaW5jbHVkZSB0aGUKICAgKiAgICAgSlNQQiBpbnN0YW5jZSBmb3IgdHJhbnNpdGlvbmFsIHNveSBwcm90byBzdXBwb3J0OgogICAqICAgICBodHRwOi8vZ290by9zb3ktcGFyYW0tbWlncmF0aW9uCiAgICogQHJldHVybiB7IU9iamVjdH0KICAgKi8KICBwcm90by5wYi5BZG1pbi5wcm90b3R5cGUudG9PYmplY3QgPSBmdW5jdGlvbiAob3B0X2luY2x1ZGVJbnN0YW5jZSkgewogICAgcmV0dXJuIHByb3RvLnBiLkFkbWluLnRvT2JqZWN0KG9wdF9pbmNsdWRlSW5zdGFuY2UsIHRoaXMpOwogIH07CiAgLyoqCiAgICogU3RhdGljIHZlcnNpb24gb2YgdGhlIHtAc2VlIHRvT2JqZWN0fSBtZXRob2QuCiAgICogQHBhcmFtIHtib29sZWFufHVuZGVmaW5lZH0gaW5jbHVkZUluc3RhbmNlIERlcHJlY2F0ZWQuIFdoZXRoZXIgdG8gaW5jbHVkZQogICAqICAgICB0aGUgSlNQQiBpbnN0YW5jZSBmb3IgdHJhbnNpdGlvbmFsIHNveSBwcm90byBzdXBwb3J0OgogICAqICAgICBodHRwOi8vZ290by9zb3ktcGFyYW0tbWlncmF0aW9uCiAgICogQHBhcmFtIHshcHJvdG8ucGIuQWRtaW59IG1zZyBUaGUgbXNnIGluc3RhbmNlIHRvIHRyYW5zZm9ybS4KICAgKiBAcmV0dXJuIHshT2JqZWN0fQogICAqIEBzdXBwcmVzcyB7dW51c2VkTG9jYWxWYXJpYWJsZXN9IGYgaXMgb25seSB1c2VkIGZvciBuZXN0ZWQgbWVzc2FnZXMKICAgKi8KCgogIHByb3RvLnBiLkFkbWluLnRvT2JqZWN0ID0gZnVuY3Rpb24gKGluY2x1ZGVJbnN0YW5jZSwgbXNnKSB7CiAgICB2YXIgZiwKICAgICAgICBvYmogPSB7CiAgICAgIGlkOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDEsIDApLAogICAgICBlbmFibGU6IGpzcGIuTWVzc2FnZS5nZXRCb29sZWFuRmllbGRXaXRoRGVmYXVsdChtc2csIDIsIGZhbHNlKSwKICAgICAgZW1haWw6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMywgIiIpLAogICAgICBwYXNzd29yZDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA0LCAiIiksCiAgICAgIG5hbWU6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNSwgIiIpLAogICAgICBub3RlOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDYsICIiKSwKICAgICAgYXJlYUlkc0xpc3Q6IChmID0ganNwYi5NZXNzYWdlLmdldFJlcGVhdGVkRmllbGQobXNnLCA3KSkgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IGYsCiAgICAgIGFwcElkc0xpc3Q6IChmID0ganNwYi5NZXNzYWdlLmdldFJlcGVhdGVkRmllbGQobXNnLCA4KSkgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IGYsCiAgICAgIG1vZHVsZXNMaXN0OiAoZiA9IGpzcGIuTWVzc2FnZS5nZXRSZXBlYXRlZEZpZWxkKG1zZywgOSkpID09IG51bGwgPyB1bmRlZmluZWQgOiBmLAogICAgICBsb2dpbkF0OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDEwLCAwKSwKICAgICAgbG9naW5JcDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxMSwgIiIpLAogICAgICBmYWlsQ291bnQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMTIsIDApLAogICAgICBhY2Nlc3NUb2tlbjoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxMywgIiIpLAogICAgICB1cGRhdGVkQXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjAsIDApLAogICAgICBjcmVhdGVkQXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjEsIDApCiAgICB9OwoKICAgIGlmIChpbmNsdWRlSW5zdGFuY2UpIHsKICAgICAgb2JqLiRqc3BiTWVzc2FnZUluc3RhbmNlID0gbXNnOwogICAgfQoKICAgIHJldHVybiBvYmo7CiAgfTsKfQovKioKICogRGVzZXJpYWxpemVzIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkuCiAqIEBwYXJhbSB7anNwYi5CeXRlU291cmNlfSBieXRlcyBUaGUgYnl0ZXMgdG8gZGVzZXJpYWxpemUuCiAqIEByZXR1cm4geyFwcm90by5wYi5BZG1pbn0KICovCgoKcHJvdG8ucGIuQWRtaW4uZGVzZXJpYWxpemVCaW5hcnkgPSBmdW5jdGlvbiAoYnl0ZXMpIHsKICB2YXIgcmVhZGVyID0gbmV3IGpzcGIuQmluYXJ5UmVhZGVyKGJ5dGVzKTsKICB2YXIgbXNnID0gbmV3IHByb3RvLnBiLkFkbWluKCk7CiAgcmV0dXJuIHByb3RvLnBiLkFkbWluLmRlc2VyaWFsaXplQmluYXJ5RnJvbVJlYWRlcihtc2csIHJlYWRlcik7Cn07Ci8qKgogKiBEZXNlcmlhbGl6ZXMgYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUgZm9ybWF0KSBmcm9tIHRoZQogKiBnaXZlbiByZWFkZXIgaW50byB0aGUgZ2l2ZW4gbWVzc2FnZSBvYmplY3QuCiAqIEBwYXJhbSB7IXByb3RvLnBiLkFkbWlufSBtc2cgVGhlIG1lc3NhZ2Ugb2JqZWN0IHRvIGRlc2VyaWFsaXplIGludG8uCiAqIEBwYXJhbSB7IWpzcGIuQmluYXJ5UmVhZGVyfSByZWFkZXIgVGhlIEJpbmFyeVJlYWRlciB0byB1c2UuCiAqIEByZXR1cm4geyFwcm90by5wYi5BZG1pbn0KICovCgoKcHJvdG8ucGIuQWRtaW4uZGVzZXJpYWxpemVCaW5hcnlGcm9tUmVhZGVyID0gZnVuY3Rpb24gKG1zZywgcmVhZGVyKSB7CiAgd2hpbGUgKHJlYWRlci5uZXh0RmllbGQoKSkgewogICAgaWYgKHJlYWRlci5pc0VuZEdyb3VwKCkpIHsKICAgICAgYnJlYWs7CiAgICB9CgogICAgdmFyIGZpZWxkID0gcmVhZGVyLmdldEZpZWxkTnVtYmVyKCk7CgogICAgc3dpdGNoIChmaWVsZCkgewogICAgICBjYXNlIDE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0SWQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAyOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkQm9vbCgpOwogICAgICAgIG1zZy5zZXRFbmFibGUodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAzOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldEVtYWlsKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNDoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXRQYXNzd29yZCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDU6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0TmFtZSh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDY6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0Tm90ZSh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDc6CiAgICAgICAgdmFyIHZhbHVlcyA9IHJlYWRlci5pc0RlbGltaXRlZCgpID8gcmVhZGVyLnJlYWRQYWNrZWRVaW50MzIoKSA6IFtyZWFkZXIucmVhZFVpbnQzMigpXTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2YWx1ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIG1zZy5hZGRBcmVhSWRzKHZhbHVlc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgODoKICAgICAgICB2YXIgdmFsdWVzID0gcmVhZGVyLmlzRGVsaW1pdGVkKCkgPyByZWFkZXIucmVhZFBhY2tlZFVpbnQzMigpIDogW3JlYWRlci5yZWFkVWludDMyKCldOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgbXNnLmFkZEFwcElkcyh2YWx1ZXNbaV0pOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDk6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuYWRkTW9kdWxlcyh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDEwOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldExvZ2luQXQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAxMToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXRMb2dpbklwKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTI6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0RmFpbENvdW50KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTM6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0QWNjZXNzVG9rZW4odmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAyMDoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRVcGRhdGVkQXQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAyMToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRDcmVhdGVkQXQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgZGVmYXVsdDoKICAgICAgICByZWFkZXIuc2tpcEZpZWxkKCk7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfQoKICByZXR1cm4gbXNnOwp9OwovKioKICogU2VyaWFsaXplcyB0aGUgbWVzc2FnZSB0byBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZSBmb3JtYXQpLgogKiBAcmV0dXJuIHshVWludDhBcnJheX0KICovCgoKcHJvdG8ucGIuQWRtaW4ucHJvdG90eXBlLnNlcmlhbGl6ZUJpbmFyeSA9IGZ1bmN0aW9uICgpIHsKICB2YXIgd3JpdGVyID0gbmV3IGpzcGIuQmluYXJ5V3JpdGVyKCk7CiAgcHJvdG8ucGIuQWRtaW4uc2VyaWFsaXplQmluYXJ5VG9Xcml0ZXIodGhpcywgd3JpdGVyKTsKICByZXR1cm4gd3JpdGVyLmdldFJlc3VsdEJ1ZmZlcigpOwp9OwovKioKICogU2VyaWFsaXplcyB0aGUgZ2l2ZW4gbWVzc2FnZSB0byBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZQogKiBmb3JtYXQpLCB3cml0aW5nIHRvIHRoZSBnaXZlbiBCaW5hcnlXcml0ZXIuCiAqIEBwYXJhbSB7IXByb3RvLnBiLkFkbWlufSBtZXNzYWdlCiAqIEBwYXJhbSB7IWpzcGIuQmluYXJ5V3JpdGVyfSB3cml0ZXIKICogQHN1cHByZXNzIHt1bnVzZWRMb2NhbFZhcmlhYmxlc30gZiBpcyBvbmx5IHVzZWQgZm9yIG5lc3RlZCBtZXNzYWdlcwogKi8KCgpwcm90by5wYi5BZG1pbi5zZXJpYWxpemVCaW5hcnlUb1dyaXRlciA9IGZ1bmN0aW9uIChtZXNzYWdlLCB3cml0ZXIpIHsKICB2YXIgZiA9IHVuZGVmaW5lZDsKICBmID0gbWVzc2FnZS5nZXRJZCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDEsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0RW5hYmxlKCk7CgogIGlmIChmKSB7CiAgICB3cml0ZXIud3JpdGVCb29sKDIsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0RW1haWwoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDMsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0UGFzc3dvcmQoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDQsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0TmFtZSgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoNSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXROb3RlKCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZyg2LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEFyZWFJZHNMaXN0KCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVBhY2tlZFVpbnQzMig3LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEFwcElkc0xpc3QoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlUGFja2VkVWludDMyKDgsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0TW9kdWxlc0xpc3QoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlUmVwZWF0ZWRTdHJpbmcoOSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRMb2dpbkF0KCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMTAsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0TG9naW5JcCgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoMTEsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0RmFpbENvdW50KCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMTIsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0QWNjZXNzVG9rZW4oKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDEzLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldFVwZGF0ZWRBdCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDIwLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldENyZWF0ZWRBdCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDIxLCBmKTsKICB9Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgaWQgPSAxOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFkbWluLnByb3RvdHlwZS5nZXRJZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMSwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFkbWlufSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQWRtaW4ucHJvdG90eXBlLnNldElkID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAxLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBib29sIGVuYWJsZSA9IDI7CiAqIEByZXR1cm4ge2Jvb2xlYW59CiAqLwoKCnByb3RvLnBiLkFkbWluLnByb3RvdHlwZS5nZXRFbmFibGUgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRCb29sZWFuRmllbGRXaXRoRGVmYXVsdCh0aGlzLCAyLCBmYWxzZSk7Cn07Ci8qKgogKiBAcGFyYW0ge2Jvb2xlYW59IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BZG1pbn0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFkbWluLnByb3RvdHlwZS5zZXRFbmFibGUgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0Jvb2xlYW5GaWVsZCh0aGlzLCAyLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgZW1haWwgPSAzOwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLkFkbWluLnByb3RvdHlwZS5nZXRFbWFpbCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMywgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BZG1pbn0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFkbWluLnByb3RvdHlwZS5zZXRFbWFpbCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgMywgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIHBhc3N3b3JkID0gNDsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5BZG1pbi5wcm90b3R5cGUuZ2V0UGFzc3dvcmQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDQsICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQWRtaW59IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BZG1pbi5wcm90b3R5cGUuc2V0UGFzc3dvcmQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDQsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyBuYW1lID0gNTsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5BZG1pbi5wcm90b3R5cGUuZ2V0TmFtZSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgNSwgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BZG1pbn0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFkbWluLnByb3RvdHlwZS5zZXROYW1lID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCA1LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgbm90ZSA9IDY7CiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKcHJvdG8ucGIuQWRtaW4ucHJvdG90eXBlLmdldE5vdGUgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDYsICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQWRtaW59IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BZG1pbi5wcm90b3R5cGUuc2V0Tm90ZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgNiwgdmFsdWUpOwp9OwovKioKICogcmVwZWF0ZWQgdWludDMyIGFyZWFfaWRzID0gNzsKICogQHJldHVybiB7IUFycmF5PG51bWJlcj59CiAqLwoKCnByb3RvLnBiLkFkbWluLnByb3RvdHlwZS5nZXRBcmVhSWRzTGlzdCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldFJlcGVhdGVkRmllbGQodGhpcywgNyk7Cn07Ci8qKgogKiBAcGFyYW0geyFBcnJheTxudW1iZXI+fSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQWRtaW59IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BZG1pbi5wcm90b3R5cGUuc2V0QXJlYUlkc0xpc3QgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldEZpZWxkKHRoaXMsIDcsIHZhbHVlIHx8IFtdKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcGFyYW0ge251bWJlcj19IG9wdF9pbmRleAogKiBAcmV0dXJuIHshcHJvdG8ucGIuQWRtaW59IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BZG1pbi5wcm90b3R5cGUuYWRkQXJlYUlkcyA9IGZ1bmN0aW9uICh2YWx1ZSwgb3B0X2luZGV4KSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5hZGRUb1JlcGVhdGVkRmllbGQodGhpcywgNywgdmFsdWUsIG9wdF9pbmRleCk7Cn07Ci8qKgogKiBDbGVhcnMgdGhlIGxpc3QgbWFraW5nIGl0IGVtcHR5IGJ1dCBub24tbnVsbC4KICogQHJldHVybiB7IXByb3RvLnBiLkFkbWlufSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQWRtaW4ucHJvdG90eXBlLmNsZWFyQXJlYUlkc0xpc3QgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMuc2V0QXJlYUlkc0xpc3QoW10pOwp9OwovKioKICogcmVwZWF0ZWQgdWludDMyIGFwcF9pZHMgPSA4OwogKiBAcmV0dXJuIHshQXJyYXk8bnVtYmVyPn0KICovCgoKcHJvdG8ucGIuQWRtaW4ucHJvdG90eXBlLmdldEFwcElkc0xpc3QgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRSZXBlYXRlZEZpZWxkKHRoaXMsIDgpOwp9OwovKioKICogQHBhcmFtIHshQXJyYXk8bnVtYmVyPn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFkbWlufSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQWRtaW4ucHJvdG90eXBlLnNldEFwcElkc0xpc3QgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldEZpZWxkKHRoaXMsIDgsIHZhbHVlIHx8IFtdKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcGFyYW0ge251bWJlcj19IG9wdF9pbmRleAogKiBAcmV0dXJuIHshcHJvdG8ucGIuQWRtaW59IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BZG1pbi5wcm90b3R5cGUuYWRkQXBwSWRzID0gZnVuY3Rpb24gKHZhbHVlLCBvcHRfaW5kZXgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmFkZFRvUmVwZWF0ZWRGaWVsZCh0aGlzLCA4LCB2YWx1ZSwgb3B0X2luZGV4KTsKfTsKLyoqCiAqIENsZWFycyB0aGUgbGlzdCBtYWtpbmcgaXQgZW1wdHkgYnV0IG5vbi1udWxsLgogKiBAcmV0dXJuIHshcHJvdG8ucGIuQWRtaW59IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BZG1pbi5wcm90b3R5cGUuY2xlYXJBcHBJZHNMaXN0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLnNldEFwcElkc0xpc3QoW10pOwp9OwovKioKICogcmVwZWF0ZWQgc3RyaW5nIG1vZHVsZXMgPSA5OwogKiBAcmV0dXJuIHshQXJyYXk8c3RyaW5nPn0KICovCgoKcHJvdG8ucGIuQWRtaW4ucHJvdG90eXBlLmdldE1vZHVsZXNMaXN0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0UmVwZWF0ZWRGaWVsZCh0aGlzLCA5KTsKfTsKLyoqCiAqIEBwYXJhbSB7IUFycmF5PHN0cmluZz59IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BZG1pbn0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFkbWluLnByb3RvdHlwZS5zZXRNb2R1bGVzTGlzdCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0RmllbGQodGhpcywgOSwgdmFsdWUgfHwgW10pOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyPX0gb3B0X2luZGV4CiAqIEByZXR1cm4geyFwcm90by5wYi5BZG1pbn0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFkbWluLnByb3RvdHlwZS5hZGRNb2R1bGVzID0gZnVuY3Rpb24gKHZhbHVlLCBvcHRfaW5kZXgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmFkZFRvUmVwZWF0ZWRGaWVsZCh0aGlzLCA5LCB2YWx1ZSwgb3B0X2luZGV4KTsKfTsKLyoqCiAqIENsZWFycyB0aGUgbGlzdCBtYWtpbmcgaXQgZW1wdHkgYnV0IG5vbi1udWxsLgogKiBAcmV0dXJuIHshcHJvdG8ucGIuQWRtaW59IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BZG1pbi5wcm90b3R5cGUuY2xlYXJNb2R1bGVzTGlzdCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5zZXRNb2R1bGVzTGlzdChbXSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgbG9naW5fYXQgPSAxMDsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BZG1pbi5wcm90b3R5cGUuZ2V0TG9naW5BdCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMTAsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BZG1pbn0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFkbWluLnByb3RvdHlwZS5zZXRMb2dpbkF0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAxMCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIGxvZ2luX2lwID0gMTE7CiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKcHJvdG8ucGIuQWRtaW4ucHJvdG90eXBlLmdldExvZ2luSXAgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDExLCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFkbWlufSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQWRtaW4ucHJvdG90eXBlLnNldExvZ2luSXAgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDExLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgZmFpbF9jb3VudCA9IDEyOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFkbWluLnByb3RvdHlwZS5nZXRGYWlsQ291bnQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDEyLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQWRtaW59IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BZG1pbi5wcm90b3R5cGUuc2V0RmFpbENvdW50ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAxMiwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIGFjY2Vzc190b2tlbiA9IDEzOwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLkFkbWluLnByb3RvdHlwZS5nZXRBY2Nlc3NUb2tlbiA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMTMsICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQWRtaW59IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BZG1pbi5wcm90b3R5cGUuc2V0QWNjZXNzVG9rZW4gPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDEzLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgdXBkYXRlZF9hdCA9IDIwOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFkbWluLnByb3RvdHlwZS5nZXRVcGRhdGVkQXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDIwLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQWRtaW59IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BZG1pbi5wcm90b3R5cGUuc2V0VXBkYXRlZEF0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAyMCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGNyZWF0ZWRfYXQgPSAyMTsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BZG1pbi5wcm90b3R5cGUuZ2V0Q3JlYXRlZEF0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAyMSwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFkbWlufSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQWRtaW4ucHJvdG90eXBlLnNldENyZWF0ZWRBdCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMjEsIHZhbHVlKTsKfTsKLyoqCiAqIExpc3Qgb2YgcmVwZWF0ZWQgZmllbGRzIHdpdGhpbiB0aGlzIG1lc3NhZ2UgdHlwZS4KICogQHByaXZhdGUgeyFBcnJheTxudW1iZXI+fQogKiBAY29uc3QKICovCgoKcHJvdG8ucGIuTW9kdWxlLnJlcGVhdGVkRmllbGRzXyA9IFszXTsKCmlmIChqc3BiLk1lc3NhZ2UuR0VORVJBVEVfVE9fT0JKRUNUKSB7CiAgLyoqCiAgICogQ3JlYXRlcyBhbiBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBwcm90by4KICAgKiBGaWVsZCBuYW1lcyB0aGF0IGFyZSByZXNlcnZlZCBpbiBKYXZhU2NyaXB0IGFuZCB3aWxsIGJlIHJlbmFtZWQgdG8gcGJfbmFtZS4KICAgKiBPcHRpb25hbCBmaWVsZHMgdGhhdCBhcmUgbm90IHNldCB3aWxsIGJlIHNldCB0byB1bmRlZmluZWQuCiAgICogVG8gYWNjZXNzIGEgcmVzZXJ2ZWQgZmllbGQgdXNlLCBmb28ucGJfPG5hbWU+LCBlZywgZm9vLnBiX2RlZmF1bHQuCiAgICogRm9yIHRoZSBsaXN0IG9mIHJlc2VydmVkIG5hbWVzIHBsZWFzZSBzZWU6CiAgICogICAgIG5ldC9wcm90bzIvY29tcGlsZXIvanMvaW50ZXJuYWwvZ2VuZXJhdG9yLmNjI2tLZXl3b3JkLgogICAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF9pbmNsdWRlSW5zdGFuY2UgRGVwcmVjYXRlZC4gd2hldGhlciB0byBpbmNsdWRlIHRoZQogICAqICAgICBKU1BCIGluc3RhbmNlIGZvciB0cmFuc2l0aW9uYWwgc295IHByb3RvIHN1cHBvcnQ6CiAgICogICAgIGh0dHA6Ly9nb3RvL3NveS1wYXJhbS1taWdyYXRpb24KICAgKiBAcmV0dXJuIHshT2JqZWN0fQogICAqLwogIHByb3RvLnBiLk1vZHVsZS5wcm90b3R5cGUudG9PYmplY3QgPSBmdW5jdGlvbiAob3B0X2luY2x1ZGVJbnN0YW5jZSkgewogICAgcmV0dXJuIHByb3RvLnBiLk1vZHVsZS50b09iamVjdChvcHRfaW5jbHVkZUluc3RhbmNlLCB0aGlzKTsKICB9OwogIC8qKgogICAqIFN0YXRpYyB2ZXJzaW9uIG9mIHRoZSB7QHNlZSB0b09iamVjdH0gbWV0aG9kLgogICAqIEBwYXJhbSB7Ym9vbGVhbnx1bmRlZmluZWR9IGluY2x1ZGVJbnN0YW5jZSBEZXByZWNhdGVkLiBXaGV0aGVyIHRvIGluY2x1ZGUKICAgKiAgICAgdGhlIEpTUEIgaW5zdGFuY2UgZm9yIHRyYW5zaXRpb25hbCBzb3kgcHJvdG8gc3VwcG9ydDoKICAgKiAgICAgaHR0cDovL2dvdG8vc295LXBhcmFtLW1pZ3JhdGlvbgogICAqIEBwYXJhbSB7IXByb3RvLnBiLk1vZHVsZX0gbXNnIFRoZSBtc2cgaW5zdGFuY2UgdG8gdHJhbnNmb3JtLgogICAqIEByZXR1cm4geyFPYmplY3R9CiAgICogQHN1cHByZXNzIHt1bnVzZWRMb2NhbFZhcmlhYmxlc30gZiBpcyBvbmx5IHVzZWQgZm9yIG5lc3RlZCBtZXNzYWdlcwogICAqLwoKCiAgcHJvdG8ucGIuTW9kdWxlLnRvT2JqZWN0ID0gZnVuY3Rpb24gKGluY2x1ZGVJbnN0YW5jZSwgbXNnKSB7CiAgICB2YXIgZiwKICAgICAgICBvYmogPSB7CiAgICAgIG5hbWU6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMSwgIiIpLAogICAgICB0aXRsZToganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAyLCAiIiksCiAgICAgIGFwaVBhdGhzTGlzdDogKGYgPSBqc3BiLk1lc3NhZ2UuZ2V0UmVwZWF0ZWRGaWVsZChtc2csIDMpKSA9PSBudWxsID8gdW5kZWZpbmVkIDogZiwKICAgICAgdXBkYXRlZEF0OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDIwLCAwKSwKICAgICAgY3JlYXRlZEF0OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDIxLCAwKQogICAgfTsKCiAgICBpZiAoaW5jbHVkZUluc3RhbmNlKSB7CiAgICAgIG9iai4kanNwYk1lc3NhZ2VJbnN0YW5jZSA9IG1zZzsKICAgIH0KCiAgICByZXR1cm4gb2JqOwogIH07Cn0KLyoqCiAqIERlc2VyaWFsaXplcyBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZSBmb3JtYXQpLgogKiBAcGFyYW0ge2pzcGIuQnl0ZVNvdXJjZX0gYnl0ZXMgVGhlIGJ5dGVzIHRvIGRlc2VyaWFsaXplLgogKiBAcmV0dXJuIHshcHJvdG8ucGIuTW9kdWxlfQogKi8KCgpwcm90by5wYi5Nb2R1bGUuZGVzZXJpYWxpemVCaW5hcnkgPSBmdW5jdGlvbiAoYnl0ZXMpIHsKICB2YXIgcmVhZGVyID0gbmV3IGpzcGIuQmluYXJ5UmVhZGVyKGJ5dGVzKTsKICB2YXIgbXNnID0gbmV3IHByb3RvLnBiLk1vZHVsZSgpOwogIHJldHVybiBwcm90by5wYi5Nb2R1bGUuZGVzZXJpYWxpemVCaW5hcnlGcm9tUmVhZGVyKG1zZywgcmVhZGVyKTsKfTsKLyoqCiAqIERlc2VyaWFsaXplcyBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZSBmb3JtYXQpIGZyb20gdGhlCiAqIGdpdmVuIHJlYWRlciBpbnRvIHRoZSBnaXZlbiBtZXNzYWdlIG9iamVjdC4KICogQHBhcmFtIHshcHJvdG8ucGIuTW9kdWxlfSBtc2cgVGhlIG1lc3NhZ2Ugb2JqZWN0IHRvIGRlc2VyaWFsaXplIGludG8uCiAqIEBwYXJhbSB7IWpzcGIuQmluYXJ5UmVhZGVyfSByZWFkZXIgVGhlIEJpbmFyeVJlYWRlciB0byB1c2UuCiAqIEByZXR1cm4geyFwcm90by5wYi5Nb2R1bGV9CiAqLwoKCnByb3RvLnBiLk1vZHVsZS5kZXNlcmlhbGl6ZUJpbmFyeUZyb21SZWFkZXIgPSBmdW5jdGlvbiAobXNnLCByZWFkZXIpIHsKICB3aGlsZSAocmVhZGVyLm5leHRGaWVsZCgpKSB7CiAgICBpZiAocmVhZGVyLmlzRW5kR3JvdXAoKSkgewogICAgICBicmVhazsKICAgIH0KCiAgICB2YXIgZmllbGQgPSByZWFkZXIuZ2V0RmllbGROdW1iZXIoKTsKCiAgICBzd2l0Y2ggKGZpZWxkKSB7CiAgICAgIGNhc2UgMToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXROYW1lKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXRUaXRsZSh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDM6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuYWRkQXBpUGF0aHModmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAyMDoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRVcGRhdGVkQXQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAyMToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRDcmVhdGVkQXQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgZGVmYXVsdDoKICAgICAgICByZWFkZXIuc2tpcEZpZWxkKCk7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfQoKICByZXR1cm4gbXNnOwp9OwovKioKICogU2VyaWFsaXplcyB0aGUgbWVzc2FnZSB0byBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZSBmb3JtYXQpLgogKiBAcmV0dXJuIHshVWludDhBcnJheX0KICovCgoKcHJvdG8ucGIuTW9kdWxlLnByb3RvdHlwZS5zZXJpYWxpemVCaW5hcnkgPSBmdW5jdGlvbiAoKSB7CiAgdmFyIHdyaXRlciA9IG5ldyBqc3BiLkJpbmFyeVdyaXRlcigpOwogIHByb3RvLnBiLk1vZHVsZS5zZXJpYWxpemVCaW5hcnlUb1dyaXRlcih0aGlzLCB3cml0ZXIpOwogIHJldHVybiB3cml0ZXIuZ2V0UmVzdWx0QnVmZmVyKCk7Cn07Ci8qKgogKiBTZXJpYWxpemVzIHRoZSBnaXZlbiBtZXNzYWdlIHRvIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlCiAqIGZvcm1hdCksIHdyaXRpbmcgdG8gdGhlIGdpdmVuIEJpbmFyeVdyaXRlci4KICogQHBhcmFtIHshcHJvdG8ucGIuTW9kdWxlfSBtZXNzYWdlCiAqIEBwYXJhbSB7IWpzcGIuQmluYXJ5V3JpdGVyfSB3cml0ZXIKICogQHN1cHByZXNzIHt1bnVzZWRMb2NhbFZhcmlhYmxlc30gZiBpcyBvbmx5IHVzZWQgZm9yIG5lc3RlZCBtZXNzYWdlcwogKi8KCgpwcm90by5wYi5Nb2R1bGUuc2VyaWFsaXplQmluYXJ5VG9Xcml0ZXIgPSBmdW5jdGlvbiAobWVzc2FnZSwgd3JpdGVyKSB7CiAgdmFyIGYgPSB1bmRlZmluZWQ7CiAgZiA9IG1lc3NhZ2UuZ2V0TmFtZSgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoMSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRUaXRsZSgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoMiwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRBcGlQYXRoc0xpc3QoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlUmVwZWF0ZWRTdHJpbmcoMywgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRVcGRhdGVkQXQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigyMCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRDcmVhdGVkQXQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigyMSwgZik7CiAgfQp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIG5hbWUgPSAxOwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLk1vZHVsZS5wcm90b3R5cGUuZ2V0TmFtZSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMSwgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5Nb2R1bGV9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5Nb2R1bGUucHJvdG90eXBlLnNldE5hbWUgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDEsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyB0aXRsZSA9IDI7CiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKcHJvdG8ucGIuTW9kdWxlLnByb3RvdHlwZS5nZXRUaXRsZSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMiwgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5Nb2R1bGV9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5Nb2R1bGUucHJvdG90eXBlLnNldFRpdGxlID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCAyLCB2YWx1ZSk7Cn07Ci8qKgogKiByZXBlYXRlZCBzdHJpbmcgYXBpX3BhdGhzID0gMzsKICogQHJldHVybiB7IUFycmF5PHN0cmluZz59CiAqLwoKCnByb3RvLnBiLk1vZHVsZS5wcm90b3R5cGUuZ2V0QXBpUGF0aHNMaXN0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0UmVwZWF0ZWRGaWVsZCh0aGlzLCAzKTsKfTsKLyoqCiAqIEBwYXJhbSB7IUFycmF5PHN0cmluZz59IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5Nb2R1bGV9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5Nb2R1bGUucHJvdG90eXBlLnNldEFwaVBhdGhzTGlzdCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0RmllbGQodGhpcywgMywgdmFsdWUgfHwgW10pOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyPX0gb3B0X2luZGV4CiAqIEByZXR1cm4geyFwcm90by5wYi5Nb2R1bGV9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5Nb2R1bGUucHJvdG90eXBlLmFkZEFwaVBhdGhzID0gZnVuY3Rpb24gKHZhbHVlLCBvcHRfaW5kZXgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmFkZFRvUmVwZWF0ZWRGaWVsZCh0aGlzLCAzLCB2YWx1ZSwgb3B0X2luZGV4KTsKfTsKLyoqCiAqIENsZWFycyB0aGUgbGlzdCBtYWtpbmcgaXQgZW1wdHkgYnV0IG5vbi1udWxsLgogKiBAcmV0dXJuIHshcHJvdG8ucGIuTW9kdWxlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuTW9kdWxlLnByb3RvdHlwZS5jbGVhckFwaVBhdGhzTGlzdCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5zZXRBcGlQYXRoc0xpc3QoW10pOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIHVwZGF0ZWRfYXQgPSAyMDsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5Nb2R1bGUucHJvdG90eXBlLmdldFVwZGF0ZWRBdCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMjAsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5Nb2R1bGV9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5Nb2R1bGUucHJvdG90eXBlLnNldFVwZGF0ZWRBdCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMjAsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBjcmVhdGVkX2F0ID0gMjE7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuTW9kdWxlLnByb3RvdHlwZS5nZXRDcmVhdGVkQXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDIxLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuTW9kdWxlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuTW9kdWxlLnByb3RvdHlwZS5zZXRDcmVhdGVkQXQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDIxLCB2YWx1ZSk7Cn07CgppZiAoanNwYi5NZXNzYWdlLkdFTkVSQVRFX1RPX09CSkVDVCkgewogIC8qKgogICAqIENyZWF0ZXMgYW4gb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgcHJvdG8uCiAgICogRmllbGQgbmFtZXMgdGhhdCBhcmUgcmVzZXJ2ZWQgaW4gSmF2YVNjcmlwdCBhbmQgd2lsbCBiZSByZW5hbWVkIHRvIHBiX25hbWUuCiAgICogT3B0aW9uYWwgZmllbGRzIHRoYXQgYXJlIG5vdCBzZXQgd2lsbCBiZSBzZXQgdG8gdW5kZWZpbmVkLgogICAqIFRvIGFjY2VzcyBhIHJlc2VydmVkIGZpZWxkIHVzZSwgZm9vLnBiXzxuYW1lPiwgZWcsIGZvby5wYl9kZWZhdWx0LgogICAqIEZvciB0aGUgbGlzdCBvZiByZXNlcnZlZCBuYW1lcyBwbGVhc2Ugc2VlOgogICAqICAgICBuZXQvcHJvdG8yL2NvbXBpbGVyL2pzL2ludGVybmFsL2dlbmVyYXRvci5jYyNrS2V5d29yZC4KICAgKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfaW5jbHVkZUluc3RhbmNlIERlcHJlY2F0ZWQuIHdoZXRoZXIgdG8gaW5jbHVkZSB0aGUKICAgKiAgICAgSlNQQiBpbnN0YW5jZSBmb3IgdHJhbnNpdGlvbmFsIHNveSBwcm90byBzdXBwb3J0OgogICAqICAgICBodHRwOi8vZ290by9zb3ktcGFyYW0tbWlncmF0aW9uCiAgICogQHJldHVybiB7IU9iamVjdH0KICAgKi8KICBwcm90by5wYi5PcFJlY29yZC5wcm90b3R5cGUudG9PYmplY3QgPSBmdW5jdGlvbiAob3B0X2luY2x1ZGVJbnN0YW5jZSkgewogICAgcmV0dXJuIHByb3RvLnBiLk9wUmVjb3JkLnRvT2JqZWN0KG9wdF9pbmNsdWRlSW5zdGFuY2UsIHRoaXMpOwogIH07CiAgLyoqCiAgICogU3RhdGljIHZlcnNpb24gb2YgdGhlIHtAc2VlIHRvT2JqZWN0fSBtZXRob2QuCiAgICogQHBhcmFtIHtib29sZWFufHVuZGVmaW5lZH0gaW5jbHVkZUluc3RhbmNlIERlcHJlY2F0ZWQuIFdoZXRoZXIgdG8gaW5jbHVkZQogICAqICAgICB0aGUgSlNQQiBpbnN0YW5jZSBmb3IgdHJhbnNpdGlvbmFsIHNveSBwcm90byBzdXBwb3J0OgogICAqICAgICBodHRwOi8vZ290by9zb3ktcGFyYW0tbWlncmF0aW9uCiAgICogQHBhcmFtIHshcHJvdG8ucGIuT3BSZWNvcmR9IG1zZyBUaGUgbXNnIGluc3RhbmNlIHRvIHRyYW5zZm9ybS4KICAgKiBAcmV0dXJuIHshT2JqZWN0fQogICAqIEBzdXBwcmVzcyB7dW51c2VkTG9jYWxWYXJpYWJsZXN9IGYgaXMgb25seSB1c2VkIGZvciBuZXN0ZWQgbWVzc2FnZXMKICAgKi8KCgogIHByb3RvLnBiLk9wUmVjb3JkLnRvT2JqZWN0ID0gZnVuY3Rpb24gKGluY2x1ZGVJbnN0YW5jZSwgbXNnKSB7CiAgICB2YXIgZiwKICAgICAgICBvYmogPSB7CiAgICAgIGlkOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDEsIDApLAogICAgICBhZG1pbklkOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDIsIDApLAogICAgICBlbWFpbDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAzLCAiIiksCiAgICAgIGFwaVBhdGg6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNCwgIiIpLAogICAgICBkZXNjOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDUsICIiKSwKICAgICAgc3BlbnRNczoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA2LCAwKSwKICAgICAgaXA6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNywgIiIpLAogICAgICByZXF1ZXN0RGF0YToganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA4LCAiIiksCiAgICAgIG1ldGFkYXRhOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDksICIiKSwKICAgICAgcmVwbHlEYXRhOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDEwLCAiIiksCiAgICAgIGVycm9yRGF0YToganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxMSwgIiIpLAogICAgICBjcmVhdGVkQXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjAsIDApCiAgICB9OwoKICAgIGlmIChpbmNsdWRlSW5zdGFuY2UpIHsKICAgICAgb2JqLiRqc3BiTWVzc2FnZUluc3RhbmNlID0gbXNnOwogICAgfQoKICAgIHJldHVybiBvYmo7CiAgfTsKfQovKioKICogRGVzZXJpYWxpemVzIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkuCiAqIEBwYXJhbSB7anNwYi5CeXRlU291cmNlfSBieXRlcyBUaGUgYnl0ZXMgdG8gZGVzZXJpYWxpemUuCiAqIEByZXR1cm4geyFwcm90by5wYi5PcFJlY29yZH0KICovCgoKcHJvdG8ucGIuT3BSZWNvcmQuZGVzZXJpYWxpemVCaW5hcnkgPSBmdW5jdGlvbiAoYnl0ZXMpIHsKICB2YXIgcmVhZGVyID0gbmV3IGpzcGIuQmluYXJ5UmVhZGVyKGJ5dGVzKTsKICB2YXIgbXNnID0gbmV3IHByb3RvLnBiLk9wUmVjb3JkKCk7CiAgcmV0dXJuIHByb3RvLnBiLk9wUmVjb3JkLmRlc2VyaWFsaXplQmluYXJ5RnJvbVJlYWRlcihtc2csIHJlYWRlcik7Cn07Ci8qKgogKiBEZXNlcmlhbGl6ZXMgYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUgZm9ybWF0KSBmcm9tIHRoZQogKiBnaXZlbiByZWFkZXIgaW50byB0aGUgZ2l2ZW4gbWVzc2FnZSBvYmplY3QuCiAqIEBwYXJhbSB7IXByb3RvLnBiLk9wUmVjb3JkfSBtc2cgVGhlIG1lc3NhZ2Ugb2JqZWN0IHRvIGRlc2VyaWFsaXplIGludG8uCiAqIEBwYXJhbSB7IWpzcGIuQmluYXJ5UmVhZGVyfSByZWFkZXIgVGhlIEJpbmFyeVJlYWRlciB0byB1c2UuCiAqIEByZXR1cm4geyFwcm90by5wYi5PcFJlY29yZH0KICovCgoKcHJvdG8ucGIuT3BSZWNvcmQuZGVzZXJpYWxpemVCaW5hcnlGcm9tUmVhZGVyID0gZnVuY3Rpb24gKG1zZywgcmVhZGVyKSB7CiAgd2hpbGUgKHJlYWRlci5uZXh0RmllbGQoKSkgewogICAgaWYgKHJlYWRlci5pc0VuZEdyb3VwKCkpIHsKICAgICAgYnJlYWs7CiAgICB9CgogICAgdmFyIGZpZWxkID0gcmVhZGVyLmdldEZpZWxkTnVtYmVyKCk7CgogICAgc3dpdGNoIChmaWVsZCkgewogICAgICBjYXNlIDE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50NjQoKTsKICAgICAgICBtc2cuc2V0SWQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAyOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldEFkbWluSWQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAzOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldEVtYWlsKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNDoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXRBcGlQYXRoKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXREZXNjKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRTcGVudE1zKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNzoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXRJcCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDg6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0UmVxdWVzdERhdGEodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA5OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldE1ldGFkYXRhKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTA6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0UmVwbHlEYXRhKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0RXJyb3JEYXRhKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjA6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0Q3JlYXRlZEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmVhZGVyLnNraXBGaWVsZCgpOwogICAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgcmV0dXJuIG1zZzsKfTsKLyoqCiAqIFNlcmlhbGl6ZXMgdGhlIG1lc3NhZ2UgdG8gYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUgZm9ybWF0KS4KICogQHJldHVybiB7IVVpbnQ4QXJyYXl9CiAqLwoKCnByb3RvLnBiLk9wUmVjb3JkLnByb3RvdHlwZS5zZXJpYWxpemVCaW5hcnkgPSBmdW5jdGlvbiAoKSB7CiAgdmFyIHdyaXRlciA9IG5ldyBqc3BiLkJpbmFyeVdyaXRlcigpOwogIHByb3RvLnBiLk9wUmVjb3JkLnNlcmlhbGl6ZUJpbmFyeVRvV3JpdGVyKHRoaXMsIHdyaXRlcik7CiAgcmV0dXJuIHdyaXRlci5nZXRSZXN1bHRCdWZmZXIoKTsKfTsKLyoqCiAqIFNlcmlhbGl6ZXMgdGhlIGdpdmVuIG1lc3NhZ2UgdG8gYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUKICogZm9ybWF0KSwgd3JpdGluZyB0byB0aGUgZ2l2ZW4gQmluYXJ5V3JpdGVyLgogKiBAcGFyYW0geyFwcm90by5wYi5PcFJlY29yZH0gbWVzc2FnZQogKiBAcGFyYW0geyFqc3BiLkJpbmFyeVdyaXRlcn0gd3JpdGVyCiAqIEBzdXBwcmVzcyB7dW51c2VkTG9jYWxWYXJpYWJsZXN9IGYgaXMgb25seSB1c2VkIGZvciBuZXN0ZWQgbWVzc2FnZXMKICovCgoKcHJvdG8ucGIuT3BSZWNvcmQuc2VyaWFsaXplQmluYXJ5VG9Xcml0ZXIgPSBmdW5jdGlvbiAobWVzc2FnZSwgd3JpdGVyKSB7CiAgdmFyIGYgPSB1bmRlZmluZWQ7CiAgZiA9IG1lc3NhZ2UuZ2V0SWQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQ2NCgxLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEFkbWluSWQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigyLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEVtYWlsKCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZygzLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEFwaVBhdGgoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDQsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0RGVzYygpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoNSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRTcGVudE1zKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoNiwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRJcCgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoNywgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRSZXF1ZXN0RGF0YSgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoOCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRNZXRhZGF0YSgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoOSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRSZXBseURhdGEoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDEwLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEVycm9yRGF0YSgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoMTEsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0Q3JlYXRlZEF0KCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMjAsIGYpOwogIH0KfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQ2NCBpZCA9IDE7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuT3BSZWNvcmQucHJvdG90eXBlLmdldElkID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuT3BSZWNvcmR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5PcFJlY29yZC5wcm90b3R5cGUuc2V0SWQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDEsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBhZG1pbl9pZCA9IDI7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuT3BSZWNvcmQucHJvdG90eXBlLmdldEFkbWluSWQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDIsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5PcFJlY29yZH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLk9wUmVjb3JkLnByb3RvdHlwZS5zZXRBZG1pbklkID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAyLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgZW1haWwgPSAzOwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLk9wUmVjb3JkLnByb3RvdHlwZS5nZXRFbWFpbCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMywgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5PcFJlY29yZH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLk9wUmVjb3JkLnByb3RvdHlwZS5zZXRFbWFpbCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgMywgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIGFwaV9wYXRoID0gNDsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5PcFJlY29yZC5wcm90b3R5cGUuZ2V0QXBpUGF0aCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgNCwgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5PcFJlY29yZH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLk9wUmVjb3JkLnByb3RvdHlwZS5zZXRBcGlQYXRoID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCA0LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgZGVzYyA9IDU7CiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKcHJvdG8ucGIuT3BSZWNvcmQucHJvdG90eXBlLmdldERlc2MgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDUsICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuT3BSZWNvcmR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5PcFJlY29yZC5wcm90b3R5cGUuc2V0RGVzYyA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgNSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIHNwZW50X21zID0gNjsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5PcFJlY29yZC5wcm90b3R5cGUuZ2V0U3BlbnRNcyA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgNiwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLk9wUmVjb3JkfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuT3BSZWNvcmQucHJvdG90eXBlLnNldFNwZW50TXMgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDYsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyBpcCA9IDc7CiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKcHJvdG8ucGIuT3BSZWNvcmQucHJvdG90eXBlLmdldElwID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA3LCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLk9wUmVjb3JkfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuT3BSZWNvcmQucHJvdG90eXBlLnNldElwID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCA3LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgcmVxdWVzdF9kYXRhID0gODsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5PcFJlY29yZC5wcm90b3R5cGUuZ2V0UmVxdWVzdERhdGEgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDgsICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuT3BSZWNvcmR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5PcFJlY29yZC5wcm90b3R5cGUuc2V0UmVxdWVzdERhdGEgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDgsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyBtZXRhZGF0YSA9IDk7CiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKcHJvdG8ucGIuT3BSZWNvcmQucHJvdG90eXBlLmdldE1ldGFkYXRhID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA5LCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLk9wUmVjb3JkfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuT3BSZWNvcmQucHJvdG90eXBlLnNldE1ldGFkYXRhID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCA5LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgcmVwbHlfZGF0YSA9IDEwOwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLk9wUmVjb3JkLnByb3RvdHlwZS5nZXRSZXBseURhdGEgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDEwLCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLk9wUmVjb3JkfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuT3BSZWNvcmQucHJvdG90eXBlLnNldFJlcGx5RGF0YSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgMTAsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyBlcnJvcl9kYXRhID0gMTE7CiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKcHJvdG8ucGIuT3BSZWNvcmQucHJvdG90eXBlLmdldEVycm9yRGF0YSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMTEsICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuT3BSZWNvcmR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5PcFJlY29yZC5wcm90b3R5cGUuc2V0RXJyb3JEYXRhID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCAxMSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGNyZWF0ZWRfYXQgPSAyMDsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5PcFJlY29yZC5wcm90b3R5cGUuZ2V0Q3JlYXRlZEF0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAyMCwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLk9wUmVjb3JkfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuT3BSZWNvcmQucHJvdG90eXBlLnNldENyZWF0ZWRBdCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMjAsIHZhbHVlKTsKfTsKCmlmIChqc3BiLk1lc3NhZ2UuR0VORVJBVEVfVE9fT0JKRUNUKSB7CiAgLyoqCiAgICogQ3JlYXRlcyBhbiBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBwcm90by4KICAgKiBGaWVsZCBuYW1lcyB0aGF0IGFyZSByZXNlcnZlZCBpbiBKYXZhU2NyaXB0IGFuZCB3aWxsIGJlIHJlbmFtZWQgdG8gcGJfbmFtZS4KICAgKiBPcHRpb25hbCBmaWVsZHMgdGhhdCBhcmUgbm90IHNldCB3aWxsIGJlIHNldCB0byB1bmRlZmluZWQuCiAgICogVG8gYWNjZXNzIGEgcmVzZXJ2ZWQgZmllbGQgdXNlLCBmb28ucGJfPG5hbWU+LCBlZywgZm9vLnBiX2RlZmF1bHQuCiAgICogRm9yIHRoZSBsaXN0IG9mIHJlc2VydmVkIG5hbWVzIHBsZWFzZSBzZWU6CiAgICogICAgIG5ldC9wcm90bzIvY29tcGlsZXIvanMvaW50ZXJuYWwvZ2VuZXJhdG9yLmNjI2tLZXl3b3JkLgogICAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF9pbmNsdWRlSW5zdGFuY2UgRGVwcmVjYXRlZC4gd2hldGhlciB0byBpbmNsdWRlIHRoZQogICAqICAgICBKU1BCIGluc3RhbmNlIGZvciB0cmFuc2l0aW9uYWwgc295IHByb3RvIHN1cHBvcnQ6CiAgICogICAgIGh0dHA6Ly9nb3RvL3NveS1wYXJhbS1taWdyYXRpb24KICAgKiBAcmV0dXJuIHshT2JqZWN0fQogICAqLwogIHByb3RvLnBiLkluc3RhbGwucHJvdG90eXBlLnRvT2JqZWN0ID0gZnVuY3Rpb24gKG9wdF9pbmNsdWRlSW5zdGFuY2UpIHsKICAgIHJldHVybiBwcm90by5wYi5JbnN0YWxsLnRvT2JqZWN0KG9wdF9pbmNsdWRlSW5zdGFuY2UsIHRoaXMpOwogIH07CiAgLyoqCiAgICogU3RhdGljIHZlcnNpb24gb2YgdGhlIHtAc2VlIHRvT2JqZWN0fSBtZXRob2QuCiAgICogQHBhcmFtIHtib29sZWFufHVuZGVmaW5lZH0gaW5jbHVkZUluc3RhbmNlIERlcHJlY2F0ZWQuIFdoZXRoZXIgdG8gaW5jbHVkZQogICAqICAgICB0aGUgSlNQQiBpbnN0YW5jZSBmb3IgdHJhbnNpdGlvbmFsIHNveSBwcm90byBzdXBwb3J0OgogICAqICAgICBodHRwOi8vZ290by9zb3ktcGFyYW0tbWlncmF0aW9uCiAgICogQHBhcmFtIHshcHJvdG8ucGIuSW5zdGFsbH0gbXNnIFRoZSBtc2cgaW5zdGFuY2UgdG8gdHJhbnNmb3JtLgogICAqIEByZXR1cm4geyFPYmplY3R9CiAgICogQHN1cHByZXNzIHt1bnVzZWRMb2NhbFZhcmlhYmxlc30gZiBpcyBvbmx5IHVzZWQgZm9yIG5lc3RlZCBtZXNzYWdlcwogICAqLwoKCiAgcHJvdG8ucGIuSW5zdGFsbC50b09iamVjdCA9IGZ1bmN0aW9uIChpbmNsdWRlSW5zdGFuY2UsIG1zZykgewogICAgdmFyIGYsCiAgICAgICAgb2JqID0gewogICAgICBpZDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxLCAwKSwKICAgICAgYXBwSWQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMiwgMCksCiAgICAgIGRldmljZUlkOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDMsICIiKSwKICAgICAgdHJhY2tlclRva2VuOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDQsICIiKSwKICAgICAgdHJhY2tlck5hbWU6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNSwgIiIpLAogICAgICBuZXR3b3JrOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDYsICIiKSwKICAgICAgY2FtcGFpZ246IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNywgIiIpLAogICAgICBhZGdyb3VwOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDgsICIiKSwKICAgICAgY3JlYXRpdmU6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgOSwgIiIpLAogICAgICBjbGlja0xhYmVsOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDEwLCAiIiksCiAgICAgIGFkaWQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMTEsICIiKSwKICAgICAgY29zdFR5cGU6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMTIsICIiKSwKICAgICAgY29zdEFtb3VudDoganNwYi5NZXNzYWdlLmdldEZsb2F0aW5nUG9pbnRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMTMsIDAuMCksCiAgICAgIGNvc3RDdXJyZW5jeToganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxNCwgIiIpLAogICAgICB1cGRhdGVkQXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjAsIDApLAogICAgICBjcmVhdGVkQXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjEsIDApCiAgICB9OwoKICAgIGlmIChpbmNsdWRlSW5zdGFuY2UpIHsKICAgICAgb2JqLiRqc3BiTWVzc2FnZUluc3RhbmNlID0gbXNnOwogICAgfQoKICAgIHJldHVybiBvYmo7CiAgfTsKfQovKioKICogRGVzZXJpYWxpemVzIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkuCiAqIEBwYXJhbSB7anNwYi5CeXRlU291cmNlfSBieXRlcyBUaGUgYnl0ZXMgdG8gZGVzZXJpYWxpemUuCiAqIEByZXR1cm4geyFwcm90by5wYi5JbnN0YWxsfQogKi8KCgpwcm90by5wYi5JbnN0YWxsLmRlc2VyaWFsaXplQmluYXJ5ID0gZnVuY3Rpb24gKGJ5dGVzKSB7CiAgdmFyIHJlYWRlciA9IG5ldyBqc3BiLkJpbmFyeVJlYWRlcihieXRlcyk7CiAgdmFyIG1zZyA9IG5ldyBwcm90by5wYi5JbnN0YWxsKCk7CiAgcmV0dXJuIHByb3RvLnBiLkluc3RhbGwuZGVzZXJpYWxpemVCaW5hcnlGcm9tUmVhZGVyKG1zZywgcmVhZGVyKTsKfTsKLyoqCiAqIERlc2VyaWFsaXplcyBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZSBmb3JtYXQpIGZyb20gdGhlCiAqIGdpdmVuIHJlYWRlciBpbnRvIHRoZSBnaXZlbiBtZXNzYWdlIG9iamVjdC4KICogQHBhcmFtIHshcHJvdG8ucGIuSW5zdGFsbH0gbXNnIFRoZSBtZXNzYWdlIG9iamVjdCB0byBkZXNlcmlhbGl6ZSBpbnRvLgogKiBAcGFyYW0geyFqc3BiLkJpbmFyeVJlYWRlcn0gcmVhZGVyIFRoZSBCaW5hcnlSZWFkZXIgdG8gdXNlLgogKiBAcmV0dXJuIHshcHJvdG8ucGIuSW5zdGFsbH0KICovCgoKcHJvdG8ucGIuSW5zdGFsbC5kZXNlcmlhbGl6ZUJpbmFyeUZyb21SZWFkZXIgPSBmdW5jdGlvbiAobXNnLCByZWFkZXIpIHsKICB3aGlsZSAocmVhZGVyLm5leHRGaWVsZCgpKSB7CiAgICBpZiAocmVhZGVyLmlzRW5kR3JvdXAoKSkgewogICAgICBicmVhazsKICAgIH0KCiAgICB2YXIgZmllbGQgPSByZWFkZXIuZ2V0RmllbGROdW1iZXIoKTsKCiAgICBzd2l0Y2ggKGZpZWxkKSB7CiAgICAgIGNhc2UgMToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRJZCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDI6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0QXBwSWQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAzOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldERldmljZUlkKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNDoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXRUcmFja2VyVG9rZW4odmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA1OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldFRyYWNrZXJOYW1lKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXROZXR3b3JrKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNzoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXRDYW1wYWlnbih2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDg6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0QWRncm91cCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDk6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0Q3JlYXRpdmUodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAxMDoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXRDbGlja0xhYmVsKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0QWRpZCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDEyOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldENvc3RUeXBlKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTM6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRGbG9hdCgpOwogICAgICAgIG1zZy5zZXRDb3N0QW1vdW50KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTQ6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0Q29zdEN1cnJlbmN5KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjA6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0VXBkYXRlZEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0Q3JlYXRlZEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmVhZGVyLnNraXBGaWVsZCgpOwogICAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgcmV0dXJuIG1zZzsKfTsKLyoqCiAqIFNlcmlhbGl6ZXMgdGhlIG1lc3NhZ2UgdG8gYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUgZm9ybWF0KS4KICogQHJldHVybiB7IVVpbnQ4QXJyYXl9CiAqLwoKCnByb3RvLnBiLkluc3RhbGwucHJvdG90eXBlLnNlcmlhbGl6ZUJpbmFyeSA9IGZ1bmN0aW9uICgpIHsKICB2YXIgd3JpdGVyID0gbmV3IGpzcGIuQmluYXJ5V3JpdGVyKCk7CiAgcHJvdG8ucGIuSW5zdGFsbC5zZXJpYWxpemVCaW5hcnlUb1dyaXRlcih0aGlzLCB3cml0ZXIpOwogIHJldHVybiB3cml0ZXIuZ2V0UmVzdWx0QnVmZmVyKCk7Cn07Ci8qKgogKiBTZXJpYWxpemVzIHRoZSBnaXZlbiBtZXNzYWdlIHRvIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlCiAqIGZvcm1hdCksIHdyaXRpbmcgdG8gdGhlIGdpdmVuIEJpbmFyeVdyaXRlci4KICogQHBhcmFtIHshcHJvdG8ucGIuSW5zdGFsbH0gbWVzc2FnZQogKiBAcGFyYW0geyFqc3BiLkJpbmFyeVdyaXRlcn0gd3JpdGVyCiAqIEBzdXBwcmVzcyB7dW51c2VkTG9jYWxWYXJpYWJsZXN9IGYgaXMgb25seSB1c2VkIGZvciBuZXN0ZWQgbWVzc2FnZXMKICovCgoKcHJvdG8ucGIuSW5zdGFsbC5zZXJpYWxpemVCaW5hcnlUb1dyaXRlciA9IGZ1bmN0aW9uIChtZXNzYWdlLCB3cml0ZXIpIHsKICB2YXIgZiA9IHVuZGVmaW5lZDsKICBmID0gbWVzc2FnZS5nZXRJZCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDEsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0QXBwSWQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigyLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldERldmljZUlkKCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZygzLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldFRyYWNrZXJUb2tlbigpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoNCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRUcmFja2VyTmFtZSgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoNSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXROZXR3b3JrKCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZyg2LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldENhbXBhaWduKCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZyg3LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEFkZ3JvdXAoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDgsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0Q3JlYXRpdmUoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDksIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0Q2xpY2tMYWJlbCgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoMTAsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0QWRpZCgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoMTEsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0Q29zdFR5cGUoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDEyLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldENvc3RBbW91bnQoKTsKCiAgaWYgKGYgIT09IDAuMCkgewogICAgd3JpdGVyLndyaXRlRmxvYXQoMTMsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0Q29zdEN1cnJlbmN5KCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZygxNCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRVcGRhdGVkQXQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigyMCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRDcmVhdGVkQXQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigyMSwgZik7CiAgfQp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGlkID0gMTsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5JbnN0YWxsLnByb3RvdHlwZS5nZXRJZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMSwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkluc3RhbGx9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5JbnN0YWxsLnByb3RvdHlwZS5zZXRJZCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGFwcF9pZCA9IDI7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuSW5zdGFsbC5wcm90b3R5cGUuZ2V0QXBwSWQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDIsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5JbnN0YWxsfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuSW5zdGFsbC5wcm90b3R5cGUuc2V0QXBwSWQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDIsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyBkZXZpY2VfaWQgPSAzOwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLkluc3RhbGwucHJvdG90eXBlLmdldERldmljZUlkID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAzLCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkluc3RhbGx9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5JbnN0YWxsLnByb3RvdHlwZS5zZXREZXZpY2VJZCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgMywgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIHRyYWNrZXJfdG9rZW4gPSA0OwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLkluc3RhbGwucHJvdG90eXBlLmdldFRyYWNrZXJUb2tlbiA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgNCwgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5JbnN0YWxsfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuSW5zdGFsbC5wcm90b3R5cGUuc2V0VHJhY2tlclRva2VuID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCA0LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgdHJhY2tlcl9uYW1lID0gNTsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5JbnN0YWxsLnByb3RvdHlwZS5nZXRUcmFja2VyTmFtZSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgNSwgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5JbnN0YWxsfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuSW5zdGFsbC5wcm90b3R5cGUuc2V0VHJhY2tlck5hbWUgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDUsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyBuZXR3b3JrID0gNjsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5JbnN0YWxsLnByb3RvdHlwZS5nZXROZXR3b3JrID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA2LCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkluc3RhbGx9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5JbnN0YWxsLnByb3RvdHlwZS5zZXROZXR3b3JrID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCA2LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgY2FtcGFpZ24gPSA3OwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLkluc3RhbGwucHJvdG90eXBlLmdldENhbXBhaWduID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA3LCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkluc3RhbGx9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5JbnN0YWxsLnByb3RvdHlwZS5zZXRDYW1wYWlnbiA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgNywgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIGFkZ3JvdXAgPSA4OwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLkluc3RhbGwucHJvdG90eXBlLmdldEFkZ3JvdXAgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDgsICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuSW5zdGFsbH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkluc3RhbGwucHJvdG90eXBlLnNldEFkZ3JvdXAgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDgsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyBjcmVhdGl2ZSA9IDk7CiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKcHJvdG8ucGIuSW5zdGFsbC5wcm90b3R5cGUuZ2V0Q3JlYXRpdmUgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDksICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuSW5zdGFsbH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkluc3RhbGwucHJvdG90eXBlLnNldENyZWF0aXZlID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCA5LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgY2xpY2tfbGFiZWwgPSAxMDsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5JbnN0YWxsLnByb3RvdHlwZS5nZXRDbGlja0xhYmVsID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxMCwgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5JbnN0YWxsfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuSW5zdGFsbC5wcm90b3R5cGUuc2V0Q2xpY2tMYWJlbCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgMTAsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyBhZGlkID0gMTE7CiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKcHJvdG8ucGIuSW5zdGFsbC5wcm90b3R5cGUuZ2V0QWRpZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMTEsICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuSW5zdGFsbH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkluc3RhbGwucHJvdG90eXBlLnNldEFkaWQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDExLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgY29zdF90eXBlID0gMTI7CiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKcHJvdG8ucGIuSW5zdGFsbC5wcm90b3R5cGUuZ2V0Q29zdFR5cGUgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDEyLCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkluc3RhbGx9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5JbnN0YWxsLnByb3RvdHlwZS5zZXRDb3N0VHlwZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgMTIsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIGZsb2F0IGNvc3RfYW1vdW50ID0gMTM7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuSW5zdGFsbC5wcm90b3R5cGUuZ2V0Q29zdEFtb3VudCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZsb2F0aW5nUG9pbnRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDEzLCAwLjApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5JbnN0YWxsfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuSW5zdGFsbC5wcm90b3R5cGUuc2V0Q29zdEFtb3VudCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zRmxvYXRGaWVsZCh0aGlzLCAxMywgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIGNvc3RfY3VycmVuY3kgPSAxNDsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5JbnN0YWxsLnByb3RvdHlwZS5nZXRDb3N0Q3VycmVuY3kgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDE0LCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkluc3RhbGx9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5JbnN0YWxsLnByb3RvdHlwZS5zZXRDb3N0Q3VycmVuY3kgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDE0LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgdXBkYXRlZF9hdCA9IDIwOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkluc3RhbGwucHJvdG90eXBlLmdldFVwZGF0ZWRBdCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMjAsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5JbnN0YWxsfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuSW5zdGFsbC5wcm90b3R5cGUuc2V0VXBkYXRlZEF0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAyMCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGNyZWF0ZWRfYXQgPSAyMTsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5JbnN0YWxsLnByb3RvdHlwZS5nZXRDcmVhdGVkQXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDIxLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuSW5zdGFsbH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkluc3RhbGwucHJvdG90eXBlLnNldENyZWF0ZWRBdCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMjEsIHZhbHVlKTsKfTsKCmlmIChqc3BiLk1lc3NhZ2UuR0VORVJBVEVfVE9fT0JKRUNUKSB7CiAgLyoqCiAgICogQ3JlYXRlcyBhbiBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBwcm90by4KICAgKiBGaWVsZCBuYW1lcyB0aGF0IGFyZSByZXNlcnZlZCBpbiBKYXZhU2NyaXB0IGFuZCB3aWxsIGJlIHJlbmFtZWQgdG8gcGJfbmFtZS4KICAgKiBPcHRpb25hbCBmaWVsZHMgdGhhdCBhcmUgbm90IHNldCB3aWxsIGJlIHNldCB0byB1bmRlZmluZWQuCiAgICogVG8gYWNjZXNzIGEgcmVzZXJ2ZWQgZmllbGQgdXNlLCBmb28ucGJfPG5hbWU+LCBlZywgZm9vLnBiX2RlZmF1bHQuCiAgICogRm9yIHRoZSBsaXN0IG9mIHJlc2VydmVkIG5hbWVzIHBsZWFzZSBzZWU6CiAgICogICAgIG5ldC9wcm90bzIvY29tcGlsZXIvanMvaW50ZXJuYWwvZ2VuZXJhdG9yLmNjI2tLZXl3b3JkLgogICAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF9pbmNsdWRlSW5zdGFuY2UgRGVwcmVjYXRlZC4gd2hldGhlciB0byBpbmNsdWRlIHRoZQogICAqICAgICBKU1BCIGluc3RhbmNlIGZvciB0cmFuc2l0aW9uYWwgc295IHByb3RvIHN1cHBvcnQ6CiAgICogICAgIGh0dHA6Ly9nb3RvL3NveS1wYXJhbS1taWdyYXRpb24KICAgKiBAcmV0dXJuIHshT2JqZWN0fQogICAqLwogIHByb3RvLnBiLkd1aWxkLnByb3RvdHlwZS50b09iamVjdCA9IGZ1bmN0aW9uIChvcHRfaW5jbHVkZUluc3RhbmNlKSB7CiAgICByZXR1cm4gcHJvdG8ucGIuR3VpbGQudG9PYmplY3Qob3B0X2luY2x1ZGVJbnN0YW5jZSwgdGhpcyk7CiAgfTsKICAvKioKICAgKiBTdGF0aWMgdmVyc2lvbiBvZiB0aGUge0BzZWUgdG9PYmplY3R9IG1ldGhvZC4KICAgKiBAcGFyYW0ge2Jvb2xlYW58dW5kZWZpbmVkfSBpbmNsdWRlSW5zdGFuY2UgRGVwcmVjYXRlZC4gV2hldGhlciB0byBpbmNsdWRlCiAgICogICAgIHRoZSBKU1BCIGluc3RhbmNlIGZvciB0cmFuc2l0aW9uYWwgc295IHByb3RvIHN1cHBvcnQ6CiAgICogICAgIGh0dHA6Ly9nb3RvL3NveS1wYXJhbS1taWdyYXRpb24KICAgKiBAcGFyYW0geyFwcm90by5wYi5HdWlsZH0gbXNnIFRoZSBtc2cgaW5zdGFuY2UgdG8gdHJhbnNmb3JtLgogICAqIEByZXR1cm4geyFPYmplY3R9CiAgICogQHN1cHByZXNzIHt1bnVzZWRMb2NhbFZhcmlhYmxlc30gZiBpcyBvbmx5IHVzZWQgZm9yIG5lc3RlZCBtZXNzYWdlcwogICAqLwoKCiAgcHJvdG8ucGIuR3VpbGQudG9PYmplY3QgPSBmdW5jdGlvbiAoaW5jbHVkZUluc3RhbmNlLCBtc2cpIHsKICAgIHZhciBmLAogICAgICAgIG9iaiA9IHsKICAgICAgaWQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMSwgMCksCiAgICAgIGFyZWFJZDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAyLCAwKSwKICAgICAgbmFtZToganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAzLCAiIiksCiAgICAgIGludml0ZUNvZGU6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNCwgIiIpLAogICAgICBhbmNob3JDb3VudDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA1LCAwKSwKICAgICAgZW5hYmxlOiBqc3BiLk1lc3NhZ2UuZ2V0Qm9vbGVhbkZpZWxkV2l0aERlZmF1bHQobXNnLCA2LCBmYWxzZSksCiAgICAgIG5vdGU6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNywgIiIpLAogICAgICB1cGRhdGVkQXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjAsIDApLAogICAgICBjcmVhdGVkQXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjEsIDApCiAgICB9OwoKICAgIGlmIChpbmNsdWRlSW5zdGFuY2UpIHsKICAgICAgb2JqLiRqc3BiTWVzc2FnZUluc3RhbmNlID0gbXNnOwogICAgfQoKICAgIHJldHVybiBvYmo7CiAgfTsKfQovKioKICogRGVzZXJpYWxpemVzIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkuCiAqIEBwYXJhbSB7anNwYi5CeXRlU291cmNlfSBieXRlcyBUaGUgYnl0ZXMgdG8gZGVzZXJpYWxpemUuCiAqIEByZXR1cm4geyFwcm90by5wYi5HdWlsZH0KICovCgoKcHJvdG8ucGIuR3VpbGQuZGVzZXJpYWxpemVCaW5hcnkgPSBmdW5jdGlvbiAoYnl0ZXMpIHsKICB2YXIgcmVhZGVyID0gbmV3IGpzcGIuQmluYXJ5UmVhZGVyKGJ5dGVzKTsKICB2YXIgbXNnID0gbmV3IHByb3RvLnBiLkd1aWxkKCk7CiAgcmV0dXJuIHByb3RvLnBiLkd1aWxkLmRlc2VyaWFsaXplQmluYXJ5RnJvbVJlYWRlcihtc2csIHJlYWRlcik7Cn07Ci8qKgogKiBEZXNlcmlhbGl6ZXMgYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUgZm9ybWF0KSBmcm9tIHRoZQogKiBnaXZlbiByZWFkZXIgaW50byB0aGUgZ2l2ZW4gbWVzc2FnZSBvYmplY3QuCiAqIEBwYXJhbSB7IXByb3RvLnBiLkd1aWxkfSBtc2cgVGhlIG1lc3NhZ2Ugb2JqZWN0IHRvIGRlc2VyaWFsaXplIGludG8uCiAqIEBwYXJhbSB7IWpzcGIuQmluYXJ5UmVhZGVyfSByZWFkZXIgVGhlIEJpbmFyeVJlYWRlciB0byB1c2UuCiAqIEByZXR1cm4geyFwcm90by5wYi5HdWlsZH0KICovCgoKcHJvdG8ucGIuR3VpbGQuZGVzZXJpYWxpemVCaW5hcnlGcm9tUmVhZGVyID0gZnVuY3Rpb24gKG1zZywgcmVhZGVyKSB7CiAgd2hpbGUgKHJlYWRlci5uZXh0RmllbGQoKSkgewogICAgaWYgKHJlYWRlci5pc0VuZEdyb3VwKCkpIHsKICAgICAgYnJlYWs7CiAgICB9CgogICAgdmFyIGZpZWxkID0gcmVhZGVyLmdldEZpZWxkTnVtYmVyKCk7CgogICAgc3dpdGNoIChmaWVsZCkgewogICAgICBjYXNlIDE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0SWQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAyOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldEFyZWFJZCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDM6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0TmFtZSh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDQ6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0SW52aXRlQ29kZSh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDU6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0QW5jaG9yQ291bnQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA2OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkQm9vbCgpOwogICAgICAgIG1zZy5zZXRFbmFibGUodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA3OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldE5vdGUodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAyMDoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRVcGRhdGVkQXQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAyMToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRDcmVhdGVkQXQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgZGVmYXVsdDoKICAgICAgICByZWFkZXIuc2tpcEZpZWxkKCk7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfQoKICByZXR1cm4gbXNnOwp9OwovKioKICogU2VyaWFsaXplcyB0aGUgbWVzc2FnZSB0byBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZSBmb3JtYXQpLgogKiBAcmV0dXJuIHshVWludDhBcnJheX0KICovCgoKcHJvdG8ucGIuR3VpbGQucHJvdG90eXBlLnNlcmlhbGl6ZUJpbmFyeSA9IGZ1bmN0aW9uICgpIHsKICB2YXIgd3JpdGVyID0gbmV3IGpzcGIuQmluYXJ5V3JpdGVyKCk7CiAgcHJvdG8ucGIuR3VpbGQuc2VyaWFsaXplQmluYXJ5VG9Xcml0ZXIodGhpcywgd3JpdGVyKTsKICByZXR1cm4gd3JpdGVyLmdldFJlc3VsdEJ1ZmZlcigpOwp9OwovKioKICogU2VyaWFsaXplcyB0aGUgZ2l2ZW4gbWVzc2FnZSB0byBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZQogKiBmb3JtYXQpLCB3cml0aW5nIHRvIHRoZSBnaXZlbiBCaW5hcnlXcml0ZXIuCiAqIEBwYXJhbSB7IXByb3RvLnBiLkd1aWxkfSBtZXNzYWdlCiAqIEBwYXJhbSB7IWpzcGIuQmluYXJ5V3JpdGVyfSB3cml0ZXIKICogQHN1cHByZXNzIHt1bnVzZWRMb2NhbFZhcmlhYmxlc30gZiBpcyBvbmx5IHVzZWQgZm9yIG5lc3RlZCBtZXNzYWdlcwogKi8KCgpwcm90by5wYi5HdWlsZC5zZXJpYWxpemVCaW5hcnlUb1dyaXRlciA9IGZ1bmN0aW9uIChtZXNzYWdlLCB3cml0ZXIpIHsKICB2YXIgZiA9IHVuZGVmaW5lZDsKICBmID0gbWVzc2FnZS5nZXRJZCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDEsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0QXJlYUlkKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMiwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXROYW1lKCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZygzLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEludml0ZUNvZGUoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDQsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0QW5jaG9yQ291bnQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMig1LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEVuYWJsZSgpOwoKICBpZiAoZikgewogICAgd3JpdGVyLndyaXRlQm9vbCg2LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldE5vdGUoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDcsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0VXBkYXRlZEF0KCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMjAsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0Q3JlYXRlZEF0KCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMjEsIGYpOwogIH0KfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBpZCA9IDE7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuR3VpbGQucHJvdG90eXBlLmdldElkID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuR3VpbGR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5HdWlsZC5wcm90b3R5cGUuc2V0SWQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDEsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBhcmVhX2lkID0gMjsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5HdWlsZC5wcm90b3R5cGUuZ2V0QXJlYUlkID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAyLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuR3VpbGR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5HdWlsZC5wcm90b3R5cGUuc2V0QXJlYUlkID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAyLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgbmFtZSA9IDM7CiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKcHJvdG8ucGIuR3VpbGQucHJvdG90eXBlLmdldE5hbWUgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDMsICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuR3VpbGR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5HdWlsZC5wcm90b3R5cGUuc2V0TmFtZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgMywgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIGludml0ZV9jb2RlID0gNDsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5HdWlsZC5wcm90b3R5cGUuZ2V0SW52aXRlQ29kZSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgNCwgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5HdWlsZH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkd1aWxkLnByb3RvdHlwZS5zZXRJbnZpdGVDb2RlID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCA0LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgYW5jaG9yX2NvdW50ID0gNTsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5HdWlsZC5wcm90b3R5cGUuZ2V0QW5jaG9yQ291bnQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDUsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5HdWlsZH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkd1aWxkLnByb3RvdHlwZS5zZXRBbmNob3JDb3VudCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgNSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgYm9vbCBlbmFibGUgPSA2OwogKiBAcmV0dXJuIHtib29sZWFufQogKi8KCgpwcm90by5wYi5HdWlsZC5wcm90b3R5cGUuZ2V0RW5hYmxlID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0Qm9vbGVhbkZpZWxkV2l0aERlZmF1bHQodGhpcywgNiwgZmFsc2UpOwp9OwovKioKICogQHBhcmFtIHtib29sZWFufSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuR3VpbGR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5HdWlsZC5wcm90b3R5cGUuc2V0RW5hYmxlID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNCb29sZWFuRmllbGQodGhpcywgNiwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIG5vdGUgPSA3OwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLkd1aWxkLnByb3RvdHlwZS5nZXROb3RlID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA3LCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkd1aWxkfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuR3VpbGQucHJvdG90eXBlLnNldE5vdGUgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDcsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiB1cGRhdGVkX2F0ID0gMjA7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuR3VpbGQucHJvdG90eXBlLmdldFVwZGF0ZWRBdCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMjAsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5HdWlsZH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkd1aWxkLnByb3RvdHlwZS5zZXRVcGRhdGVkQXQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDIwLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgY3JlYXRlZF9hdCA9IDIxOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkd1aWxkLnByb3RvdHlwZS5nZXRDcmVhdGVkQXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDIxLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuR3VpbGR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5HdWlsZC5wcm90b3R5cGUuc2V0Q3JlYXRlZEF0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAyMSwgdmFsdWUpOwp9OwovKioKICogTGlzdCBvZiByZXBlYXRlZCBmaWVsZHMgd2l0aGluIHRoaXMgbWVzc2FnZSB0eXBlLgogKiBAcHJpdmF0ZSB7IUFycmF5PG51bWJlcj59CiAqIEBjb25zdAogKi8KCgpwcm90by5wYi5BcHAucmVwZWF0ZWRGaWVsZHNfID0gWzExXTsKCmlmIChqc3BiLk1lc3NhZ2UuR0VORVJBVEVfVE9fT0JKRUNUKSB7CiAgLyoqCiAgICogQ3JlYXRlcyBhbiBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBwcm90by4KICAgKiBGaWVsZCBuYW1lcyB0aGF0IGFyZSByZXNlcnZlZCBpbiBKYXZhU2NyaXB0IGFuZCB3aWxsIGJlIHJlbmFtZWQgdG8gcGJfbmFtZS4KICAgKiBPcHRpb25hbCBmaWVsZHMgdGhhdCBhcmUgbm90IHNldCB3aWxsIGJlIHNldCB0byB1bmRlZmluZWQuCiAgICogVG8gYWNjZXNzIGEgcmVzZXJ2ZWQgZmllbGQgdXNlLCBmb28ucGJfPG5hbWU+LCBlZywgZm9vLnBiX2RlZmF1bHQuCiAgICogRm9yIHRoZSBsaXN0IG9mIHJlc2VydmVkIG5hbWVzIHBsZWFzZSBzZWU6CiAgICogICAgIG5ldC9wcm90bzIvY29tcGlsZXIvanMvaW50ZXJuYWwvZ2VuZXJhdG9yLmNjI2tLZXl3b3JkLgogICAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF9pbmNsdWRlSW5zdGFuY2UgRGVwcmVjYXRlZC4gd2hldGhlciB0byBpbmNsdWRlIHRoZQogICAqICAgICBKU1BCIGluc3RhbmNlIGZvciB0cmFuc2l0aW9uYWwgc295IHByb3RvIHN1cHBvcnQ6CiAgICogICAgIGh0dHA6Ly9nb3RvL3NveS1wYXJhbS1taWdyYXRpb24KICAgKiBAcmV0dXJuIHshT2JqZWN0fQogICAqLwogIHByb3RvLnBiLkFwcC5wcm90b3R5cGUudG9PYmplY3QgPSBmdW5jdGlvbiAob3B0X2luY2x1ZGVJbnN0YW5jZSkgewogICAgcmV0dXJuIHByb3RvLnBiLkFwcC50b09iamVjdChvcHRfaW5jbHVkZUluc3RhbmNlLCB0aGlzKTsKICB9OwogIC8qKgogICAqIFN0YXRpYyB2ZXJzaW9uIG9mIHRoZSB7QHNlZSB0b09iamVjdH0gbWV0aG9kLgogICAqIEBwYXJhbSB7Ym9vbGVhbnx1bmRlZmluZWR9IGluY2x1ZGVJbnN0YW5jZSBEZXByZWNhdGVkLiBXaGV0aGVyIHRvIGluY2x1ZGUKICAgKiAgICAgdGhlIEpTUEIgaW5zdGFuY2UgZm9yIHRyYW5zaXRpb25hbCBzb3kgcHJvdG8gc3VwcG9ydDoKICAgKiAgICAgaHR0cDovL2dvdG8vc295LXBhcmFtLW1pZ3JhdGlvbgogICAqIEBwYXJhbSB7IXByb3RvLnBiLkFwcH0gbXNnIFRoZSBtc2cgaW5zdGFuY2UgdG8gdHJhbnNmb3JtLgogICAqIEByZXR1cm4geyFPYmplY3R9CiAgICogQHN1cHByZXNzIHt1bnVzZWRMb2NhbFZhcmlhYmxlc30gZiBpcyBvbmx5IHVzZWQgZm9yIG5lc3RlZCBtZXNzYWdlcwogICAqLwoKCiAgcHJvdG8ucGIuQXBwLnRvT2JqZWN0ID0gZnVuY3Rpb24gKGluY2x1ZGVJbnN0YW5jZSwgbXNnKSB7CiAgICB2YXIgZiwKICAgICAgICBvYmogPSB7CiAgICAgIGlkOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDEsIDApLAogICAgICBvc1R5cGU6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMiwgMCksCiAgICAgIGFwcEtleToganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAzLCAiIiksCiAgICAgIGVuYWJsZToganNwYi5NZXNzYWdlLmdldEJvb2xlYW5GaWVsZFdpdGhEZWZhdWx0KG1zZywgNCwgZmFsc2UpLAogICAgICB0aXRsZToganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA1LCAiIiksCiAgICAgIGlzQW5jaG9yOiBqc3BiLk1lc3NhZ2UuZ2V0Qm9vbGVhbkZpZWxkV2l0aERlZmF1bHQobXNnLCA2LCBmYWxzZSksCiAgICAgIGJ1bmRsZUlkOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDcsICIiKSwKICAgICAgc3RvcmVDcmVkOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDgsICIiKSwKICAgICAgYXBpQWRkcjoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA5LCAiIiksCiAgICAgIG5vdGU6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMTAsICIiKSwKICAgICAgYXJlYUlkc0xpc3Q6IChmID0ganNwYi5NZXNzYWdlLmdldFJlcGVhdGVkRmllbGQobXNnLCAxMSkpID09IG51bGwgPyB1bmRlZmluZWQgOiBmLAogICAgICB1cGRhdGVkQXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjAsIDApLAogICAgICBjcmVhdGVkQXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjEsIDApCiAgICB9OwoKICAgIGlmIChpbmNsdWRlSW5zdGFuY2UpIHsKICAgICAgb2JqLiRqc3BiTWVzc2FnZUluc3RhbmNlID0gbXNnOwogICAgfQoKICAgIHJldHVybiBvYmo7CiAgfTsKfQovKioKICogRGVzZXJpYWxpemVzIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkuCiAqIEBwYXJhbSB7anNwYi5CeXRlU291cmNlfSBieXRlcyBUaGUgYnl0ZXMgdG8gZGVzZXJpYWxpemUuCiAqIEByZXR1cm4geyFwcm90by5wYi5BcHB9CiAqLwoKCnByb3RvLnBiLkFwcC5kZXNlcmlhbGl6ZUJpbmFyeSA9IGZ1bmN0aW9uIChieXRlcykgewogIHZhciByZWFkZXIgPSBuZXcganNwYi5CaW5hcnlSZWFkZXIoYnl0ZXMpOwogIHZhciBtc2cgPSBuZXcgcHJvdG8ucGIuQXBwKCk7CiAgcmV0dXJuIHByb3RvLnBiLkFwcC5kZXNlcmlhbGl6ZUJpbmFyeUZyb21SZWFkZXIobXNnLCByZWFkZXIpOwp9OwovKioKICogRGVzZXJpYWxpemVzIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkgZnJvbSB0aGUKICogZ2l2ZW4gcmVhZGVyIGludG8gdGhlIGdpdmVuIG1lc3NhZ2Ugb2JqZWN0LgogKiBAcGFyYW0geyFwcm90by5wYi5BcHB9IG1zZyBUaGUgbWVzc2FnZSBvYmplY3QgdG8gZGVzZXJpYWxpemUgaW50by4KICogQHBhcmFtIHshanNwYi5CaW5hcnlSZWFkZXJ9IHJlYWRlciBUaGUgQmluYXJ5UmVhZGVyIHRvIHVzZS4KICogQHJldHVybiB7IXByb3RvLnBiLkFwcH0KICovCgoKcHJvdG8ucGIuQXBwLmRlc2VyaWFsaXplQmluYXJ5RnJvbVJlYWRlciA9IGZ1bmN0aW9uIChtc2csIHJlYWRlcikgewogIHdoaWxlIChyZWFkZXIubmV4dEZpZWxkKCkpIHsKICAgIGlmIChyZWFkZXIuaXNFbmRHcm91cCgpKSB7CiAgICAgIGJyZWFrOwogICAgfQoKICAgIHZhciBmaWVsZCA9IHJlYWRlci5nZXRGaWVsZE51bWJlcigpOwoKICAgIHN3aXRjaCAoZmllbGQpIHsKICAgICAgY2FzZSAxOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldElkKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZEVudW0oKTsKICAgICAgICBtc2cuc2V0T3NUeXBlKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMzoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXRBcHBLZXkodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA0OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkQm9vbCgpOwogICAgICAgIG1zZy5zZXRFbmFibGUodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA1OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldFRpdGxlKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZEJvb2woKTsKICAgICAgICBtc2cuc2V0SXNBbmNob3IodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA3OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldEJ1bmRsZUlkKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgODoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXRTdG9yZUNyZWQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA5OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldEFwaUFkZHIodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAxMDoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXROb3RlKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTE6CiAgICAgICAgdmFyIHZhbHVlcyA9IHJlYWRlci5pc0RlbGltaXRlZCgpID8gcmVhZGVyLnJlYWRQYWNrZWRVaW50MzIoKSA6IFtyZWFkZXIucmVhZFVpbnQzMigpXTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2YWx1ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIG1zZy5hZGRBcmVhSWRzKHZhbHVlc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjA6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0VXBkYXRlZEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0Q3JlYXRlZEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmVhZGVyLnNraXBGaWVsZCgpOwogICAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgcmV0dXJuIG1zZzsKfTsKLyoqCiAqIFNlcmlhbGl6ZXMgdGhlIG1lc3NhZ2UgdG8gYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUgZm9ybWF0KS4KICogQHJldHVybiB7IVVpbnQ4QXJyYXl9CiAqLwoKCnByb3RvLnBiLkFwcC5wcm90b3R5cGUuc2VyaWFsaXplQmluYXJ5ID0gZnVuY3Rpb24gKCkgewogIHZhciB3cml0ZXIgPSBuZXcganNwYi5CaW5hcnlXcml0ZXIoKTsKICBwcm90by5wYi5BcHAuc2VyaWFsaXplQmluYXJ5VG9Xcml0ZXIodGhpcywgd3JpdGVyKTsKICByZXR1cm4gd3JpdGVyLmdldFJlc3VsdEJ1ZmZlcigpOwp9OwovKioKICogU2VyaWFsaXplcyB0aGUgZ2l2ZW4gbWVzc2FnZSB0byBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZQogKiBmb3JtYXQpLCB3cml0aW5nIHRvIHRoZSBnaXZlbiBCaW5hcnlXcml0ZXIuCiAqIEBwYXJhbSB7IXByb3RvLnBiLkFwcH0gbWVzc2FnZQogKiBAcGFyYW0geyFqc3BiLkJpbmFyeVdyaXRlcn0gd3JpdGVyCiAqIEBzdXBwcmVzcyB7dW51c2VkTG9jYWxWYXJpYWJsZXN9IGYgaXMgb25seSB1c2VkIGZvciBuZXN0ZWQgbWVzc2FnZXMKICovCgoKcHJvdG8ucGIuQXBwLnNlcmlhbGl6ZUJpbmFyeVRvV3JpdGVyID0gZnVuY3Rpb24gKG1lc3NhZ2UsIHdyaXRlcikgewogIHZhciBmID0gdW5kZWZpbmVkOwogIGYgPSBtZXNzYWdlLmdldElkKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRPc1R5cGUoKTsKCiAgaWYgKGYgIT09IDAuMCkgewogICAgd3JpdGVyLndyaXRlRW51bSgyLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEFwcEtleSgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoMywgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRFbmFibGUoKTsKCiAgaWYgKGYpIHsKICAgIHdyaXRlci53cml0ZUJvb2woNCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRUaXRsZSgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoNSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRJc0FuY2hvcigpOwoKICBpZiAoZikgewogICAgd3JpdGVyLndyaXRlQm9vbCg2LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEJ1bmRsZUlkKCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZyg3LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldFN0b3JlQ3JlZCgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoOCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRBcGlBZGRyKCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZyg5LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldE5vdGUoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDEwLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEFyZWFJZHNMaXN0KCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVBhY2tlZFVpbnQzMigxMSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRVcGRhdGVkQXQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigyMCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRDcmVhdGVkQXQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigyMSwgZik7CiAgfQp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGlkID0gMTsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BcHAucHJvdG90eXBlLmdldElkID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXBwfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXBwLnByb3RvdHlwZS5zZXRJZCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgT3NUeXBlIG9zX3R5cGUgPSAyOwogKiBAcmV0dXJuIHshcHJvdG8ucGIuT3NUeXBlfQogKi8KCgpwcm90by5wYi5BcHAucHJvdG90eXBlLmdldE9zVHlwZSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMiwgMCk7Cn07Ci8qKgogKiBAcGFyYW0geyFwcm90by5wYi5Pc1R5cGV9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BcHB9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BcHAucHJvdG90eXBlLnNldE9zVHlwZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zRW51bUZpZWxkKHRoaXMsIDIsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyBhcHBfa2V5ID0gMzsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5BcHAucHJvdG90eXBlLmdldEFwcEtleSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMywgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BcHB9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BcHAucHJvdG90eXBlLnNldEFwcEtleSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgMywgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgYm9vbCBlbmFibGUgPSA0OwogKiBAcmV0dXJuIHtib29sZWFufQogKi8KCgpwcm90by5wYi5BcHAucHJvdG90eXBlLmdldEVuYWJsZSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEJvb2xlYW5GaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDQsIGZhbHNlKTsKfTsKLyoqCiAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFwcH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFwcC5wcm90b3R5cGUuc2V0RW5hYmxlID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNCb29sZWFuRmllbGQodGhpcywgNCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIHRpdGxlID0gNTsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5BcHAucHJvdG90eXBlLmdldFRpdGxlID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA1LCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFwcH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFwcC5wcm90b3R5cGUuc2V0VGl0bGUgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDUsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIGJvb2wgaXNfYW5jaG9yID0gNjsKICogQHJldHVybiB7Ym9vbGVhbn0KICovCgoKcHJvdG8ucGIuQXBwLnByb3RvdHlwZS5nZXRJc0FuY2hvciA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEJvb2xlYW5GaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDYsIGZhbHNlKTsKfTsKLyoqCiAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFwcH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFwcC5wcm90b3R5cGUuc2V0SXNBbmNob3IgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0Jvb2xlYW5GaWVsZCh0aGlzLCA2LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgYnVuZGxlX2lkID0gNzsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5BcHAucHJvdG90eXBlLmdldEJ1bmRsZUlkID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA3LCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFwcH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFwcC5wcm90b3R5cGUuc2V0QnVuZGxlSWQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDcsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyBzdG9yZV9jcmVkID0gODsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5BcHAucHJvdG90eXBlLmdldFN0b3JlQ3JlZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgOCwgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BcHB9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BcHAucHJvdG90eXBlLnNldFN0b3JlQ3JlZCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgOCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIGFwaV9hZGRyID0gOTsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5BcHAucHJvdG90eXBlLmdldEFwaUFkZHIgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDksICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXBwfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXBwLnByb3RvdHlwZS5zZXRBcGlBZGRyID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCA5LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgbm90ZSA9IDEwOwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLkFwcC5wcm90b3R5cGUuZ2V0Tm90ZSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMTAsICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXBwfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXBwLnByb3RvdHlwZS5zZXROb3RlID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCAxMCwgdmFsdWUpOwp9OwovKioKICogcmVwZWF0ZWQgdWludDMyIGFyZWFfaWRzID0gMTE7CiAqIEByZXR1cm4geyFBcnJheTxudW1iZXI+fQogKi8KCgpwcm90by5wYi5BcHAucHJvdG90eXBlLmdldEFyZWFJZHNMaXN0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0UmVwZWF0ZWRGaWVsZCh0aGlzLCAxMSk7Cn07Ci8qKgogKiBAcGFyYW0geyFBcnJheTxudW1iZXI+fSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXBwfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXBwLnByb3RvdHlwZS5zZXRBcmVhSWRzTGlzdCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0RmllbGQodGhpcywgMTEsIHZhbHVlIHx8IFtdKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcGFyYW0ge251bWJlcj19IG9wdF9pbmRleAogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXBwfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXBwLnByb3RvdHlwZS5hZGRBcmVhSWRzID0gZnVuY3Rpb24gKHZhbHVlLCBvcHRfaW5kZXgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmFkZFRvUmVwZWF0ZWRGaWVsZCh0aGlzLCAxMSwgdmFsdWUsIG9wdF9pbmRleCk7Cn07Ci8qKgogKiBDbGVhcnMgdGhlIGxpc3QgbWFraW5nIGl0IGVtcHR5IGJ1dCBub24tbnVsbC4KICogQHJldHVybiB7IXByb3RvLnBiLkFwcH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFwcC5wcm90b3R5cGUuY2xlYXJBcmVhSWRzTGlzdCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5zZXRBcmVhSWRzTGlzdChbXSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgdXBkYXRlZF9hdCA9IDIwOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFwcC5wcm90b3R5cGUuZ2V0VXBkYXRlZEF0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAyMCwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFwcH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFwcC5wcm90b3R5cGUuc2V0VXBkYXRlZEF0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAyMCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGNyZWF0ZWRfYXQgPSAyMTsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BcHAucHJvdG90eXBlLmdldENyZWF0ZWRBdCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMjEsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BcHB9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BcHAucHJvdG90eXBlLnNldENyZWF0ZWRBdCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMjEsIHZhbHVlKTsKfTsKCmlmIChqc3BiLk1lc3NhZ2UuR0VORVJBVEVfVE9fT0JKRUNUKSB7CiAgLyoqCiAgICogQ3JlYXRlcyBhbiBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBwcm90by4KICAgKiBGaWVsZCBuYW1lcyB0aGF0IGFyZSByZXNlcnZlZCBpbiBKYXZhU2NyaXB0IGFuZCB3aWxsIGJlIHJlbmFtZWQgdG8gcGJfbmFtZS4KICAgKiBPcHRpb25hbCBmaWVsZHMgdGhhdCBhcmUgbm90IHNldCB3aWxsIGJlIHNldCB0byB1bmRlZmluZWQuCiAgICogVG8gYWNjZXNzIGEgcmVzZXJ2ZWQgZmllbGQgdXNlLCBmb28ucGJfPG5hbWU+LCBlZywgZm9vLnBiX2RlZmF1bHQuCiAgICogRm9yIHRoZSBsaXN0IG9mIHJlc2VydmVkIG5hbWVzIHBsZWFzZSBzZWU6CiAgICogICAgIG5ldC9wcm90bzIvY29tcGlsZXIvanMvaW50ZXJuYWwvZ2VuZXJhdG9yLmNjI2tLZXl3b3JkLgogICAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF9pbmNsdWRlSW5zdGFuY2UgRGVwcmVjYXRlZC4gd2hldGhlciB0byBpbmNsdWRlIHRoZQogICAqICAgICBKU1BCIGluc3RhbmNlIGZvciB0cmFuc2l0aW9uYWwgc295IHByb3RvIHN1cHBvcnQ6CiAgICogICAgIGh0dHA6Ly9nb3RvL3NveS1wYXJhbS1taWdyYXRpb24KICAgKiBAcmV0dXJuIHshT2JqZWN0fQogICAqLwogIHByb3RvLnBiLkFnb3JhQ29uZmlnLnByb3RvdHlwZS50b09iamVjdCA9IGZ1bmN0aW9uIChvcHRfaW5jbHVkZUluc3RhbmNlKSB7CiAgICByZXR1cm4gcHJvdG8ucGIuQWdvcmFDb25maWcudG9PYmplY3Qob3B0X2luY2x1ZGVJbnN0YW5jZSwgdGhpcyk7CiAgfTsKICAvKioKICAgKiBTdGF0aWMgdmVyc2lvbiBvZiB0aGUge0BzZWUgdG9PYmplY3R9IG1ldGhvZC4KICAgKiBAcGFyYW0ge2Jvb2xlYW58dW5kZWZpbmVkfSBpbmNsdWRlSW5zdGFuY2UgRGVwcmVjYXRlZC4gV2hldGhlciB0byBpbmNsdWRlCiAgICogICAgIHRoZSBKU1BCIGluc3RhbmNlIGZvciB0cmFuc2l0aW9uYWwgc295IHByb3RvIHN1cHBvcnQ6CiAgICogICAgIGh0dHA6Ly9nb3RvL3NveS1wYXJhbS1taWdyYXRpb24KICAgKiBAcGFyYW0geyFwcm90by5wYi5BZ29yYUNvbmZpZ30gbXNnIFRoZSBtc2cgaW5zdGFuY2UgdG8gdHJhbnNmb3JtLgogICAqIEByZXR1cm4geyFPYmplY3R9CiAgICogQHN1cHByZXNzIHt1bnVzZWRMb2NhbFZhcmlhYmxlc30gZiBpcyBvbmx5IHVzZWQgZm9yIG5lc3RlZCBtZXNzYWdlcwogICAqLwoKCiAgcHJvdG8ucGIuQWdvcmFDb25maWcudG9PYmplY3QgPSBmdW5jdGlvbiAoaW5jbHVkZUluc3RhbmNlLCBtc2cpIHsKICAgIHZhciBmLAogICAgICAgIG9iaiA9IHsKICAgICAgYXBwSWQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMSwgIiIpLAogICAgICBhcHBDZXJ0OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDIsICIiKSwKICAgICAgY2xpZW50SWQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMywgIiIpLAogICAgICBjbGllbnRTZWNyZXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNCwgIiIpLAogICAgICBjYXB0dXJlRHVyYXRpb246IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNSwgMCksCiAgICAgIHN0b3JhZ2VWZW5kb3I6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNiwgMCksCiAgICAgIHN0b3JhZ2VSZWdpb246IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNywgMCksCiAgICAgIHN0b3JhZ2VFbmRwb2ludDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA4LCAiIiksCiAgICAgIHN0b3JhZ2VCdWNrZXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgOSwgIiIpLAogICAgICBzdG9yYWdlQWNjZXNzS2V5OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDEwLCAiIiksCiAgICAgIHN0b3JhZ2VTZWNyZXRLZXk6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMTEsICIiKQogICAgfTsKCiAgICBpZiAoaW5jbHVkZUluc3RhbmNlKSB7CiAgICAgIG9iai4kanNwYk1lc3NhZ2VJbnN0YW5jZSA9IG1zZzsKICAgIH0KCiAgICByZXR1cm4gb2JqOwogIH07Cn0KLyoqCiAqIERlc2VyaWFsaXplcyBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZSBmb3JtYXQpLgogKiBAcGFyYW0ge2pzcGIuQnl0ZVNvdXJjZX0gYnl0ZXMgVGhlIGJ5dGVzIHRvIGRlc2VyaWFsaXplLgogKiBAcmV0dXJuIHshcHJvdG8ucGIuQWdvcmFDb25maWd9CiAqLwoKCnByb3RvLnBiLkFnb3JhQ29uZmlnLmRlc2VyaWFsaXplQmluYXJ5ID0gZnVuY3Rpb24gKGJ5dGVzKSB7CiAgdmFyIHJlYWRlciA9IG5ldyBqc3BiLkJpbmFyeVJlYWRlcihieXRlcyk7CiAgdmFyIG1zZyA9IG5ldyBwcm90by5wYi5BZ29yYUNvbmZpZygpOwogIHJldHVybiBwcm90by5wYi5BZ29yYUNvbmZpZy5kZXNlcmlhbGl6ZUJpbmFyeUZyb21SZWFkZXIobXNnLCByZWFkZXIpOwp9OwovKioKICogRGVzZXJpYWxpemVzIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkgZnJvbSB0aGUKICogZ2l2ZW4gcmVhZGVyIGludG8gdGhlIGdpdmVuIG1lc3NhZ2Ugb2JqZWN0LgogKiBAcGFyYW0geyFwcm90by5wYi5BZ29yYUNvbmZpZ30gbXNnIFRoZSBtZXNzYWdlIG9iamVjdCB0byBkZXNlcmlhbGl6ZSBpbnRvLgogKiBAcGFyYW0geyFqc3BiLkJpbmFyeVJlYWRlcn0gcmVhZGVyIFRoZSBCaW5hcnlSZWFkZXIgdG8gdXNlLgogKiBAcmV0dXJuIHshcHJvdG8ucGIuQWdvcmFDb25maWd9CiAqLwoKCnByb3RvLnBiLkFnb3JhQ29uZmlnLmRlc2VyaWFsaXplQmluYXJ5RnJvbVJlYWRlciA9IGZ1bmN0aW9uIChtc2csIHJlYWRlcikgewogIHdoaWxlIChyZWFkZXIubmV4dEZpZWxkKCkpIHsKICAgIGlmIChyZWFkZXIuaXNFbmRHcm91cCgpKSB7CiAgICAgIGJyZWFrOwogICAgfQoKICAgIHZhciBmaWVsZCA9IHJlYWRlci5nZXRGaWVsZE51bWJlcigpOwoKICAgIHN3aXRjaCAoZmllbGQpIHsKICAgICAgY2FzZSAxOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldEFwcElkKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXRBcHBDZXJ0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMzoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXRDbGllbnRJZCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDQ6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0Q2xpZW50U2VjcmV0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRDYXB0dXJlRHVyYXRpb24odmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA2OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldFN0b3JhZ2VWZW5kb3IodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA3OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldFN0b3JhZ2VSZWdpb24odmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA4OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldFN0b3JhZ2VFbmRwb2ludCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDk6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0U3RvcmFnZUJ1Y2tldCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDEwOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldFN0b3JhZ2VBY2Nlc3NLZXkodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAxMToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXRTdG9yYWdlU2VjcmV0S2V5KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmVhZGVyLnNraXBGaWVsZCgpOwogICAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgcmV0dXJuIG1zZzsKfTsKLyoqCiAqIFNlcmlhbGl6ZXMgdGhlIG1lc3NhZ2UgdG8gYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUgZm9ybWF0KS4KICogQHJldHVybiB7IVVpbnQ4QXJyYXl9CiAqLwoKCnByb3RvLnBiLkFnb3JhQ29uZmlnLnByb3RvdHlwZS5zZXJpYWxpemVCaW5hcnkgPSBmdW5jdGlvbiAoKSB7CiAgdmFyIHdyaXRlciA9IG5ldyBqc3BiLkJpbmFyeVdyaXRlcigpOwogIHByb3RvLnBiLkFnb3JhQ29uZmlnLnNlcmlhbGl6ZUJpbmFyeVRvV3JpdGVyKHRoaXMsIHdyaXRlcik7CiAgcmV0dXJuIHdyaXRlci5nZXRSZXN1bHRCdWZmZXIoKTsKfTsKLyoqCiAqIFNlcmlhbGl6ZXMgdGhlIGdpdmVuIG1lc3NhZ2UgdG8gYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUKICogZm9ybWF0KSwgd3JpdGluZyB0byB0aGUgZ2l2ZW4gQmluYXJ5V3JpdGVyLgogKiBAcGFyYW0geyFwcm90by5wYi5BZ29yYUNvbmZpZ30gbWVzc2FnZQogKiBAcGFyYW0geyFqc3BiLkJpbmFyeVdyaXRlcn0gd3JpdGVyCiAqIEBzdXBwcmVzcyB7dW51c2VkTG9jYWxWYXJpYWJsZXN9IGYgaXMgb25seSB1c2VkIGZvciBuZXN0ZWQgbWVzc2FnZXMKICovCgoKcHJvdG8ucGIuQWdvcmFDb25maWcuc2VyaWFsaXplQmluYXJ5VG9Xcml0ZXIgPSBmdW5jdGlvbiAobWVzc2FnZSwgd3JpdGVyKSB7CiAgdmFyIGYgPSB1bmRlZmluZWQ7CiAgZiA9IG1lc3NhZ2UuZ2V0QXBwSWQoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDEsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0QXBwQ2VydCgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoMiwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRDbGllbnRJZCgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoMywgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRDbGllbnRTZWNyZXQoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDQsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0Q2FwdHVyZUR1cmF0aW9uKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoNSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRTdG9yYWdlVmVuZG9yKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoNiwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRTdG9yYWdlUmVnaW9uKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoNywgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRTdG9yYWdlRW5kcG9pbnQoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDgsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0U3RvcmFnZUJ1Y2tldCgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoOSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRTdG9yYWdlQWNjZXNzS2V5KCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZygxMCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRTdG9yYWdlU2VjcmV0S2V5KCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZygxMSwgZik7CiAgfQp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIGFwcF9pZCA9IDE7CiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKcHJvdG8ucGIuQWdvcmFDb25maWcucHJvdG90eXBlLmdldEFwcElkID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxLCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFnb3JhQ29uZmlnfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQWdvcmFDb25maWcucHJvdG90eXBlLnNldEFwcElkID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCAxLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgYXBwX2NlcnQgPSAyOwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLkFnb3JhQ29uZmlnLnByb3RvdHlwZS5nZXRBcHBDZXJ0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAyLCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFnb3JhQ29uZmlnfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQWdvcmFDb25maWcucHJvdG90eXBlLnNldEFwcENlcnQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDIsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyBjbGllbnRfaWQgPSAzOwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLkFnb3JhQ29uZmlnLnByb3RvdHlwZS5nZXRDbGllbnRJZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMywgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BZ29yYUNvbmZpZ30gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFnb3JhQ29uZmlnLnByb3RvdHlwZS5zZXRDbGllbnRJZCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgMywgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIGNsaWVudF9zZWNyZXQgPSA0OwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLkFnb3JhQ29uZmlnLnByb3RvdHlwZS5nZXRDbGllbnRTZWNyZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDQsICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQWdvcmFDb25maWd9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BZ29yYUNvbmZpZy5wcm90b3R5cGUuc2V0Q2xpZW50U2VjcmV0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCA0LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgY2FwdHVyZV9kdXJhdGlvbiA9IDU7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQWdvcmFDb25maWcucHJvdG90eXBlLmdldENhcHR1cmVEdXJhdGlvbiA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgNSwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFnb3JhQ29uZmlnfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQWdvcmFDb25maWcucHJvdG90eXBlLnNldENhcHR1cmVEdXJhdGlvbiA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgNSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIHN0b3JhZ2VfdmVuZG9yID0gNjsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BZ29yYUNvbmZpZy5wcm90b3R5cGUuZ2V0U3RvcmFnZVZlbmRvciA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgNiwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFnb3JhQ29uZmlnfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQWdvcmFDb25maWcucHJvdG90eXBlLnNldFN0b3JhZ2VWZW5kb3IgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDYsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBzdG9yYWdlX3JlZ2lvbiA9IDc7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQWdvcmFDb25maWcucHJvdG90eXBlLmdldFN0b3JhZ2VSZWdpb24gPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDcsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BZ29yYUNvbmZpZ30gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFnb3JhQ29uZmlnLnByb3RvdHlwZS5zZXRTdG9yYWdlUmVnaW9uID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCA3LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgc3RvcmFnZV9lbmRwb2ludCA9IDg7CiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKcHJvdG8ucGIuQWdvcmFDb25maWcucHJvdG90eXBlLmdldFN0b3JhZ2VFbmRwb2ludCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgOCwgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BZ29yYUNvbmZpZ30gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFnb3JhQ29uZmlnLnByb3RvdHlwZS5zZXRTdG9yYWdlRW5kcG9pbnQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDgsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyBzdG9yYWdlX2J1Y2tldCA9IDk7CiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKcHJvdG8ucGIuQWdvcmFDb25maWcucHJvdG90eXBlLmdldFN0b3JhZ2VCdWNrZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDksICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQWdvcmFDb25maWd9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BZ29yYUNvbmZpZy5wcm90b3R5cGUuc2V0U3RvcmFnZUJ1Y2tldCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgOSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIHN0b3JhZ2VfYWNjZXNzX2tleSA9IDEwOwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLkFnb3JhQ29uZmlnLnByb3RvdHlwZS5nZXRTdG9yYWdlQWNjZXNzS2V5ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxMCwgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BZ29yYUNvbmZpZ30gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFnb3JhQ29uZmlnLnByb3RvdHlwZS5zZXRTdG9yYWdlQWNjZXNzS2V5ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCAxMCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIHN0b3JhZ2Vfc2VjcmV0X2tleSA9IDExOwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLkFnb3JhQ29uZmlnLnByb3RvdHlwZS5nZXRTdG9yYWdlU2VjcmV0S2V5ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxMSwgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BZ29yYUNvbmZpZ30gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFnb3JhQ29uZmlnLnByb3RvdHlwZS5zZXRTdG9yYWdlU2VjcmV0S2V5ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCAxMSwgdmFsdWUpOwp9OwoKaWYgKGpzcGIuTWVzc2FnZS5HRU5FUkFURV9UT19PQkpFQ1QpIHsKICAvKioKICAgKiBDcmVhdGVzIGFuIG9iamVjdCByZXByZXNlbnRhdGlvbiBvZiB0aGlzIHByb3RvLgogICAqIEZpZWxkIG5hbWVzIHRoYXQgYXJlIHJlc2VydmVkIGluIEphdmFTY3JpcHQgYW5kIHdpbGwgYmUgcmVuYW1lZCB0byBwYl9uYW1lLgogICAqIE9wdGlvbmFsIGZpZWxkcyB0aGF0IGFyZSBub3Qgc2V0IHdpbGwgYmUgc2V0IHRvIHVuZGVmaW5lZC4KICAgKiBUbyBhY2Nlc3MgYSByZXNlcnZlZCBmaWVsZCB1c2UsIGZvby5wYl88bmFtZT4sIGVnLCBmb28ucGJfZGVmYXVsdC4KICAgKiBGb3IgdGhlIGxpc3Qgb2YgcmVzZXJ2ZWQgbmFtZXMgcGxlYXNlIHNlZToKICAgKiAgICAgbmV0L3Byb3RvMi9jb21waWxlci9qcy9pbnRlcm5hbC9nZW5lcmF0b3IuY2Mja0tleXdvcmQuCiAgICogQHBhcmFtIHtib29sZWFuPX0gb3B0X2luY2x1ZGVJbnN0YW5jZSBEZXByZWNhdGVkLiB3aGV0aGVyIHRvIGluY2x1ZGUgdGhlCiAgICogICAgIEpTUEIgaW5zdGFuY2UgZm9yIHRyYW5zaXRpb25hbCBzb3kgcHJvdG8gc3VwcG9ydDoKICAgKiAgICAgaHR0cDovL2dvdG8vc295LXBhcmFtLW1pZ3JhdGlvbgogICAqIEByZXR1cm4geyFPYmplY3R9CiAgICovCiAgcHJvdG8ucGIuT3NzQ29uZmlnLnByb3RvdHlwZS50b09iamVjdCA9IGZ1bmN0aW9uIChvcHRfaW5jbHVkZUluc3RhbmNlKSB7CiAgICByZXR1cm4gcHJvdG8ucGIuT3NzQ29uZmlnLnRvT2JqZWN0KG9wdF9pbmNsdWRlSW5zdGFuY2UsIHRoaXMpOwogIH07CiAgLyoqCiAgICogU3RhdGljIHZlcnNpb24gb2YgdGhlIHtAc2VlIHRvT2JqZWN0fSBtZXRob2QuCiAgICogQHBhcmFtIHtib29sZWFufHVuZGVmaW5lZH0gaW5jbHVkZUluc3RhbmNlIERlcHJlY2F0ZWQuIFdoZXRoZXIgdG8gaW5jbHVkZQogICAqICAgICB0aGUgSlNQQiBpbnN0YW5jZSBmb3IgdHJhbnNpdGlvbmFsIHNveSBwcm90byBzdXBwb3J0OgogICAqICAgICBodHRwOi8vZ290by9zb3ktcGFyYW0tbWlncmF0aW9uCiAgICogQHBhcmFtIHshcHJvdG8ucGIuT3NzQ29uZmlnfSBtc2cgVGhlIG1zZyBpbnN0YW5jZSB0byB0cmFuc2Zvcm0uCiAgICogQHJldHVybiB7IU9iamVjdH0KICAgKiBAc3VwcHJlc3Mge3VudXNlZExvY2FsVmFyaWFibGVzfSBmIGlzIG9ubHkgdXNlZCBmb3IgbmVzdGVkIG1lc3NhZ2VzCiAgICovCgoKICBwcm90by5wYi5Pc3NDb25maWcudG9PYmplY3QgPSBmdW5jdGlvbiAoaW5jbHVkZUluc3RhbmNlLCBtc2cpIHsKICAgIHZhciBmLAogICAgICAgIG9iaiA9IHsKICAgICAgZW5kcG9pbnQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMSwgIiIpLAogICAgICBidWNrZXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMiwgIiIpLAogICAgICBrZXlJZDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAzLCAiIiksCiAgICAgIGtleVNlY3JldDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA0LCAiIikKICAgIH07CgogICAgaWYgKGluY2x1ZGVJbnN0YW5jZSkgewogICAgICBvYmouJGpzcGJNZXNzYWdlSW5zdGFuY2UgPSBtc2c7CiAgICB9CgogICAgcmV0dXJuIG9iajsKICB9Owp9Ci8qKgogKiBEZXNlcmlhbGl6ZXMgYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUgZm9ybWF0KS4KICogQHBhcmFtIHtqc3BiLkJ5dGVTb3VyY2V9IGJ5dGVzIFRoZSBieXRlcyB0byBkZXNlcmlhbGl6ZS4KICogQHJldHVybiB7IXByb3RvLnBiLk9zc0NvbmZpZ30KICovCgoKcHJvdG8ucGIuT3NzQ29uZmlnLmRlc2VyaWFsaXplQmluYXJ5ID0gZnVuY3Rpb24gKGJ5dGVzKSB7CiAgdmFyIHJlYWRlciA9IG5ldyBqc3BiLkJpbmFyeVJlYWRlcihieXRlcyk7CiAgdmFyIG1zZyA9IG5ldyBwcm90by5wYi5Pc3NDb25maWcoKTsKICByZXR1cm4gcHJvdG8ucGIuT3NzQ29uZmlnLmRlc2VyaWFsaXplQmluYXJ5RnJvbVJlYWRlcihtc2csIHJlYWRlcik7Cn07Ci8qKgogKiBEZXNlcmlhbGl6ZXMgYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUgZm9ybWF0KSBmcm9tIHRoZQogKiBnaXZlbiByZWFkZXIgaW50byB0aGUgZ2l2ZW4gbWVzc2FnZSBvYmplY3QuCiAqIEBwYXJhbSB7IXByb3RvLnBiLk9zc0NvbmZpZ30gbXNnIFRoZSBtZXNzYWdlIG9iamVjdCB0byBkZXNlcmlhbGl6ZSBpbnRvLgogKiBAcGFyYW0geyFqc3BiLkJpbmFyeVJlYWRlcn0gcmVhZGVyIFRoZSBCaW5hcnlSZWFkZXIgdG8gdXNlLgogKiBAcmV0dXJuIHshcHJvdG8ucGIuT3NzQ29uZmlnfQogKi8KCgpwcm90by5wYi5Pc3NDb25maWcuZGVzZXJpYWxpemVCaW5hcnlGcm9tUmVhZGVyID0gZnVuY3Rpb24gKG1zZywgcmVhZGVyKSB7CiAgd2hpbGUgKHJlYWRlci5uZXh0RmllbGQoKSkgewogICAgaWYgKHJlYWRlci5pc0VuZEdyb3VwKCkpIHsKICAgICAgYnJlYWs7CiAgICB9CgogICAgdmFyIGZpZWxkID0gcmVhZGVyLmdldEZpZWxkTnVtYmVyKCk7CgogICAgc3dpdGNoIChmaWVsZCkgewogICAgICBjYXNlIDE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0RW5kcG9pbnQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAyOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldEJ1Y2tldCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDM6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0S2V5SWQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA0OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldEtleVNlY3JldCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBkZWZhdWx0OgogICAgICAgIHJlYWRlci5za2lwRmllbGQoKTsKICAgICAgICBicmVhazsKICAgIH0KICB9CgogIHJldHVybiBtc2c7Cn07Ci8qKgogKiBTZXJpYWxpemVzIHRoZSBtZXNzYWdlIHRvIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkuCiAqIEByZXR1cm4geyFVaW50OEFycmF5fQogKi8KCgpwcm90by5wYi5Pc3NDb25maWcucHJvdG90eXBlLnNlcmlhbGl6ZUJpbmFyeSA9IGZ1bmN0aW9uICgpIHsKICB2YXIgd3JpdGVyID0gbmV3IGpzcGIuQmluYXJ5V3JpdGVyKCk7CiAgcHJvdG8ucGIuT3NzQ29uZmlnLnNlcmlhbGl6ZUJpbmFyeVRvV3JpdGVyKHRoaXMsIHdyaXRlcik7CiAgcmV0dXJuIHdyaXRlci5nZXRSZXN1bHRCdWZmZXIoKTsKfTsKLyoqCiAqIFNlcmlhbGl6ZXMgdGhlIGdpdmVuIG1lc3NhZ2UgdG8gYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUKICogZm9ybWF0KSwgd3JpdGluZyB0byB0aGUgZ2l2ZW4gQmluYXJ5V3JpdGVyLgogKiBAcGFyYW0geyFwcm90by5wYi5Pc3NDb25maWd9IG1lc3NhZ2UKICogQHBhcmFtIHshanNwYi5CaW5hcnlXcml0ZXJ9IHdyaXRlcgogKiBAc3VwcHJlc3Mge3VudXNlZExvY2FsVmFyaWFibGVzfSBmIGlzIG9ubHkgdXNlZCBmb3IgbmVzdGVkIG1lc3NhZ2VzCiAqLwoKCnByb3RvLnBiLk9zc0NvbmZpZy5zZXJpYWxpemVCaW5hcnlUb1dyaXRlciA9IGZ1bmN0aW9uIChtZXNzYWdlLCB3cml0ZXIpIHsKICB2YXIgZiA9IHVuZGVmaW5lZDsKICBmID0gbWVzc2FnZS5nZXRFbmRwb2ludCgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoMSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRCdWNrZXQoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDIsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0S2V5SWQoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDMsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0S2V5U2VjcmV0KCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZyg0LCBmKTsKICB9Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgZW5kcG9pbnQgPSAxOwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLk9zc0NvbmZpZy5wcm90b3R5cGUuZ2V0RW5kcG9pbnQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDEsICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuT3NzQ29uZmlnfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuT3NzQ29uZmlnLnByb3RvdHlwZS5zZXRFbmRwb2ludCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgMSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIGJ1Y2tldCA9IDI7CiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKcHJvdG8ucGIuT3NzQ29uZmlnLnByb3RvdHlwZS5nZXRCdWNrZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDIsICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuT3NzQ29uZmlnfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuT3NzQ29uZmlnLnByb3RvdHlwZS5zZXRCdWNrZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDIsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyBrZXlfaWQgPSAzOwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLk9zc0NvbmZpZy5wcm90b3R5cGUuZ2V0S2V5SWQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDMsICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuT3NzQ29uZmlnfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuT3NzQ29uZmlnLnByb3RvdHlwZS5zZXRLZXlJZCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgMywgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIGtleV9zZWNyZXQgPSA0OwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLk9zc0NvbmZpZy5wcm90b3R5cGUuZ2V0S2V5U2VjcmV0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA0LCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLk9zc0NvbmZpZ30gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLk9zc0NvbmZpZy5wcm90b3R5cGUuc2V0S2V5U2VjcmV0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCA0LCB2YWx1ZSk7Cn07CgppZiAoanNwYi5NZXNzYWdlLkdFTkVSQVRFX1RPX09CSkVDVCkgewogIC8qKgogICAqIENyZWF0ZXMgYW4gb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgcHJvdG8uCiAgICogRmllbGQgbmFtZXMgdGhhdCBhcmUgcmVzZXJ2ZWQgaW4gSmF2YVNjcmlwdCBhbmQgd2lsbCBiZSByZW5hbWVkIHRvIHBiX25hbWUuCiAgICogT3B0aW9uYWwgZmllbGRzIHRoYXQgYXJlIG5vdCBzZXQgd2lsbCBiZSBzZXQgdG8gdW5kZWZpbmVkLgogICAqIFRvIGFjY2VzcyBhIHJlc2VydmVkIGZpZWxkIHVzZSwgZm9vLnBiXzxuYW1lPiwgZWcsIGZvby5wYl9kZWZhdWx0LgogICAqIEZvciB0aGUgbGlzdCBvZiByZXNlcnZlZCBuYW1lcyBwbGVhc2Ugc2VlOgogICAqICAgICBuZXQvcHJvdG8yL2NvbXBpbGVyL2pzL2ludGVybmFsL2dlbmVyYXRvci5jYyNrS2V5d29yZC4KICAgKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfaW5jbHVkZUluc3RhbmNlIERlcHJlY2F0ZWQuIHdoZXRoZXIgdG8gaW5jbHVkZSB0aGUKICAgKiAgICAgSlNQQiBpbnN0YW5jZSBmb3IgdHJhbnNpdGlvbmFsIHNveSBwcm90byBzdXBwb3J0OgogICAqICAgICBodHRwOi8vZ290by9zb3ktcGFyYW0tbWlncmF0aW9uCiAgICogQHJldHVybiB7IU9iamVjdH0KICAgKi8KICBwcm90by5wYi5Sb25nY2xvdWRDb25maWcucHJvdG90eXBlLnRvT2JqZWN0ID0gZnVuY3Rpb24gKG9wdF9pbmNsdWRlSW5zdGFuY2UpIHsKICAgIHJldHVybiBwcm90by5wYi5Sb25nY2xvdWRDb25maWcudG9PYmplY3Qob3B0X2luY2x1ZGVJbnN0YW5jZSwgdGhpcyk7CiAgfTsKICAvKioKICAgKiBTdGF0aWMgdmVyc2lvbiBvZiB0aGUge0BzZWUgdG9PYmplY3R9IG1ldGhvZC4KICAgKiBAcGFyYW0ge2Jvb2xlYW58dW5kZWZpbmVkfSBpbmNsdWRlSW5zdGFuY2UgRGVwcmVjYXRlZC4gV2hldGhlciB0byBpbmNsdWRlCiAgICogICAgIHRoZSBKU1BCIGluc3RhbmNlIGZvciB0cmFuc2l0aW9uYWwgc295IHByb3RvIHN1cHBvcnQ6CiAgICogICAgIGh0dHA6Ly9nb3RvL3NveS1wYXJhbS1taWdyYXRpb24KICAgKiBAcGFyYW0geyFwcm90by5wYi5Sb25nY2xvdWRDb25maWd9IG1zZyBUaGUgbXNnIGluc3RhbmNlIHRvIHRyYW5zZm9ybS4KICAgKiBAcmV0dXJuIHshT2JqZWN0fQogICAqIEBzdXBwcmVzcyB7dW51c2VkTG9jYWxWYXJpYWJsZXN9IGYgaXMgb25seSB1c2VkIGZvciBuZXN0ZWQgbWVzc2FnZXMKICAgKi8KCgogIHByb3RvLnBiLlJvbmdjbG91ZENvbmZpZy50b09iamVjdCA9IGZ1bmN0aW9uIChpbmNsdWRlSW5zdGFuY2UsIG1zZykgewogICAgdmFyIGYsCiAgICAgICAgb2JqID0gewogICAgICBhcHBLZXk6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMSwgIiIpLAogICAgICBhcHBTZWNyZXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMiwgIiIpLAogICAgICBkb21haW46IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMywgIiIpLAogICAgICBvbGRBcHBLZXk6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNCwgIiIpLAogICAgICBvbGRBcHBTZWNyZXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNSwgIiIpLAogICAgICBvbGREb21haW46IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNiwgIiIpCiAgICB9OwoKICAgIGlmIChpbmNsdWRlSW5zdGFuY2UpIHsKICAgICAgb2JqLiRqc3BiTWVzc2FnZUluc3RhbmNlID0gbXNnOwogICAgfQoKICAgIHJldHVybiBvYmo7CiAgfTsKfQovKioKICogRGVzZXJpYWxpemVzIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkuCiAqIEBwYXJhbSB7anNwYi5CeXRlU291cmNlfSBieXRlcyBUaGUgYnl0ZXMgdG8gZGVzZXJpYWxpemUuCiAqIEByZXR1cm4geyFwcm90by5wYi5Sb25nY2xvdWRDb25maWd9CiAqLwoKCnByb3RvLnBiLlJvbmdjbG91ZENvbmZpZy5kZXNlcmlhbGl6ZUJpbmFyeSA9IGZ1bmN0aW9uIChieXRlcykgewogIHZhciByZWFkZXIgPSBuZXcganNwYi5CaW5hcnlSZWFkZXIoYnl0ZXMpOwogIHZhciBtc2cgPSBuZXcgcHJvdG8ucGIuUm9uZ2Nsb3VkQ29uZmlnKCk7CiAgcmV0dXJuIHByb3RvLnBiLlJvbmdjbG91ZENvbmZpZy5kZXNlcmlhbGl6ZUJpbmFyeUZyb21SZWFkZXIobXNnLCByZWFkZXIpOwp9OwovKioKICogRGVzZXJpYWxpemVzIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkgZnJvbSB0aGUKICogZ2l2ZW4gcmVhZGVyIGludG8gdGhlIGdpdmVuIG1lc3NhZ2Ugb2JqZWN0LgogKiBAcGFyYW0geyFwcm90by5wYi5Sb25nY2xvdWRDb25maWd9IG1zZyBUaGUgbWVzc2FnZSBvYmplY3QgdG8gZGVzZXJpYWxpemUgaW50by4KICogQHBhcmFtIHshanNwYi5CaW5hcnlSZWFkZXJ9IHJlYWRlciBUaGUgQmluYXJ5UmVhZGVyIHRvIHVzZS4KICogQHJldHVybiB7IXByb3RvLnBiLlJvbmdjbG91ZENvbmZpZ30KICovCgoKcHJvdG8ucGIuUm9uZ2Nsb3VkQ29uZmlnLmRlc2VyaWFsaXplQmluYXJ5RnJvbVJlYWRlciA9IGZ1bmN0aW9uIChtc2csIHJlYWRlcikgewogIHdoaWxlIChyZWFkZXIubmV4dEZpZWxkKCkpIHsKICAgIGlmIChyZWFkZXIuaXNFbmRHcm91cCgpKSB7CiAgICAgIGJyZWFrOwogICAgfQoKICAgIHZhciBmaWVsZCA9IHJlYWRlci5nZXRGaWVsZE51bWJlcigpOwoKICAgIHN3aXRjaCAoZmllbGQpIHsKICAgICAgY2FzZSAxOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldEFwcEtleSh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDI6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0QXBwU2VjcmV0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMzoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXREb21haW4odmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA0OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldE9sZEFwcEtleSh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDU6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0T2xkQXBwU2VjcmV0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXRPbGREb21haW4odmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgZGVmYXVsdDoKICAgICAgICByZWFkZXIuc2tpcEZpZWxkKCk7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfQoKICByZXR1cm4gbXNnOwp9OwovKioKICogU2VyaWFsaXplcyB0aGUgbWVzc2FnZSB0byBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZSBmb3JtYXQpLgogKiBAcmV0dXJuIHshVWludDhBcnJheX0KICovCgoKcHJvdG8ucGIuUm9uZ2Nsb3VkQ29uZmlnLnByb3RvdHlwZS5zZXJpYWxpemVCaW5hcnkgPSBmdW5jdGlvbiAoKSB7CiAgdmFyIHdyaXRlciA9IG5ldyBqc3BiLkJpbmFyeVdyaXRlcigpOwogIHByb3RvLnBiLlJvbmdjbG91ZENvbmZpZy5zZXJpYWxpemVCaW5hcnlUb1dyaXRlcih0aGlzLCB3cml0ZXIpOwogIHJldHVybiB3cml0ZXIuZ2V0UmVzdWx0QnVmZmVyKCk7Cn07Ci8qKgogKiBTZXJpYWxpemVzIHRoZSBnaXZlbiBtZXNzYWdlIHRvIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlCiAqIGZvcm1hdCksIHdyaXRpbmcgdG8gdGhlIGdpdmVuIEJpbmFyeVdyaXRlci4KICogQHBhcmFtIHshcHJvdG8ucGIuUm9uZ2Nsb3VkQ29uZmlnfSBtZXNzYWdlCiAqIEBwYXJhbSB7IWpzcGIuQmluYXJ5V3JpdGVyfSB3cml0ZXIKICogQHN1cHByZXNzIHt1bnVzZWRMb2NhbFZhcmlhYmxlc30gZiBpcyBvbmx5IHVzZWQgZm9yIG5lc3RlZCBtZXNzYWdlcwogKi8KCgpwcm90by5wYi5Sb25nY2xvdWRDb25maWcuc2VyaWFsaXplQmluYXJ5VG9Xcml0ZXIgPSBmdW5jdGlvbiAobWVzc2FnZSwgd3JpdGVyKSB7CiAgdmFyIGYgPSB1bmRlZmluZWQ7CiAgZiA9IG1lc3NhZ2UuZ2V0QXBwS2V5KCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZygxLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEFwcFNlY3JldCgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoMiwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXREb21haW4oKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDMsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0T2xkQXBwS2V5KCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZyg0LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldE9sZEFwcFNlY3JldCgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoNSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRPbGREb21haW4oKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDYsIGYpOwogIH0KfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyBhcHBfa2V5ID0gMTsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5Sb25nY2xvdWRDb25maWcucHJvdG90eXBlLmdldEFwcEtleSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMSwgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5Sb25nY2xvdWRDb25maWd9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5Sb25nY2xvdWRDb25maWcucHJvdG90eXBlLnNldEFwcEtleSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgMSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIGFwcF9zZWNyZXQgPSAyOwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLlJvbmdjbG91ZENvbmZpZy5wcm90b3R5cGUuZ2V0QXBwU2VjcmV0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAyLCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlJvbmdjbG91ZENvbmZpZ30gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlJvbmdjbG91ZENvbmZpZy5wcm90b3R5cGUuc2V0QXBwU2VjcmV0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCAyLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgZG9tYWluID0gMzsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5Sb25nY2xvdWRDb25maWcucHJvdG90eXBlLmdldERvbWFpbiA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMywgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5Sb25nY2xvdWRDb25maWd9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5Sb25nY2xvdWRDb25maWcucHJvdG90eXBlLnNldERvbWFpbiA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgMywgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIG9sZF9hcHBfa2V5ID0gNDsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5Sb25nY2xvdWRDb25maWcucHJvdG90eXBlLmdldE9sZEFwcEtleSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgNCwgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5Sb25nY2xvdWRDb25maWd9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5Sb25nY2xvdWRDb25maWcucHJvdG90eXBlLnNldE9sZEFwcEtleSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgNCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIG9sZF9hcHBfc2VjcmV0ID0gNTsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5Sb25nY2xvdWRDb25maWcucHJvdG90eXBlLmdldE9sZEFwcFNlY3JldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgNSwgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5Sb25nY2xvdWRDb25maWd9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5Sb25nY2xvdWRDb25maWcucHJvdG90eXBlLnNldE9sZEFwcFNlY3JldCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgNSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIG9sZF9kb21haW4gPSA2OwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLlJvbmdjbG91ZENvbmZpZy5wcm90b3R5cGUuZ2V0T2xkRG9tYWluID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA2LCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlJvbmdjbG91ZENvbmZpZ30gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlJvbmdjbG91ZENvbmZpZy5wcm90b3R5cGUuc2V0T2xkRG9tYWluID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCA2LCB2YWx1ZSk7Cn07CgppZiAoanNwYi5NZXNzYWdlLkdFTkVSQVRFX1RPX09CSkVDVCkgewogIC8qKgogICAqIENyZWF0ZXMgYW4gb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgcHJvdG8uCiAgICogRmllbGQgbmFtZXMgdGhhdCBhcmUgcmVzZXJ2ZWQgaW4gSmF2YVNjcmlwdCBhbmQgd2lsbCBiZSByZW5hbWVkIHRvIHBiX25hbWUuCiAgICogT3B0aW9uYWwgZmllbGRzIHRoYXQgYXJlIG5vdCBzZXQgd2lsbCBiZSBzZXQgdG8gdW5kZWZpbmVkLgogICAqIFRvIGFjY2VzcyBhIHJlc2VydmVkIGZpZWxkIHVzZSwgZm9vLnBiXzxuYW1lPiwgZWcsIGZvby5wYl9kZWZhdWx0LgogICAqIEZvciB0aGUgbGlzdCBvZiByZXNlcnZlZCBuYW1lcyBwbGVhc2Ugc2VlOgogICAqICAgICBuZXQvcHJvdG8yL2NvbXBpbGVyL2pzL2ludGVybmFsL2dlbmVyYXRvci5jYyNrS2V5d29yZC4KICAgKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfaW5jbHVkZUluc3RhbmNlIERlcHJlY2F0ZWQuIHdoZXRoZXIgdG8gaW5jbHVkZSB0aGUKICAgKiAgICAgSlNQQiBpbnN0YW5jZSBmb3IgdHJhbnNpdGlvbmFsIHNveSBwcm90byBzdXBwb3J0OgogICAqICAgICBodHRwOi8vZ290by9zb3ktcGFyYW0tbWlncmF0aW9uCiAgICogQHJldHVybiB7IU9iamVjdH0KICAgKi8KICBwcm90by5wYi5HcmVlbkNvbmZpZy5wcm90b3R5cGUudG9PYmplY3QgPSBmdW5jdGlvbiAob3B0X2luY2x1ZGVJbnN0YW5jZSkgewogICAgcmV0dXJuIHByb3RvLnBiLkdyZWVuQ29uZmlnLnRvT2JqZWN0KG9wdF9pbmNsdWRlSW5zdGFuY2UsIHRoaXMpOwogIH07CiAgLyoqCiAgICogU3RhdGljIHZlcnNpb24gb2YgdGhlIHtAc2VlIHRvT2JqZWN0fSBtZXRob2QuCiAgICogQHBhcmFtIHtib29sZWFufHVuZGVmaW5lZH0gaW5jbHVkZUluc3RhbmNlIERlcHJlY2F0ZWQuIFdoZXRoZXIgdG8gaW5jbHVkZQogICAqICAgICB0aGUgSlNQQiBpbnN0YW5jZSBmb3IgdHJhbnNpdGlvbmFsIHNveSBwcm90byBzdXBwb3J0OgogICAqICAgICBodHRwOi8vZ290by9zb3ktcGFyYW0tbWlncmF0aW9uCiAgICogQHBhcmFtIHshcHJvdG8ucGIuR3JlZW5Db25maWd9IG1zZyBUaGUgbXNnIGluc3RhbmNlIHRvIHRyYW5zZm9ybS4KICAgKiBAcmV0dXJuIHshT2JqZWN0fQogICAqIEBzdXBwcmVzcyB7dW51c2VkTG9jYWxWYXJpYWJsZXN9IGYgaXMgb25seSB1c2VkIGZvciBuZXN0ZWQgbWVzc2FnZXMKICAgKi8KCgogIHByb3RvLnBiLkdyZWVuQ29uZmlnLnRvT2JqZWN0ID0gZnVuY3Rpb24gKGluY2x1ZGVJbnN0YW5jZSwgbXNnKSB7CiAgICB2YXIgZiwKICAgICAgICBvYmogPSB7CiAgICAgIGtleUlkOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDEsICIiKSwKICAgICAga2V5U2VjcmV0OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDIsICIiKQogICAgfTsKCiAgICBpZiAoaW5jbHVkZUluc3RhbmNlKSB7CiAgICAgIG9iai4kanNwYk1lc3NhZ2VJbnN0YW5jZSA9IG1zZzsKICAgIH0KCiAgICByZXR1cm4gb2JqOwogIH07Cn0KLyoqCiAqIERlc2VyaWFsaXplcyBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZSBmb3JtYXQpLgogKiBAcGFyYW0ge2pzcGIuQnl0ZVNvdXJjZX0gYnl0ZXMgVGhlIGJ5dGVzIHRvIGRlc2VyaWFsaXplLgogKiBAcmV0dXJuIHshcHJvdG8ucGIuR3JlZW5Db25maWd9CiAqLwoKCnByb3RvLnBiLkdyZWVuQ29uZmlnLmRlc2VyaWFsaXplQmluYXJ5ID0gZnVuY3Rpb24gKGJ5dGVzKSB7CiAgdmFyIHJlYWRlciA9IG5ldyBqc3BiLkJpbmFyeVJlYWRlcihieXRlcyk7CiAgdmFyIG1zZyA9IG5ldyBwcm90by5wYi5HcmVlbkNvbmZpZygpOwogIHJldHVybiBwcm90by5wYi5HcmVlbkNvbmZpZy5kZXNlcmlhbGl6ZUJpbmFyeUZyb21SZWFkZXIobXNnLCByZWFkZXIpOwp9OwovKioKICogRGVzZXJpYWxpemVzIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkgZnJvbSB0aGUKICogZ2l2ZW4gcmVhZGVyIGludG8gdGhlIGdpdmVuIG1lc3NhZ2Ugb2JqZWN0LgogKiBAcGFyYW0geyFwcm90by5wYi5HcmVlbkNvbmZpZ30gbXNnIFRoZSBtZXNzYWdlIG9iamVjdCB0byBkZXNlcmlhbGl6ZSBpbnRvLgogKiBAcGFyYW0geyFqc3BiLkJpbmFyeVJlYWRlcn0gcmVhZGVyIFRoZSBCaW5hcnlSZWFkZXIgdG8gdXNlLgogKiBAcmV0dXJuIHshcHJvdG8ucGIuR3JlZW5Db25maWd9CiAqLwoKCnByb3RvLnBiLkdyZWVuQ29uZmlnLmRlc2VyaWFsaXplQmluYXJ5RnJvbVJlYWRlciA9IGZ1bmN0aW9uIChtc2csIHJlYWRlcikgewogIHdoaWxlIChyZWFkZXIubmV4dEZpZWxkKCkpIHsKICAgIGlmIChyZWFkZXIuaXNFbmRHcm91cCgpKSB7CiAgICAgIGJyZWFrOwogICAgfQoKICAgIHZhciBmaWVsZCA9IHJlYWRlci5nZXRGaWVsZE51bWJlcigpOwoKICAgIHN3aXRjaCAoZmllbGQpIHsKICAgICAgY2FzZSAxOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldEtleUlkKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXRLZXlTZWNyZXQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgZGVmYXVsdDoKICAgICAgICByZWFkZXIuc2tpcEZpZWxkKCk7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfQoKICByZXR1cm4gbXNnOwp9OwovKioKICogU2VyaWFsaXplcyB0aGUgbWVzc2FnZSB0byBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZSBmb3JtYXQpLgogKiBAcmV0dXJuIHshVWludDhBcnJheX0KICovCgoKcHJvdG8ucGIuR3JlZW5Db25maWcucHJvdG90eXBlLnNlcmlhbGl6ZUJpbmFyeSA9IGZ1bmN0aW9uICgpIHsKICB2YXIgd3JpdGVyID0gbmV3IGpzcGIuQmluYXJ5V3JpdGVyKCk7CiAgcHJvdG8ucGIuR3JlZW5Db25maWcuc2VyaWFsaXplQmluYXJ5VG9Xcml0ZXIodGhpcywgd3JpdGVyKTsKICByZXR1cm4gd3JpdGVyLmdldFJlc3VsdEJ1ZmZlcigpOwp9OwovKioKICogU2VyaWFsaXplcyB0aGUgZ2l2ZW4gbWVzc2FnZSB0byBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZQogKiBmb3JtYXQpLCB3cml0aW5nIHRvIHRoZSBnaXZlbiBCaW5hcnlXcml0ZXIuCiAqIEBwYXJhbSB7IXByb3RvLnBiLkdyZWVuQ29uZmlnfSBtZXNzYWdlCiAqIEBwYXJhbSB7IWpzcGIuQmluYXJ5V3JpdGVyfSB3cml0ZXIKICogQHN1cHByZXNzIHt1bnVzZWRMb2NhbFZhcmlhYmxlc30gZiBpcyBvbmx5IHVzZWQgZm9yIG5lc3RlZCBtZXNzYWdlcwogKi8KCgpwcm90by5wYi5HcmVlbkNvbmZpZy5zZXJpYWxpemVCaW5hcnlUb1dyaXRlciA9IGZ1bmN0aW9uIChtZXNzYWdlLCB3cml0ZXIpIHsKICB2YXIgZiA9IHVuZGVmaW5lZDsKICBmID0gbWVzc2FnZS5nZXRLZXlJZCgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoMSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRLZXlTZWNyZXQoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDIsIGYpOwogIH0KfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyBrZXlfaWQgPSAxOwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLkdyZWVuQ29uZmlnLnByb3RvdHlwZS5nZXRLZXlJZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMSwgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5HcmVlbkNvbmZpZ30gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkdyZWVuQ29uZmlnLnByb3RvdHlwZS5zZXRLZXlJZCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgMSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIGtleV9zZWNyZXQgPSAyOwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLkdyZWVuQ29uZmlnLnByb3RvdHlwZS5nZXRLZXlTZWNyZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDIsICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuR3JlZW5Db25maWd9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5HcmVlbkNvbmZpZy5wcm90b3R5cGUuc2V0S2V5U2VjcmV0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCAyLCB2YWx1ZSk7Cn07Ci8qKgogKiBMaXN0IG9mIHJlcGVhdGVkIGZpZWxkcyB3aXRoaW4gdGhpcyBtZXNzYWdlIHR5cGUuCiAqIEBwcml2YXRlIHshQXJyYXk8bnVtYmVyPn0KICogQGNvbnN0CiAqLwoKCnByb3RvLnBiLkFyZWFDb25maWcucmVwZWF0ZWRGaWVsZHNfID0gWzExLCAxNF07CgppZiAoanNwYi5NZXNzYWdlLkdFTkVSQVRFX1RPX09CSkVDVCkgewogIC8qKgogICAqIENyZWF0ZXMgYW4gb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgcHJvdG8uCiAgICogRmllbGQgbmFtZXMgdGhhdCBhcmUgcmVzZXJ2ZWQgaW4gSmF2YVNjcmlwdCBhbmQgd2lsbCBiZSByZW5hbWVkIHRvIHBiX25hbWUuCiAgICogT3B0aW9uYWwgZmllbGRzIHRoYXQgYXJlIG5vdCBzZXQgd2lsbCBiZSBzZXQgdG8gdW5kZWZpbmVkLgogICAqIFRvIGFjY2VzcyBhIHJlc2VydmVkIGZpZWxkIHVzZSwgZm9vLnBiXzxuYW1lPiwgZWcsIGZvby5wYl9kZWZhdWx0LgogICAqIEZvciB0aGUgbGlzdCBvZiByZXNlcnZlZCBuYW1lcyBwbGVhc2Ugc2VlOgogICAqICAgICBuZXQvcHJvdG8yL2NvbXBpbGVyL2pzL2ludGVybmFsL2dlbmVyYXRvci5jYyNrS2V5d29yZC4KICAgKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfaW5jbHVkZUluc3RhbmNlIERlcHJlY2F0ZWQuIHdoZXRoZXIgdG8gaW5jbHVkZSB0aGUKICAgKiAgICAgSlNQQiBpbnN0YW5jZSBmb3IgdHJhbnNpdGlvbmFsIHNveSBwcm90byBzdXBwb3J0OgogICAqICAgICBodHRwOi8vZ290by9zb3ktcGFyYW0tbWlncmF0aW9uCiAgICogQHJldHVybiB7IU9iamVjdH0KICAgKi8KICBwcm90by5wYi5BcmVhQ29uZmlnLnByb3RvdHlwZS50b09iamVjdCA9IGZ1bmN0aW9uIChvcHRfaW5jbHVkZUluc3RhbmNlKSB7CiAgICByZXR1cm4gcHJvdG8ucGIuQXJlYUNvbmZpZy50b09iamVjdChvcHRfaW5jbHVkZUluc3RhbmNlLCB0aGlzKTsKICB9OwogIC8qKgogICAqIFN0YXRpYyB2ZXJzaW9uIG9mIHRoZSB7QHNlZSB0b09iamVjdH0gbWV0aG9kLgogICAqIEBwYXJhbSB7Ym9vbGVhbnx1bmRlZmluZWR9IGluY2x1ZGVJbnN0YW5jZSBEZXByZWNhdGVkLiBXaGV0aGVyIHRvIGluY2x1ZGUKICAgKiAgICAgdGhlIEpTUEIgaW5zdGFuY2UgZm9yIHRyYW5zaXRpb25hbCBzb3kgcHJvdG8gc3VwcG9ydDoKICAgKiAgICAgaHR0cDovL2dvdG8vc295LXBhcmFtLW1pZ3JhdGlvbgogICAqIEBwYXJhbSB7IXByb3RvLnBiLkFyZWFDb25maWd9IG1zZyBUaGUgbXNnIGluc3RhbmNlIHRvIHRyYW5zZm9ybS4KICAgKiBAcmV0dXJuIHshT2JqZWN0fQogICAqIEBzdXBwcmVzcyB7dW51c2VkTG9jYWxWYXJpYWJsZXN9IGYgaXMgb25seSB1c2VkIGZvciBuZXN0ZWQgbWVzc2FnZXMKICAgKi8KCgogIHByb3RvLnBiLkFyZWFDb25maWcudG9PYmplY3QgPSBmdW5jdGlvbiAoaW5jbHVkZUluc3RhbmNlLCBtc2cpIHsKICAgIHZhciBmLAogICAgICAgIG9iaiA9IHsKICAgICAgaWQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMSwgMCksCiAgICAgIGFwcElkOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDIsIDApLAogICAgICBhcmVhSWQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMywgMCksCiAgICAgIGNvbnZlcnRSYXRlOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDQsIDApLAogICAgICBkZXBvc2l0Q29tbWlzc2lvbjoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA1LCAwKSwKICAgICAgcmV3YXJkQ29tbWlzc2lvbjoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA2LCAwKSwKICAgICAgY2FsbFByaWNlOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDcsIDApLAogICAgICBmcmVlTWVzc2FnZUNvdW50OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDgsIDApLAogICAgICBuZXdVc2VyUmV3YXJkOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDksIDApLAogICAgICBoZWFydGJlYXRJbnRlcnZhbDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxMCwgMCksCiAgICAgIHBheVR5cGVzTGlzdDogKGYgPSBqc3BiLk1lc3NhZ2UuZ2V0UmVwZWF0ZWRGaWVsZChtc2csIDExKSkgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IGYsCiAgICAgIGNkbjoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxMiwgIiIpLAogICAgICBkbmRQZXJpb2Q6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMTMsIDApLAogICAgICB0YWdzTGlzdDogKGYgPSBqc3BiLk1lc3NhZ2UuZ2V0UmVwZWF0ZWRGaWVsZChtc2csIDE0KSkgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IGYsCiAgICAgIGFuY2hvckV4Y2hhbmdlUmF0ZToganNwYi5NZXNzYWdlLmdldEZsb2F0aW5nUG9pbnRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMTUsIDAuMCksCiAgICAgIGFnb3JhQ29uZmlnOiAoZiA9IG1zZy5nZXRBZ29yYUNvbmZpZygpKSAmJiBwcm90by5wYi5BZ29yYUNvbmZpZy50b09iamVjdChpbmNsdWRlSW5zdGFuY2UsIGYpLAogICAgICBvc3NDb25maWc6IChmID0gbXNnLmdldE9zc0NvbmZpZygpKSAmJiBwcm90by5wYi5Pc3NDb25maWcudG9PYmplY3QoaW5jbHVkZUluc3RhbmNlLCBmKSwKICAgICAgcm9uZ2Nsb3VkQ29uZmlnOiAoZiA9IG1zZy5nZXRSb25nY2xvdWRDb25maWcoKSkgJiYgcHJvdG8ucGIuUm9uZ2Nsb3VkQ29uZmlnLnRvT2JqZWN0KGluY2x1ZGVJbnN0YW5jZSwgZiksCiAgICAgIGdyZWVuQ29uZmlnOiAoZiA9IG1zZy5nZXRHcmVlbkNvbmZpZygpKSAmJiBwcm90by5wYi5HcmVlbkNvbmZpZy50b09iamVjdChpbmNsdWRlSW5zdGFuY2UsIGYpLAogICAgICB1cGRhdGVkQXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMzAsIDApLAogICAgICBjcmVhdGVkQXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMzEsIDApCiAgICB9OwoKICAgIGlmIChpbmNsdWRlSW5zdGFuY2UpIHsKICAgICAgb2JqLiRqc3BiTWVzc2FnZUluc3RhbmNlID0gbXNnOwogICAgfQoKICAgIHJldHVybiBvYmo7CiAgfTsKfQovKioKICogRGVzZXJpYWxpemVzIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkuCiAqIEBwYXJhbSB7anNwYi5CeXRlU291cmNlfSBieXRlcyBUaGUgYnl0ZXMgdG8gZGVzZXJpYWxpemUuCiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhQ29uZmlnfQogKi8KCgpwcm90by5wYi5BcmVhQ29uZmlnLmRlc2VyaWFsaXplQmluYXJ5ID0gZnVuY3Rpb24gKGJ5dGVzKSB7CiAgdmFyIHJlYWRlciA9IG5ldyBqc3BiLkJpbmFyeVJlYWRlcihieXRlcyk7CiAgdmFyIG1zZyA9IG5ldyBwcm90by5wYi5BcmVhQ29uZmlnKCk7CiAgcmV0dXJuIHByb3RvLnBiLkFyZWFDb25maWcuZGVzZXJpYWxpemVCaW5hcnlGcm9tUmVhZGVyKG1zZywgcmVhZGVyKTsKfTsKLyoqCiAqIERlc2VyaWFsaXplcyBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZSBmb3JtYXQpIGZyb20gdGhlCiAqIGdpdmVuIHJlYWRlciBpbnRvIHRoZSBnaXZlbiBtZXNzYWdlIG9iamVjdC4KICogQHBhcmFtIHshcHJvdG8ucGIuQXJlYUNvbmZpZ30gbXNnIFRoZSBtZXNzYWdlIG9iamVjdCB0byBkZXNlcmlhbGl6ZSBpbnRvLgogKiBAcGFyYW0geyFqc3BiLkJpbmFyeVJlYWRlcn0gcmVhZGVyIFRoZSBCaW5hcnlSZWFkZXIgdG8gdXNlLgogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYUNvbmZpZ30KICovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5kZXNlcmlhbGl6ZUJpbmFyeUZyb21SZWFkZXIgPSBmdW5jdGlvbiAobXNnLCByZWFkZXIpIHsKICB3aGlsZSAocmVhZGVyLm5leHRGaWVsZCgpKSB7CiAgICBpZiAocmVhZGVyLmlzRW5kR3JvdXAoKSkgewogICAgICBicmVhazsKICAgIH0KCiAgICB2YXIgZmllbGQgPSByZWFkZXIuZ2V0RmllbGROdW1iZXIoKTsKCiAgICBzd2l0Y2ggKGZpZWxkKSB7CiAgICAgIGNhc2UgMToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRJZCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDI6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0QXBwSWQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAzOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldEFyZWFJZCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDQ6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0Q29udmVydFJhdGUodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA1OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldERlcG9zaXRDb21taXNzaW9uKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRSZXdhcmRDb21taXNzaW9uKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNzoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRDYWxsUHJpY2UodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA4OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldEZyZWVNZXNzYWdlQ291bnQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA5OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldE5ld1VzZXJSZXdhcmQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAxMDoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRIZWFydGJlYXRJbnRlcnZhbCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDExOgogICAgICAgIHZhciB2YWx1ZXMgPSByZWFkZXIuaXNEZWxpbWl0ZWQoKSA/IHJlYWRlci5yZWFkUGFja2VkRW51bSgpIDogW3JlYWRlci5yZWFkRW51bSgpXTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2YWx1ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIG1zZy5hZGRQYXlUeXBlcyh2YWx1ZXNbaV0pOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDEyOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldENkbih2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDEzOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldERuZFBlcmlvZCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDE0OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLmFkZFRhZ3ModmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAxNToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZEZsb2F0KCk7CiAgICAgICAgbXNnLnNldEFuY2hvckV4Y2hhbmdlUmF0ZSh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDIwOgogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBwcm90by5wYi5BZ29yYUNvbmZpZygpOwogICAgICAgIHJlYWRlci5yZWFkTWVzc2FnZSh2YWx1ZSwgcHJvdG8ucGIuQWdvcmFDb25maWcuZGVzZXJpYWxpemVCaW5hcnlGcm9tUmVhZGVyKTsKICAgICAgICBtc2cuc2V0QWdvcmFDb25maWcodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAyMToKICAgICAgICB2YXIgdmFsdWUgPSBuZXcgcHJvdG8ucGIuT3NzQ29uZmlnKCk7CiAgICAgICAgcmVhZGVyLnJlYWRNZXNzYWdlKHZhbHVlLCBwcm90by5wYi5Pc3NDb25maWcuZGVzZXJpYWxpemVCaW5hcnlGcm9tUmVhZGVyKTsKICAgICAgICBtc2cuc2V0T3NzQ29uZmlnKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjI6CiAgICAgICAgdmFyIHZhbHVlID0gbmV3IHByb3RvLnBiLlJvbmdjbG91ZENvbmZpZygpOwogICAgICAgIHJlYWRlci5yZWFkTWVzc2FnZSh2YWx1ZSwgcHJvdG8ucGIuUm9uZ2Nsb3VkQ29uZmlnLmRlc2VyaWFsaXplQmluYXJ5RnJvbVJlYWRlcik7CiAgICAgICAgbXNnLnNldFJvbmdjbG91ZENvbmZpZyh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDIzOgogICAgICAgIHZhciB2YWx1ZSA9IG5ldyBwcm90by5wYi5HcmVlbkNvbmZpZygpOwogICAgICAgIHJlYWRlci5yZWFkTWVzc2FnZSh2YWx1ZSwgcHJvdG8ucGIuR3JlZW5Db25maWcuZGVzZXJpYWxpemVCaW5hcnlGcm9tUmVhZGVyKTsKICAgICAgICBtc2cuc2V0R3JlZW5Db25maWcodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAzMDoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRVcGRhdGVkQXQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAzMToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRDcmVhdGVkQXQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgZGVmYXVsdDoKICAgICAgICByZWFkZXIuc2tpcEZpZWxkKCk7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfQoKICByZXR1cm4gbXNnOwp9OwovKioKICogU2VyaWFsaXplcyB0aGUgbWVzc2FnZSB0byBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZSBmb3JtYXQpLgogKiBAcmV0dXJuIHshVWludDhBcnJheX0KICovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuc2VyaWFsaXplQmluYXJ5ID0gZnVuY3Rpb24gKCkgewogIHZhciB3cml0ZXIgPSBuZXcganNwYi5CaW5hcnlXcml0ZXIoKTsKICBwcm90by5wYi5BcmVhQ29uZmlnLnNlcmlhbGl6ZUJpbmFyeVRvV3JpdGVyKHRoaXMsIHdyaXRlcik7CiAgcmV0dXJuIHdyaXRlci5nZXRSZXN1bHRCdWZmZXIoKTsKfTsKLyoqCiAqIFNlcmlhbGl6ZXMgdGhlIGdpdmVuIG1lc3NhZ2UgdG8gYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUKICogZm9ybWF0KSwgd3JpdGluZyB0byB0aGUgZ2l2ZW4gQmluYXJ5V3JpdGVyLgogKiBAcGFyYW0geyFwcm90by5wYi5BcmVhQ29uZmlnfSBtZXNzYWdlCiAqIEBwYXJhbSB7IWpzcGIuQmluYXJ5V3JpdGVyfSB3cml0ZXIKICogQHN1cHByZXNzIHt1bnVzZWRMb2NhbFZhcmlhYmxlc30gZiBpcyBvbmx5IHVzZWQgZm9yIG5lc3RlZCBtZXNzYWdlcwogKi8KCgpwcm90by5wYi5BcmVhQ29uZmlnLnNlcmlhbGl6ZUJpbmFyeVRvV3JpdGVyID0gZnVuY3Rpb24gKG1lc3NhZ2UsIHdyaXRlcikgewogIHZhciBmID0gdW5kZWZpbmVkOwogIGYgPSBtZXNzYWdlLmdldElkKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRBcHBJZCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDIsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0QXJlYUlkKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMywgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRDb252ZXJ0UmF0ZSgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDQsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0RGVwb3NpdENvbW1pc3Npb24oKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMig1LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldFJld2FyZENvbW1pc3Npb24oKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMig2LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldENhbGxQcmljZSgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDcsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0RnJlZU1lc3NhZ2VDb3VudCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDgsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0TmV3VXNlclJld2FyZCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDksIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0SGVhcnRiZWF0SW50ZXJ2YWwoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigxMCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRQYXlUeXBlc0xpc3QoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlUGFja2VkRW51bSgxMSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRDZG4oKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDEyLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldERuZFBlcmlvZCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDEzLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldFRhZ3NMaXN0KCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVJlcGVhdGVkU3RyaW5nKDE0LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEFuY2hvckV4Y2hhbmdlUmF0ZSgpOwoKICBpZiAoZiAhPT0gMC4wKSB7CiAgICB3cml0ZXIud3JpdGVGbG9hdCgxNSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRBZ29yYUNvbmZpZygpOwoKICBpZiAoZiAhPSBudWxsKSB7CiAgICB3cml0ZXIud3JpdGVNZXNzYWdlKDIwLCBmLCBwcm90by5wYi5BZ29yYUNvbmZpZy5zZXJpYWxpemVCaW5hcnlUb1dyaXRlcik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRPc3NDb25maWcoKTsKCiAgaWYgKGYgIT0gbnVsbCkgewogICAgd3JpdGVyLndyaXRlTWVzc2FnZSgyMSwgZiwgcHJvdG8ucGIuT3NzQ29uZmlnLnNlcmlhbGl6ZUJpbmFyeVRvV3JpdGVyKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldFJvbmdjbG91ZENvbmZpZygpOwoKICBpZiAoZiAhPSBudWxsKSB7CiAgICB3cml0ZXIud3JpdGVNZXNzYWdlKDIyLCBmLCBwcm90by5wYi5Sb25nY2xvdWRDb25maWcuc2VyaWFsaXplQmluYXJ5VG9Xcml0ZXIpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0R3JlZW5Db25maWcoKTsKCiAgaWYgKGYgIT0gbnVsbCkgewogICAgd3JpdGVyLndyaXRlTWVzc2FnZSgyMywgZiwgcHJvdG8ucGIuR3JlZW5Db25maWcuc2VyaWFsaXplQmluYXJ5VG9Xcml0ZXIpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0VXBkYXRlZEF0KCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMzAsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0Q3JlYXRlZEF0KCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMzEsIGYpOwogIH0KfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBpZCA9IDE7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuZ2V0SWQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDEsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhQ29uZmlnfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuc2V0SWQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDEsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBhcHBfaWQgPSAyOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFyZWFDb25maWcucHJvdG90eXBlLmdldEFwcElkID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAyLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYUNvbmZpZ30gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFyZWFDb25maWcucHJvdG90eXBlLnNldEFwcElkID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAyLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgYXJlYV9pZCA9IDM7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuZ2V0QXJlYUlkID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAzLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYUNvbmZpZ30gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFyZWFDb25maWcucHJvdG90eXBlLnNldEFyZWFJZCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMywgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGNvbnZlcnRfcmF0ZSA9IDQ7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuZ2V0Q29udmVydFJhdGUgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDQsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhQ29uZmlnfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuc2V0Q29udmVydFJhdGUgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDQsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBkZXBvc2l0X2NvbW1pc3Npb24gPSA1OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFyZWFDb25maWcucHJvdG90eXBlLmdldERlcG9zaXRDb21taXNzaW9uID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA1LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYUNvbmZpZ30gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFyZWFDb25maWcucHJvdG90eXBlLnNldERlcG9zaXRDb21taXNzaW9uID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCA1LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgcmV3YXJkX2NvbW1pc3Npb24gPSA2OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFyZWFDb25maWcucHJvdG90eXBlLmdldFJld2FyZENvbW1pc3Npb24gPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDYsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhQ29uZmlnfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuc2V0UmV3YXJkQ29tbWlzc2lvbiA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgNiwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGNhbGxfcHJpY2UgPSA3OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFyZWFDb25maWcucHJvdG90eXBlLmdldENhbGxQcmljZSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgNywgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFyZWFDb25maWd9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BcmVhQ29uZmlnLnByb3RvdHlwZS5zZXRDYWxsUHJpY2UgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDcsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBmcmVlX21lc3NhZ2VfY291bnQgPSA4OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFyZWFDb25maWcucHJvdG90eXBlLmdldEZyZWVNZXNzYWdlQ291bnQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDgsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhQ29uZmlnfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuc2V0RnJlZU1lc3NhZ2VDb3VudCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgOCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIG5ld191c2VyX3Jld2FyZCA9IDk7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuZ2V0TmV3VXNlclJld2FyZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgOSwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFyZWFDb25maWd9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BcmVhQ29uZmlnLnByb3RvdHlwZS5zZXROZXdVc2VyUmV3YXJkID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCA5LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgaGVhcnRiZWF0X2ludGVydmFsID0gMTA7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuZ2V0SGVhcnRiZWF0SW50ZXJ2YWwgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDEwLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYUNvbmZpZ30gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFyZWFDb25maWcucHJvdG90eXBlLnNldEhlYXJ0YmVhdEludGVydmFsID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAxMCwgdmFsdWUpOwp9OwovKioKICogcmVwZWF0ZWQgUGF5VHlwZSBwYXlfdHlwZXMgPSAxMTsKICogQHJldHVybiB7IUFycmF5PCFwcm90by5wYi5QYXlUeXBlPn0KICovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuZ2V0UGF5VHlwZXNMaXN0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0UmVwZWF0ZWRGaWVsZCh0aGlzLCAxMSk7Cn07Ci8qKgogKiBAcGFyYW0geyFBcnJheTwhcHJvdG8ucGIuUGF5VHlwZT59IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhQ29uZmlnfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuc2V0UGF5VHlwZXNMaXN0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRGaWVsZCh0aGlzLCAxMSwgdmFsdWUgfHwgW10pOwp9OwovKioKICogQHBhcmFtIHshcHJvdG8ucGIuUGF5VHlwZX0gdmFsdWUKICogQHBhcmFtIHtudW1iZXI9fSBvcHRfaW5kZXgKICogQHJldHVybiB7IXByb3RvLnBiLkFyZWFDb25maWd9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BcmVhQ29uZmlnLnByb3RvdHlwZS5hZGRQYXlUeXBlcyA9IGZ1bmN0aW9uICh2YWx1ZSwgb3B0X2luZGV4KSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5hZGRUb1JlcGVhdGVkRmllbGQodGhpcywgMTEsIHZhbHVlLCBvcHRfaW5kZXgpOwp9OwovKioKICogQ2xlYXJzIHRoZSBsaXN0IG1ha2luZyBpdCBlbXB0eSBidXQgbm9uLW51bGwuCiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhQ29uZmlnfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuY2xlYXJQYXlUeXBlc0xpc3QgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMuc2V0UGF5VHlwZXNMaXN0KFtdKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyBjZG4gPSAxMjsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5BcmVhQ29uZmlnLnByb3RvdHlwZS5nZXRDZG4gPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDEyLCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFyZWFDb25maWd9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BcmVhQ29uZmlnLnByb3RvdHlwZS5zZXRDZG4gPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDEyLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgZG5kX3BlcmlvZCA9IDEzOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFyZWFDb25maWcucHJvdG90eXBlLmdldERuZFBlcmlvZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMTMsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhQ29uZmlnfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuc2V0RG5kUGVyaW9kID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAxMywgdmFsdWUpOwp9OwovKioKICogcmVwZWF0ZWQgc3RyaW5nIHRhZ3MgPSAxNDsKICogQHJldHVybiB7IUFycmF5PHN0cmluZz59CiAqLwoKCnByb3RvLnBiLkFyZWFDb25maWcucHJvdG90eXBlLmdldFRhZ3NMaXN0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0UmVwZWF0ZWRGaWVsZCh0aGlzLCAxNCk7Cn07Ci8qKgogKiBAcGFyYW0geyFBcnJheTxzdHJpbmc+fSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYUNvbmZpZ30gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFyZWFDb25maWcucHJvdG90eXBlLnNldFRhZ3NMaXN0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRGaWVsZCh0aGlzLCAxNCwgdmFsdWUgfHwgW10pOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEBwYXJhbSB7bnVtYmVyPX0gb3B0X2luZGV4CiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhQ29uZmlnfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuYWRkVGFncyA9IGZ1bmN0aW9uICh2YWx1ZSwgb3B0X2luZGV4KSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5hZGRUb1JlcGVhdGVkRmllbGQodGhpcywgMTQsIHZhbHVlLCBvcHRfaW5kZXgpOwp9OwovKioKICogQ2xlYXJzIHRoZSBsaXN0IG1ha2luZyBpdCBlbXB0eSBidXQgbm9uLW51bGwuCiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhQ29uZmlnfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuY2xlYXJUYWdzTGlzdCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5zZXRUYWdzTGlzdChbXSk7Cn07Ci8qKgogKiBvcHRpb25hbCBmbG9hdCBhbmNob3JfZXhjaGFuZ2VfcmF0ZSA9IDE1OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFyZWFDb25maWcucHJvdG90eXBlLmdldEFuY2hvckV4Y2hhbmdlUmF0ZSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZsb2F0aW5nUG9pbnRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDE1LCAwLjApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhQ29uZmlnfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuc2V0QW5jaG9yRXhjaGFuZ2VSYXRlID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNGbG9hdEZpZWxkKHRoaXMsIDE1LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBBZ29yYUNvbmZpZyBhZ29yYV9jb25maWcgPSAyMDsKICogQHJldHVybiB7P3Byb3RvLnBiLkFnb3JhQ29uZmlnfQogKi8KCgpwcm90by5wYi5BcmVhQ29uZmlnLnByb3RvdHlwZS5nZXRBZ29yYUNvbmZpZyA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldFdyYXBwZXJGaWVsZCh0aGlzLCBwcm90by5wYi5BZ29yYUNvbmZpZywgMjApOwp9OwovKioKICogQHBhcmFtIHs/cHJvdG8ucGIuQWdvcmFDb25maWd8dW5kZWZpbmVkfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYUNvbmZpZ30gcmV0dXJucyB0aGlzCiovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuc2V0QWdvcmFDb25maWcgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFdyYXBwZXJGaWVsZCh0aGlzLCAyMCwgdmFsdWUpOwp9OwovKioKICogQ2xlYXJzIHRoZSBtZXNzYWdlIGZpZWxkIG1ha2luZyBpdCB1bmRlZmluZWQuCiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhQ29uZmlnfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuY2xlYXJBZ29yYUNvbmZpZyA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5zZXRBZ29yYUNvbmZpZyh1bmRlZmluZWQpOwp9OwovKioKICogUmV0dXJucyB3aGV0aGVyIHRoaXMgZmllbGQgaXMgc2V0LgogKiBAcmV0dXJuIHtib29sZWFufQogKi8KCgpwcm90by5wYi5BcmVhQ29uZmlnLnByb3RvdHlwZS5oYXNBZ29yYUNvbmZpZyA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkKHRoaXMsIDIwKSAhPSBudWxsOwp9OwovKioKICogb3B0aW9uYWwgT3NzQ29uZmlnIG9zc19jb25maWcgPSAyMTsKICogQHJldHVybiB7P3Byb3RvLnBiLk9zc0NvbmZpZ30KICovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuZ2V0T3NzQ29uZmlnID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0V3JhcHBlckZpZWxkKHRoaXMsIHByb3RvLnBiLk9zc0NvbmZpZywgMjEpOwp9OwovKioKICogQHBhcmFtIHs/cHJvdG8ucGIuT3NzQ29uZmlnfHVuZGVmaW5lZH0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFyZWFDb25maWd9IHJldHVybnMgdGhpcwoqLwoKCnByb3RvLnBiLkFyZWFDb25maWcucHJvdG90eXBlLnNldE9zc0NvbmZpZyA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0V3JhcHBlckZpZWxkKHRoaXMsIDIxLCB2YWx1ZSk7Cn07Ci8qKgogKiBDbGVhcnMgdGhlIG1lc3NhZ2UgZmllbGQgbWFraW5nIGl0IHVuZGVmaW5lZC4KICogQHJldHVybiB7IXByb3RvLnBiLkFyZWFDb25maWd9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BcmVhQ29uZmlnLnByb3RvdHlwZS5jbGVhck9zc0NvbmZpZyA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5zZXRPc3NDb25maWcodW5kZWZpbmVkKTsKfTsKLyoqCiAqIFJldHVybnMgd2hldGhlciB0aGlzIGZpZWxkIGlzIHNldC4KICogQHJldHVybiB7Ym9vbGVhbn0KICovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuaGFzT3NzQ29uZmlnID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGQodGhpcywgMjEpICE9IG51bGw7Cn07Ci8qKgogKiBvcHRpb25hbCBSb25nY2xvdWRDb25maWcgcm9uZ2Nsb3VkX2NvbmZpZyA9IDIyOwogKiBAcmV0dXJuIHs/cHJvdG8ucGIuUm9uZ2Nsb3VkQ29uZmlnfQogKi8KCgpwcm90by5wYi5BcmVhQ29uZmlnLnByb3RvdHlwZS5nZXRSb25nY2xvdWRDb25maWcgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRXcmFwcGVyRmllbGQodGhpcywgcHJvdG8ucGIuUm9uZ2Nsb3VkQ29uZmlnLCAyMik7Cn07Ci8qKgogKiBAcGFyYW0gez9wcm90by5wYi5Sb25nY2xvdWRDb25maWd8dW5kZWZpbmVkfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYUNvbmZpZ30gcmV0dXJucyB0aGlzCiovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuc2V0Um9uZ2Nsb3VkQ29uZmlnID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRXcmFwcGVyRmllbGQodGhpcywgMjIsIHZhbHVlKTsKfTsKLyoqCiAqIENsZWFycyB0aGUgbWVzc2FnZSBmaWVsZCBtYWtpbmcgaXQgdW5kZWZpbmVkLgogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYUNvbmZpZ30gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFyZWFDb25maWcucHJvdG90eXBlLmNsZWFyUm9uZ2Nsb3VkQ29uZmlnID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLnNldFJvbmdjbG91ZENvbmZpZyh1bmRlZmluZWQpOwp9OwovKioKICogUmV0dXJucyB3aGV0aGVyIHRoaXMgZmllbGQgaXMgc2V0LgogKiBAcmV0dXJuIHtib29sZWFufQogKi8KCgpwcm90by5wYi5BcmVhQ29uZmlnLnByb3RvdHlwZS5oYXNSb25nY2xvdWRDb25maWcgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZCh0aGlzLCAyMikgIT0gbnVsbDsKfTsKLyoqCiAqIG9wdGlvbmFsIEdyZWVuQ29uZmlnIGdyZWVuX2NvbmZpZyA9IDIzOwogKiBAcmV0dXJuIHs/cHJvdG8ucGIuR3JlZW5Db25maWd9CiAqLwoKCnByb3RvLnBiLkFyZWFDb25maWcucHJvdG90eXBlLmdldEdyZWVuQ29uZmlnID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0V3JhcHBlckZpZWxkKHRoaXMsIHByb3RvLnBiLkdyZWVuQ29uZmlnLCAyMyk7Cn07Ci8qKgogKiBAcGFyYW0gez9wcm90by5wYi5HcmVlbkNvbmZpZ3x1bmRlZmluZWR9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhQ29uZmlnfSByZXR1cm5zIHRoaXMKKi8KCgpwcm90by5wYi5BcmVhQ29uZmlnLnByb3RvdHlwZS5zZXRHcmVlbkNvbmZpZyA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0V3JhcHBlckZpZWxkKHRoaXMsIDIzLCB2YWx1ZSk7Cn07Ci8qKgogKiBDbGVhcnMgdGhlIG1lc3NhZ2UgZmllbGQgbWFraW5nIGl0IHVuZGVmaW5lZC4KICogQHJldHVybiB7IXByb3RvLnBiLkFyZWFDb25maWd9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BcmVhQ29uZmlnLnByb3RvdHlwZS5jbGVhckdyZWVuQ29uZmlnID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLnNldEdyZWVuQ29uZmlnKHVuZGVmaW5lZCk7Cn07Ci8qKgogKiBSZXR1cm5zIHdoZXRoZXIgdGhpcyBmaWVsZCBpcyBzZXQuCiAqIEByZXR1cm4ge2Jvb2xlYW59CiAqLwoKCnByb3RvLnBiLkFyZWFDb25maWcucHJvdG90eXBlLmhhc0dyZWVuQ29uZmlnID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGQodGhpcywgMjMpICE9IG51bGw7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgdXBkYXRlZF9hdCA9IDMwOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFyZWFDb25maWcucHJvdG90eXBlLmdldFVwZGF0ZWRBdCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMzAsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhQ29uZmlnfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXJlYUNvbmZpZy5wcm90b3R5cGUuc2V0VXBkYXRlZEF0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAzMCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGNyZWF0ZWRfYXQgPSAzMTsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BcmVhQ29uZmlnLnByb3RvdHlwZS5nZXRDcmVhdGVkQXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDMxLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYUNvbmZpZ30gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFyZWFDb25maWcucHJvdG90eXBlLnNldENyZWF0ZWRBdCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMzEsIHZhbHVlKTsKfTsKCmlmIChqc3BiLk1lc3NhZ2UuR0VORVJBVEVfVE9fT0JKRUNUKSB7CiAgLyoqCiAgICogQ3JlYXRlcyBhbiBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBwcm90by4KICAgKiBGaWVsZCBuYW1lcyB0aGF0IGFyZSByZXNlcnZlZCBpbiBKYXZhU2NyaXB0IGFuZCB3aWxsIGJlIHJlbmFtZWQgdG8gcGJfbmFtZS4KICAgKiBPcHRpb25hbCBmaWVsZHMgdGhhdCBhcmUgbm90IHNldCB3aWxsIGJlIHNldCB0byB1bmRlZmluZWQuCiAgICogVG8gYWNjZXNzIGEgcmVzZXJ2ZWQgZmllbGQgdXNlLCBmb28ucGJfPG5hbWU+LCBlZywgZm9vLnBiX2RlZmF1bHQuCiAgICogRm9yIHRoZSBsaXN0IG9mIHJlc2VydmVkIG5hbWVzIHBsZWFzZSBzZWU6CiAgICogICAgIG5ldC9wcm90bzIvY29tcGlsZXIvanMvaW50ZXJuYWwvZ2VuZXJhdG9yLmNjI2tLZXl3b3JkLgogICAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF9pbmNsdWRlSW5zdGFuY2UgRGVwcmVjYXRlZC4gd2hldGhlciB0byBpbmNsdWRlIHRoZQogICAqICAgICBKU1BCIGluc3RhbmNlIGZvciB0cmFuc2l0aW9uYWwgc295IHByb3RvIHN1cHBvcnQ6CiAgICogICAgIGh0dHA6Ly9nb3RvL3NveS1wYXJhbS1taWdyYXRpb24KICAgKiBAcmV0dXJuIHshT2JqZWN0fQogICAqLwogIHByb3RvLnBiLlBheUNvbmZpZy5wcm90b3R5cGUudG9PYmplY3QgPSBmdW5jdGlvbiAob3B0X2luY2x1ZGVJbnN0YW5jZSkgewogICAgcmV0dXJuIHByb3RvLnBiLlBheUNvbmZpZy50b09iamVjdChvcHRfaW5jbHVkZUluc3RhbmNlLCB0aGlzKTsKICB9OwogIC8qKgogICAqIFN0YXRpYyB2ZXJzaW9uIG9mIHRoZSB7QHNlZSB0b09iamVjdH0gbWV0aG9kLgogICAqIEBwYXJhbSB7Ym9vbGVhbnx1bmRlZmluZWR9IGluY2x1ZGVJbnN0YW5jZSBEZXByZWNhdGVkLiBXaGV0aGVyIHRvIGluY2x1ZGUKICAgKiAgICAgdGhlIEpTUEIgaW5zdGFuY2UgZm9yIHRyYW5zaXRpb25hbCBzb3kgcHJvdG8gc3VwcG9ydDoKICAgKiAgICAgaHR0cDovL2dvdG8vc295LXBhcmFtLW1pZ3JhdGlvbgogICAqIEBwYXJhbSB7IXByb3RvLnBiLlBheUNvbmZpZ30gbXNnIFRoZSBtc2cgaW5zdGFuY2UgdG8gdHJhbnNmb3JtLgogICAqIEByZXR1cm4geyFPYmplY3R9CiAgICogQHN1cHByZXNzIHt1bnVzZWRMb2NhbFZhcmlhYmxlc30gZiBpcyBvbmx5IHVzZWQgZm9yIG5lc3RlZCBtZXNzYWdlcwogICAqLwoKCiAgcHJvdG8ucGIuUGF5Q29uZmlnLnRvT2JqZWN0ID0gZnVuY3Rpb24gKGluY2x1ZGVJbnN0YW5jZSwgbXNnKSB7CiAgICB2YXIgZiwKICAgICAgICBvYmogPSB7CiAgICAgIGlkOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDEsIDApLAogICAgICBhcmVhSWQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMiwgMCksCiAgICAgIHR5cGU6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMywgMCksCiAgICAgIGFwcElkOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDQsICIiKSwKICAgICAgYXBwU2VjcmV0OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDYsICIiKSwKICAgICAgcmVkaXJlY3RVcmw6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgOCwgIiIpLAogICAgICBjYWxsYmFja1VybDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxMCwgIiIpLAogICAgICBleHRyYTE6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMTEsICIiKSwKICAgICAgZXh0cmEyOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDEyLCAiIiksCiAgICAgIGV4dHJhMzoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxMywgIiIpLAogICAgICB1cGRhdGVkQXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjAsIDApLAogICAgICBjcmVhdGVkQXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjEsIDApCiAgICB9OwoKICAgIGlmIChpbmNsdWRlSW5zdGFuY2UpIHsKICAgICAgb2JqLiRqc3BiTWVzc2FnZUluc3RhbmNlID0gbXNnOwogICAgfQoKICAgIHJldHVybiBvYmo7CiAgfTsKfQovKioKICogRGVzZXJpYWxpemVzIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkuCiAqIEBwYXJhbSB7anNwYi5CeXRlU291cmNlfSBieXRlcyBUaGUgYnl0ZXMgdG8gZGVzZXJpYWxpemUuCiAqIEByZXR1cm4geyFwcm90by5wYi5QYXlDb25maWd9CiAqLwoKCnByb3RvLnBiLlBheUNvbmZpZy5kZXNlcmlhbGl6ZUJpbmFyeSA9IGZ1bmN0aW9uIChieXRlcykgewogIHZhciByZWFkZXIgPSBuZXcganNwYi5CaW5hcnlSZWFkZXIoYnl0ZXMpOwogIHZhciBtc2cgPSBuZXcgcHJvdG8ucGIuUGF5Q29uZmlnKCk7CiAgcmV0dXJuIHByb3RvLnBiLlBheUNvbmZpZy5kZXNlcmlhbGl6ZUJpbmFyeUZyb21SZWFkZXIobXNnLCByZWFkZXIpOwp9OwovKioKICogRGVzZXJpYWxpemVzIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkgZnJvbSB0aGUKICogZ2l2ZW4gcmVhZGVyIGludG8gdGhlIGdpdmVuIG1lc3NhZ2Ugb2JqZWN0LgogKiBAcGFyYW0geyFwcm90by5wYi5QYXlDb25maWd9IG1zZyBUaGUgbWVzc2FnZSBvYmplY3QgdG8gZGVzZXJpYWxpemUgaW50by4KICogQHBhcmFtIHshanNwYi5CaW5hcnlSZWFkZXJ9IHJlYWRlciBUaGUgQmluYXJ5UmVhZGVyIHRvIHVzZS4KICogQHJldHVybiB7IXByb3RvLnBiLlBheUNvbmZpZ30KICovCgoKcHJvdG8ucGIuUGF5Q29uZmlnLmRlc2VyaWFsaXplQmluYXJ5RnJvbVJlYWRlciA9IGZ1bmN0aW9uIChtc2csIHJlYWRlcikgewogIHdoaWxlIChyZWFkZXIubmV4dEZpZWxkKCkpIHsKICAgIGlmIChyZWFkZXIuaXNFbmRHcm91cCgpKSB7CiAgICAgIGJyZWFrOwogICAgfQoKICAgIHZhciBmaWVsZCA9IHJlYWRlci5nZXRGaWVsZE51bWJlcigpOwoKICAgIHN3aXRjaCAoZmllbGQpIHsKICAgICAgY2FzZSAxOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldElkKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRBcmVhSWQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAzOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkRW51bSgpOwogICAgICAgIG1zZy5zZXRUeXBlKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNDoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXRBcHBJZCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDY6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0QXBwU2VjcmV0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgODoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXRSZWRpcmVjdFVybCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDEwOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldENhbGxiYWNrVXJsKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0RXh0cmExKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTI6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0RXh0cmEyKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTM6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0RXh0cmEzKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjA6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0VXBkYXRlZEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0Q3JlYXRlZEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmVhZGVyLnNraXBGaWVsZCgpOwogICAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgcmV0dXJuIG1zZzsKfTsKLyoqCiAqIFNlcmlhbGl6ZXMgdGhlIG1lc3NhZ2UgdG8gYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUgZm9ybWF0KS4KICogQHJldHVybiB7IVVpbnQ4QXJyYXl9CiAqLwoKCnByb3RvLnBiLlBheUNvbmZpZy5wcm90b3R5cGUuc2VyaWFsaXplQmluYXJ5ID0gZnVuY3Rpb24gKCkgewogIHZhciB3cml0ZXIgPSBuZXcganNwYi5CaW5hcnlXcml0ZXIoKTsKICBwcm90by5wYi5QYXlDb25maWcuc2VyaWFsaXplQmluYXJ5VG9Xcml0ZXIodGhpcywgd3JpdGVyKTsKICByZXR1cm4gd3JpdGVyLmdldFJlc3VsdEJ1ZmZlcigpOwp9OwovKioKICogU2VyaWFsaXplcyB0aGUgZ2l2ZW4gbWVzc2FnZSB0byBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZQogKiBmb3JtYXQpLCB3cml0aW5nIHRvIHRoZSBnaXZlbiBCaW5hcnlXcml0ZXIuCiAqIEBwYXJhbSB7IXByb3RvLnBiLlBheUNvbmZpZ30gbWVzc2FnZQogKiBAcGFyYW0geyFqc3BiLkJpbmFyeVdyaXRlcn0gd3JpdGVyCiAqIEBzdXBwcmVzcyB7dW51c2VkTG9jYWxWYXJpYWJsZXN9IGYgaXMgb25seSB1c2VkIGZvciBuZXN0ZWQgbWVzc2FnZXMKICovCgoKcHJvdG8ucGIuUGF5Q29uZmlnLnNlcmlhbGl6ZUJpbmFyeVRvV3JpdGVyID0gZnVuY3Rpb24gKG1lc3NhZ2UsIHdyaXRlcikgewogIHZhciBmID0gdW5kZWZpbmVkOwogIGYgPSBtZXNzYWdlLmdldElkKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRBcmVhSWQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigyLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldFR5cGUoKTsKCiAgaWYgKGYgIT09IDAuMCkgewogICAgd3JpdGVyLndyaXRlRW51bSgzLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEFwcElkKCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZyg0LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEFwcFNlY3JldCgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoNiwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRSZWRpcmVjdFVybCgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoOCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRDYWxsYmFja1VybCgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoMTAsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0RXh0cmExKCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZygxMSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRFeHRyYTIoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDEyLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEV4dHJhMygpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoMTMsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0VXBkYXRlZEF0KCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMjAsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0Q3JlYXRlZEF0KCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMjEsIGYpOwogIH0KfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBpZCA9IDE7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuUGF5Q29uZmlnLnByb3RvdHlwZS5nZXRJZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMSwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlBheUNvbmZpZ30gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlBheUNvbmZpZy5wcm90b3R5cGUuc2V0SWQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDEsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBhcmVhX2lkID0gMjsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5QYXlDb25maWcucHJvdG90eXBlLmdldEFyZWFJZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMiwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlBheUNvbmZpZ30gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlBheUNvbmZpZy5wcm90b3R5cGUuc2V0QXJlYUlkID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAyLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBQYXlUeXBlIHR5cGUgPSAzOwogKiBAcmV0dXJuIHshcHJvdG8ucGIuUGF5VHlwZX0KICovCgoKcHJvdG8ucGIuUGF5Q29uZmlnLnByb3RvdHlwZS5nZXRUeXBlID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAzLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7IXByb3RvLnBiLlBheVR5cGV9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5QYXlDb25maWd9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5QYXlDb25maWcucHJvdG90eXBlLnNldFR5cGUgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0VudW1GaWVsZCh0aGlzLCAzLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgYXBwX2lkID0gNDsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5QYXlDb25maWcucHJvdG90eXBlLmdldEFwcElkID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA0LCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlBheUNvbmZpZ30gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlBheUNvbmZpZy5wcm90b3R5cGUuc2V0QXBwSWQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDQsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyBhcHBfc2VjcmV0ID0gNjsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5QYXlDb25maWcucHJvdG90eXBlLmdldEFwcFNlY3JldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgNiwgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5QYXlDb25maWd9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5QYXlDb25maWcucHJvdG90eXBlLnNldEFwcFNlY3JldCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgNiwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIHJlZGlyZWN0X3VybCA9IDg7CiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKcHJvdG8ucGIuUGF5Q29uZmlnLnByb3RvdHlwZS5nZXRSZWRpcmVjdFVybCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgOCwgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5QYXlDb25maWd9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5QYXlDb25maWcucHJvdG90eXBlLnNldFJlZGlyZWN0VXJsID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCA4LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgY2FsbGJhY2tfdXJsID0gMTA7CiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKcHJvdG8ucGIuUGF5Q29uZmlnLnByb3RvdHlwZS5nZXRDYWxsYmFja1VybCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMTAsICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuUGF5Q29uZmlnfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuUGF5Q29uZmlnLnByb3RvdHlwZS5zZXRDYWxsYmFja1VybCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgMTAsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyBleHRyYTEgPSAxMTsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5QYXlDb25maWcucHJvdG90eXBlLmdldEV4dHJhMSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMTEsICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuUGF5Q29uZmlnfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuUGF5Q29uZmlnLnByb3RvdHlwZS5zZXRFeHRyYTEgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDExLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgZXh0cmEyID0gMTI7CiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKcHJvdG8ucGIuUGF5Q29uZmlnLnByb3RvdHlwZS5nZXRFeHRyYTIgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDEyLCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlBheUNvbmZpZ30gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlBheUNvbmZpZy5wcm90b3R5cGUuc2V0RXh0cmEyID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCAxMiwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIGV4dHJhMyA9IDEzOwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLlBheUNvbmZpZy5wcm90b3R5cGUuZ2V0RXh0cmEzID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxMywgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5QYXlDb25maWd9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5QYXlDb25maWcucHJvdG90eXBlLnNldEV4dHJhMyA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgMTMsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiB1cGRhdGVkX2F0ID0gMjA7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuUGF5Q29uZmlnLnByb3RvdHlwZS5nZXRVcGRhdGVkQXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDIwLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuUGF5Q29uZmlnfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuUGF5Q29uZmlnLnByb3RvdHlwZS5zZXRVcGRhdGVkQXQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDIwLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgY3JlYXRlZF9hdCA9IDIxOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLlBheUNvbmZpZy5wcm90b3R5cGUuZ2V0Q3JlYXRlZEF0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAyMSwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlBheUNvbmZpZ30gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlBheUNvbmZpZy5wcm90b3R5cGUuc2V0Q3JlYXRlZEF0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAyMSwgdmFsdWUpOwp9OwoKaWYgKGpzcGIuTWVzc2FnZS5HRU5FUkFURV9UT19PQkpFQ1QpIHsKICAvKioKICAgKiBDcmVhdGVzIGFuIG9iamVjdCByZXByZXNlbnRhdGlvbiBvZiB0aGlzIHByb3RvLgogICAqIEZpZWxkIG5hbWVzIHRoYXQgYXJlIHJlc2VydmVkIGluIEphdmFTY3JpcHQgYW5kIHdpbGwgYmUgcmVuYW1lZCB0byBwYl9uYW1lLgogICAqIE9wdGlvbmFsIGZpZWxkcyB0aGF0IGFyZSBub3Qgc2V0IHdpbGwgYmUgc2V0IHRvIHVuZGVmaW5lZC4KICAgKiBUbyBhY2Nlc3MgYSByZXNlcnZlZCBmaWVsZCB1c2UsIGZvby5wYl88bmFtZT4sIGVnLCBmb28ucGJfZGVmYXVsdC4KICAgKiBGb3IgdGhlIGxpc3Qgb2YgcmVzZXJ2ZWQgbmFtZXMgcGxlYXNlIHNlZToKICAgKiAgICAgbmV0L3Byb3RvMi9jb21waWxlci9qcy9pbnRlcm5hbC9nZW5lcmF0b3IuY2Mja0tleXdvcmQuCiAgICogQHBhcmFtIHtib29sZWFuPX0gb3B0X2luY2x1ZGVJbnN0YW5jZSBEZXByZWNhdGVkLiB3aGV0aGVyIHRvIGluY2x1ZGUgdGhlCiAgICogICAgIEpTUEIgaW5zdGFuY2UgZm9yIHRyYW5zaXRpb25hbCBzb3kgcHJvdG8gc3VwcG9ydDoKICAgKiAgICAgaHR0cDovL2dvdG8vc295LXBhcmFtLW1pZ3JhdGlvbgogICAqIEByZXR1cm4geyFPYmplY3R9CiAgICovCiAgcHJvdG8ucGIuVmVyc2lvbi5wcm90b3R5cGUudG9PYmplY3QgPSBmdW5jdGlvbiAob3B0X2luY2x1ZGVJbnN0YW5jZSkgewogICAgcmV0dXJuIHByb3RvLnBiLlZlcnNpb24udG9PYmplY3Qob3B0X2luY2x1ZGVJbnN0YW5jZSwgdGhpcyk7CiAgfTsKICAvKioKICAgKiBTdGF0aWMgdmVyc2lvbiBvZiB0aGUge0BzZWUgdG9PYmplY3R9IG1ldGhvZC4KICAgKiBAcGFyYW0ge2Jvb2xlYW58dW5kZWZpbmVkfSBpbmNsdWRlSW5zdGFuY2UgRGVwcmVjYXRlZC4gV2hldGhlciB0byBpbmNsdWRlCiAgICogICAgIHRoZSBKU1BCIGluc3RhbmNlIGZvciB0cmFuc2l0aW9uYWwgc295IHByb3RvIHN1cHBvcnQ6CiAgICogICAgIGh0dHA6Ly9nb3RvL3NveS1wYXJhbS1taWdyYXRpb24KICAgKiBAcGFyYW0geyFwcm90by5wYi5WZXJzaW9ufSBtc2cgVGhlIG1zZyBpbnN0YW5jZSB0byB0cmFuc2Zvcm0uCiAgICogQHJldHVybiB7IU9iamVjdH0KICAgKiBAc3VwcHJlc3Mge3VudXNlZExvY2FsVmFyaWFibGVzfSBmIGlzIG9ubHkgdXNlZCBmb3IgbmVzdGVkIG1lc3NhZ2VzCiAgICovCgoKICBwcm90by5wYi5WZXJzaW9uLnRvT2JqZWN0ID0gZnVuY3Rpb24gKGluY2x1ZGVJbnN0YW5jZSwgbXNnKSB7CiAgICB2YXIgZiwKICAgICAgICBvYmogPSB7CiAgICAgIGlkOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDEsIDApLAogICAgICBhcHBJZDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAyLCAwKSwKICAgICAgb3NUeXBlOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDMsIDApLAogICAgICBjb2RlOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDQsIDApLAogICAgICBuYW1lOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDUsICIiKSwKICAgICAgZW5hYmxlOiBqc3BiLk1lc3NhZ2UuZ2V0Qm9vbGVhbkZpZWxkV2l0aERlZmF1bHQobXNnLCA2LCBmYWxzZSksCiAgICAgIGluUmV2aWV3OiBqc3BiLk1lc3NhZ2UuZ2V0Qm9vbGVhbkZpZWxkV2l0aERlZmF1bHQobXNnLCA3LCBmYWxzZSksCiAgICAgIG5vdGU6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgOCwgIiIpLAogICAgICB1cGRhdGVkQXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjAsIDApLAogICAgICBjcmVhdGVkQXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjEsIDApCiAgICB9OwoKICAgIGlmIChpbmNsdWRlSW5zdGFuY2UpIHsKICAgICAgb2JqLiRqc3BiTWVzc2FnZUluc3RhbmNlID0gbXNnOwogICAgfQoKICAgIHJldHVybiBvYmo7CiAgfTsKfQovKioKICogRGVzZXJpYWxpemVzIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkuCiAqIEBwYXJhbSB7anNwYi5CeXRlU291cmNlfSBieXRlcyBUaGUgYnl0ZXMgdG8gZGVzZXJpYWxpemUuCiAqIEByZXR1cm4geyFwcm90by5wYi5WZXJzaW9ufQogKi8KCgpwcm90by5wYi5WZXJzaW9uLmRlc2VyaWFsaXplQmluYXJ5ID0gZnVuY3Rpb24gKGJ5dGVzKSB7CiAgdmFyIHJlYWRlciA9IG5ldyBqc3BiLkJpbmFyeVJlYWRlcihieXRlcyk7CiAgdmFyIG1zZyA9IG5ldyBwcm90by5wYi5WZXJzaW9uKCk7CiAgcmV0dXJuIHByb3RvLnBiLlZlcnNpb24uZGVzZXJpYWxpemVCaW5hcnlGcm9tUmVhZGVyKG1zZywgcmVhZGVyKTsKfTsKLyoqCiAqIERlc2VyaWFsaXplcyBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZSBmb3JtYXQpIGZyb20gdGhlCiAqIGdpdmVuIHJlYWRlciBpbnRvIHRoZSBnaXZlbiBtZXNzYWdlIG9iamVjdC4KICogQHBhcmFtIHshcHJvdG8ucGIuVmVyc2lvbn0gbXNnIFRoZSBtZXNzYWdlIG9iamVjdCB0byBkZXNlcmlhbGl6ZSBpbnRvLgogKiBAcGFyYW0geyFqc3BiLkJpbmFyeVJlYWRlcn0gcmVhZGVyIFRoZSBCaW5hcnlSZWFkZXIgdG8gdXNlLgogKiBAcmV0dXJuIHshcHJvdG8ucGIuVmVyc2lvbn0KICovCgoKcHJvdG8ucGIuVmVyc2lvbi5kZXNlcmlhbGl6ZUJpbmFyeUZyb21SZWFkZXIgPSBmdW5jdGlvbiAobXNnLCByZWFkZXIpIHsKICB3aGlsZSAocmVhZGVyLm5leHRGaWVsZCgpKSB7CiAgICBpZiAocmVhZGVyLmlzRW5kR3JvdXAoKSkgewogICAgICBicmVhazsKICAgIH0KCiAgICB2YXIgZmllbGQgPSByZWFkZXIuZ2V0RmllbGROdW1iZXIoKTsKCiAgICBzd2l0Y2ggKGZpZWxkKSB7CiAgICAgIGNhc2UgMToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRJZCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDI6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0QXBwSWQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAzOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkRW51bSgpOwogICAgICAgIG1zZy5zZXRPc1R5cGUodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA0OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldENvZGUodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA1OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldE5hbWUodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA2OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkQm9vbCgpOwogICAgICAgIG1zZy5zZXRFbmFibGUodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA3OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkQm9vbCgpOwogICAgICAgIG1zZy5zZXRJblJldmlldyh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDg6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0Tm90ZSh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDIwOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldFVwZGF0ZWRBdCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDIxOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldENyZWF0ZWRBdCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBkZWZhdWx0OgogICAgICAgIHJlYWRlci5za2lwRmllbGQoKTsKICAgICAgICBicmVhazsKICAgIH0KICB9CgogIHJldHVybiBtc2c7Cn07Ci8qKgogKiBTZXJpYWxpemVzIHRoZSBtZXNzYWdlIHRvIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkuCiAqIEByZXR1cm4geyFVaW50OEFycmF5fQogKi8KCgpwcm90by5wYi5WZXJzaW9uLnByb3RvdHlwZS5zZXJpYWxpemVCaW5hcnkgPSBmdW5jdGlvbiAoKSB7CiAgdmFyIHdyaXRlciA9IG5ldyBqc3BiLkJpbmFyeVdyaXRlcigpOwogIHByb3RvLnBiLlZlcnNpb24uc2VyaWFsaXplQmluYXJ5VG9Xcml0ZXIodGhpcywgd3JpdGVyKTsKICByZXR1cm4gd3JpdGVyLmdldFJlc3VsdEJ1ZmZlcigpOwp9OwovKioKICogU2VyaWFsaXplcyB0aGUgZ2l2ZW4gbWVzc2FnZSB0byBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZQogKiBmb3JtYXQpLCB3cml0aW5nIHRvIHRoZSBnaXZlbiBCaW5hcnlXcml0ZXIuCiAqIEBwYXJhbSB7IXByb3RvLnBiLlZlcnNpb259IG1lc3NhZ2UKICogQHBhcmFtIHshanNwYi5CaW5hcnlXcml0ZXJ9IHdyaXRlcgogKiBAc3VwcHJlc3Mge3VudXNlZExvY2FsVmFyaWFibGVzfSBmIGlzIG9ubHkgdXNlZCBmb3IgbmVzdGVkIG1lc3NhZ2VzCiAqLwoKCnByb3RvLnBiLlZlcnNpb24uc2VyaWFsaXplQmluYXJ5VG9Xcml0ZXIgPSBmdW5jdGlvbiAobWVzc2FnZSwgd3JpdGVyKSB7CiAgdmFyIGYgPSB1bmRlZmluZWQ7CiAgZiA9IG1lc3NhZ2UuZ2V0SWQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigxLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEFwcElkKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMiwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRPc1R5cGUoKTsKCiAgaWYgKGYgIT09IDAuMCkgewogICAgd3JpdGVyLndyaXRlRW51bSgzLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldENvZGUoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMig0LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldE5hbWUoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDUsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0RW5hYmxlKCk7CgogIGlmIChmKSB7CiAgICB3cml0ZXIud3JpdGVCb29sKDYsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0SW5SZXZpZXcoKTsKCiAgaWYgKGYpIHsKICAgIHdyaXRlci53cml0ZUJvb2woNywgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXROb3RlKCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZyg4LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldFVwZGF0ZWRBdCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDIwLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldENyZWF0ZWRBdCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDIxLCBmKTsKICB9Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgaWQgPSAxOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLlZlcnNpb24ucHJvdG90eXBlLmdldElkID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuVmVyc2lvbn0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlZlcnNpb24ucHJvdG90eXBlLnNldElkID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAxLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgYXBwX2lkID0gMjsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5WZXJzaW9uLnByb3RvdHlwZS5nZXRBcHBJZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMiwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlZlcnNpb259IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5WZXJzaW9uLnByb3RvdHlwZS5zZXRBcHBJZCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMiwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgT3NUeXBlIG9zX3R5cGUgPSAzOwogKiBAcmV0dXJuIHshcHJvdG8ucGIuT3NUeXBlfQogKi8KCgpwcm90by5wYi5WZXJzaW9uLnByb3RvdHlwZS5nZXRPc1R5cGUgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDMsIDApOwp9OwovKioKICogQHBhcmFtIHshcHJvdG8ucGIuT3NUeXBlfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuVmVyc2lvbn0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlZlcnNpb24ucHJvdG90eXBlLnNldE9zVHlwZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zRW51bUZpZWxkKHRoaXMsIDMsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBjb2RlID0gNDsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5WZXJzaW9uLnByb3RvdHlwZS5nZXRDb2RlID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA0LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuVmVyc2lvbn0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlZlcnNpb24ucHJvdG90eXBlLnNldENvZGUgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDQsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyBuYW1lID0gNTsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5WZXJzaW9uLnByb3RvdHlwZS5nZXROYW1lID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA1LCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlZlcnNpb259IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5WZXJzaW9uLnByb3RvdHlwZS5zZXROYW1lID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCA1LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBib29sIGVuYWJsZSA9IDY7CiAqIEByZXR1cm4ge2Jvb2xlYW59CiAqLwoKCnByb3RvLnBiLlZlcnNpb24ucHJvdG90eXBlLmdldEVuYWJsZSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEJvb2xlYW5GaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDYsIGZhbHNlKTsKfTsKLyoqCiAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlZlcnNpb259IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5WZXJzaW9uLnByb3RvdHlwZS5zZXRFbmFibGUgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0Jvb2xlYW5GaWVsZCh0aGlzLCA2LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBib29sIGluX3JldmlldyA9IDc7CiAqIEByZXR1cm4ge2Jvb2xlYW59CiAqLwoKCnByb3RvLnBiLlZlcnNpb24ucHJvdG90eXBlLmdldEluUmV2aWV3ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0Qm9vbGVhbkZpZWxkV2l0aERlZmF1bHQodGhpcywgNywgZmFsc2UpOwp9OwovKioKICogQHBhcmFtIHtib29sZWFufSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuVmVyc2lvbn0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlZlcnNpb24ucHJvdG90eXBlLnNldEluUmV2aWV3ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNCb29sZWFuRmllbGQodGhpcywgNywgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIG5vdGUgPSA4OwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLlZlcnNpb24ucHJvdG90eXBlLmdldE5vdGUgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDgsICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuVmVyc2lvbn0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlZlcnNpb24ucHJvdG90eXBlLnNldE5vdGUgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDgsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiB1cGRhdGVkX2F0ID0gMjA7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuVmVyc2lvbi5wcm90b3R5cGUuZ2V0VXBkYXRlZEF0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAyMCwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlZlcnNpb259IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5WZXJzaW9uLnByb3RvdHlwZS5zZXRVcGRhdGVkQXQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDIwLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgY3JlYXRlZF9hdCA9IDIxOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLlZlcnNpb24ucHJvdG90eXBlLmdldENyZWF0ZWRBdCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMjEsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5WZXJzaW9ufSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuVmVyc2lvbi5wcm90b3R5cGUuc2V0Q3JlYXRlZEF0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAyMSwgdmFsdWUpOwp9OwoKaWYgKGpzcGIuTWVzc2FnZS5HRU5FUkFURV9UT19PQkpFQ1QpIHsKICAvKioKICAgKiBDcmVhdGVzIGFuIG9iamVjdCByZXByZXNlbnRhdGlvbiBvZiB0aGlzIHByb3RvLgogICAqIEZpZWxkIG5hbWVzIHRoYXQgYXJlIHJlc2VydmVkIGluIEphdmFTY3JpcHQgYW5kIHdpbGwgYmUgcmVuYW1lZCB0byBwYl9uYW1lLgogICAqIE9wdGlvbmFsIGZpZWxkcyB0aGF0IGFyZSBub3Qgc2V0IHdpbGwgYmUgc2V0IHRvIHVuZGVmaW5lZC4KICAgKiBUbyBhY2Nlc3MgYSByZXNlcnZlZCBmaWVsZCB1c2UsIGZvby5wYl88bmFtZT4sIGVnLCBmb28ucGJfZGVmYXVsdC4KICAgKiBGb3IgdGhlIGxpc3Qgb2YgcmVzZXJ2ZWQgbmFtZXMgcGxlYXNlIHNlZToKICAgKiAgICAgbmV0L3Byb3RvMi9jb21waWxlci9qcy9pbnRlcm5hbC9nZW5lcmF0b3IuY2Mja0tleXdvcmQuCiAgICogQHBhcmFtIHtib29sZWFuPX0gb3B0X2luY2x1ZGVJbnN0YW5jZSBEZXByZWNhdGVkLiB3aGV0aGVyIHRvIGluY2x1ZGUgdGhlCiAgICogICAgIEpTUEIgaW5zdGFuY2UgZm9yIHRyYW5zaXRpb25hbCBzb3kgcHJvdG8gc3VwcG9ydDoKICAgKiAgICAgaHR0cDovL2dvdG8vc295LXBhcmFtLW1pZ3JhdGlvbgogICAqIEByZXR1cm4geyFPYmplY3R9CiAgICovCiAgcHJvdG8ucGIuTG9jYWxpemF0aW9uLnByb3RvdHlwZS50b09iamVjdCA9IGZ1bmN0aW9uIChvcHRfaW5jbHVkZUluc3RhbmNlKSB7CiAgICByZXR1cm4gcHJvdG8ucGIuTG9jYWxpemF0aW9uLnRvT2JqZWN0KG9wdF9pbmNsdWRlSW5zdGFuY2UsIHRoaXMpOwogIH07CiAgLyoqCiAgICogU3RhdGljIHZlcnNpb24gb2YgdGhlIHtAc2VlIHRvT2JqZWN0fSBtZXRob2QuCiAgICogQHBhcmFtIHtib29sZWFufHVuZGVmaW5lZH0gaW5jbHVkZUluc3RhbmNlIERlcHJlY2F0ZWQuIFdoZXRoZXIgdG8gaW5jbHVkZQogICAqICAgICB0aGUgSlNQQiBpbnN0YW5jZSBmb3IgdHJhbnNpdGlvbmFsIHNveSBwcm90byBzdXBwb3J0OgogICAqICAgICBodHRwOi8vZ290by9zb3ktcGFyYW0tbWlncmF0aW9uCiAgICogQHBhcmFtIHshcHJvdG8ucGIuTG9jYWxpemF0aW9ufSBtc2cgVGhlIG1zZyBpbnN0YW5jZSB0byB0cmFuc2Zvcm0uCiAgICogQHJldHVybiB7IU9iamVjdH0KICAgKiBAc3VwcHJlc3Mge3VudXNlZExvY2FsVmFyaWFibGVzfSBmIGlzIG9ubHkgdXNlZCBmb3IgbmVzdGVkIG1lc3NhZ2VzCiAgICovCgoKICBwcm90by5wYi5Mb2NhbGl6YXRpb24udG9PYmplY3QgPSBmdW5jdGlvbiAoaW5jbHVkZUluc3RhbmNlLCBtc2cpIHsKICAgIHZhciBmLAogICAgICAgIG9iaiA9IHsKICAgICAgbGFuZzoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxLCAiIiksCiAgICAgIGNvbnRlbnQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMiwgIiIpCiAgICB9OwoKICAgIGlmIChpbmNsdWRlSW5zdGFuY2UpIHsKICAgICAgb2JqLiRqc3BiTWVzc2FnZUluc3RhbmNlID0gbXNnOwogICAgfQoKICAgIHJldHVybiBvYmo7CiAgfTsKfQovKioKICogRGVzZXJpYWxpemVzIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkuCiAqIEBwYXJhbSB7anNwYi5CeXRlU291cmNlfSBieXRlcyBUaGUgYnl0ZXMgdG8gZGVzZXJpYWxpemUuCiAqIEByZXR1cm4geyFwcm90by5wYi5Mb2NhbGl6YXRpb259CiAqLwoKCnByb3RvLnBiLkxvY2FsaXphdGlvbi5kZXNlcmlhbGl6ZUJpbmFyeSA9IGZ1bmN0aW9uIChieXRlcykgewogIHZhciByZWFkZXIgPSBuZXcganNwYi5CaW5hcnlSZWFkZXIoYnl0ZXMpOwogIHZhciBtc2cgPSBuZXcgcHJvdG8ucGIuTG9jYWxpemF0aW9uKCk7CiAgcmV0dXJuIHByb3RvLnBiLkxvY2FsaXphdGlvbi5kZXNlcmlhbGl6ZUJpbmFyeUZyb21SZWFkZXIobXNnLCByZWFkZXIpOwp9OwovKioKICogRGVzZXJpYWxpemVzIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkgZnJvbSB0aGUKICogZ2l2ZW4gcmVhZGVyIGludG8gdGhlIGdpdmVuIG1lc3NhZ2Ugb2JqZWN0LgogKiBAcGFyYW0geyFwcm90by5wYi5Mb2NhbGl6YXRpb259IG1zZyBUaGUgbWVzc2FnZSBvYmplY3QgdG8gZGVzZXJpYWxpemUgaW50by4KICogQHBhcmFtIHshanNwYi5CaW5hcnlSZWFkZXJ9IHJlYWRlciBUaGUgQmluYXJ5UmVhZGVyIHRvIHVzZS4KICogQHJldHVybiB7IXByb3RvLnBiLkxvY2FsaXphdGlvbn0KICovCgoKcHJvdG8ucGIuTG9jYWxpemF0aW9uLmRlc2VyaWFsaXplQmluYXJ5RnJvbVJlYWRlciA9IGZ1bmN0aW9uIChtc2csIHJlYWRlcikgewogIHdoaWxlIChyZWFkZXIubmV4dEZpZWxkKCkpIHsKICAgIGlmIChyZWFkZXIuaXNFbmRHcm91cCgpKSB7CiAgICAgIGJyZWFrOwogICAgfQoKICAgIHZhciBmaWVsZCA9IHJlYWRlci5nZXRGaWVsZE51bWJlcigpOwoKICAgIHN3aXRjaCAoZmllbGQpIHsKICAgICAgY2FzZSAxOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldExhbmcodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAyOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldENvbnRlbnQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgZGVmYXVsdDoKICAgICAgICByZWFkZXIuc2tpcEZpZWxkKCk7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfQoKICByZXR1cm4gbXNnOwp9OwovKioKICogU2VyaWFsaXplcyB0aGUgbWVzc2FnZSB0byBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZSBmb3JtYXQpLgogKiBAcmV0dXJuIHshVWludDhBcnJheX0KICovCgoKcHJvdG8ucGIuTG9jYWxpemF0aW9uLnByb3RvdHlwZS5zZXJpYWxpemVCaW5hcnkgPSBmdW5jdGlvbiAoKSB7CiAgdmFyIHdyaXRlciA9IG5ldyBqc3BiLkJpbmFyeVdyaXRlcigpOwogIHByb3RvLnBiLkxvY2FsaXphdGlvbi5zZXJpYWxpemVCaW5hcnlUb1dyaXRlcih0aGlzLCB3cml0ZXIpOwogIHJldHVybiB3cml0ZXIuZ2V0UmVzdWx0QnVmZmVyKCk7Cn07Ci8qKgogKiBTZXJpYWxpemVzIHRoZSBnaXZlbiBtZXNzYWdlIHRvIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlCiAqIGZvcm1hdCksIHdyaXRpbmcgdG8gdGhlIGdpdmVuIEJpbmFyeVdyaXRlci4KICogQHBhcmFtIHshcHJvdG8ucGIuTG9jYWxpemF0aW9ufSBtZXNzYWdlCiAqIEBwYXJhbSB7IWpzcGIuQmluYXJ5V3JpdGVyfSB3cml0ZXIKICogQHN1cHByZXNzIHt1bnVzZWRMb2NhbFZhcmlhYmxlc30gZiBpcyBvbmx5IHVzZWQgZm9yIG5lc3RlZCBtZXNzYWdlcwogKi8KCgpwcm90by5wYi5Mb2NhbGl6YXRpb24uc2VyaWFsaXplQmluYXJ5VG9Xcml0ZXIgPSBmdW5jdGlvbiAobWVzc2FnZSwgd3JpdGVyKSB7CiAgdmFyIGYgPSB1bmRlZmluZWQ7CiAgZiA9IG1lc3NhZ2UuZ2V0TGFuZygpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoMSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRDb250ZW50KCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZygyLCBmKTsKICB9Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgbGFuZyA9IDE7CiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKcHJvdG8ucGIuTG9jYWxpemF0aW9uLnByb3RvdHlwZS5nZXRMYW5nID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxLCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkxvY2FsaXphdGlvbn0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkxvY2FsaXphdGlvbi5wcm90b3R5cGUuc2V0TGFuZyA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgMSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIGNvbnRlbnQgPSAyOwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLkxvY2FsaXphdGlvbi5wcm90b3R5cGUuZ2V0Q29udGVudCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMiwgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5Mb2NhbGl6YXRpb259IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5Mb2NhbGl6YXRpb24ucHJvdG90eXBlLnNldENvbnRlbnQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDIsIHZhbHVlKTsKfTsKLyoqCiAqIExpc3Qgb2YgcmVwZWF0ZWQgZmllbGRzIHdpdGhpbiB0aGlzIG1lc3NhZ2UgdHlwZS4KICogQHByaXZhdGUgeyFBcnJheTxudW1iZXI+fQogKiBAY29uc3QKICovCgoKcHJvdG8ucGIuVXBncmFkZS5yZXBlYXRlZEZpZWxkc18gPSBbMTBdOwoKaWYgKGpzcGIuTWVzc2FnZS5HRU5FUkFURV9UT19PQkpFQ1QpIHsKICAvKioKICAgKiBDcmVhdGVzIGFuIG9iamVjdCByZXByZXNlbnRhdGlvbiBvZiB0aGlzIHByb3RvLgogICAqIEZpZWxkIG5hbWVzIHRoYXQgYXJlIHJlc2VydmVkIGluIEphdmFTY3JpcHQgYW5kIHdpbGwgYmUgcmVuYW1lZCB0byBwYl9uYW1lLgogICAqIE9wdGlvbmFsIGZpZWxkcyB0aGF0IGFyZSBub3Qgc2V0IHdpbGwgYmUgc2V0IHRvIHVuZGVmaW5lZC4KICAgKiBUbyBhY2Nlc3MgYSByZXNlcnZlZCBmaWVsZCB1c2UsIGZvby5wYl88bmFtZT4sIGVnLCBmb28ucGJfZGVmYXVsdC4KICAgKiBGb3IgdGhlIGxpc3Qgb2YgcmVzZXJ2ZWQgbmFtZXMgcGxlYXNlIHNlZToKICAgKiAgICAgbmV0L3Byb3RvMi9jb21waWxlci9qcy9pbnRlcm5hbC9nZW5lcmF0b3IuY2Mja0tleXdvcmQuCiAgICogQHBhcmFtIHtib29sZWFuPX0gb3B0X2luY2x1ZGVJbnN0YW5jZSBEZXByZWNhdGVkLiB3aGV0aGVyIHRvIGluY2x1ZGUgdGhlCiAgICogICAgIEpTUEIgaW5zdGFuY2UgZm9yIHRyYW5zaXRpb25hbCBzb3kgcHJvdG8gc3VwcG9ydDoKICAgKiAgICAgaHR0cDovL2dvdG8vc295LXBhcmFtLW1pZ3JhdGlvbgogICAqIEByZXR1cm4geyFPYmplY3R9CiAgICovCiAgcHJvdG8ucGIuVXBncmFkZS5wcm90b3R5cGUudG9PYmplY3QgPSBmdW5jdGlvbiAob3B0X2luY2x1ZGVJbnN0YW5jZSkgewogICAgcmV0dXJuIHByb3RvLnBiLlVwZ3JhZGUudG9PYmplY3Qob3B0X2luY2x1ZGVJbnN0YW5jZSwgdGhpcyk7CiAgfTsKICAvKioKICAgKiBTdGF0aWMgdmVyc2lvbiBvZiB0aGUge0BzZWUgdG9PYmplY3R9IG1ldGhvZC4KICAgKiBAcGFyYW0ge2Jvb2xlYW58dW5kZWZpbmVkfSBpbmNsdWRlSW5zdGFuY2UgRGVwcmVjYXRlZC4gV2hldGhlciB0byBpbmNsdWRlCiAgICogICAgIHRoZSBKU1BCIGluc3RhbmNlIGZvciB0cmFuc2l0aW9uYWwgc295IHByb3RvIHN1cHBvcnQ6CiAgICogICAgIGh0dHA6Ly9nb3RvL3NveS1wYXJhbS1taWdyYXRpb24KICAgKiBAcGFyYW0geyFwcm90by5wYi5VcGdyYWRlfSBtc2cgVGhlIG1zZyBpbnN0YW5jZSB0byB0cmFuc2Zvcm0uCiAgICogQHJldHVybiB7IU9iamVjdH0KICAgKiBAc3VwcHJlc3Mge3VudXNlZExvY2FsVmFyaWFibGVzfSBmIGlzIG9ubHkgdXNlZCBmb3IgbmVzdGVkIG1lc3NhZ2VzCiAgICovCgoKICBwcm90by5wYi5VcGdyYWRlLnRvT2JqZWN0ID0gZnVuY3Rpb24gKGluY2x1ZGVJbnN0YW5jZSwgbXNnKSB7CiAgICB2YXIgZiwKICAgICAgICBvYmogPSB7CiAgICAgIGlkOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDEsIDApLAogICAgICBhcHBJZDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAyLCAwKSwKICAgICAgZW5hYmxlOiBqc3BiLk1lc3NhZ2UuZ2V0Qm9vbGVhbkZpZWxkV2l0aERlZmF1bHQobXNnLCAzLCBmYWxzZSksCiAgICAgIG9zVHlwZToganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA0LCAwKSwKICAgICAgbWluVmVyc2lvbjoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA1LCAwKSwKICAgICAgdGl0bGU6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNiwgIiIpLAogICAgICBzaG93VXBncmFkZToganNwYi5NZXNzYWdlLmdldEJvb2xlYW5GaWVsZFdpdGhEZWZhdWx0KG1zZywgNywgZmFsc2UpLAogICAgICBmb3JjZVVwZ3JhZGU6IGpzcGIuTWVzc2FnZS5nZXRCb29sZWFuRmllbGRXaXRoRGVmYXVsdChtc2csIDgsIGZhbHNlKSwKICAgICAgdXBncmFkZVVybDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA5LCAiIiksCiAgICAgIHVwZ3JhZGVUaXBzTGlzdDoganNwYi5NZXNzYWdlLnRvT2JqZWN0TGlzdChtc2cuZ2V0VXBncmFkZVRpcHNMaXN0KCksIHByb3RvLnBiLkxvY2FsaXphdGlvbi50b09iamVjdCwgaW5jbHVkZUluc3RhbmNlKSwKICAgICAgdXBkYXRlZEF0OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDIwLCAwKSwKICAgICAgY3JlYXRlZEF0OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDIxLCAwKQogICAgfTsKCiAgICBpZiAoaW5jbHVkZUluc3RhbmNlKSB7CiAgICAgIG9iai4kanNwYk1lc3NhZ2VJbnN0YW5jZSA9IG1zZzsKICAgIH0KCiAgICByZXR1cm4gb2JqOwogIH07Cn0KLyoqCiAqIERlc2VyaWFsaXplcyBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZSBmb3JtYXQpLgogKiBAcGFyYW0ge2pzcGIuQnl0ZVNvdXJjZX0gYnl0ZXMgVGhlIGJ5dGVzIHRvIGRlc2VyaWFsaXplLgogKiBAcmV0dXJuIHshcHJvdG8ucGIuVXBncmFkZX0KICovCgoKcHJvdG8ucGIuVXBncmFkZS5kZXNlcmlhbGl6ZUJpbmFyeSA9IGZ1bmN0aW9uIChieXRlcykgewogIHZhciByZWFkZXIgPSBuZXcganNwYi5CaW5hcnlSZWFkZXIoYnl0ZXMpOwogIHZhciBtc2cgPSBuZXcgcHJvdG8ucGIuVXBncmFkZSgpOwogIHJldHVybiBwcm90by5wYi5VcGdyYWRlLmRlc2VyaWFsaXplQmluYXJ5RnJvbVJlYWRlcihtc2csIHJlYWRlcik7Cn07Ci8qKgogKiBEZXNlcmlhbGl6ZXMgYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUgZm9ybWF0KSBmcm9tIHRoZQogKiBnaXZlbiByZWFkZXIgaW50byB0aGUgZ2l2ZW4gbWVzc2FnZSBvYmplY3QuCiAqIEBwYXJhbSB7IXByb3RvLnBiLlVwZ3JhZGV9IG1zZyBUaGUgbWVzc2FnZSBvYmplY3QgdG8gZGVzZXJpYWxpemUgaW50by4KICogQHBhcmFtIHshanNwYi5CaW5hcnlSZWFkZXJ9IHJlYWRlciBUaGUgQmluYXJ5UmVhZGVyIHRvIHVzZS4KICogQHJldHVybiB7IXByb3RvLnBiLlVwZ3JhZGV9CiAqLwoKCnByb3RvLnBiLlVwZ3JhZGUuZGVzZXJpYWxpemVCaW5hcnlGcm9tUmVhZGVyID0gZnVuY3Rpb24gKG1zZywgcmVhZGVyKSB7CiAgd2hpbGUgKHJlYWRlci5uZXh0RmllbGQoKSkgewogICAgaWYgKHJlYWRlci5pc0VuZEdyb3VwKCkpIHsKICAgICAgYnJlYWs7CiAgICB9CgogICAgdmFyIGZpZWxkID0gcmVhZGVyLmdldEZpZWxkTnVtYmVyKCk7CgogICAgc3dpdGNoIChmaWVsZCkgewogICAgICBjYXNlIDE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0SWQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAyOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldEFwcElkKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMzoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZEJvb2woKTsKICAgICAgICBtc2cuc2V0RW5hYmxlKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNDoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZEVudW0oKTsKICAgICAgICBtc2cuc2V0T3NUeXBlKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRNaW5WZXJzaW9uKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXRUaXRsZSh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDc6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRCb29sKCk7CiAgICAgICAgbXNnLnNldFNob3dVcGdyYWRlKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgODoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZEJvb2woKTsKICAgICAgICBtc2cuc2V0Rm9yY2VVcGdyYWRlKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgOToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXRVcGdyYWRlVXJsKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTA6CiAgICAgICAgdmFyIHZhbHVlID0gbmV3IHByb3RvLnBiLkxvY2FsaXphdGlvbigpOwogICAgICAgIHJlYWRlci5yZWFkTWVzc2FnZSh2YWx1ZSwgcHJvdG8ucGIuTG9jYWxpemF0aW9uLmRlc2VyaWFsaXplQmluYXJ5RnJvbVJlYWRlcik7CiAgICAgICAgbXNnLmFkZFVwZ3JhZGVUaXBzKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjA6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0VXBkYXRlZEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0Q3JlYXRlZEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmVhZGVyLnNraXBGaWVsZCgpOwogICAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgcmV0dXJuIG1zZzsKfTsKLyoqCiAqIFNlcmlhbGl6ZXMgdGhlIG1lc3NhZ2UgdG8gYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUgZm9ybWF0KS4KICogQHJldHVybiB7IVVpbnQ4QXJyYXl9CiAqLwoKCnByb3RvLnBiLlVwZ3JhZGUucHJvdG90eXBlLnNlcmlhbGl6ZUJpbmFyeSA9IGZ1bmN0aW9uICgpIHsKICB2YXIgd3JpdGVyID0gbmV3IGpzcGIuQmluYXJ5V3JpdGVyKCk7CiAgcHJvdG8ucGIuVXBncmFkZS5zZXJpYWxpemVCaW5hcnlUb1dyaXRlcih0aGlzLCB3cml0ZXIpOwogIHJldHVybiB3cml0ZXIuZ2V0UmVzdWx0QnVmZmVyKCk7Cn07Ci8qKgogKiBTZXJpYWxpemVzIHRoZSBnaXZlbiBtZXNzYWdlIHRvIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlCiAqIGZvcm1hdCksIHdyaXRpbmcgdG8gdGhlIGdpdmVuIEJpbmFyeVdyaXRlci4KICogQHBhcmFtIHshcHJvdG8ucGIuVXBncmFkZX0gbWVzc2FnZQogKiBAcGFyYW0geyFqc3BiLkJpbmFyeVdyaXRlcn0gd3JpdGVyCiAqIEBzdXBwcmVzcyB7dW51c2VkTG9jYWxWYXJpYWJsZXN9IGYgaXMgb25seSB1c2VkIGZvciBuZXN0ZWQgbWVzc2FnZXMKICovCgoKcHJvdG8ucGIuVXBncmFkZS5zZXJpYWxpemVCaW5hcnlUb1dyaXRlciA9IGZ1bmN0aW9uIChtZXNzYWdlLCB3cml0ZXIpIHsKICB2YXIgZiA9IHVuZGVmaW5lZDsKICBmID0gbWVzc2FnZS5nZXRJZCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDEsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0QXBwSWQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigyLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEVuYWJsZSgpOwoKICBpZiAoZikgewogICAgd3JpdGVyLndyaXRlQm9vbCgzLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldE9zVHlwZSgpOwoKICBpZiAoZiAhPT0gMC4wKSB7CiAgICB3cml0ZXIud3JpdGVFbnVtKDQsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0TWluVmVyc2lvbigpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDUsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0VGl0bGUoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDYsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0U2hvd1VwZ3JhZGUoKTsKCiAgaWYgKGYpIHsKICAgIHdyaXRlci53cml0ZUJvb2woNywgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRGb3JjZVVwZ3JhZGUoKTsKCiAgaWYgKGYpIHsKICAgIHdyaXRlci53cml0ZUJvb2woOCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRVcGdyYWRlVXJsKCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZyg5LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldFVwZ3JhZGVUaXBzTGlzdCgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVSZXBlYXRlZE1lc3NhZ2UoMTAsIGYsIHByb3RvLnBiLkxvY2FsaXphdGlvbi5zZXJpYWxpemVCaW5hcnlUb1dyaXRlcik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRVcGRhdGVkQXQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigyMCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRDcmVhdGVkQXQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigyMSwgZik7CiAgfQp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGlkID0gMTsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5VcGdyYWRlLnByb3RvdHlwZS5nZXRJZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMSwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlVwZ3JhZGV9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5VcGdyYWRlLnByb3RvdHlwZS5zZXRJZCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGFwcF9pZCA9IDI7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuVXBncmFkZS5wcm90b3R5cGUuZ2V0QXBwSWQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDIsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5VcGdyYWRlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuVXBncmFkZS5wcm90b3R5cGUuc2V0QXBwSWQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDIsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIGJvb2wgZW5hYmxlID0gMzsKICogQHJldHVybiB7Ym9vbGVhbn0KICovCgoKcHJvdG8ucGIuVXBncmFkZS5wcm90b3R5cGUuZ2V0RW5hYmxlID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0Qm9vbGVhbkZpZWxkV2l0aERlZmF1bHQodGhpcywgMywgZmFsc2UpOwp9OwovKioKICogQHBhcmFtIHtib29sZWFufSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuVXBncmFkZX0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlVwZ3JhZGUucHJvdG90eXBlLnNldEVuYWJsZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zQm9vbGVhbkZpZWxkKHRoaXMsIDMsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIE9zVHlwZSBvc190eXBlID0gNDsKICogQHJldHVybiB7IXByb3RvLnBiLk9zVHlwZX0KICovCgoKcHJvdG8ucGIuVXBncmFkZS5wcm90b3R5cGUuZ2V0T3NUeXBlID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA0LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7IXByb3RvLnBiLk9zVHlwZX0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlVwZ3JhZGV9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5VcGdyYWRlLnByb3RvdHlwZS5zZXRPc1R5cGUgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0VudW1GaWVsZCh0aGlzLCA0LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgbWluX3ZlcnNpb24gPSA1OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLlVwZ3JhZGUucHJvdG90eXBlLmdldE1pblZlcnNpb24gPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDUsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5VcGdyYWRlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuVXBncmFkZS5wcm90b3R5cGUuc2V0TWluVmVyc2lvbiA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgNSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIHRpdGxlID0gNjsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5VcGdyYWRlLnByb3RvdHlwZS5nZXRUaXRsZSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgNiwgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5VcGdyYWRlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuVXBncmFkZS5wcm90b3R5cGUuc2V0VGl0bGUgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDYsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIGJvb2wgc2hvd191cGdyYWRlID0gNzsKICogQHJldHVybiB7Ym9vbGVhbn0KICovCgoKcHJvdG8ucGIuVXBncmFkZS5wcm90b3R5cGUuZ2V0U2hvd1VwZ3JhZGUgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRCb29sZWFuRmllbGRXaXRoRGVmYXVsdCh0aGlzLCA3LCBmYWxzZSk7Cn07Ci8qKgogKiBAcGFyYW0ge2Jvb2xlYW59IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5VcGdyYWRlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuVXBncmFkZS5wcm90b3R5cGUuc2V0U2hvd1VwZ3JhZGUgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0Jvb2xlYW5GaWVsZCh0aGlzLCA3LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBib29sIGZvcmNlX3VwZ3JhZGUgPSA4OwogKiBAcmV0dXJuIHtib29sZWFufQogKi8KCgpwcm90by5wYi5VcGdyYWRlLnByb3RvdHlwZS5nZXRGb3JjZVVwZ3JhZGUgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRCb29sZWFuRmllbGRXaXRoRGVmYXVsdCh0aGlzLCA4LCBmYWxzZSk7Cn07Ci8qKgogKiBAcGFyYW0ge2Jvb2xlYW59IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5VcGdyYWRlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuVXBncmFkZS5wcm90b3R5cGUuc2V0Rm9yY2VVcGdyYWRlID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNCb29sZWFuRmllbGQodGhpcywgOCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIHVwZ3JhZGVfdXJsID0gOTsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5VcGdyYWRlLnByb3RvdHlwZS5nZXRVcGdyYWRlVXJsID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA5LCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlVwZ3JhZGV9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5VcGdyYWRlLnByb3RvdHlwZS5zZXRVcGdyYWRlVXJsID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCA5LCB2YWx1ZSk7Cn07Ci8qKgogKiByZXBlYXRlZCBMb2NhbGl6YXRpb24gdXBncmFkZV90aXBzID0gMTA7CiAqIEByZXR1cm4geyFBcnJheTwhcHJvdG8ucGIuTG9jYWxpemF0aW9uPn0KICovCgoKcHJvdG8ucGIuVXBncmFkZS5wcm90b3R5cGUuZ2V0VXBncmFkZVRpcHNMaXN0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0UmVwZWF0ZWRXcmFwcGVyRmllbGQodGhpcywgcHJvdG8ucGIuTG9jYWxpemF0aW9uLCAxMCk7Cn07Ci8qKgogKiBAcGFyYW0geyFBcnJheTwhcHJvdG8ucGIuTG9jYWxpemF0aW9uPn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlVwZ3JhZGV9IHJldHVybnMgdGhpcwoqLwoKCnByb3RvLnBiLlVwZ3JhZGUucHJvdG90eXBlLnNldFVwZ3JhZGVUaXBzTGlzdCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UmVwZWF0ZWRXcmFwcGVyRmllbGQodGhpcywgMTAsIHZhbHVlKTsKfTsKLyoqCiAqIEBwYXJhbSB7IXByb3RvLnBiLkxvY2FsaXphdGlvbj19IG9wdF92YWx1ZQogKiBAcGFyYW0ge251bWJlcj19IG9wdF9pbmRleAogKiBAcmV0dXJuIHshcHJvdG8ucGIuTG9jYWxpemF0aW9ufQogKi8KCgpwcm90by5wYi5VcGdyYWRlLnByb3RvdHlwZS5hZGRVcGdyYWRlVGlwcyA9IGZ1bmN0aW9uIChvcHRfdmFsdWUsIG9wdF9pbmRleCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuYWRkVG9SZXBlYXRlZFdyYXBwZXJGaWVsZCh0aGlzLCAxMCwgb3B0X3ZhbHVlLCBwcm90by5wYi5Mb2NhbGl6YXRpb24sIG9wdF9pbmRleCk7Cn07Ci8qKgogKiBDbGVhcnMgdGhlIGxpc3QgbWFraW5nIGl0IGVtcHR5IGJ1dCBub24tbnVsbC4KICogQHJldHVybiB7IXByb3RvLnBiLlVwZ3JhZGV9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5VcGdyYWRlLnByb3RvdHlwZS5jbGVhclVwZ3JhZGVUaXBzTGlzdCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5zZXRVcGdyYWRlVGlwc0xpc3QoW10pOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIHVwZGF0ZWRfYXQgPSAyMDsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5VcGdyYWRlLnByb3RvdHlwZS5nZXRVcGRhdGVkQXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDIwLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuVXBncmFkZX0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlVwZ3JhZGUucHJvdG90eXBlLnNldFVwZGF0ZWRBdCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMjAsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBjcmVhdGVkX2F0ID0gMjE7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuVXBncmFkZS5wcm90b3R5cGUuZ2V0Q3JlYXRlZEF0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAyMSwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlVwZ3JhZGV9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5VcGdyYWRlLnByb3RvdHlwZS5zZXRDcmVhdGVkQXQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDIxLCB2YWx1ZSk7Cn07CgppZiAoanNwYi5NZXNzYWdlLkdFTkVSQVRFX1RPX09CSkVDVCkgewogIC8qKgogICAqIENyZWF0ZXMgYW4gb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgcHJvdG8uCiAgICogRmllbGQgbmFtZXMgdGhhdCBhcmUgcmVzZXJ2ZWQgaW4gSmF2YVNjcmlwdCBhbmQgd2lsbCBiZSByZW5hbWVkIHRvIHBiX25hbWUuCiAgICogT3B0aW9uYWwgZmllbGRzIHRoYXQgYXJlIG5vdCBzZXQgd2lsbCBiZSBzZXQgdG8gdW5kZWZpbmVkLgogICAqIFRvIGFjY2VzcyBhIHJlc2VydmVkIGZpZWxkIHVzZSwgZm9vLnBiXzxuYW1lPiwgZWcsIGZvby5wYl9kZWZhdWx0LgogICAqIEZvciB0aGUgbGlzdCBvZiByZXNlcnZlZCBuYW1lcyBwbGVhc2Ugc2VlOgogICAqICAgICBuZXQvcHJvdG8yL2NvbXBpbGVyL2pzL2ludGVybmFsL2dlbmVyYXRvci5jYyNrS2V5d29yZC4KICAgKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfaW5jbHVkZUluc3RhbmNlIERlcHJlY2F0ZWQuIHdoZXRoZXIgdG8gaW5jbHVkZSB0aGUKICAgKiAgICAgSlNQQiBpbnN0YW5jZSBmb3IgdHJhbnNpdGlvbmFsIHNveSBwcm90byBzdXBwb3J0OgogICAqICAgICBodHRwOi8vZ290by9zb3ktcGFyYW0tbWlncmF0aW9uCiAgICogQHJldHVybiB7IU9iamVjdH0KICAgKi8KICBwcm90by5wYi5Sb2JvdE1lc3NhZ2UucHJvdG90eXBlLnRvT2JqZWN0ID0gZnVuY3Rpb24gKG9wdF9pbmNsdWRlSW5zdGFuY2UpIHsKICAgIHJldHVybiBwcm90by5wYi5Sb2JvdE1lc3NhZ2UudG9PYmplY3Qob3B0X2luY2x1ZGVJbnN0YW5jZSwgdGhpcyk7CiAgfTsKICAvKioKICAgKiBTdGF0aWMgdmVyc2lvbiBvZiB0aGUge0BzZWUgdG9PYmplY3R9IG1ldGhvZC4KICAgKiBAcGFyYW0ge2Jvb2xlYW58dW5kZWZpbmVkfSBpbmNsdWRlSW5zdGFuY2UgRGVwcmVjYXRlZC4gV2hldGhlciB0byBpbmNsdWRlCiAgICogICAgIHRoZSBKU1BCIGluc3RhbmNlIGZvciB0cmFuc2l0aW9uYWwgc295IHByb3RvIHN1cHBvcnQ6CiAgICogICAgIGh0dHA6Ly9nb3RvL3NveS1wYXJhbS1taWdyYXRpb24KICAgKiBAcGFyYW0geyFwcm90by5wYi5Sb2JvdE1lc3NhZ2V9IG1zZyBUaGUgbXNnIGluc3RhbmNlIHRvIHRyYW5zZm9ybS4KICAgKiBAcmV0dXJuIHshT2JqZWN0fQogICAqIEBzdXBwcmVzcyB7dW51c2VkTG9jYWxWYXJpYWJsZXN9IGYgaXMgb25seSB1c2VkIGZvciBuZXN0ZWQgbWVzc2FnZXMKICAgKi8KCgogIHByb3RvLnBiLlJvYm90TWVzc2FnZS50b09iamVjdCA9IGZ1bmN0aW9uIChpbmNsdWRlSW5zdGFuY2UsIG1zZykgewogICAgdmFyIGYsCiAgICAgICAgb2JqID0gewogICAgICBpZDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxLCAwKSwKICAgICAgYXJlYUlkOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDIsIDApLAogICAgICBhbmNob3JJZDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAzLCAwKSwKICAgICAgZW5hYmxlOiBqc3BiLk1lc3NhZ2UuZ2V0Qm9vbGVhbkZpZWxkV2l0aERlZmF1bHQobXNnLCA0LCBmYWxzZSksCiAgICAgIHR5cGU6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNSwgMCksCiAgICAgIHRleHQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNiwgIiIpLAogICAgICB1cmk6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNywgIiIpLAogICAgICB0aHVtYjoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA4LCAiIiksCiAgICAgIGR1cmF0aW9uOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDksIDApLAogICAgICBzb3J0OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDEwLCAwKSwKICAgICAgaW50ZXJ2YWw6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMTEsIDApLAogICAgICBhY3Rpb246IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMTIsIDApLAogICAgICB1cGRhdGVkQXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjAsIDApLAogICAgICBjcmVhdGVkQXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjEsIDApCiAgICB9OwoKICAgIGlmIChpbmNsdWRlSW5zdGFuY2UpIHsKICAgICAgb2JqLiRqc3BiTWVzc2FnZUluc3RhbmNlID0gbXNnOwogICAgfQoKICAgIHJldHVybiBvYmo7CiAgfTsKfQovKioKICogRGVzZXJpYWxpemVzIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkuCiAqIEBwYXJhbSB7anNwYi5CeXRlU291cmNlfSBieXRlcyBUaGUgYnl0ZXMgdG8gZGVzZXJpYWxpemUuCiAqIEByZXR1cm4geyFwcm90by5wYi5Sb2JvdE1lc3NhZ2V9CiAqLwoKCnByb3RvLnBiLlJvYm90TWVzc2FnZS5kZXNlcmlhbGl6ZUJpbmFyeSA9IGZ1bmN0aW9uIChieXRlcykgewogIHZhciByZWFkZXIgPSBuZXcganNwYi5CaW5hcnlSZWFkZXIoYnl0ZXMpOwogIHZhciBtc2cgPSBuZXcgcHJvdG8ucGIuUm9ib3RNZXNzYWdlKCk7CiAgcmV0dXJuIHByb3RvLnBiLlJvYm90TWVzc2FnZS5kZXNlcmlhbGl6ZUJpbmFyeUZyb21SZWFkZXIobXNnLCByZWFkZXIpOwp9OwovKioKICogRGVzZXJpYWxpemVzIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkgZnJvbSB0aGUKICogZ2l2ZW4gcmVhZGVyIGludG8gdGhlIGdpdmVuIG1lc3NhZ2Ugb2JqZWN0LgogKiBAcGFyYW0geyFwcm90by5wYi5Sb2JvdE1lc3NhZ2V9IG1zZyBUaGUgbWVzc2FnZSBvYmplY3QgdG8gZGVzZXJpYWxpemUgaW50by4KICogQHBhcmFtIHshanNwYi5CaW5hcnlSZWFkZXJ9IHJlYWRlciBUaGUgQmluYXJ5UmVhZGVyIHRvIHVzZS4KICogQHJldHVybiB7IXByb3RvLnBiLlJvYm90TWVzc2FnZX0KICovCgoKcHJvdG8ucGIuUm9ib3RNZXNzYWdlLmRlc2VyaWFsaXplQmluYXJ5RnJvbVJlYWRlciA9IGZ1bmN0aW9uIChtc2csIHJlYWRlcikgewogIHdoaWxlIChyZWFkZXIubmV4dEZpZWxkKCkpIHsKICAgIGlmIChyZWFkZXIuaXNFbmRHcm91cCgpKSB7CiAgICAgIGJyZWFrOwogICAgfQoKICAgIHZhciBmaWVsZCA9IHJlYWRlci5nZXRGaWVsZE51bWJlcigpOwoKICAgIHN3aXRjaCAoZmllbGQpIHsKICAgICAgY2FzZSAxOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldElkKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRBcmVhSWQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAzOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldEFuY2hvcklkKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNDoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZEJvb2woKTsKICAgICAgICBtc2cuc2V0RW5hYmxlKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZEVudW0oKTsKICAgICAgICBtc2cuc2V0VHlwZSh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDY6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0VGV4dCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDc6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0VXJpKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgODoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFN0cmluZygpOwogICAgICAgIG1zZy5zZXRUaHVtYih2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDk6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0RHVyYXRpb24odmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAxMDoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRTb3J0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0SW50ZXJ2YWwodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAxMjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZEVudW0oKTsKICAgICAgICBtc2cuc2V0QWN0aW9uKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjA6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0VXBkYXRlZEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0Q3JlYXRlZEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmVhZGVyLnNraXBGaWVsZCgpOwogICAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgcmV0dXJuIG1zZzsKfTsKLyoqCiAqIFNlcmlhbGl6ZXMgdGhlIG1lc3NhZ2UgdG8gYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUgZm9ybWF0KS4KICogQHJldHVybiB7IVVpbnQ4QXJyYXl9CiAqLwoKCnByb3RvLnBiLlJvYm90TWVzc2FnZS5wcm90b3R5cGUuc2VyaWFsaXplQmluYXJ5ID0gZnVuY3Rpb24gKCkgewogIHZhciB3cml0ZXIgPSBuZXcganNwYi5CaW5hcnlXcml0ZXIoKTsKICBwcm90by5wYi5Sb2JvdE1lc3NhZ2Uuc2VyaWFsaXplQmluYXJ5VG9Xcml0ZXIodGhpcywgd3JpdGVyKTsKICByZXR1cm4gd3JpdGVyLmdldFJlc3VsdEJ1ZmZlcigpOwp9OwovKioKICogU2VyaWFsaXplcyB0aGUgZ2l2ZW4gbWVzc2FnZSB0byBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZQogKiBmb3JtYXQpLCB3cml0aW5nIHRvIHRoZSBnaXZlbiBCaW5hcnlXcml0ZXIuCiAqIEBwYXJhbSB7IXByb3RvLnBiLlJvYm90TWVzc2FnZX0gbWVzc2FnZQogKiBAcGFyYW0geyFqc3BiLkJpbmFyeVdyaXRlcn0gd3JpdGVyCiAqIEBzdXBwcmVzcyB7dW51c2VkTG9jYWxWYXJpYWJsZXN9IGYgaXMgb25seSB1c2VkIGZvciBuZXN0ZWQgbWVzc2FnZXMKICovCgoKcHJvdG8ucGIuUm9ib3RNZXNzYWdlLnNlcmlhbGl6ZUJpbmFyeVRvV3JpdGVyID0gZnVuY3Rpb24gKG1lc3NhZ2UsIHdyaXRlcikgewogIHZhciBmID0gdW5kZWZpbmVkOwogIGYgPSBtZXNzYWdlLmdldElkKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRBcmVhSWQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigyLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEFuY2hvcklkKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMywgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRFbmFibGUoKTsKCiAgaWYgKGYpIHsKICAgIHdyaXRlci53cml0ZUJvb2woNCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRUeXBlKCk7CgogIGlmIChmICE9PSAwLjApIHsKICAgIHdyaXRlci53cml0ZUVudW0oNSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRUZXh0KCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZyg2LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldFVyaSgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoNywgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRUaHVtYigpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoOCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXREdXJhdGlvbigpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDksIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0U29ydCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDEwLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEludGVydmFsKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMTEsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0QWN0aW9uKCk7CgogIGlmIChmICE9PSAwLjApIHsKICAgIHdyaXRlci53cml0ZUVudW0oMTIsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0VXBkYXRlZEF0KCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMjAsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0Q3JlYXRlZEF0KCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMjEsIGYpOwogIH0KfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBpZCA9IDE7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuUm9ib3RNZXNzYWdlLnByb3RvdHlwZS5nZXRJZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMSwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlJvYm90TWVzc2FnZX0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlJvYm90TWVzc2FnZS5wcm90b3R5cGUuc2V0SWQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDEsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBhcmVhX2lkID0gMjsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5Sb2JvdE1lc3NhZ2UucHJvdG90eXBlLmdldEFyZWFJZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMiwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlJvYm90TWVzc2FnZX0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlJvYm90TWVzc2FnZS5wcm90b3R5cGUuc2V0QXJlYUlkID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAyLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgYW5jaG9yX2lkID0gMzsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5Sb2JvdE1lc3NhZ2UucHJvdG90eXBlLmdldEFuY2hvcklkID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAzLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuUm9ib3RNZXNzYWdlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuUm9ib3RNZXNzYWdlLnByb3RvdHlwZS5zZXRBbmNob3JJZCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMywgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgYm9vbCBlbmFibGUgPSA0OwogKiBAcmV0dXJuIHtib29sZWFufQogKi8KCgpwcm90by5wYi5Sb2JvdE1lc3NhZ2UucHJvdG90eXBlLmdldEVuYWJsZSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEJvb2xlYW5GaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDQsIGZhbHNlKTsKfTsKLyoqCiAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlJvYm90TWVzc2FnZX0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlJvYm90TWVzc2FnZS5wcm90b3R5cGUuc2V0RW5hYmxlID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNCb29sZWFuRmllbGQodGhpcywgNCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgTWVzc2FnZVR5cGUgdHlwZSA9IDU7CiAqIEByZXR1cm4geyFwcm90by5wYi5NZXNzYWdlVHlwZX0KICovCgoKcHJvdG8ucGIuUm9ib3RNZXNzYWdlLnByb3RvdHlwZS5nZXRUeXBlID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA1LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7IXByb3RvLnBiLk1lc3NhZ2VUeXBlfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuUm9ib3RNZXNzYWdlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuUm9ib3RNZXNzYWdlLnByb3RvdHlwZS5zZXRUeXBlID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNFbnVtRmllbGQodGhpcywgNSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIHRleHQgPSA2OwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLlJvYm90TWVzc2FnZS5wcm90b3R5cGUuZ2V0VGV4dCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgNiwgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5Sb2JvdE1lc3NhZ2V9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5Sb2JvdE1lc3NhZ2UucHJvdG90eXBlLnNldFRleHQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDYsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyB1cmkgPSA3OwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLlJvYm90TWVzc2FnZS5wcm90b3R5cGUuZ2V0VXJpID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA3LCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlJvYm90TWVzc2FnZX0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlJvYm90TWVzc2FnZS5wcm90b3R5cGUuc2V0VXJpID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCA3LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgdGh1bWIgPSA4OwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLlJvYm90TWVzc2FnZS5wcm90b3R5cGUuZ2V0VGh1bWIgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDgsICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuUm9ib3RNZXNzYWdlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuUm9ib3RNZXNzYWdlLnByb3RvdHlwZS5zZXRUaHVtYiA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgOCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGR1cmF0aW9uID0gOTsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5Sb2JvdE1lc3NhZ2UucHJvdG90eXBlLmdldER1cmF0aW9uID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA5LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuUm9ib3RNZXNzYWdlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuUm9ib3RNZXNzYWdlLnByb3RvdHlwZS5zZXREdXJhdGlvbiA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgOSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIHNvcnQgPSAxMDsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5Sb2JvdE1lc3NhZ2UucHJvdG90eXBlLmdldFNvcnQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDEwLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuUm9ib3RNZXNzYWdlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuUm9ib3RNZXNzYWdlLnByb3RvdHlwZS5zZXRTb3J0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAxMCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGludGVydmFsID0gMTE7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuUm9ib3RNZXNzYWdlLnByb3RvdHlwZS5nZXRJbnRlcnZhbCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMTEsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5Sb2JvdE1lc3NhZ2V9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5Sb2JvdE1lc3NhZ2UucHJvdG90eXBlLnNldEludGVydmFsID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAxMSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgQWN0aW9uVHlwZSBhY3Rpb24gPSAxMjsKICogQHJldHVybiB7IXByb3RvLnBiLkFjdGlvblR5cGV9CiAqLwoKCnByb3RvLnBiLlJvYm90TWVzc2FnZS5wcm90b3R5cGUuZ2V0QWN0aW9uID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxMiwgMCk7Cn07Ci8qKgogKiBAcGFyYW0geyFwcm90by5wYi5BY3Rpb25UeXBlfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuUm9ib3RNZXNzYWdlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuUm9ib3RNZXNzYWdlLnByb3RvdHlwZS5zZXRBY3Rpb24gPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0VudW1GaWVsZCh0aGlzLCAxMiwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIHVwZGF0ZWRfYXQgPSAyMDsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5Sb2JvdE1lc3NhZ2UucHJvdG90eXBlLmdldFVwZGF0ZWRBdCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMjAsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5Sb2JvdE1lc3NhZ2V9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5Sb2JvdE1lc3NhZ2UucHJvdG90eXBlLnNldFVwZGF0ZWRBdCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMjAsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBjcmVhdGVkX2F0ID0gMjE7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuUm9ib3RNZXNzYWdlLnByb3RvdHlwZS5nZXRDcmVhdGVkQXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDIxLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuUm9ib3RNZXNzYWdlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuUm9ib3RNZXNzYWdlLnByb3RvdHlwZS5zZXRDcmVhdGVkQXQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDIxLCB2YWx1ZSk7Cn07CgppZiAoanNwYi5NZXNzYWdlLkdFTkVSQVRFX1RPX09CSkVDVCkgewogIC8qKgogICAqIENyZWF0ZXMgYW4gb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgcHJvdG8uCiAgICogRmllbGQgbmFtZXMgdGhhdCBhcmUgcmVzZXJ2ZWQgaW4gSmF2YVNjcmlwdCBhbmQgd2lsbCBiZSByZW5hbWVkIHRvIHBiX25hbWUuCiAgICogT3B0aW9uYWwgZmllbGRzIHRoYXQgYXJlIG5vdCBzZXQgd2lsbCBiZSBzZXQgdG8gdW5kZWZpbmVkLgogICAqIFRvIGFjY2VzcyBhIHJlc2VydmVkIGZpZWxkIHVzZSwgZm9vLnBiXzxuYW1lPiwgZWcsIGZvby5wYl9kZWZhdWx0LgogICAqIEZvciB0aGUgbGlzdCBvZiByZXNlcnZlZCBuYW1lcyBwbGVhc2Ugc2VlOgogICAqICAgICBuZXQvcHJvdG8yL2NvbXBpbGVyL2pzL2ludGVybmFsL2dlbmVyYXRvci5jYyNrS2V5d29yZC4KICAgKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfaW5jbHVkZUluc3RhbmNlIERlcHJlY2F0ZWQuIHdoZXRoZXIgdG8gaW5jbHVkZSB0aGUKICAgKiAgICAgSlNQQiBpbnN0YW5jZSBmb3IgdHJhbnNpdGlvbmFsIHNveSBwcm90byBzdXBwb3J0OgogICAqICAgICBodHRwOi8vZ290by9zb3ktcGFyYW0tbWlncmF0aW9uCiAgICogQHJldHVybiB7IU9iamVjdH0KICAgKi8KICBwcm90by5wYi5BdXRvTWVzc2FnZS5wcm90b3R5cGUudG9PYmplY3QgPSBmdW5jdGlvbiAob3B0X2luY2x1ZGVJbnN0YW5jZSkgewogICAgcmV0dXJuIHByb3RvLnBiLkF1dG9NZXNzYWdlLnRvT2JqZWN0KG9wdF9pbmNsdWRlSW5zdGFuY2UsIHRoaXMpOwogIH07CiAgLyoqCiAgICogU3RhdGljIHZlcnNpb24gb2YgdGhlIHtAc2VlIHRvT2JqZWN0fSBtZXRob2QuCiAgICogQHBhcmFtIHtib29sZWFufHVuZGVmaW5lZH0gaW5jbHVkZUluc3RhbmNlIERlcHJlY2F0ZWQuIFdoZXRoZXIgdG8gaW5jbHVkZQogICAqICAgICB0aGUgSlNQQiBpbnN0YW5jZSBmb3IgdHJhbnNpdGlvbmFsIHNveSBwcm90byBzdXBwb3J0OgogICAqICAgICBodHRwOi8vZ290by9zb3ktcGFyYW0tbWlncmF0aW9uCiAgICogQHBhcmFtIHshcHJvdG8ucGIuQXV0b01lc3NhZ2V9IG1zZyBUaGUgbXNnIGluc3RhbmNlIHRvIHRyYW5zZm9ybS4KICAgKiBAcmV0dXJuIHshT2JqZWN0fQogICAqIEBzdXBwcmVzcyB7dW51c2VkTG9jYWxWYXJpYWJsZXN9IGYgaXMgb25seSB1c2VkIGZvciBuZXN0ZWQgbWVzc2FnZXMKICAgKi8KCgogIHByb3RvLnBiLkF1dG9NZXNzYWdlLnRvT2JqZWN0ID0gZnVuY3Rpb24gKGluY2x1ZGVJbnN0YW5jZSwgbXNnKSB7CiAgICB2YXIgZiwKICAgICAgICBvYmogPSB7CiAgICAgIGlkOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDEsIDApLAogICAgICBhcmVhSWQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMiwgMCksCiAgICAgIGVuYWJsZToganNwYi5NZXNzYWdlLmdldEJvb2xlYW5GaWVsZFdpdGhEZWZhdWx0KG1zZywgMywgZmFsc2UpLAogICAgICBhY3Rpb246IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNCwgMCksCiAgICAgIHR5cGU6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNSwgMCksCiAgICAgIHRleHQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNiwgIiIpLAogICAgICB1cmk6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNywgIiIpLAogICAgICB0aHVtYjoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA4LCAiIiksCiAgICAgIGR1cmF0aW9uOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDksIDApLAogICAgICB1cGRhdGVkQXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjAsIDApLAogICAgICBjcmVhdGVkQXQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjEsIDApCiAgICB9OwoKICAgIGlmIChpbmNsdWRlSW5zdGFuY2UpIHsKICAgICAgb2JqLiRqc3BiTWVzc2FnZUluc3RhbmNlID0gbXNnOwogICAgfQoKICAgIHJldHVybiBvYmo7CiAgfTsKfQovKioKICogRGVzZXJpYWxpemVzIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkuCiAqIEBwYXJhbSB7anNwYi5CeXRlU291cmNlfSBieXRlcyBUaGUgYnl0ZXMgdG8gZGVzZXJpYWxpemUuCiAqIEByZXR1cm4geyFwcm90by5wYi5BdXRvTWVzc2FnZX0KICovCgoKcHJvdG8ucGIuQXV0b01lc3NhZ2UuZGVzZXJpYWxpemVCaW5hcnkgPSBmdW5jdGlvbiAoYnl0ZXMpIHsKICB2YXIgcmVhZGVyID0gbmV3IGpzcGIuQmluYXJ5UmVhZGVyKGJ5dGVzKTsKICB2YXIgbXNnID0gbmV3IHByb3RvLnBiLkF1dG9NZXNzYWdlKCk7CiAgcmV0dXJuIHByb3RvLnBiLkF1dG9NZXNzYWdlLmRlc2VyaWFsaXplQmluYXJ5RnJvbVJlYWRlcihtc2csIHJlYWRlcik7Cn07Ci8qKgogKiBEZXNlcmlhbGl6ZXMgYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUgZm9ybWF0KSBmcm9tIHRoZQogKiBnaXZlbiByZWFkZXIgaW50byB0aGUgZ2l2ZW4gbWVzc2FnZSBvYmplY3QuCiAqIEBwYXJhbSB7IXByb3RvLnBiLkF1dG9NZXNzYWdlfSBtc2cgVGhlIG1lc3NhZ2Ugb2JqZWN0IHRvIGRlc2VyaWFsaXplIGludG8uCiAqIEBwYXJhbSB7IWpzcGIuQmluYXJ5UmVhZGVyfSByZWFkZXIgVGhlIEJpbmFyeVJlYWRlciB0byB1c2UuCiAqIEByZXR1cm4geyFwcm90by5wYi5BdXRvTWVzc2FnZX0KICovCgoKcHJvdG8ucGIuQXV0b01lc3NhZ2UuZGVzZXJpYWxpemVCaW5hcnlGcm9tUmVhZGVyID0gZnVuY3Rpb24gKG1zZywgcmVhZGVyKSB7CiAgd2hpbGUgKHJlYWRlci5uZXh0RmllbGQoKSkgewogICAgaWYgKHJlYWRlci5pc0VuZEdyb3VwKCkpIHsKICAgICAgYnJlYWs7CiAgICB9CgogICAgdmFyIGZpZWxkID0gcmVhZGVyLmdldEZpZWxkTnVtYmVyKCk7CgogICAgc3dpdGNoIChmaWVsZCkgewogICAgICBjYXNlIDE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0SWQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAyOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldEFyZWFJZCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDM6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRCb29sKCk7CiAgICAgICAgbXNnLnNldEVuYWJsZSh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDQ6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRFbnVtKCk7CiAgICAgICAgbXNnLnNldEFjdGlvbih2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDU6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRFbnVtKCk7CiAgICAgICAgbXNnLnNldFR5cGUodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA2OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldFRleHQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA3OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkU3RyaW5nKCk7CiAgICAgICAgbXNnLnNldFVyaSh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDg6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0VGh1bWIodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA5OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldER1cmF0aW9uKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjA6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0VXBkYXRlZEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0Q3JlYXRlZEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmVhZGVyLnNraXBGaWVsZCgpOwogICAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgcmV0dXJuIG1zZzsKfTsKLyoqCiAqIFNlcmlhbGl6ZXMgdGhlIG1lc3NhZ2UgdG8gYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUgZm9ybWF0KS4KICogQHJldHVybiB7IVVpbnQ4QXJyYXl9CiAqLwoKCnByb3RvLnBiLkF1dG9NZXNzYWdlLnByb3RvdHlwZS5zZXJpYWxpemVCaW5hcnkgPSBmdW5jdGlvbiAoKSB7CiAgdmFyIHdyaXRlciA9IG5ldyBqc3BiLkJpbmFyeVdyaXRlcigpOwogIHByb3RvLnBiLkF1dG9NZXNzYWdlLnNlcmlhbGl6ZUJpbmFyeVRvV3JpdGVyKHRoaXMsIHdyaXRlcik7CiAgcmV0dXJuIHdyaXRlci5nZXRSZXN1bHRCdWZmZXIoKTsKfTsKLyoqCiAqIFNlcmlhbGl6ZXMgdGhlIGdpdmVuIG1lc3NhZ2UgdG8gYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUKICogZm9ybWF0KSwgd3JpdGluZyB0byB0aGUgZ2l2ZW4gQmluYXJ5V3JpdGVyLgogKiBAcGFyYW0geyFwcm90by5wYi5BdXRvTWVzc2FnZX0gbWVzc2FnZQogKiBAcGFyYW0geyFqc3BiLkJpbmFyeVdyaXRlcn0gd3JpdGVyCiAqIEBzdXBwcmVzcyB7dW51c2VkTG9jYWxWYXJpYWJsZXN9IGYgaXMgb25seSB1c2VkIGZvciBuZXN0ZWQgbWVzc2FnZXMKICovCgoKcHJvdG8ucGIuQXV0b01lc3NhZ2Uuc2VyaWFsaXplQmluYXJ5VG9Xcml0ZXIgPSBmdW5jdGlvbiAobWVzc2FnZSwgd3JpdGVyKSB7CiAgdmFyIGYgPSB1bmRlZmluZWQ7CiAgZiA9IG1lc3NhZ2UuZ2V0SWQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigxLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEFyZWFJZCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDIsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0RW5hYmxlKCk7CgogIGlmIChmKSB7CiAgICB3cml0ZXIud3JpdGVCb29sKDMsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0QWN0aW9uKCk7CgogIGlmIChmICE9PSAwLjApIHsKICAgIHdyaXRlci53cml0ZUVudW0oNCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRUeXBlKCk7CgogIGlmIChmICE9PSAwLjApIHsKICAgIHdyaXRlci53cml0ZUVudW0oNSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRUZXh0KCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZyg2LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldFVyaSgpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoNywgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRUaHVtYigpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoOCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXREdXJhdGlvbigpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDksIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0VXBkYXRlZEF0KCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMjAsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0Q3JlYXRlZEF0KCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMjEsIGYpOwogIH0KfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBpZCA9IDE7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQXV0b01lc3NhZ2UucHJvdG90eXBlLmdldElkID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXV0b01lc3NhZ2V9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BdXRvTWVzc2FnZS5wcm90b3R5cGUuc2V0SWQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDEsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBhcmVhX2lkID0gMjsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BdXRvTWVzc2FnZS5wcm90b3R5cGUuZ2V0QXJlYUlkID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAyLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXV0b01lc3NhZ2V9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BdXRvTWVzc2FnZS5wcm90b3R5cGUuc2V0QXJlYUlkID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAyLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBib29sIGVuYWJsZSA9IDM7CiAqIEByZXR1cm4ge2Jvb2xlYW59CiAqLwoKCnByb3RvLnBiLkF1dG9NZXNzYWdlLnByb3RvdHlwZS5nZXRFbmFibGUgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRCb29sZWFuRmllbGRXaXRoRGVmYXVsdCh0aGlzLCAzLCBmYWxzZSk7Cn07Ci8qKgogKiBAcGFyYW0ge2Jvb2xlYW59IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BdXRvTWVzc2FnZX0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkF1dG9NZXNzYWdlLnByb3RvdHlwZS5zZXRFbmFibGUgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0Jvb2xlYW5GaWVsZCh0aGlzLCAzLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBBY3Rpb25UeXBlIGFjdGlvbiA9IDQ7CiAqIEByZXR1cm4geyFwcm90by5wYi5BY3Rpb25UeXBlfQogKi8KCgpwcm90by5wYi5BdXRvTWVzc2FnZS5wcm90b3R5cGUuZ2V0QWN0aW9uID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA0LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7IXByb3RvLnBiLkFjdGlvblR5cGV9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BdXRvTWVzc2FnZX0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkF1dG9NZXNzYWdlLnByb3RvdHlwZS5zZXRBY3Rpb24gPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0VudW1GaWVsZCh0aGlzLCA0LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBNZXNzYWdlVHlwZSB0eXBlID0gNTsKICogQHJldHVybiB7IXByb3RvLnBiLk1lc3NhZ2VUeXBlfQogKi8KCgpwcm90by5wYi5BdXRvTWVzc2FnZS5wcm90b3R5cGUuZ2V0VHlwZSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgNSwgMCk7Cn07Ci8qKgogKiBAcGFyYW0geyFwcm90by5wYi5NZXNzYWdlVHlwZX0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkF1dG9NZXNzYWdlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXV0b01lc3NhZ2UucHJvdG90eXBlLnNldFR5cGUgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0VudW1GaWVsZCh0aGlzLCA1LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgdGV4dCA9IDY7CiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKcHJvdG8ucGIuQXV0b01lc3NhZ2UucHJvdG90eXBlLmdldFRleHQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDYsICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXV0b01lc3NhZ2V9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BdXRvTWVzc2FnZS5wcm90b3R5cGUuc2V0VGV4dCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zU3RyaW5nRmllbGQodGhpcywgNiwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIHVyaSA9IDc7CiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKcHJvdG8ucGIuQXV0b01lc3NhZ2UucHJvdG90eXBlLmdldFVyaSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgNywgIiIpOwp9OwovKioKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BdXRvTWVzc2FnZX0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkF1dG9NZXNzYWdlLnByb3RvdHlwZS5zZXRVcmkgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDcsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyB0aHVtYiA9IDg7CiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKcHJvdG8ucGIuQXV0b01lc3NhZ2UucHJvdG90eXBlLmdldFRodW1iID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA4LCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkF1dG9NZXNzYWdlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXV0b01lc3NhZ2UucHJvdG90eXBlLnNldFRodW1iID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCA4LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgZHVyYXRpb24gPSA5OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkF1dG9NZXNzYWdlLnByb3RvdHlwZS5nZXREdXJhdGlvbiA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgOSwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkF1dG9NZXNzYWdlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXV0b01lc3NhZ2UucHJvdG90eXBlLnNldER1cmF0aW9uID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCA5LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgdXBkYXRlZF9hdCA9IDIwOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkF1dG9NZXNzYWdlLnByb3RvdHlwZS5nZXRVcGRhdGVkQXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDIwLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXV0b01lc3NhZ2V9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BdXRvTWVzc2FnZS5wcm90b3R5cGUuc2V0VXBkYXRlZEF0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAyMCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGNyZWF0ZWRfYXQgPSAyMTsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BdXRvTWVzc2FnZS5wcm90b3R5cGUuZ2V0Q3JlYXRlZEF0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAyMSwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkF1dG9NZXNzYWdlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXV0b01lc3NhZ2UucHJvdG90eXBlLnNldENyZWF0ZWRBdCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMjEsIHZhbHVlKTsKfTsKCmlmIChqc3BiLk1lc3NhZ2UuR0VORVJBVEVfVE9fT0JKRUNUKSB7CiAgLyoqCiAgICogQ3JlYXRlcyBhbiBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBwcm90by4KICAgKiBGaWVsZCBuYW1lcyB0aGF0IGFyZSByZXNlcnZlZCBpbiBKYXZhU2NyaXB0IGFuZCB3aWxsIGJlIHJlbmFtZWQgdG8gcGJfbmFtZS4KICAgKiBPcHRpb25hbCBmaWVsZHMgdGhhdCBhcmUgbm90IHNldCB3aWxsIGJlIHNldCB0byB1bmRlZmluZWQuCiAgICogVG8gYWNjZXNzIGEgcmVzZXJ2ZWQgZmllbGQgdXNlLCBmb28ucGJfPG5hbWU+LCBlZywgZm9vLnBiX2RlZmF1bHQuCiAgICogRm9yIHRoZSBsaXN0IG9mIHJlc2VydmVkIG5hbWVzIHBsZWFzZSBzZWU6CiAgICogICAgIG5ldC9wcm90bzIvY29tcGlsZXIvanMvaW50ZXJuYWwvZ2VuZXJhdG9yLmNjI2tLZXl3b3JkLgogICAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF9pbmNsdWRlSW5zdGFuY2UgRGVwcmVjYXRlZC4gd2hldGhlciB0byBpbmNsdWRlIHRoZQogICAqICAgICBKU1BCIGluc3RhbmNlIGZvciB0cmFuc2l0aW9uYWwgc295IHByb3RvIHN1cHBvcnQ6CiAgICogICAgIGh0dHA6Ly9nb3RvL3NveS1wYXJhbS1taWdyYXRpb24KICAgKiBAcmV0dXJuIHshT2JqZWN0fQogICAqLwogIHByb3RvLnBiLkNoYXRNZXNzYWdlLnByb3RvdHlwZS50b09iamVjdCA9IGZ1bmN0aW9uIChvcHRfaW5jbHVkZUluc3RhbmNlKSB7CiAgICByZXR1cm4gcHJvdG8ucGIuQ2hhdE1lc3NhZ2UudG9PYmplY3Qob3B0X2luY2x1ZGVJbnN0YW5jZSwgdGhpcyk7CiAgfTsKICAvKioKICAgKiBTdGF0aWMgdmVyc2lvbiBvZiB0aGUge0BzZWUgdG9PYmplY3R9IG1ldGhvZC4KICAgKiBAcGFyYW0ge2Jvb2xlYW58dW5kZWZpbmVkfSBpbmNsdWRlSW5zdGFuY2UgRGVwcmVjYXRlZC4gV2hldGhlciB0byBpbmNsdWRlCiAgICogICAgIHRoZSBKU1BCIGluc3RhbmNlIGZvciB0cmFuc2l0aW9uYWwgc295IHByb3RvIHN1cHBvcnQ6CiAgICogICAgIGh0dHA6Ly9nb3RvL3NveS1wYXJhbS1taWdyYXRpb24KICAgKiBAcGFyYW0geyFwcm90by5wYi5DaGF0TWVzc2FnZX0gbXNnIFRoZSBtc2cgaW5zdGFuY2UgdG8gdHJhbnNmb3JtLgogICAqIEByZXR1cm4geyFPYmplY3R9CiAgICogQHN1cHByZXNzIHt1bnVzZWRMb2NhbFZhcmlhYmxlc30gZiBpcyBvbmx5IHVzZWQgZm9yIG5lc3RlZCBtZXNzYWdlcwogICAqLwoKCiAgcHJvdG8ucGIuQ2hhdE1lc3NhZ2UudG9PYmplY3QgPSBmdW5jdGlvbiAoaW5jbHVkZUluc3RhbmNlLCBtc2cpIHsKICAgIHZhciBmLAogICAgICAgIG9iaiA9IHsKICAgICAgaWQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMSwgMCksCiAgICAgIGFyZWFJZDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAyLCAwKSwKICAgICAgYXBwSWQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMywgMCksCiAgICAgIHVzZXJJZDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA0LCAwKSwKICAgICAgYW5jaG9ySWQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNSwgMCksCiAgICAgIHR5cGU6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNiwgMCksCiAgICAgIGRpcmVjdGlvbjoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA3LCAwKSwKICAgICAgdGV4dDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA4LCAiIiksCiAgICAgIHVyaToganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA5LCAiIiksCiAgICAgIHRodW1iOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDEwLCAiIiksCiAgICAgIGR1cmF0aW9uOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDExLCAwKSwKICAgICAgc2VuZEF0OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDEyLCAwKSwKICAgICAgY3JlYXRlZEF0OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDIxLCAwKQogICAgfTsKCiAgICBpZiAoaW5jbHVkZUluc3RhbmNlKSB7CiAgICAgIG9iai4kanNwYk1lc3NhZ2VJbnN0YW5jZSA9IG1zZzsKICAgIH0KCiAgICByZXR1cm4gb2JqOwogIH07Cn0KLyoqCiAqIERlc2VyaWFsaXplcyBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZSBmb3JtYXQpLgogKiBAcGFyYW0ge2pzcGIuQnl0ZVNvdXJjZX0gYnl0ZXMgVGhlIGJ5dGVzIHRvIGRlc2VyaWFsaXplLgogKiBAcmV0dXJuIHshcHJvdG8ucGIuQ2hhdE1lc3NhZ2V9CiAqLwoKCnByb3RvLnBiLkNoYXRNZXNzYWdlLmRlc2VyaWFsaXplQmluYXJ5ID0gZnVuY3Rpb24gKGJ5dGVzKSB7CiAgdmFyIHJlYWRlciA9IG5ldyBqc3BiLkJpbmFyeVJlYWRlcihieXRlcyk7CiAgdmFyIG1zZyA9IG5ldyBwcm90by5wYi5DaGF0TWVzc2FnZSgpOwogIHJldHVybiBwcm90by5wYi5DaGF0TWVzc2FnZS5kZXNlcmlhbGl6ZUJpbmFyeUZyb21SZWFkZXIobXNnLCByZWFkZXIpOwp9OwovKioKICogRGVzZXJpYWxpemVzIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkgZnJvbSB0aGUKICogZ2l2ZW4gcmVhZGVyIGludG8gdGhlIGdpdmVuIG1lc3NhZ2Ugb2JqZWN0LgogKiBAcGFyYW0geyFwcm90by5wYi5DaGF0TWVzc2FnZX0gbXNnIFRoZSBtZXNzYWdlIG9iamVjdCB0byBkZXNlcmlhbGl6ZSBpbnRvLgogKiBAcGFyYW0geyFqc3BiLkJpbmFyeVJlYWRlcn0gcmVhZGVyIFRoZSBCaW5hcnlSZWFkZXIgdG8gdXNlLgogKiBAcmV0dXJuIHshcHJvdG8ucGIuQ2hhdE1lc3NhZ2V9CiAqLwoKCnByb3RvLnBiLkNoYXRNZXNzYWdlLmRlc2VyaWFsaXplQmluYXJ5RnJvbVJlYWRlciA9IGZ1bmN0aW9uIChtc2csIHJlYWRlcikgewogIHdoaWxlIChyZWFkZXIubmV4dEZpZWxkKCkpIHsKICAgIGlmIChyZWFkZXIuaXNFbmRHcm91cCgpKSB7CiAgICAgIGJyZWFrOwogICAgfQoKICAgIHZhciBmaWVsZCA9IHJlYWRlci5nZXRGaWVsZE51bWJlcigpOwoKICAgIHN3aXRjaCAoZmllbGQpIHsKICAgICAgY2FzZSAxOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDY0KCk7CiAgICAgICAgbXNnLnNldElkKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRBcmVhSWQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAzOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldEFwcElkKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNDoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRVc2VySWQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA1OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldEFuY2hvcklkKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZEVudW0oKTsKICAgICAgICBtc2cuc2V0VHlwZSh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDc6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRFbnVtKCk7CiAgICAgICAgbXNnLnNldERpcmVjdGlvbih2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDg6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0VGV4dCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDk6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0VXJpKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTA6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0VGh1bWIodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAxMToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXREdXJhdGlvbih2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDEyOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldFNlbmRBdCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDIxOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldENyZWF0ZWRBdCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBkZWZhdWx0OgogICAgICAgIHJlYWRlci5za2lwRmllbGQoKTsKICAgICAgICBicmVhazsKICAgIH0KICB9CgogIHJldHVybiBtc2c7Cn07Ci8qKgogKiBTZXJpYWxpemVzIHRoZSBtZXNzYWdlIHRvIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkuCiAqIEByZXR1cm4geyFVaW50OEFycmF5fQogKi8KCgpwcm90by5wYi5DaGF0TWVzc2FnZS5wcm90b3R5cGUuc2VyaWFsaXplQmluYXJ5ID0gZnVuY3Rpb24gKCkgewogIHZhciB3cml0ZXIgPSBuZXcganNwYi5CaW5hcnlXcml0ZXIoKTsKICBwcm90by5wYi5DaGF0TWVzc2FnZS5zZXJpYWxpemVCaW5hcnlUb1dyaXRlcih0aGlzLCB3cml0ZXIpOwogIHJldHVybiB3cml0ZXIuZ2V0UmVzdWx0QnVmZmVyKCk7Cn07Ci8qKgogKiBTZXJpYWxpemVzIHRoZSBnaXZlbiBtZXNzYWdlIHRvIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlCiAqIGZvcm1hdCksIHdyaXRpbmcgdG8gdGhlIGdpdmVuIEJpbmFyeVdyaXRlci4KICogQHBhcmFtIHshcHJvdG8ucGIuQ2hhdE1lc3NhZ2V9IG1lc3NhZ2UKICogQHBhcmFtIHshanNwYi5CaW5hcnlXcml0ZXJ9IHdyaXRlcgogKiBAc3VwcHJlc3Mge3VudXNlZExvY2FsVmFyaWFibGVzfSBmIGlzIG9ubHkgdXNlZCBmb3IgbmVzdGVkIG1lc3NhZ2VzCiAqLwoKCnByb3RvLnBiLkNoYXRNZXNzYWdlLnNlcmlhbGl6ZUJpbmFyeVRvV3JpdGVyID0gZnVuY3Rpb24gKG1lc3NhZ2UsIHdyaXRlcikgewogIHZhciBmID0gdW5kZWZpbmVkOwogIGYgPSBtZXNzYWdlLmdldElkKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50NjQoMSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRBcmVhSWQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigyLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEFwcElkKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMywgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRVc2VySWQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMig0LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEFuY2hvcklkKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoNSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRUeXBlKCk7CgogIGlmIChmICE9PSAwLjApIHsKICAgIHdyaXRlci53cml0ZUVudW0oNiwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXREaXJlY3Rpb24oKTsKCiAgaWYgKGYgIT09IDAuMCkgewogICAgd3JpdGVyLndyaXRlRW51bSg3LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldFRleHQoKTsKCiAgaWYgKGYubGVuZ3RoID4gMCkgewogICAgd3JpdGVyLndyaXRlU3RyaW5nKDgsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0VXJpKCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZyg5LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldFRodW1iKCk7CgogIGlmIChmLmxlbmd0aCA+IDApIHsKICAgIHdyaXRlci53cml0ZVN0cmluZygxMCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXREdXJhdGlvbigpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDExLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldFNlbmRBdCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDEyLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldENyZWF0ZWRBdCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDIxLCBmKTsKICB9Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50NjQgaWQgPSAxOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkNoYXRNZXNzYWdlLnByb3RvdHlwZS5nZXRJZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMSwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkNoYXRNZXNzYWdlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQ2hhdE1lc3NhZ2UucHJvdG90eXBlLnNldElkID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAxLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgYXJlYV9pZCA9IDI7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQ2hhdE1lc3NhZ2UucHJvdG90eXBlLmdldEFyZWFJZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMiwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkNoYXRNZXNzYWdlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQ2hhdE1lc3NhZ2UucHJvdG90eXBlLnNldEFyZWFJZCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMiwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGFwcF9pZCA9IDM7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQ2hhdE1lc3NhZ2UucHJvdG90eXBlLmdldEFwcElkID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAzLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQ2hhdE1lc3NhZ2V9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5DaGF0TWVzc2FnZS5wcm90b3R5cGUuc2V0QXBwSWQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDMsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiB1c2VyX2lkID0gNDsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5DaGF0TWVzc2FnZS5wcm90b3R5cGUuZ2V0VXNlcklkID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA0LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQ2hhdE1lc3NhZ2V9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5DaGF0TWVzc2FnZS5wcm90b3R5cGUuc2V0VXNlcklkID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCA0LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgYW5jaG9yX2lkID0gNTsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5DaGF0TWVzc2FnZS5wcm90b3R5cGUuZ2V0QW5jaG9ySWQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDUsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5DaGF0TWVzc2FnZX0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkNoYXRNZXNzYWdlLnByb3RvdHlwZS5zZXRBbmNob3JJZCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgNSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgTWVzc2FnZVR5cGUgdHlwZSA9IDY7CiAqIEByZXR1cm4geyFwcm90by5wYi5NZXNzYWdlVHlwZX0KICovCgoKcHJvdG8ucGIuQ2hhdE1lc3NhZ2UucHJvdG90eXBlLmdldFR5cGUgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDYsIDApOwp9OwovKioKICogQHBhcmFtIHshcHJvdG8ucGIuTWVzc2FnZVR5cGV9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5DaGF0TWVzc2FnZX0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkNoYXRNZXNzYWdlLnByb3RvdHlwZS5zZXRUeXBlID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNFbnVtRmllbGQodGhpcywgNiwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgTWVzc2FnZURpcmVjdGlvbiBkaXJlY3Rpb24gPSA3OwogKiBAcmV0dXJuIHshcHJvdG8ucGIuTWVzc2FnZURpcmVjdGlvbn0KICovCgoKcHJvdG8ucGIuQ2hhdE1lc3NhZ2UucHJvdG90eXBlLmdldERpcmVjdGlvbiA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgNywgMCk7Cn07Ci8qKgogKiBAcGFyYW0geyFwcm90by5wYi5NZXNzYWdlRGlyZWN0aW9ufSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQ2hhdE1lc3NhZ2V9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5DaGF0TWVzc2FnZS5wcm90b3R5cGUuc2V0RGlyZWN0aW9uID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNFbnVtRmllbGQodGhpcywgNywgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgc3RyaW5nIHRleHQgPSA4OwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLkNoYXRNZXNzYWdlLnByb3RvdHlwZS5nZXRUZXh0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA4LCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkNoYXRNZXNzYWdlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQ2hhdE1lc3NhZ2UucHJvdG90eXBlLnNldFRleHQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM1N0cmluZ0ZpZWxkKHRoaXMsIDgsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyB1cmkgPSA5OwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLkNoYXRNZXNzYWdlLnByb3RvdHlwZS5nZXRVcmkgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDksICIiKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQ2hhdE1lc3NhZ2V9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5DaGF0TWVzc2FnZS5wcm90b3R5cGUuc2V0VXJpID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCA5LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBzdHJpbmcgdGh1bWIgPSAxMDsKICogQHJldHVybiB7c3RyaW5nfQogKi8KCgpwcm90by5wYi5DaGF0TWVzc2FnZS5wcm90b3R5cGUuZ2V0VGh1bWIgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDEwLCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkNoYXRNZXNzYWdlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQ2hhdE1lc3NhZ2UucHJvdG90eXBlLnNldFRodW1iID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCAxMCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGR1cmF0aW9uID0gMTE7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQ2hhdE1lc3NhZ2UucHJvdG90eXBlLmdldER1cmF0aW9uID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxMSwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkNoYXRNZXNzYWdlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQ2hhdE1lc3NhZ2UucHJvdG90eXBlLnNldER1cmF0aW9uID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAxMSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIHNlbmRfYXQgPSAxMjsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5DaGF0TWVzc2FnZS5wcm90b3R5cGUuZ2V0U2VuZEF0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxMiwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkNoYXRNZXNzYWdlfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQ2hhdE1lc3NhZ2UucHJvdG90eXBlLnNldFNlbmRBdCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMTIsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBjcmVhdGVkX2F0ID0gMjE7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQ2hhdE1lc3NhZ2UucHJvdG90eXBlLmdldENyZWF0ZWRBdCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMjEsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5DaGF0TWVzc2FnZX0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkNoYXRNZXNzYWdlLnByb3RvdHlwZS5zZXRDcmVhdGVkQXQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDIxLCB2YWx1ZSk7Cn07CgppZiAoanNwYi5NZXNzYWdlLkdFTkVSQVRFX1RPX09CSkVDVCkgewogIC8qKgogICAqIENyZWF0ZXMgYW4gb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgcHJvdG8uCiAgICogRmllbGQgbmFtZXMgdGhhdCBhcmUgcmVzZXJ2ZWQgaW4gSmF2YVNjcmlwdCBhbmQgd2lsbCBiZSByZW5hbWVkIHRvIHBiX25hbWUuCiAgICogT3B0aW9uYWwgZmllbGRzIHRoYXQgYXJlIG5vdCBzZXQgd2lsbCBiZSBzZXQgdG8gdW5kZWZpbmVkLgogICAqIFRvIGFjY2VzcyBhIHJlc2VydmVkIGZpZWxkIHVzZSwgZm9vLnBiXzxuYW1lPiwgZWcsIGZvby5wYl9kZWZhdWx0LgogICAqIEZvciB0aGUgbGlzdCBvZiByZXNlcnZlZCBuYW1lcyBwbGVhc2Ugc2VlOgogICAqICAgICBuZXQvcHJvdG8yL2NvbXBpbGVyL2pzL2ludGVybmFsL2dlbmVyYXRvci5jYyNrS2V5d29yZC4KICAgKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfaW5jbHVkZUluc3RhbmNlIERlcHJlY2F0ZWQuIHdoZXRoZXIgdG8gaW5jbHVkZSB0aGUKICAgKiAgICAgSlNQQiBpbnN0YW5jZSBmb3IgdHJhbnNpdGlvbmFsIHNveSBwcm90byBzdXBwb3J0OgogICAqICAgICBodHRwOi8vZ290by9zb3ktcGFyYW0tbWlncmF0aW9uCiAgICogQHJldHVybiB7IU9iamVjdH0KICAgKi8KICBwcm90by5wYi5BZGp1c3RSZWNvcmQucHJvdG90eXBlLnRvT2JqZWN0ID0gZnVuY3Rpb24gKG9wdF9pbmNsdWRlSW5zdGFuY2UpIHsKICAgIHJldHVybiBwcm90by5wYi5BZGp1c3RSZWNvcmQudG9PYmplY3Qob3B0X2luY2x1ZGVJbnN0YW5jZSwgdGhpcyk7CiAgfTsKICAvKioKICAgKiBTdGF0aWMgdmVyc2lvbiBvZiB0aGUge0BzZWUgdG9PYmplY3R9IG1ldGhvZC4KICAgKiBAcGFyYW0ge2Jvb2xlYW58dW5kZWZpbmVkfSBpbmNsdWRlSW5zdGFuY2UgRGVwcmVjYXRlZC4gV2hldGhlciB0byBpbmNsdWRlCiAgICogICAgIHRoZSBKU1BCIGluc3RhbmNlIGZvciB0cmFuc2l0aW9uYWwgc295IHByb3RvIHN1cHBvcnQ6CiAgICogICAgIGh0dHA6Ly9nb3RvL3NveS1wYXJhbS1taWdyYXRpb24KICAgKiBAcGFyYW0geyFwcm90by5wYi5BZGp1c3RSZWNvcmR9IG1zZyBUaGUgbXNnIGluc3RhbmNlIHRvIHRyYW5zZm9ybS4KICAgKiBAcmV0dXJuIHshT2JqZWN0fQogICAqIEBzdXBwcmVzcyB7dW51c2VkTG9jYWxWYXJpYWJsZXN9IGYgaXMgb25seSB1c2VkIGZvciBuZXN0ZWQgbWVzc2FnZXMKICAgKi8KCgogIHByb3RvLnBiLkFkanVzdFJlY29yZC50b09iamVjdCA9IGZ1bmN0aW9uIChpbmNsdWRlSW5zdGFuY2UsIG1zZykgewogICAgdmFyIGYsCiAgICAgICAgb2JqID0gewogICAgICBpZDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxLCAwKSwKICAgICAgYXBwSWQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMiwgMCksCiAgICAgIGFyZWFJZDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAzLCAwKSwKICAgICAgYWRtaW5JZDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA0LCAwKSwKICAgICAgZW50aXR5VHlwZToganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA1LCAwKSwKICAgICAgZW50aXR5SWQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNiwgMCksCiAgICAgIGFtb3VudDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA3LCAwKSwKICAgICAgcmVhc29uOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDgsICIiKSwKICAgICAgdXBkYXRlZEF0OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDIwLCAwKSwKICAgICAgY3JlYXRlZEF0OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDIxLCAwKQogICAgfTsKCiAgICBpZiAoaW5jbHVkZUluc3RhbmNlKSB7CiAgICAgIG9iai4kanNwYk1lc3NhZ2VJbnN0YW5jZSA9IG1zZzsKICAgIH0KCiAgICByZXR1cm4gb2JqOwogIH07Cn0KLyoqCiAqIERlc2VyaWFsaXplcyBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZSBmb3JtYXQpLgogKiBAcGFyYW0ge2pzcGIuQnl0ZVNvdXJjZX0gYnl0ZXMgVGhlIGJ5dGVzIHRvIGRlc2VyaWFsaXplLgogKiBAcmV0dXJuIHshcHJvdG8ucGIuQWRqdXN0UmVjb3JkfQogKi8KCgpwcm90by5wYi5BZGp1c3RSZWNvcmQuZGVzZXJpYWxpemVCaW5hcnkgPSBmdW5jdGlvbiAoYnl0ZXMpIHsKICB2YXIgcmVhZGVyID0gbmV3IGpzcGIuQmluYXJ5UmVhZGVyKGJ5dGVzKTsKICB2YXIgbXNnID0gbmV3IHByb3RvLnBiLkFkanVzdFJlY29yZCgpOwogIHJldHVybiBwcm90by5wYi5BZGp1c3RSZWNvcmQuZGVzZXJpYWxpemVCaW5hcnlGcm9tUmVhZGVyKG1zZywgcmVhZGVyKTsKfTsKLyoqCiAqIERlc2VyaWFsaXplcyBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZSBmb3JtYXQpIGZyb20gdGhlCiAqIGdpdmVuIHJlYWRlciBpbnRvIHRoZSBnaXZlbiBtZXNzYWdlIG9iamVjdC4KICogQHBhcmFtIHshcHJvdG8ucGIuQWRqdXN0UmVjb3JkfSBtc2cgVGhlIG1lc3NhZ2Ugb2JqZWN0IHRvIGRlc2VyaWFsaXplIGludG8uCiAqIEBwYXJhbSB7IWpzcGIuQmluYXJ5UmVhZGVyfSByZWFkZXIgVGhlIEJpbmFyeVJlYWRlciB0byB1c2UuCiAqIEByZXR1cm4geyFwcm90by5wYi5BZGp1c3RSZWNvcmR9CiAqLwoKCnByb3RvLnBiLkFkanVzdFJlY29yZC5kZXNlcmlhbGl6ZUJpbmFyeUZyb21SZWFkZXIgPSBmdW5jdGlvbiAobXNnLCByZWFkZXIpIHsKICB3aGlsZSAocmVhZGVyLm5leHRGaWVsZCgpKSB7CiAgICBpZiAocmVhZGVyLmlzRW5kR3JvdXAoKSkgewogICAgICBicmVhazsKICAgIH0KCiAgICB2YXIgZmllbGQgPSByZWFkZXIuZ2V0RmllbGROdW1iZXIoKTsKCiAgICBzd2l0Y2ggKGZpZWxkKSB7CiAgICAgIGNhc2UgMToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQ2NCgpOwogICAgICAgIG1zZy5zZXRJZCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDI6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0QXBwSWQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAzOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldEFyZWFJZCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDQ6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0QWRtaW5JZCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDU6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRFbnVtKCk7CiAgICAgICAgbXNnLnNldEVudGl0eVR5cGUodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA2OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldEVudGl0eUlkKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNzoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZEludDMyKCk7CiAgICAgICAgbXNnLnNldEFtb3VudCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDg6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRTdHJpbmcoKTsKICAgICAgICBtc2cuc2V0UmVhc29uKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjA6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0VXBkYXRlZEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0Q3JlYXRlZEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmVhZGVyLnNraXBGaWVsZCgpOwogICAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgcmV0dXJuIG1zZzsKfTsKLyoqCiAqIFNlcmlhbGl6ZXMgdGhlIG1lc3NhZ2UgdG8gYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUgZm9ybWF0KS4KICogQHJldHVybiB7IVVpbnQ4QXJyYXl9CiAqLwoKCnByb3RvLnBiLkFkanVzdFJlY29yZC5wcm90b3R5cGUuc2VyaWFsaXplQmluYXJ5ID0gZnVuY3Rpb24gKCkgewogIHZhciB3cml0ZXIgPSBuZXcganNwYi5CaW5hcnlXcml0ZXIoKTsKICBwcm90by5wYi5BZGp1c3RSZWNvcmQuc2VyaWFsaXplQmluYXJ5VG9Xcml0ZXIodGhpcywgd3JpdGVyKTsKICByZXR1cm4gd3JpdGVyLmdldFJlc3VsdEJ1ZmZlcigpOwp9OwovKioKICogU2VyaWFsaXplcyB0aGUgZ2l2ZW4gbWVzc2FnZSB0byBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZQogKiBmb3JtYXQpLCB3cml0aW5nIHRvIHRoZSBnaXZlbiBCaW5hcnlXcml0ZXIuCiAqIEBwYXJhbSB7IXByb3RvLnBiLkFkanVzdFJlY29yZH0gbWVzc2FnZQogKiBAcGFyYW0geyFqc3BiLkJpbmFyeVdyaXRlcn0gd3JpdGVyCiAqIEBzdXBwcmVzcyB7dW51c2VkTG9jYWxWYXJpYWJsZXN9IGYgaXMgb25seSB1c2VkIGZvciBuZXN0ZWQgbWVzc2FnZXMKICovCgoKcHJvdG8ucGIuQWRqdXN0UmVjb3JkLnNlcmlhbGl6ZUJpbmFyeVRvV3JpdGVyID0gZnVuY3Rpb24gKG1lc3NhZ2UsIHdyaXRlcikgewogIHZhciBmID0gdW5kZWZpbmVkOwogIGYgPSBtZXNzYWdlLmdldElkKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50NjQoMSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRBcHBJZCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDIsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0QXJlYUlkKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMywgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRBZG1pbklkKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoNCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRFbnRpdHlUeXBlKCk7CgogIGlmIChmICE9PSAwLjApIHsKICAgIHdyaXRlci53cml0ZUVudW0oNSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRFbnRpdHlJZCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDYsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0QW1vdW50KCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVJbnQzMig3LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldFJlYXNvbigpOwoKICBpZiAoZi5sZW5ndGggPiAwKSB7CiAgICB3cml0ZXIud3JpdGVTdHJpbmcoOCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRVcGRhdGVkQXQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigyMCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRDcmVhdGVkQXQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigyMSwgZik7CiAgfQp9OwovKioKICogb3B0aW9uYWwgdWludDY0IGlkID0gMTsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BZGp1c3RSZWNvcmQucHJvdG90eXBlLmdldElkID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQWRqdXN0UmVjb3JkfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQWRqdXN0UmVjb3JkLnByb3RvdHlwZS5zZXRJZCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGFwcF9pZCA9IDI7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQWRqdXN0UmVjb3JkLnByb3RvdHlwZS5nZXRBcHBJZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMiwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFkanVzdFJlY29yZH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFkanVzdFJlY29yZC5wcm90b3R5cGUuc2V0QXBwSWQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDIsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBhcmVhX2lkID0gMzsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BZGp1c3RSZWNvcmQucHJvdG90eXBlLmdldEFyZWFJZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMywgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFkanVzdFJlY29yZH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFkanVzdFJlY29yZC5wcm90b3R5cGUuc2V0QXJlYUlkID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAzLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgYWRtaW5faWQgPSA0OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFkanVzdFJlY29yZC5wcm90b3R5cGUuZ2V0QWRtaW5JZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgNCwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFkanVzdFJlY29yZH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFkanVzdFJlY29yZC5wcm90b3R5cGUuc2V0QWRtaW5JZCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgNCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgRW50aXR5VHlwZSBlbnRpdHlfdHlwZSA9IDU7CiAqIEByZXR1cm4geyFwcm90by5wYi5FbnRpdHlUeXBlfQogKi8KCgpwcm90by5wYi5BZGp1c3RSZWNvcmQucHJvdG90eXBlLmdldEVudGl0eVR5cGUgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDUsIDApOwp9OwovKioKICogQHBhcmFtIHshcHJvdG8ucGIuRW50aXR5VHlwZX0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFkanVzdFJlY29yZH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFkanVzdFJlY29yZC5wcm90b3R5cGUuc2V0RW50aXR5VHlwZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zRW51bUZpZWxkKHRoaXMsIDUsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBlbnRpdHlfaWQgPSA2OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFkanVzdFJlY29yZC5wcm90b3R5cGUuZ2V0RW50aXR5SWQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDYsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BZGp1c3RSZWNvcmR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BZGp1c3RSZWNvcmQucHJvdG90eXBlLnNldEVudGl0eUlkID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCA2LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCBpbnQzMiBhbW91bnQgPSA3OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFkanVzdFJlY29yZC5wcm90b3R5cGUuZ2V0QW1vdW50ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA3LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQWRqdXN0UmVjb3JkfSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQWRqdXN0UmVjb3JkLnByb3RvdHlwZS5zZXRBbW91bnQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDcsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHN0cmluZyByZWFzb24gPSA4OwogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCnByb3RvLnBiLkFkanVzdFJlY29yZC5wcm90b3R5cGUuZ2V0UmVhc29uID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA4LCAiIik7Cn07Ci8qKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFkanVzdFJlY29yZH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFkanVzdFJlY29yZC5wcm90b3R5cGUuc2V0UmVhc29uID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNTdHJpbmdGaWVsZCh0aGlzLCA4LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgdXBkYXRlZF9hdCA9IDIwOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFkanVzdFJlY29yZC5wcm90b3R5cGUuZ2V0VXBkYXRlZEF0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAyMCwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFkanVzdFJlY29yZH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFkanVzdFJlY29yZC5wcm90b3R5cGUuc2V0VXBkYXRlZEF0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAyMCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGNyZWF0ZWRfYXQgPSAyMTsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BZGp1c3RSZWNvcmQucHJvdG90eXBlLmdldENyZWF0ZWRBdCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMjEsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BZGp1c3RSZWNvcmR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BZGp1c3RSZWNvcmQucHJvdG90eXBlLnNldENyZWF0ZWRBdCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMjEsIHZhbHVlKTsKfTsKCmlmIChqc3BiLk1lc3NhZ2UuR0VORVJBVEVfVE9fT0JKRUNUKSB7CiAgLyoqCiAgICogQ3JlYXRlcyBhbiBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBwcm90by4KICAgKiBGaWVsZCBuYW1lcyB0aGF0IGFyZSByZXNlcnZlZCBpbiBKYXZhU2NyaXB0IGFuZCB3aWxsIGJlIHJlbmFtZWQgdG8gcGJfbmFtZS4KICAgKiBPcHRpb25hbCBmaWVsZHMgdGhhdCBhcmUgbm90IHNldCB3aWxsIGJlIHNldCB0byB1bmRlZmluZWQuCiAgICogVG8gYWNjZXNzIGEgcmVzZXJ2ZWQgZmllbGQgdXNlLCBmb28ucGJfPG5hbWU+LCBlZywgZm9vLnBiX2RlZmF1bHQuCiAgICogRm9yIHRoZSBsaXN0IG9mIHJlc2VydmVkIG5hbWVzIHBsZWFzZSBzZWU6CiAgICogICAgIG5ldC9wcm90bzIvY29tcGlsZXIvanMvaW50ZXJuYWwvZ2VuZXJhdG9yLmNjI2tLZXl3b3JkLgogICAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF9pbmNsdWRlSW5zdGFuY2UgRGVwcmVjYXRlZC4gd2hldGhlciB0byBpbmNsdWRlIHRoZQogICAqICAgICBKU1BCIGluc3RhbmNlIGZvciB0cmFuc2l0aW9uYWwgc295IHByb3RvIHN1cHBvcnQ6CiAgICogICAgIGh0dHA6Ly9nb3RvL3NveS1wYXJhbS1taWdyYXRpb24KICAgKiBAcmV0dXJuIHshT2JqZWN0fQogICAqLwogIHByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS50b09iamVjdCA9IGZ1bmN0aW9uIChvcHRfaW5jbHVkZUluc3RhbmNlKSB7CiAgICByZXR1cm4gcHJvdG8ucGIuQXJlYVN0YXQudG9PYmplY3Qob3B0X2luY2x1ZGVJbnN0YW5jZSwgdGhpcyk7CiAgfTsKICAvKioKICAgKiBTdGF0aWMgdmVyc2lvbiBvZiB0aGUge0BzZWUgdG9PYmplY3R9IG1ldGhvZC4KICAgKiBAcGFyYW0ge2Jvb2xlYW58dW5kZWZpbmVkfSBpbmNsdWRlSW5zdGFuY2UgRGVwcmVjYXRlZC4gV2hldGhlciB0byBpbmNsdWRlCiAgICogICAgIHRoZSBKU1BCIGluc3RhbmNlIGZvciB0cmFuc2l0aW9uYWwgc295IHByb3RvIHN1cHBvcnQ6CiAgICogICAgIGh0dHA6Ly9nb3RvL3NveS1wYXJhbS1taWdyYXRpb24KICAgKiBAcGFyYW0geyFwcm90by5wYi5BcmVhU3RhdH0gbXNnIFRoZSBtc2cgaW5zdGFuY2UgdG8gdHJhbnNmb3JtLgogICAqIEByZXR1cm4geyFPYmplY3R9CiAgICogQHN1cHByZXNzIHt1bnVzZWRMb2NhbFZhcmlhYmxlc30gZiBpcyBvbmx5IHVzZWQgZm9yIG5lc3RlZCBtZXNzYWdlcwogICAqLwoKCiAgcHJvdG8ucGIuQXJlYVN0YXQudG9PYmplY3QgPSBmdW5jdGlvbiAoaW5jbHVkZUluc3RhbmNlLCBtc2cpIHsKICAgIHZhciBmLAogICAgICAgIG9iaiA9IHsKICAgICAgaWQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMSwgMCksCiAgICAgIGFyZWFJZDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAyLCAwKSwKICAgICAgc3RhcnRBdDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAzLCAwKSwKICAgICAgaW50ZXJ2YWw6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNCwgMCksCiAgICAgIHN0YXRBdDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA1LCAwKSwKICAgICAgYWN0aXZlVXNlcjoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA2LCAwKSwKICAgICAgb25saW5lVXNlcjoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA3LCAwKSwKICAgICAgbmV3VXNlcjoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA4LCAwKSwKICAgICAgcGF5VXNlcjoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA5LCAwKSwKICAgICAgYWN0aXZlQW5jaG9yOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDEwLCAwKSwKICAgICAgaWRsZUFuY2hvcjoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxMSwgMCksCiAgICAgIGJ1c3lBbmNob3I6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMTIsIDApLAogICAgICBhaUNhbGxpbmc6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMTMsIDApLAogICAgICB1c2VyQ2FsbGluZzoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxNCwgMCksCiAgICAgIGFuY2hvckNhbGxpbmc6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMTUsIDApLAogICAgICBhaUNhbGw6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMTYsIDApLAogICAgICB1c2VyQ2FsbDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxNywgMCksCiAgICAgIGFuY2hvckNhbGw6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMTgsIDApLAogICAgICB1c2VyQW5zd2VyOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDE5LCAwKSwKICAgICAgYW5jaG9yQW5zd2VyOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDIwLCAwKSwKICAgICAgZGVwb3NpdDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAyMSwgMCksCiAgICAgIGV4cGVuc2U6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjIsIDApLAogICAgICBpbmNvbWU6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjMsIDApLAogICAgICBnb29nbGVQYXk6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjQsIDApLAogICAgICBhcHBsZVBheToganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAyNSwgMCksCiAgICAgIG90aGVyUGF5OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDI2LCAwKSwKICAgICAgdXBkYXRlZEF0OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDMwLCAwKSwKICAgICAgY3JlYXRlZEF0OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDMxLCAwKQogICAgfTsKCiAgICBpZiAoaW5jbHVkZUluc3RhbmNlKSB7CiAgICAgIG9iai4kanNwYk1lc3NhZ2VJbnN0YW5jZSA9IG1zZzsKICAgIH0KCiAgICByZXR1cm4gb2JqOwogIH07Cn0KLyoqCiAqIERlc2VyaWFsaXplcyBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZSBmb3JtYXQpLgogKiBAcGFyYW0ge2pzcGIuQnl0ZVNvdXJjZX0gYnl0ZXMgVGhlIGJ5dGVzIHRvIGRlc2VyaWFsaXplLgogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYVN0YXR9CiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LmRlc2VyaWFsaXplQmluYXJ5ID0gZnVuY3Rpb24gKGJ5dGVzKSB7CiAgdmFyIHJlYWRlciA9IG5ldyBqc3BiLkJpbmFyeVJlYWRlcihieXRlcyk7CiAgdmFyIG1zZyA9IG5ldyBwcm90by5wYi5BcmVhU3RhdCgpOwogIHJldHVybiBwcm90by5wYi5BcmVhU3RhdC5kZXNlcmlhbGl6ZUJpbmFyeUZyb21SZWFkZXIobXNnLCByZWFkZXIpOwp9OwovKioKICogRGVzZXJpYWxpemVzIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkgZnJvbSB0aGUKICogZ2l2ZW4gcmVhZGVyIGludG8gdGhlIGdpdmVuIG1lc3NhZ2Ugb2JqZWN0LgogKiBAcGFyYW0geyFwcm90by5wYi5BcmVhU3RhdH0gbXNnIFRoZSBtZXNzYWdlIG9iamVjdCB0byBkZXNlcmlhbGl6ZSBpbnRvLgogKiBAcGFyYW0geyFqc3BiLkJpbmFyeVJlYWRlcn0gcmVhZGVyIFRoZSBCaW5hcnlSZWFkZXIgdG8gdXNlLgogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYVN0YXR9CiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LmRlc2VyaWFsaXplQmluYXJ5RnJvbVJlYWRlciA9IGZ1bmN0aW9uIChtc2csIHJlYWRlcikgewogIHdoaWxlIChyZWFkZXIubmV4dEZpZWxkKCkpIHsKICAgIGlmIChyZWFkZXIuaXNFbmRHcm91cCgpKSB7CiAgICAgIGJyZWFrOwogICAgfQoKICAgIHZhciBmaWVsZCA9IHJlYWRlci5nZXRGaWVsZE51bWJlcigpOwoKICAgIHN3aXRjaCAoZmllbGQpIHsKICAgICAgY2FzZSAxOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDY0KCk7CiAgICAgICAgbXNnLnNldElkKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRBcmVhSWQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAzOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldFN0YXJ0QXQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA0OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkRW51bSgpOwogICAgICAgIG1zZy5zZXRJbnRlcnZhbCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDU6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0U3RhdEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRBY3RpdmVVc2VyKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNzoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRPbmxpbmVVc2VyKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgODoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXROZXdVc2VyKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgOToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRQYXlVc2VyKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTA6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0QWN0aXZlQW5jaG9yKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0SWRsZUFuY2hvcih2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDEyOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldEJ1c3lBbmNob3IodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAxMzoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRBaUNhbGxpbmcodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAxNDoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRVc2VyQ2FsbGluZyh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDE1OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldEFuY2hvckNhbGxpbmcodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAxNjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRBaUNhbGwodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAxNzoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRVc2VyQ2FsbCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDE4OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldEFuY2hvckNhbGwodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAxOToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRVc2VyQW5zd2VyKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjA6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0QW5jaG9yQW5zd2VyKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50NjQoKTsKICAgICAgICBtc2cuc2V0RGVwb3NpdCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDIyOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDY0KCk7CiAgICAgICAgbXNnLnNldEV4cGVuc2UodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAyMzoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRJbmNvbWUodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAyNDoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRHb29nbGVQYXkodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAyNToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRBcHBsZVBheSh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDI2OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldE90aGVyUGF5KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMzA6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0VXBkYXRlZEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMzE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0Q3JlYXRlZEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmVhZGVyLnNraXBGaWVsZCgpOwogICAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgcmV0dXJuIG1zZzsKfTsKLyoqCiAqIFNlcmlhbGl6ZXMgdGhlIG1lc3NhZ2UgdG8gYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUgZm9ybWF0KS4KICogQHJldHVybiB7IVVpbnQ4QXJyYXl9CiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5zZXJpYWxpemVCaW5hcnkgPSBmdW5jdGlvbiAoKSB7CiAgdmFyIHdyaXRlciA9IG5ldyBqc3BiLkJpbmFyeVdyaXRlcigpOwogIHByb3RvLnBiLkFyZWFTdGF0LnNlcmlhbGl6ZUJpbmFyeVRvV3JpdGVyKHRoaXMsIHdyaXRlcik7CiAgcmV0dXJuIHdyaXRlci5nZXRSZXN1bHRCdWZmZXIoKTsKfTsKLyoqCiAqIFNlcmlhbGl6ZXMgdGhlIGdpdmVuIG1lc3NhZ2UgdG8gYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUKICogZm9ybWF0KSwgd3JpdGluZyB0byB0aGUgZ2l2ZW4gQmluYXJ5V3JpdGVyLgogKiBAcGFyYW0geyFwcm90by5wYi5BcmVhU3RhdH0gbWVzc2FnZQogKiBAcGFyYW0geyFqc3BiLkJpbmFyeVdyaXRlcn0gd3JpdGVyCiAqIEBzdXBwcmVzcyB7dW51c2VkTG9jYWxWYXJpYWJsZXN9IGYgaXMgb25seSB1c2VkIGZvciBuZXN0ZWQgbWVzc2FnZXMKICovCgoKcHJvdG8ucGIuQXJlYVN0YXQuc2VyaWFsaXplQmluYXJ5VG9Xcml0ZXIgPSBmdW5jdGlvbiAobWVzc2FnZSwgd3JpdGVyKSB7CiAgdmFyIGYgPSB1bmRlZmluZWQ7CiAgZiA9IG1lc3NhZ2UuZ2V0SWQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQ2NCgxLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEFyZWFJZCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDIsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0U3RhcnRBdCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDMsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0SW50ZXJ2YWwoKTsKCiAgaWYgKGYgIT09IDAuMCkgewogICAgd3JpdGVyLndyaXRlRW51bSg0LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldFN0YXRBdCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDUsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0QWN0aXZlVXNlcigpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDYsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0T25saW5lVXNlcigpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDcsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0TmV3VXNlcigpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDgsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0UGF5VXNlcigpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDksIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0QWN0aXZlQW5jaG9yKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMTAsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0SWRsZUFuY2hvcigpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDExLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEJ1c3lBbmNob3IoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigxMiwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRBaUNhbGxpbmcoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigxMywgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRVc2VyQ2FsbGluZygpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDE0LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEFuY2hvckNhbGxpbmcoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigxNSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRBaUNhbGwoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigxNiwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRVc2VyQ2FsbCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDE3LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEFuY2hvckNhbGwoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigxOCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRVc2VyQW5zd2VyKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMTksIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0QW5jaG9yQW5zd2VyKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMjAsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0RGVwb3NpdCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDY0KDIxLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEV4cGVuc2UoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQ2NCgyMiwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRJbmNvbWUoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigyMywgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRHb29nbGVQYXkoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigyNCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRBcHBsZVBheSgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDI1LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldE90aGVyUGF5KCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMjYsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0VXBkYXRlZEF0KCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMzAsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0Q3JlYXRlZEF0KCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMzEsIGYpOwogIH0KfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQ2NCBpZCA9IDE7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQXJlYVN0YXQucHJvdG90eXBlLmdldElkID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYVN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BcmVhU3RhdC5wcm90b3R5cGUuc2V0SWQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDEsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBhcmVhX2lkID0gMjsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BcmVhU3RhdC5wcm90b3R5cGUuZ2V0QXJlYUlkID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAyLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYVN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BcmVhU3RhdC5wcm90b3R5cGUuc2V0QXJlYUlkID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAyLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgc3RhcnRfYXQgPSAzOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5nZXRTdGFydEF0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAzLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYVN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BcmVhU3RhdC5wcm90b3R5cGUuc2V0U3RhcnRBdCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMywgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgU3RhdEludGVydmFsIGludGVydmFsID0gNDsKICogQHJldHVybiB7IXByb3RvLnBiLlN0YXRJbnRlcnZhbH0KICovCgoKcHJvdG8ucGIuQXJlYVN0YXQucHJvdG90eXBlLmdldEludGVydmFsID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA0LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7IXByb3RvLnBiLlN0YXRJbnRlcnZhbH0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFyZWFTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXJlYVN0YXQucHJvdG90eXBlLnNldEludGVydmFsID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNFbnVtRmllbGQodGhpcywgNCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIHN0YXRfYXQgPSA1OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5nZXRTdGF0QXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDUsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5zZXRTdGF0QXQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDUsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBhY3RpdmVfdXNlciA9IDY7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQXJlYVN0YXQucHJvdG90eXBlLmdldEFjdGl2ZVVzZXIgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDYsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5zZXRBY3RpdmVVc2VyID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCA2LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgb25saW5lX3VzZXIgPSA3OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5nZXRPbmxpbmVVc2VyID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA3LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYVN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BcmVhU3RhdC5wcm90b3R5cGUuc2V0T25saW5lVXNlciA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgNywgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIG5ld191c2VyID0gODsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BcmVhU3RhdC5wcm90b3R5cGUuZ2V0TmV3VXNlciA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgOCwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFyZWFTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXJlYVN0YXQucHJvdG90eXBlLnNldE5ld1VzZXIgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDgsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBwYXlfdXNlciA9IDk7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQXJlYVN0YXQucHJvdG90eXBlLmdldFBheVVzZXIgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDksIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5zZXRQYXlVc2VyID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCA5LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgYWN0aXZlX2FuY2hvciA9IDEwOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5nZXRBY3RpdmVBbmNob3IgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDEwLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYVN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BcmVhU3RhdC5wcm90b3R5cGUuc2V0QWN0aXZlQW5jaG9yID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAxMCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGlkbGVfYW5jaG9yID0gMTE7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQXJlYVN0YXQucHJvdG90eXBlLmdldElkbGVBbmNob3IgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDExLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYVN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BcmVhU3RhdC5wcm90b3R5cGUuc2V0SWRsZUFuY2hvciA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMTEsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBidXN5X2FuY2hvciA9IDEyOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5nZXRCdXN5QW5jaG9yID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxMiwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFyZWFTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXJlYVN0YXQucHJvdG90eXBlLnNldEJ1c3lBbmNob3IgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDEyLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgYWlfY2FsbGluZyA9IDEzOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5nZXRBaUNhbGxpbmcgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDEzLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYVN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BcmVhU3RhdC5wcm90b3R5cGUuc2V0QWlDYWxsaW5nID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAxMywgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIHVzZXJfY2FsbGluZyA9IDE0OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5nZXRVc2VyQ2FsbGluZyA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMTQsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5zZXRVc2VyQ2FsbGluZyA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMTQsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBhbmNob3JfY2FsbGluZyA9IDE1OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5nZXRBbmNob3JDYWxsaW5nID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxNSwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFyZWFTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXJlYVN0YXQucHJvdG90eXBlLnNldEFuY2hvckNhbGxpbmcgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDE1LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgYWlfY2FsbCA9IDE2OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5nZXRBaUNhbGwgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDE2LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYVN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BcmVhU3RhdC5wcm90b3R5cGUuc2V0QWlDYWxsID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAxNiwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIHVzZXJfY2FsbCA9IDE3OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5nZXRVc2VyQ2FsbCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMTcsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5zZXRVc2VyQ2FsbCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMTcsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBhbmNob3JfY2FsbCA9IDE4OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5nZXRBbmNob3JDYWxsID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxOCwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFyZWFTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXJlYVN0YXQucHJvdG90eXBlLnNldEFuY2hvckNhbGwgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDE4LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgdXNlcl9hbnN3ZXIgPSAxOTsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BcmVhU3RhdC5wcm90b3R5cGUuZ2V0VXNlckFuc3dlciA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMTksIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5zZXRVc2VyQW5zd2VyID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAxOSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGFuY2hvcl9hbnN3ZXIgPSAyMDsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BcmVhU3RhdC5wcm90b3R5cGUuZ2V0QW5jaG9yQW5zd2VyID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAyMCwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFyZWFTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXJlYVN0YXQucHJvdG90eXBlLnNldEFuY2hvckFuc3dlciA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMjAsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQ2NCBkZXBvc2l0ID0gMjE7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQXJlYVN0YXQucHJvdG90eXBlLmdldERlcG9zaXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDIxLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYVN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BcmVhU3RhdC5wcm90b3R5cGUuc2V0RGVwb3NpdCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMjEsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQ2NCBleHBlbnNlID0gMjI7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQXJlYVN0YXQucHJvdG90eXBlLmdldEV4cGVuc2UgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDIyLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYVN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BcmVhU3RhdC5wcm90b3R5cGUuc2V0RXhwZW5zZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMjIsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBpbmNvbWUgPSAyMzsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BcmVhU3RhdC5wcm90b3R5cGUuZ2V0SW5jb21lID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAyMywgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFyZWFTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXJlYVN0YXQucHJvdG90eXBlLnNldEluY29tZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMjMsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBnb29nbGVfcGF5ID0gMjQ7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQXJlYVN0YXQucHJvdG90eXBlLmdldEdvb2dsZVBheSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMjQsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5zZXRHb29nbGVQYXkgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDI0LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgYXBwbGVfcGF5ID0gMjU7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQXJlYVN0YXQucHJvdG90eXBlLmdldEFwcGxlUGF5ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAyNSwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFyZWFTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQXJlYVN0YXQucHJvdG90eXBlLnNldEFwcGxlUGF5ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAyNSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIG90aGVyX3BheSA9IDI2OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5nZXRPdGhlclBheSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMjYsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5zZXRPdGhlclBheSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMjYsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiB1cGRhdGVkX2F0ID0gMzA7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQXJlYVN0YXQucHJvdG90eXBlLmdldFVwZGF0ZWRBdCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMzAsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BcmVhU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5zZXRVcGRhdGVkQXQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDMwLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgY3JlYXRlZF9hdCA9IDMxOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFyZWFTdGF0LnByb3RvdHlwZS5nZXRDcmVhdGVkQXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDMxLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQXJlYVN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BcmVhU3RhdC5wcm90b3R5cGUuc2V0Q3JlYXRlZEF0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAzMSwgdmFsdWUpOwp9OwoKaWYgKGpzcGIuTWVzc2FnZS5HRU5FUkFURV9UT19PQkpFQ1QpIHsKICAvKioKICAgKiBDcmVhdGVzIGFuIG9iamVjdCByZXByZXNlbnRhdGlvbiBvZiB0aGlzIHByb3RvLgogICAqIEZpZWxkIG5hbWVzIHRoYXQgYXJlIHJlc2VydmVkIGluIEphdmFTY3JpcHQgYW5kIHdpbGwgYmUgcmVuYW1lZCB0byBwYl9uYW1lLgogICAqIE9wdGlvbmFsIGZpZWxkcyB0aGF0IGFyZSBub3Qgc2V0IHdpbGwgYmUgc2V0IHRvIHVuZGVmaW5lZC4KICAgKiBUbyBhY2Nlc3MgYSByZXNlcnZlZCBmaWVsZCB1c2UsIGZvby5wYl88bmFtZT4sIGVnLCBmb28ucGJfZGVmYXVsdC4KICAgKiBGb3IgdGhlIGxpc3Qgb2YgcmVzZXJ2ZWQgbmFtZXMgcGxlYXNlIHNlZToKICAgKiAgICAgbmV0L3Byb3RvMi9jb21waWxlci9qcy9pbnRlcm5hbC9nZW5lcmF0b3IuY2Mja0tleXdvcmQuCiAgICogQHBhcmFtIHtib29sZWFuPX0gb3B0X2luY2x1ZGVJbnN0YW5jZSBEZXByZWNhdGVkLiB3aGV0aGVyIHRvIGluY2x1ZGUgdGhlCiAgICogICAgIEpTUEIgaW5zdGFuY2UgZm9yIHRyYW5zaXRpb25hbCBzb3kgcHJvdG8gc3VwcG9ydDoKICAgKiAgICAgaHR0cDovL2dvdG8vc295LXBhcmFtLW1pZ3JhdGlvbgogICAqIEByZXR1cm4geyFPYmplY3R9CiAgICovCiAgcHJvdG8ucGIuQW5jaG9yU3RhdC5wcm90b3R5cGUudG9PYmplY3QgPSBmdW5jdGlvbiAob3B0X2luY2x1ZGVJbnN0YW5jZSkgewogICAgcmV0dXJuIHByb3RvLnBiLkFuY2hvclN0YXQudG9PYmplY3Qob3B0X2luY2x1ZGVJbnN0YW5jZSwgdGhpcyk7CiAgfTsKICAvKioKICAgKiBTdGF0aWMgdmVyc2lvbiBvZiB0aGUge0BzZWUgdG9PYmplY3R9IG1ldGhvZC4KICAgKiBAcGFyYW0ge2Jvb2xlYW58dW5kZWZpbmVkfSBpbmNsdWRlSW5zdGFuY2UgRGVwcmVjYXRlZC4gV2hldGhlciB0byBpbmNsdWRlCiAgICogICAgIHRoZSBKU1BCIGluc3RhbmNlIGZvciB0cmFuc2l0aW9uYWwgc295IHByb3RvIHN1cHBvcnQ6CiAgICogICAgIGh0dHA6Ly9nb3RvL3NveS1wYXJhbS1taWdyYXRpb24KICAgKiBAcGFyYW0geyFwcm90by5wYi5BbmNob3JTdGF0fSBtc2cgVGhlIG1zZyBpbnN0YW5jZSB0byB0cmFuc2Zvcm0uCiAgICogQHJldHVybiB7IU9iamVjdH0KICAgKiBAc3VwcHJlc3Mge3VudXNlZExvY2FsVmFyaWFibGVzfSBmIGlzIG9ubHkgdXNlZCBmb3IgbmVzdGVkIG1lc3NhZ2VzCiAgICovCgoKICBwcm90by5wYi5BbmNob3JTdGF0LnRvT2JqZWN0ID0gZnVuY3Rpb24gKGluY2x1ZGVJbnN0YW5jZSwgbXNnKSB7CiAgICB2YXIgZiwKICAgICAgICBvYmogPSB7CiAgICAgIGlkOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDEsIDApLAogICAgICBhcmVhSWQ6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMiwgMCksCiAgICAgIGFuY2hvcklkOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDMsIDApLAogICAgICBzdGFydEF0OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDQsIDApLAogICAgICBpbnRlcnZhbDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA1LCAwKSwKICAgICAgc3RhdEF0OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDYsIDApLAogICAgICBvbmxpbmVEdXJhdGlvbjoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA3LCAwKSwKICAgICAgaW5DYWxsOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDgsIDApLAogICAgICBvdXRDYWxsOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDksIDApLAogICAgICBhbnN3ZXI6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMTAsIDApLAogICAgICBhbnN3ZXIzMDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxMSwgMCksCiAgICAgIGFuc3dlcjUwOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDEyLCAwKSwKICAgICAgZHVyYXRpb246IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMTMsIDApLAogICAgICBjYWxsSW5jb21lOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDE0LCAwKSwKICAgICAgZ2lmdEluY29tZToganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxNSwgMCksCiAgICAgIGNvbW1pc3Npb25JbmNvbWU6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMTYsIDApLAogICAgICBhZGp1c3RJbmNvbWU6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMTcsIDApLAogICAgICBleHBlbnNlOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDE4LCAwKSwKICAgICAgaW5jb21lOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDE5LCAwKSwKICAgICAgdXBkYXRlZEF0OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDMwLCAwKSwKICAgICAgY3JlYXRlZEF0OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDMxLCAwKQogICAgfTsKCiAgICBpZiAoaW5jbHVkZUluc3RhbmNlKSB7CiAgICAgIG9iai4kanNwYk1lc3NhZ2VJbnN0YW5jZSA9IG1zZzsKICAgIH0KCiAgICByZXR1cm4gb2JqOwogIH07Cn0KLyoqCiAqIERlc2VyaWFsaXplcyBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZSBmb3JtYXQpLgogKiBAcGFyYW0ge2pzcGIuQnl0ZVNvdXJjZX0gYnl0ZXMgVGhlIGJ5dGVzIHRvIGRlc2VyaWFsaXplLgogKiBAcmV0dXJuIHshcHJvdG8ucGIuQW5jaG9yU3RhdH0KICovCgoKcHJvdG8ucGIuQW5jaG9yU3RhdC5kZXNlcmlhbGl6ZUJpbmFyeSA9IGZ1bmN0aW9uIChieXRlcykgewogIHZhciByZWFkZXIgPSBuZXcganNwYi5CaW5hcnlSZWFkZXIoYnl0ZXMpOwogIHZhciBtc2cgPSBuZXcgcHJvdG8ucGIuQW5jaG9yU3RhdCgpOwogIHJldHVybiBwcm90by5wYi5BbmNob3JTdGF0LmRlc2VyaWFsaXplQmluYXJ5RnJvbVJlYWRlcihtc2csIHJlYWRlcik7Cn07Ci8qKgogKiBEZXNlcmlhbGl6ZXMgYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUgZm9ybWF0KSBmcm9tIHRoZQogKiBnaXZlbiByZWFkZXIgaW50byB0aGUgZ2l2ZW4gbWVzc2FnZSBvYmplY3QuCiAqIEBwYXJhbSB7IXByb3RvLnBiLkFuY2hvclN0YXR9IG1zZyBUaGUgbWVzc2FnZSBvYmplY3QgdG8gZGVzZXJpYWxpemUgaW50by4KICogQHBhcmFtIHshanNwYi5CaW5hcnlSZWFkZXJ9IHJlYWRlciBUaGUgQmluYXJ5UmVhZGVyIHRvIHVzZS4KICogQHJldHVybiB7IXByb3RvLnBiLkFuY2hvclN0YXR9CiAqLwoKCnByb3RvLnBiLkFuY2hvclN0YXQuZGVzZXJpYWxpemVCaW5hcnlGcm9tUmVhZGVyID0gZnVuY3Rpb24gKG1zZywgcmVhZGVyKSB7CiAgd2hpbGUgKHJlYWRlci5uZXh0RmllbGQoKSkgewogICAgaWYgKHJlYWRlci5pc0VuZEdyb3VwKCkpIHsKICAgICAgYnJlYWs7CiAgICB9CgogICAgdmFyIGZpZWxkID0gcmVhZGVyLmdldEZpZWxkTnVtYmVyKCk7CgogICAgc3dpdGNoIChmaWVsZCkgewogICAgICBjYXNlIDE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50NjQoKTsKICAgICAgICBtc2cuc2V0SWQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAyOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldEFyZWFJZCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDM6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0QW5jaG9ySWQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA0OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldFN0YXJ0QXQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA1OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkRW51bSgpOwogICAgICAgIG1zZy5zZXRJbnRlcnZhbCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDY6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0U3RhdEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNzoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRPbmxpbmVEdXJhdGlvbih2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDg6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0SW5DYWxsKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgOToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRPdXRDYWxsKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTA6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0QW5zd2VyKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0QW5zd2VyMzAodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAxMjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRBbnN3ZXI1MCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDEzOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldER1cmF0aW9uKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTQ6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0Q2FsbEluY29tZSh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDE1OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldEdpZnRJbmNvbWUodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAxNjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRDb21taXNzaW9uSW5jb21lKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTc6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRJbnQzMigpOwogICAgICAgIG1zZy5zZXRBZGp1c3RJbmNvbWUodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAxODoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRFeHBlbnNlKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTk6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0SW5jb21lKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMzA6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0VXBkYXRlZEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMzE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0Q3JlYXRlZEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmVhZGVyLnNraXBGaWVsZCgpOwogICAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgcmV0dXJuIG1zZzsKfTsKLyoqCiAqIFNlcmlhbGl6ZXMgdGhlIG1lc3NhZ2UgdG8gYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUgZm9ybWF0KS4KICogQHJldHVybiB7IVVpbnQ4QXJyYXl9CiAqLwoKCnByb3RvLnBiLkFuY2hvclN0YXQucHJvdG90eXBlLnNlcmlhbGl6ZUJpbmFyeSA9IGZ1bmN0aW9uICgpIHsKICB2YXIgd3JpdGVyID0gbmV3IGpzcGIuQmluYXJ5V3JpdGVyKCk7CiAgcHJvdG8ucGIuQW5jaG9yU3RhdC5zZXJpYWxpemVCaW5hcnlUb1dyaXRlcih0aGlzLCB3cml0ZXIpOwogIHJldHVybiB3cml0ZXIuZ2V0UmVzdWx0QnVmZmVyKCk7Cn07Ci8qKgogKiBTZXJpYWxpemVzIHRoZSBnaXZlbiBtZXNzYWdlIHRvIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlCiAqIGZvcm1hdCksIHdyaXRpbmcgdG8gdGhlIGdpdmVuIEJpbmFyeVdyaXRlci4KICogQHBhcmFtIHshcHJvdG8ucGIuQW5jaG9yU3RhdH0gbWVzc2FnZQogKiBAcGFyYW0geyFqc3BiLkJpbmFyeVdyaXRlcn0gd3JpdGVyCiAqIEBzdXBwcmVzcyB7dW51c2VkTG9jYWxWYXJpYWJsZXN9IGYgaXMgb25seSB1c2VkIGZvciBuZXN0ZWQgbWVzc2FnZXMKICovCgoKcHJvdG8ucGIuQW5jaG9yU3RhdC5zZXJpYWxpemVCaW5hcnlUb1dyaXRlciA9IGZ1bmN0aW9uIChtZXNzYWdlLCB3cml0ZXIpIHsKICB2YXIgZiA9IHVuZGVmaW5lZDsKICBmID0gbWVzc2FnZS5nZXRJZCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDY0KDEsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0QXJlYUlkKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMiwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRBbmNob3JJZCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDMsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0U3RhcnRBdCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDQsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0SW50ZXJ2YWwoKTsKCiAgaWYgKGYgIT09IDAuMCkgewogICAgd3JpdGVyLndyaXRlRW51bSg1LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldFN0YXRBdCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDYsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0T25saW5lRHVyYXRpb24oKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMig3LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEluQ2FsbCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDgsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0T3V0Q2FsbCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDksIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0QW5zd2VyKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMTAsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0QW5zd2VyMzAoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigxMSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRBbnN3ZXI1MCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDEyLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldER1cmF0aW9uKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMTMsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0Q2FsbEluY29tZSgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDE0LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEdpZnRJbmNvbWUoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigxNSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRDb21taXNzaW9uSW5jb21lKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMTYsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0QWRqdXN0SW5jb21lKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVJbnQzMigxNywgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRFeHBlbnNlKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMTgsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0SW5jb21lKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMTksIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0VXBkYXRlZEF0KCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMzAsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0Q3JlYXRlZEF0KCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMzEsIGYpOwogIH0KfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQ2NCBpZCA9IDE7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQW5jaG9yU3RhdC5wcm90b3R5cGUuZ2V0SWQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDEsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BbmNob3JTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQW5jaG9yU3RhdC5wcm90b3R5cGUuc2V0SWQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDEsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBhcmVhX2lkID0gMjsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BbmNob3JTdGF0LnByb3RvdHlwZS5nZXRBcmVhSWQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDIsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BbmNob3JTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQW5jaG9yU3RhdC5wcm90b3R5cGUuc2V0QXJlYUlkID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAyLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgYW5jaG9yX2lkID0gMzsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BbmNob3JTdGF0LnByb3RvdHlwZS5nZXRBbmNob3JJZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMywgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFuY2hvclN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BbmNob3JTdGF0LnByb3RvdHlwZS5zZXRBbmNob3JJZCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMywgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIHN0YXJ0X2F0ID0gNDsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BbmNob3JTdGF0LnByb3RvdHlwZS5nZXRTdGFydEF0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA0LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQW5jaG9yU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFuY2hvclN0YXQucHJvdG90eXBlLnNldFN0YXJ0QXQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDQsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIFN0YXRJbnRlcnZhbCBpbnRlcnZhbCA9IDU7CiAqIEByZXR1cm4geyFwcm90by5wYi5TdGF0SW50ZXJ2YWx9CiAqLwoKCnByb3RvLnBiLkFuY2hvclN0YXQucHJvdG90eXBlLmdldEludGVydmFsID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA1LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7IXByb3RvLnBiLlN0YXRJbnRlcnZhbH0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFuY2hvclN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BbmNob3JTdGF0LnByb3RvdHlwZS5zZXRJbnRlcnZhbCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zRW51bUZpZWxkKHRoaXMsIDUsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBzdGF0X2F0ID0gNjsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BbmNob3JTdGF0LnByb3RvdHlwZS5nZXRTdGF0QXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDYsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BbmNob3JTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQW5jaG9yU3RhdC5wcm90b3R5cGUuc2V0U3RhdEF0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCA2LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgb25saW5lX2R1cmF0aW9uID0gNzsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BbmNob3JTdGF0LnByb3RvdHlwZS5nZXRPbmxpbmVEdXJhdGlvbiA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgNywgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFuY2hvclN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BbmNob3JTdGF0LnByb3RvdHlwZS5zZXRPbmxpbmVEdXJhdGlvbiA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgNywgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGluX2NhbGwgPSA4OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFuY2hvclN0YXQucHJvdG90eXBlLmdldEluQ2FsbCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgOCwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFuY2hvclN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BbmNob3JTdGF0LnByb3RvdHlwZS5zZXRJbkNhbGwgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDgsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBvdXRfY2FsbCA9IDk7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQW5jaG9yU3RhdC5wcm90b3R5cGUuZ2V0T3V0Q2FsbCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgOSwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFuY2hvclN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BbmNob3JTdGF0LnByb3RvdHlwZS5zZXRPdXRDYWxsID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCA5LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgYW5zd2VyID0gMTA7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQW5jaG9yU3RhdC5wcm90b3R5cGUuZ2V0QW5zd2VyID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxMCwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFuY2hvclN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BbmNob3JTdGF0LnByb3RvdHlwZS5zZXRBbnN3ZXIgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDEwLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgYW5zd2VyXzMwID0gMTE7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQW5jaG9yU3RhdC5wcm90b3R5cGUuZ2V0QW5zd2VyMzAgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDExLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQW5jaG9yU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFuY2hvclN0YXQucHJvdG90eXBlLnNldEFuc3dlcjMwID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAxMSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGFuc3dlcl81MCA9IDEyOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFuY2hvclN0YXQucHJvdG90eXBlLmdldEFuc3dlcjUwID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxMiwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFuY2hvclN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BbmNob3JTdGF0LnByb3RvdHlwZS5zZXRBbnN3ZXI1MCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMTIsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBkdXJhdGlvbiA9IDEzOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFuY2hvclN0YXQucHJvdG90eXBlLmdldER1cmF0aW9uID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxMywgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFuY2hvclN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BbmNob3JTdGF0LnByb3RvdHlwZS5zZXREdXJhdGlvbiA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMTMsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBjYWxsX2luY29tZSA9IDE0OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFuY2hvclN0YXQucHJvdG90eXBlLmdldENhbGxJbmNvbWUgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDE0LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQW5jaG9yU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFuY2hvclN0YXQucHJvdG90eXBlLnNldENhbGxJbmNvbWUgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDE0LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgZ2lmdF9pbmNvbWUgPSAxNTsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BbmNob3JTdGF0LnByb3RvdHlwZS5nZXRHaWZ0SW5jb21lID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxNSwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFuY2hvclN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BbmNob3JTdGF0LnByb3RvdHlwZS5zZXRHaWZ0SW5jb21lID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAxNSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGNvbW1pc3Npb25faW5jb21lID0gMTY7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQW5jaG9yU3RhdC5wcm90b3R5cGUuZ2V0Q29tbWlzc2lvbkluY29tZSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMTYsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BbmNob3JTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQW5jaG9yU3RhdC5wcm90b3R5cGUuc2V0Q29tbWlzc2lvbkluY29tZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMTYsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIGludDMyIGFkanVzdF9pbmNvbWUgPSAxNzsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BbmNob3JTdGF0LnByb3RvdHlwZS5nZXRBZGp1c3RJbmNvbWUgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDE3LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQW5jaG9yU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFuY2hvclN0YXQucHJvdG90eXBlLnNldEFkanVzdEluY29tZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMTcsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBleHBlbnNlID0gMTg7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQW5jaG9yU3RhdC5wcm90b3R5cGUuZ2V0RXhwZW5zZSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMTgsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BbmNob3JTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQW5jaG9yU3RhdC5wcm90b3R5cGUuc2V0RXhwZW5zZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMTgsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBpbmNvbWUgPSAxOTsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5BbmNob3JTdGF0LnByb3RvdHlwZS5nZXRJbmNvbWUgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDE5LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuQW5jaG9yU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLkFuY2hvclN0YXQucHJvdG90eXBlLnNldEluY29tZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMTksIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiB1cGRhdGVkX2F0ID0gMzA7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuQW5jaG9yU3RhdC5wcm90b3R5cGUuZ2V0VXBkYXRlZEF0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAzMCwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLkFuY2hvclN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5BbmNob3JTdGF0LnByb3RvdHlwZS5zZXRVcGRhdGVkQXQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDMwLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgY3JlYXRlZF9hdCA9IDMxOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLkFuY2hvclN0YXQucHJvdG90eXBlLmdldENyZWF0ZWRBdCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMzEsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5BbmNob3JTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuQW5jaG9yU3RhdC5wcm90b3R5cGUuc2V0Q3JlYXRlZEF0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAzMSwgdmFsdWUpOwp9OwoKaWYgKGpzcGIuTWVzc2FnZS5HRU5FUkFURV9UT19PQkpFQ1QpIHsKICAvKioKICAgKiBDcmVhdGVzIGFuIG9iamVjdCByZXByZXNlbnRhdGlvbiBvZiB0aGlzIHByb3RvLgogICAqIEZpZWxkIG5hbWVzIHRoYXQgYXJlIHJlc2VydmVkIGluIEphdmFTY3JpcHQgYW5kIHdpbGwgYmUgcmVuYW1lZCB0byBwYl9uYW1lLgogICAqIE9wdGlvbmFsIGZpZWxkcyB0aGF0IGFyZSBub3Qgc2V0IHdpbGwgYmUgc2V0IHRvIHVuZGVmaW5lZC4KICAgKiBUbyBhY2Nlc3MgYSByZXNlcnZlZCBmaWVsZCB1c2UsIGZvby5wYl88bmFtZT4sIGVnLCBmb28ucGJfZGVmYXVsdC4KICAgKiBGb3IgdGhlIGxpc3Qgb2YgcmVzZXJ2ZWQgbmFtZXMgcGxlYXNlIHNlZToKICAgKiAgICAgbmV0L3Byb3RvMi9jb21waWxlci9qcy9pbnRlcm5hbC9nZW5lcmF0b3IuY2Mja0tleXdvcmQuCiAgICogQHBhcmFtIHtib29sZWFuPX0gb3B0X2luY2x1ZGVJbnN0YW5jZSBEZXByZWNhdGVkLiB3aGV0aGVyIHRvIGluY2x1ZGUgdGhlCiAgICogICAgIEpTUEIgaW5zdGFuY2UgZm9yIHRyYW5zaXRpb25hbCBzb3kgcHJvdG8gc3VwcG9ydDoKICAgKiAgICAgaHR0cDovL2dvdG8vc295LXBhcmFtLW1pZ3JhdGlvbgogICAqIEByZXR1cm4geyFPYmplY3R9CiAgICovCiAgcHJvdG8ucGIuVXNlclN0YXQucHJvdG90eXBlLnRvT2JqZWN0ID0gZnVuY3Rpb24gKG9wdF9pbmNsdWRlSW5zdGFuY2UpIHsKICAgIHJldHVybiBwcm90by5wYi5Vc2VyU3RhdC50b09iamVjdChvcHRfaW5jbHVkZUluc3RhbmNlLCB0aGlzKTsKICB9OwogIC8qKgogICAqIFN0YXRpYyB2ZXJzaW9uIG9mIHRoZSB7QHNlZSB0b09iamVjdH0gbWV0aG9kLgogICAqIEBwYXJhbSB7Ym9vbGVhbnx1bmRlZmluZWR9IGluY2x1ZGVJbnN0YW5jZSBEZXByZWNhdGVkLiBXaGV0aGVyIHRvIGluY2x1ZGUKICAgKiAgICAgdGhlIEpTUEIgaW5zdGFuY2UgZm9yIHRyYW5zaXRpb25hbCBzb3kgcHJvdG8gc3VwcG9ydDoKICAgKiAgICAgaHR0cDovL2dvdG8vc295LXBhcmFtLW1pZ3JhdGlvbgogICAqIEBwYXJhbSB7IXByb3RvLnBiLlVzZXJTdGF0fSBtc2cgVGhlIG1zZyBpbnN0YW5jZSB0byB0cmFuc2Zvcm0uCiAgICogQHJldHVybiB7IU9iamVjdH0KICAgKiBAc3VwcHJlc3Mge3VudXNlZExvY2FsVmFyaWFibGVzfSBmIGlzIG9ubHkgdXNlZCBmb3IgbmVzdGVkIG1lc3NhZ2VzCiAgICovCgoKICBwcm90by5wYi5Vc2VyU3RhdC50b09iamVjdCA9IGZ1bmN0aW9uIChpbmNsdWRlSW5zdGFuY2UsIG1zZykgewogICAgdmFyIGYsCiAgICAgICAgb2JqID0gewogICAgICBpZDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxLCAwKSwKICAgICAgYXJlYUlkOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDIsIDApLAogICAgICBhcHBJZDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAzLCAwKSwKICAgICAgc3RhcnRBdDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA0LCAwKSwKICAgICAgaW50ZXJ2YWw6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgNSwgMCksCiAgICAgIHN0YXRBdDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCA2LCAwKSwKICAgICAgaW5jb21lOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDcsIDApLAogICAgICBhY3RpdmVVc2VyOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDgsIDApLAogICAgICBuZXdVc2VyOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDksIDApLAogICAgICBwYXlVc2VyOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDEwLCAwKSwKICAgICAgdmlwVXNlcjoganNwYi5NZXNzYWdlLmdldEZsb2F0aW5nUG9pbnRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMTEsIDAuMCksCiAgICAgIHJlcGF5VXNlcjoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxMiwgMCksCiAgICAgIG5ld0luY29tZToganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxMywgMCksCiAgICAgIG5ld1BheVVzZXI6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMTQsIDApLAogICAgICBuZXdDYWxsVXNlcjoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxNSwgMCksCiAgICAgIG5ld0NoYXRVc2VyOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDE2LCAwKSwKICAgICAgY2FsbDoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxNywgMCksCiAgICAgIGFuc3dlcjoganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAxOCwgMCksCiAgICAgIGR1cmF0aW9uOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDE5LCAwKSwKICAgICAgYWlDYWxsOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDIwLCAwKSwKICAgICAgYWlBbnN3ZXI6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjEsIDApLAogICAgICBhaUR1cmF0aW9uOiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDIyLCAwKSwKICAgICAgZXhwZW5zZToganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAyMywgMCksCiAgICAgIG5ld0V4cGVuc2U6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjQsIDApLAogICAgICBnb29nbGVQYXk6IGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KG1zZywgMjUsIDApLAogICAgICBhcHBsZVBheToganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQobXNnLCAyNiwgMCksCiAgICAgIG90aGVyUGF5OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDI3LCAwKSwKICAgICAgdXBkYXRlZEF0OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDQwLCAwKSwKICAgICAgY3JlYXRlZEF0OiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdChtc2csIDQxLCAwKQogICAgfTsKCiAgICBpZiAoaW5jbHVkZUluc3RhbmNlKSB7CiAgICAgIG9iai4kanNwYk1lc3NhZ2VJbnN0YW5jZSA9IG1zZzsKICAgIH0KCiAgICByZXR1cm4gb2JqOwogIH07Cn0KLyoqCiAqIERlc2VyaWFsaXplcyBiaW5hcnkgZGF0YSAoaW4gcHJvdG9idWYgd2lyZSBmb3JtYXQpLgogKiBAcGFyYW0ge2pzcGIuQnl0ZVNvdXJjZX0gYnl0ZXMgVGhlIGJ5dGVzIHRvIGRlc2VyaWFsaXplLgogKiBAcmV0dXJuIHshcHJvdG8ucGIuVXNlclN0YXR9CiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LmRlc2VyaWFsaXplQmluYXJ5ID0gZnVuY3Rpb24gKGJ5dGVzKSB7CiAgdmFyIHJlYWRlciA9IG5ldyBqc3BiLkJpbmFyeVJlYWRlcihieXRlcyk7CiAgdmFyIG1zZyA9IG5ldyBwcm90by5wYi5Vc2VyU3RhdCgpOwogIHJldHVybiBwcm90by5wYi5Vc2VyU3RhdC5kZXNlcmlhbGl6ZUJpbmFyeUZyb21SZWFkZXIobXNnLCByZWFkZXIpOwp9OwovKioKICogRGVzZXJpYWxpemVzIGJpbmFyeSBkYXRhIChpbiBwcm90b2J1ZiB3aXJlIGZvcm1hdCkgZnJvbSB0aGUKICogZ2l2ZW4gcmVhZGVyIGludG8gdGhlIGdpdmVuIG1lc3NhZ2Ugb2JqZWN0LgogKiBAcGFyYW0geyFwcm90by5wYi5Vc2VyU3RhdH0gbXNnIFRoZSBtZXNzYWdlIG9iamVjdCB0byBkZXNlcmlhbGl6ZSBpbnRvLgogKiBAcGFyYW0geyFqc3BiLkJpbmFyeVJlYWRlcn0gcmVhZGVyIFRoZSBCaW5hcnlSZWFkZXIgdG8gdXNlLgogKiBAcmV0dXJuIHshcHJvdG8ucGIuVXNlclN0YXR9CiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LmRlc2VyaWFsaXplQmluYXJ5RnJvbVJlYWRlciA9IGZ1bmN0aW9uIChtc2csIHJlYWRlcikgewogIHdoaWxlIChyZWFkZXIubmV4dEZpZWxkKCkpIHsKICAgIGlmIChyZWFkZXIuaXNFbmRHcm91cCgpKSB7CiAgICAgIGJyZWFrOwogICAgfQoKICAgIHZhciBmaWVsZCA9IHJlYWRlci5nZXRGaWVsZE51bWJlcigpOwoKICAgIHN3aXRjaCAoZmllbGQpIHsKICAgICAgY2FzZSAxOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDY0KCk7CiAgICAgICAgbXNnLnNldElkKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRBcmVhSWQodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAzOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldEFwcElkKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNDoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRTdGFydEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZEVudW0oKTsKICAgICAgICBtc2cuc2V0SW50ZXJ2YWwodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA2OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldFN0YXRBdCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDc6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0SW5jb21lKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgODoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRBY3RpdmVVc2VyKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgOToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXROZXdVc2VyKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTA6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0UGF5VXNlcih2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDExOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkRmxvYXQoKTsKICAgICAgICBtc2cuc2V0VmlwVXNlcih2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDEyOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldFJlcGF5VXNlcih2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDEzOgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldE5ld0luY29tZSh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDE0OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldE5ld1BheVVzZXIodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAxNToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXROZXdDYWxsVXNlcih2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDE2OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldE5ld0NoYXRVc2VyKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMTc6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0Q2FsbCh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDE4OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldEFuc3dlcih2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDE5OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDY0KCk7CiAgICAgICAgbXNnLnNldER1cmF0aW9uKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjA6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0QWlDYWxsKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0QWlBbnN3ZXIodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAyMjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQ2NCgpOwogICAgICAgIG1zZy5zZXRBaUR1cmF0aW9uKHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMjM6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50NjQoKTsKICAgICAgICBtc2cuc2V0RXhwZW5zZSh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDI0OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDY0KCk7CiAgICAgICAgbXNnLnNldE5ld0V4cGVuc2UodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAyNToKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRHb29nbGVQYXkodmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAyNjoKICAgICAgICB2YXIgdmFsdWUgPSByZWFkZXIucmVhZFVpbnQzMigpOwogICAgICAgIG1zZy5zZXRBcHBsZVBheSh2YWx1ZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDI3OgogICAgICAgIHZhciB2YWx1ZSA9IHJlYWRlci5yZWFkVWludDMyKCk7CiAgICAgICAgbXNnLnNldE90aGVyUGF5KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNDA6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0VXBkYXRlZEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgNDE6CiAgICAgICAgdmFyIHZhbHVlID0gcmVhZGVyLnJlYWRVaW50MzIoKTsKICAgICAgICBtc2cuc2V0Q3JlYXRlZEF0KHZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmVhZGVyLnNraXBGaWVsZCgpOwogICAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgcmV0dXJuIG1zZzsKfTsKLyoqCiAqIFNlcmlhbGl6ZXMgdGhlIG1lc3NhZ2UgdG8gYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUgZm9ybWF0KS4KICogQHJldHVybiB7IVVpbnQ4QXJyYXl9CiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LnByb3RvdHlwZS5zZXJpYWxpemVCaW5hcnkgPSBmdW5jdGlvbiAoKSB7CiAgdmFyIHdyaXRlciA9IG5ldyBqc3BiLkJpbmFyeVdyaXRlcigpOwogIHByb3RvLnBiLlVzZXJTdGF0LnNlcmlhbGl6ZUJpbmFyeVRvV3JpdGVyKHRoaXMsIHdyaXRlcik7CiAgcmV0dXJuIHdyaXRlci5nZXRSZXN1bHRCdWZmZXIoKTsKfTsKLyoqCiAqIFNlcmlhbGl6ZXMgdGhlIGdpdmVuIG1lc3NhZ2UgdG8gYmluYXJ5IGRhdGEgKGluIHByb3RvYnVmIHdpcmUKICogZm9ybWF0KSwgd3JpdGluZyB0byB0aGUgZ2l2ZW4gQmluYXJ5V3JpdGVyLgogKiBAcGFyYW0geyFwcm90by5wYi5Vc2VyU3RhdH0gbWVzc2FnZQogKiBAcGFyYW0geyFqc3BiLkJpbmFyeVdyaXRlcn0gd3JpdGVyCiAqIEBzdXBwcmVzcyB7dW51c2VkTG9jYWxWYXJpYWJsZXN9IGYgaXMgb25seSB1c2VkIGZvciBuZXN0ZWQgbWVzc2FnZXMKICovCgoKcHJvdG8ucGIuVXNlclN0YXQuc2VyaWFsaXplQmluYXJ5VG9Xcml0ZXIgPSBmdW5jdGlvbiAobWVzc2FnZSwgd3JpdGVyKSB7CiAgdmFyIGYgPSB1bmRlZmluZWQ7CiAgZiA9IG1lc3NhZ2UuZ2V0SWQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQ2NCgxLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEFyZWFJZCgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDIsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0QXBwSWQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigzLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldFN0YXJ0QXQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMig0LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEludGVydmFsKCk7CgogIGlmIChmICE9PSAwLjApIHsKICAgIHdyaXRlci53cml0ZUVudW0oNSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRTdGF0QXQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMig2LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEluY29tZSgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDcsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0QWN0aXZlVXNlcigpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDgsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0TmV3VXNlcigpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDksIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0UGF5VXNlcigpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDEwLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldFZpcFVzZXIoKTsKCiAgaWYgKGYgIT09IDAuMCkgewogICAgd3JpdGVyLndyaXRlRmxvYXQoMTEsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0UmVwYXlVc2VyKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMTIsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0TmV3SW5jb21lKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMTMsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0TmV3UGF5VXNlcigpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDE0LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldE5ld0NhbGxVc2VyKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMTUsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0TmV3Q2hhdFVzZXIoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigxNiwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRDYWxsKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMTcsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0QW5zd2VyKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMTgsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0RHVyYXRpb24oKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQ2NCgxOSwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRBaUNhbGwoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigyMCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRBaUFuc3dlcigpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDIxLCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEFpRHVyYXRpb24oKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQ2NCgyMiwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRFeHBlbnNlKCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50NjQoMjMsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0TmV3RXhwZW5zZSgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDY0KDI0LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEdvb2dsZVBheSgpOwoKICBpZiAoZiAhPT0gMCkgewogICAgd3JpdGVyLndyaXRlVWludDMyKDI1LCBmKTsKICB9CgogIGYgPSBtZXNzYWdlLmdldEFwcGxlUGF5KCk7CgogIGlmIChmICE9PSAwKSB7CiAgICB3cml0ZXIud3JpdGVVaW50MzIoMjYsIGYpOwogIH0KCiAgZiA9IG1lc3NhZ2UuZ2V0T3RoZXJQYXkoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMigyNywgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRVcGRhdGVkQXQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMig0MCwgZik7CiAgfQoKICBmID0gbWVzc2FnZS5nZXRDcmVhdGVkQXQoKTsKCiAgaWYgKGYgIT09IDApIHsKICAgIHdyaXRlci53cml0ZVVpbnQzMig0MSwgZik7CiAgfQp9OwovKioKICogb3B0aW9uYWwgdWludDY0IGlkID0gMTsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5Vc2VyU3RhdC5wcm90b3R5cGUuZ2V0SWQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDEsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5Vc2VyU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LnByb3RvdHlwZS5zZXRJZCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGFyZWFfaWQgPSAyOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LnByb3RvdHlwZS5nZXRBcmVhSWQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDIsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5Vc2VyU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LnByb3RvdHlwZS5zZXRBcmVhSWQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDIsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBhcHBfaWQgPSAzOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LnByb3RvdHlwZS5nZXRBcHBJZCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMywgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlVzZXJTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuVXNlclN0YXQucHJvdG90eXBlLnNldEFwcElkID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAzLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgc3RhcnRfYXQgPSA0OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LnByb3RvdHlwZS5nZXRTdGFydEF0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA0LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuVXNlclN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5Vc2VyU3RhdC5wcm90b3R5cGUuc2V0U3RhcnRBdCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgNCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgU3RhdEludGVydmFsIGludGVydmFsID0gNTsKICogQHJldHVybiB7IXByb3RvLnBiLlN0YXRJbnRlcnZhbH0KICovCgoKcHJvdG8ucGIuVXNlclN0YXQucHJvdG90eXBlLmdldEludGVydmFsID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA1LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7IXByb3RvLnBiLlN0YXRJbnRlcnZhbH0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlVzZXJTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuVXNlclN0YXQucHJvdG90eXBlLnNldEludGVydmFsID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNFbnVtRmllbGQodGhpcywgNSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIHN0YXRfYXQgPSA2OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LnByb3RvdHlwZS5nZXRTdGF0QXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDYsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5Vc2VyU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LnByb3RvdHlwZS5zZXRTdGF0QXQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDYsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBpbmNvbWUgPSA3OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LnByb3RvdHlwZS5nZXRJbmNvbWUgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDcsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5Vc2VyU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LnByb3RvdHlwZS5zZXRJbmNvbWUgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDcsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBhY3RpdmVfdXNlciA9IDg7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuVXNlclN0YXQucHJvdG90eXBlLmdldEFjdGl2ZVVzZXIgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDgsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5Vc2VyU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LnByb3RvdHlwZS5zZXRBY3RpdmVVc2VyID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCA4LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgbmV3X3VzZXIgPSA5OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LnByb3RvdHlwZS5nZXROZXdVc2VyID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA5LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuVXNlclN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5Vc2VyU3RhdC5wcm90b3R5cGUuc2V0TmV3VXNlciA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgOSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIHBheV91c2VyID0gMTA7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuVXNlclN0YXQucHJvdG90eXBlLmdldFBheVVzZXIgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDEwLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuVXNlclN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5Vc2VyU3RhdC5wcm90b3R5cGUuc2V0UGF5VXNlciA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMTAsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIGZsb2F0IHZpcF91c2VyID0gMTE7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuVXNlclN0YXQucHJvdG90eXBlLmdldFZpcFVzZXIgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGbG9hdGluZ1BvaW50RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxMSwgMC4wKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuVXNlclN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5Vc2VyU3RhdC5wcm90b3R5cGUuc2V0VmlwVXNlciA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zRmxvYXRGaWVsZCh0aGlzLCAxMSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIHJlcGF5X3VzZXIgPSAxMjsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5Vc2VyU3RhdC5wcm90b3R5cGUuZ2V0UmVwYXlVc2VyID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxMiwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlVzZXJTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuVXNlclN0YXQucHJvdG90eXBlLnNldFJlcGF5VXNlciA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMTIsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBuZXdfaW5jb21lID0gMTM7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuVXNlclN0YXQucHJvdG90eXBlLmdldE5ld0luY29tZSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMTMsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5Vc2VyU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LnByb3RvdHlwZS5zZXROZXdJbmNvbWUgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDEzLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgbmV3X3BheV91c2VyID0gMTQ7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuVXNlclN0YXQucHJvdG90eXBlLmdldE5ld1BheVVzZXIgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDE0LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuVXNlclN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5Vc2VyU3RhdC5wcm90b3R5cGUuc2V0TmV3UGF5VXNlciA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMTQsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBuZXdfY2FsbF91c2VyID0gMTU7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuVXNlclN0YXQucHJvdG90eXBlLmdldE5ld0NhbGxVc2VyID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxNSwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlVzZXJTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuVXNlclN0YXQucHJvdG90eXBlLnNldE5ld0NhbGxVc2VyID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAxNSwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIG5ld19jaGF0X3VzZXIgPSAxNjsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5Vc2VyU3RhdC5wcm90b3R5cGUuZ2V0TmV3Q2hhdFVzZXIgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDE2LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuVXNlclN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5Vc2VyU3RhdC5wcm90b3R5cGUuc2V0TmV3Q2hhdFVzZXIgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDE2LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgY2FsbCA9IDE3OwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LnByb3RvdHlwZS5nZXRDYWxsID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAxNywgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlVzZXJTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuVXNlclN0YXQucHJvdG90eXBlLnNldENhbGwgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDE3LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgYW5zd2VyID0gMTg7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuVXNlclN0YXQucHJvdG90eXBlLmdldEFuc3dlciA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMTgsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5Vc2VyU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LnByb3RvdHlwZS5zZXRBbnN3ZXIgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDE4LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50NjQgZHVyYXRpb24gPSAxOTsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5Vc2VyU3RhdC5wcm90b3R5cGUuZ2V0RHVyYXRpb24gPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDE5LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuVXNlclN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5Vc2VyU3RhdC5wcm90b3R5cGUuc2V0RHVyYXRpb24gPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDE5LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgYWlfY2FsbCA9IDIwOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LnByb3RvdHlwZS5nZXRBaUNhbGwgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDIwLCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuVXNlclN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5Vc2VyU3RhdC5wcm90b3R5cGUuc2V0QWlDYWxsID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAyMCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGFpX2Fuc3dlciA9IDIxOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LnByb3RvdHlwZS5nZXRBaUFuc3dlciA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMjEsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5Vc2VyU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LnByb3RvdHlwZS5zZXRBaUFuc3dlciA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMjEsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQ2NCBhaV9kdXJhdGlvbiA9IDIyOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LnByb3RvdHlwZS5nZXRBaUR1cmF0aW9uID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAyMiwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlVzZXJTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuVXNlclN0YXQucHJvdG90eXBlLnNldEFpRHVyYXRpb24gPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDIyLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50NjQgZXhwZW5zZSA9IDIzOwogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LnByb3RvdHlwZS5nZXRFeHBlbnNlID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAyMywgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlVzZXJTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuVXNlclN0YXQucHJvdG90eXBlLnNldEV4cGVuc2UgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDIzLCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50NjQgbmV3X2V4cGVuc2UgPSAyNDsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5Vc2VyU3RhdC5wcm90b3R5cGUuZ2V0TmV3RXhwZW5zZSA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgMjQsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5Vc2VyU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LnByb3RvdHlwZS5zZXROZXdFeHBlbnNlID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAyNCwgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIGdvb2dsZV9wYXkgPSAyNTsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5Vc2VyU3RhdC5wcm90b3R5cGUuZ2V0R29vZ2xlUGF5ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAyNSwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlVzZXJTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuVXNlclN0YXQucHJvdG90eXBlLnNldEdvb2dsZVBheSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgMjUsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBhcHBsZV9wYXkgPSAyNjsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5Vc2VyU3RhdC5wcm90b3R5cGUuZ2V0QXBwbGVQYXkgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5nZXRGaWVsZFdpdGhEZWZhdWx0KHRoaXMsIDI2LCAwKTsKfTsKLyoqCiAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQogKiBAcmV0dXJuIHshcHJvdG8ucGIuVXNlclN0YXR9IHJldHVybnMgdGhpcwogKi8KCgpwcm90by5wYi5Vc2VyU3RhdC5wcm90b3R5cGUuc2V0QXBwbGVQYXkgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDI2LCB2YWx1ZSk7Cn07Ci8qKgogKiBvcHRpb25hbCB1aW50MzIgb3RoZXJfcGF5ID0gMjc7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuVXNlclN0YXQucHJvdG90eXBlLmdldE90aGVyUGF5ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCAyNywgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlVzZXJTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuVXNlclN0YXQucHJvdG90eXBlLnNldE90aGVyUGF5ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIGpzcGIuTWVzc2FnZS5zZXRQcm90bzNJbnRGaWVsZCh0aGlzLCAyNywgdmFsdWUpOwp9OwovKioKICogb3B0aW9uYWwgdWludDMyIHVwZGF0ZWRfYXQgPSA0MDsKICogQHJldHVybiB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5Vc2VyU3RhdC5wcm90b3R5cGUuZ2V0VXBkYXRlZEF0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBqc3BiLk1lc3NhZ2UuZ2V0RmllbGRXaXRoRGVmYXVsdCh0aGlzLCA0MCwgMCk7Cn07Ci8qKgogKiBAcGFyYW0ge251bWJlcn0gdmFsdWUKICogQHJldHVybiB7IXByb3RvLnBiLlVzZXJTdGF0fSByZXR1cm5zIHRoaXMKICovCgoKcHJvdG8ucGIuVXNlclN0YXQucHJvdG90eXBlLnNldFVwZGF0ZWRBdCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHJldHVybiBqc3BiLk1lc3NhZ2Uuc2V0UHJvdG8zSW50RmllbGQodGhpcywgNDAsIHZhbHVlKTsKfTsKLyoqCiAqIG9wdGlvbmFsIHVpbnQzMiBjcmVhdGVkX2F0ID0gNDE7CiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKcHJvdG8ucGIuVXNlclN0YXQucHJvdG90eXBlLmdldENyZWF0ZWRBdCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLmdldEZpZWxkV2l0aERlZmF1bHQodGhpcywgNDEsIDApOwp9OwovKioKICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlCiAqIEByZXR1cm4geyFwcm90by5wYi5Vc2VyU3RhdH0gcmV0dXJucyB0aGlzCiAqLwoKCnByb3RvLnBiLlVzZXJTdGF0LnByb3RvdHlwZS5zZXRDcmVhdGVkQXQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4ganNwYi5NZXNzYWdlLnNldFByb3RvM0ludEZpZWxkKHRoaXMsIDQxLCB2YWx1ZSk7Cn07Ci8qKgogKiBAZW51bSB7bnVtYmVyfQogKi8KCgpwcm90by5wYi5NZXNzYWdlVHlwZSA9IHsKICBNRVNTQUdFVFlQRVVOS05PV046IDAsCiAgTUVTU0FHRVRFWFQ6IDEsCiAgTUVTU0FHRUdJRlQ6IDIsCiAgTUVTU0FHRURFUE9TSVQ6IDMsCiAgTUVTU0FHRUlNQUdFOiA0LAogIE1FU1NBR0VWSURFTzogNSwKICBNRVNTQUdFQVVESU86IDYsCiAgTUVTU0FHRUxPQ0FUSU9OOiA3LAogIE1FU1NBR0VWSVJUVUFMOiA4Cn07Ci8qKgogKiBAZW51bSB7bnVtYmVyfQogKi8KCnByb3RvLnBiLk1lc3NhZ2VEaXJlY3Rpb24gPSB7CiAgRElSRUNUSU9OVU5LTk9XTjogMCwKICBUT1VTRVI6IDEsCiAgVE9BTkNIT1I6IDIKfTsKLyoqCiAqIEBlbnVtIHtudW1iZXJ9CiAqLwoKcHJvdG8ucGIuQWN0aW9uVHlwZSA9IHsKICBBQ1RJT05UWVBFVU5LTk9XTjogMCwKICBBQ1RJT05SRUZVU0VDQUxMOiAxLAogIEFDVElPTk1JU1NDQUxMOiAyLAogIEFDVElPTkVORENBTEw6IDMsCiAgQUNUSU9ORk9MTE9XOiA0LAogIEFDVElPTkRFUE9TSVQ6IDUsCiAgQUNUSU9OU0VOREdJRlQ6IDYKfTsKLyoqCiAqIEBlbnVtIHtudW1iZXJ9CiAqLwoKcHJvdG8ucGIuU3RhdEludGVydmFsID0gewogIFNUQVRJTlRFUlZBTFVOS05PV046IDAsCiAgU1RBVE1JTjogMSwKICBTVEFUTUlONTogMiwKICBTVEFUSE9VUkxZOiAzLAogIFNUQVREQUlMWTogNCwKICBTVEFUV0VFS0xZOiA1Cn07Cmdvb2cub2JqZWN0LmV4dGVuZChleHBvcnRzLCBwcm90by5wYik7"},null]}