{"remainingRequest":"/home/mengy/develop/iwork/kafo/vue-admin-design/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/mengy/develop/iwork/kafo/vue-admin-design/src/views/image/ImageCompress.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/mengy/develop/iwork/kafo/vue-admin-design/src/views/image/ImageCompress.vue","mtime":1624500048824},{"path":"/home/mengy/develop/iwork/kafo/vue-admin-design/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/mengy/develop/iwork/kafo/vue-admin-design/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/mengy/develop/iwork/kafo/vue-admin-design/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/mengy/develop/iwork/kafo/vue-admin-design/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBIaW50cyBmcm9tICcuLi8uLi9jb21wb25lbnRzL0hpbnRzJwppbXBvcnQgVXBsb2FkSW1hZ2UgZnJvbSAnLi4vLi4vY29tcG9uZW50cy9VcGxvYWRJbWFnZScKaW1wb3J0IHsgYmFzZTY0dG9CbG9iLCBjYWxjSW1hZ2VTaXplIH0gZnJvbSAnLi4vLi4vdXRpbHMnCmNvbnN0IHF1YWxpdHlPcHRpb25zID0gWwogIHsgbGFiZWw6IDEwMCwgdmFsdWU6IDEgfSwKICB7IGxhYmVsOiA5MCwgdmFsdWU6IDAuOSB9LAogIHsgbGFiZWw6IDgwLCB2YWx1ZTogMC44IH0sCiAgeyBsYWJlbDogNzAsIHZhbHVlOiAwLjcgfSwKICB7IGxhYmVsOiA2MCwgdmFsdWU6IDAuNiB9LAogIHsgbGFiZWw6IDUwLCB2YWx1ZTogMC41IH0KXQoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdJbWFnZUNvbXByZXNzJywKICBjb21wb25lbnRzOiB7IEhpbnRzLCBVcGxvYWRJbWFnZSB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICAvLyDlm77niYflr7nosaEKICAgICAgaW1hZ2U6IHsKICAgICAgICB3aWR0aDogMTkyMCwKICAgICAgICBoZWlnaHQ6IDEwODAsCiAgICAgICAgc3JjOiAnaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2JhaW1pbmd4dWFuL21lZGlhLXN0b3JlL2ltYWdlcy9pbWcwMy5qcGcnCiAgICAgIH0sCiAgICAgIC8vIOWbvueJh+aYvuekuuWvueixoQogICAgICBpbWFnZVNob3c6IHsKICAgICAgICB3aWR0aDogMCwKICAgICAgICBoZWlnaHQ6IDAsCiAgICAgICAgaW1nU3JjOiAnJwogICAgICB9LAogICAgICAvLyDlm77niYfljovnvKnnmoTlgLzlr7nosaEKICAgICAgaW1hZ2VPYmo6IHsKICAgICAgICB3aWR0aDogMCwKICAgICAgICBoZWlnaHQ6IDAsCiAgICAgICAgcmF0aW86IDEwMCArICclJywKICAgICAgICBxdWFsaXR5OiAxCiAgICAgIH0sCiAgICAgIHF1YWxpdHlPcHRpb25zCiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgLy8g5Zu+54mH5pi+56S65Yy65qC35byPCiAgICBpbWFnZVN0eWxlKCkgewogICAgICByZXR1cm4gewogICAgICAgIHdpZHRoOiB0aGlzLmltYWdlU2hvdy53aWR0aCArICdweCcsCiAgICAgICAgaGVpZ2h0OiB0aGlzLmltYWdlU2hvdy5oZWlnaHQgKyAncHgnLAogICAgICAgIGJhY2tncm91bmRJbWFnZTogJ3VybChcJycgKyB0aGlzLmltYWdlU2hvdy5pbWdTcmMgKyAnXCcpJwogICAgICB9CiAgICB9LAogICAgLy8g5Zu+54mH5a696auY5q+U546HCiAgICBpbWFnZVJhdGlvKCkgewogICAgICByZXR1cm4gdGhpcy5pbWFnZS53aWR0aCAvIHRoaXMuaW1hZ2UuaGVpZ2h0CiAgICB9CiAgfSwKICB3YXRjaDogewogICAgaW1hZ2U6IHsKICAgICAgaGFuZGxlcih2YWwpIHsKICAgICAgICB0aGlzLmdldERyYWdDb250YWluZXJTaXplKHZhbC53aWR0aCwgdmFsLmhlaWdodCkKICAgICAgICB0aGlzLmltYWdlU2hvdy5pbWdTcmMgPSB2YWwuc3JjCiAgICAgICAgdGhpcy5pbWFnZU9iai53aWR0aCA9IHZhbC53aWR0aAogICAgICAgIHRoaXMuaW1hZ2VPYmouaGVpZ2h0ID0gdmFsLmhlaWdodAogICAgICAgIHRoaXMuaW1hZ2VPYmoucmF0aW8gPSAxMDAgKyAnJScKICAgICAgICB0aGlzLmltYWdlT2JqLnF1YWxpdHkgPSAxCiAgICAgIH0sCiAgICAgIGRlZXA6IHRydWUKICAgIH0KICB9LAogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmdldERyYWdDb250YWluZXJTaXplKHRoaXMuaW1hZ2Uud2lkdGgsIHRoaXMuaW1hZ2UuaGVpZ2h0KQogICAgdGhpcy5pbWFnZVNob3cuaW1nU3JjID0gdGhpcy5pbWFnZS5zcmMKICAgIHRoaXMuaW1hZ2VPYmoud2lkdGggPSB0aGlzLmltYWdlLndpZHRoCiAgICB0aGlzLmltYWdlT2JqLmhlaWdodCA9IHRoaXMuaW1hZ2UuaGVpZ2h0CiAgfSwKICBtZXRob2RzOiB7CiAgICAvLyDovpPlhaXlrr3pq5jlhbPogZQKICAgIGJpbmRJbnB1dCh0eXBlKSB7CiAgICAgIGlmICh0eXBlID09PSAnaCcpIHsKICAgICAgICB0aGlzLmltYWdlT2JqLmhlaWdodCA9IE1hdGgucm91bmQodGhpcy5pbWFnZU9iai53aWR0aCAvIHRoaXMuaW1hZ2VSYXRpbykudG9GaXhlZCgwKQogICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICd3JykgewogICAgICAgIHRoaXMuaW1hZ2VPYmoud2lkdGggPSBNYXRoLnJvdW5kKHRoaXMuaW1hZ2VPYmouaGVpZ2h0ICogdGhpcy5pbWFnZVJhdGlvKS50b0ZpeGVkKDApCiAgICAgIH0KICAgICAgdGhpcy5pbWFnZU9iai5yYXRpbyA9ICh0aGlzLmltYWdlT2JqLndpZHRoIC8gdGhpcy5pbWFnZS53aWR0aCAqIDEwMCkudG9GaXhlZCgyKSArICclJwogICAgfSwKICAgIC8vIOiuoeeul+WbvueJh+aYvuekuuWuvemrmAogICAgZ2V0RHJhZ0NvbnRhaW5lclNpemUoaW1hZ2VXLCBpbWFnZUgpIHsKICAgICAgY29uc3QgW3Nob3dBcmVhVywgc2hvd0FyZWFIXSA9IFs4NTAsIDU1MF0KICAgICAgY29uc3Qgc2l6ZU9iaiA9IGNhbGNJbWFnZVNpemUoaW1hZ2VXLCBpbWFnZUgsIHNob3dBcmVhVywgc2hvd0FyZWFIKQogICAgICAvLyDmm7TmlrDlm77niYflsZXnpLrljLrlrr3pq5gKICAgICAgdGhpcy5pbWFnZVNob3cud2lkdGggPSBzaXplT2JqLndpZHRoCiAgICAgIHRoaXMuaW1hZ2VTaG93LmhlaWdodCA9IHNpemVPYmouaGVpZ2h0CiAgICB9LAogICAgaGFuZGxlU3VjY2VzcyhkYXRhKSB7CiAgICAgIHRoaXMuaW1hZ2Uuc3JjID0gZGF0YQogICAgICBjb25zdCBpbWFnZSA9IG5ldyBJbWFnZSgpCiAgICAgIGltYWdlLnNyYyA9IGRhdGEKICAgICAgaW1hZ2Uub25sb2FkID0gKCkgPT4gewogICAgICAgIHRoaXMuaW1hZ2Uud2lkdGggPSBpbWFnZS53aWR0aAogICAgICAgIHRoaXMuaW1hZ2UuaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0CiAgICAgIH0KICAgIH0sCiAgICAvLyDlm77niYfljovnvKkKICAgIGNvbXByZXNzSW1hZ2UoKSB7CiAgICAgIGNvbnN0IHdpZHRoID0gdGhpcy5pbWFnZU9iai53aWR0aAogICAgICBjb25zdCBoZWlnaHQgPSB0aGlzLmltYWdlT2JqLmhlaWdodAogICAgICBjb25zdCBxdWFsaXR5ID0gdGhpcy5pbWFnZU9iai5xdWFsaXR5CiAgICAgIGNvbnN0IGltZyA9IG5ldyBJbWFnZSgpCiAgICAgIGltZy5zcmMgPSB0aGlzLmltYWdlLnNyYwogICAgICBpbWcub25sb2FkID0gKCkgPT4gewogICAgICAgIC8vIOWIm+W7umNhbnZhcwogICAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpCiAgICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJykKICAgICAgICAvLyDliJvlu7rlsZ7mgKfoioLngrkKICAgICAgICBjb25zdCBhbncgPSBkb2N1bWVudC5jcmVhdGVBdHRyaWJ1dGUoJ3dpZHRoJykKICAgICAgICBhbncubm9kZVZhbHVlID0gd2lkdGgKICAgICAgICBjb25zdCBhbmggPSBkb2N1bWVudC5jcmVhdGVBdHRyaWJ1dGUoJ2hlaWdodCcpCiAgICAgICAgYW5oLm5vZGVWYWx1ZSA9IGhlaWdodAogICAgICAgIGNhbnZhcy5zZXRBdHRyaWJ1dGVOb2RlKGFudykKICAgICAgICBjYW52YXMuc2V0QXR0cmlidXRlTm9kZShhbmgpCiAgICAgICAgLy8g57uY5Yi25Zu+54mHCiAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpCiAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIDAsIDAsIHdpZHRoLCBoZWlnaHQpCiAgICAgICAgLy8g55Sf5oiQYmFzZTY05Zu+54mHCiAgICAgICAgY29uc3QgaW1hZ2VCYXNlNjQgPSBjYW52YXMudG9EYXRhVVJMKCdpbWFnZS9wbmcnLCBxdWFsaXR5KQogICAgICAgIHRoaXMuZG93bmxvYWRJbWFnZShpbWFnZUJhc2U2NCkKICAgICAgfQogICAgfSwKICAgIC8vIOS4i+i9veWOi+e8qeeahOWbvueJhwogICAgZG93bmxvYWRJbWFnZShpbWFnZUJhc2U2NCkgewogICAgICBjb25zdCBpbWFnZUJsb2IgPSBiYXNlNjR0b0Jsb2IoaW1hZ2VCYXNlNjQpCiAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJykKICAgICAgY29uc3QgZXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnSFRNTEV2ZW50cycpCiAgICAgIC8vIGluaXRFdmVudCDkuI3liqDlkI7kuKTkuKrlj4LmlbDkvJrlnKjngavni5DkuIvmiqXplJkg5LqL5Lu257G75Z6L77yM5piv5ZCm5YaS5rOh77yM5piv5ZCm6Zi75q2i5rWP6KeI5Zmo55qE6buY6K6k6KGM5Li6CiAgICAgIGV2ZW50LmluaXRFdmVudCgnY2xpY2snLCB0cnVlLCB0cnVlKQogICAgICBsaW5rLmRvd25sb2FkID0gJ2ltYWdlLnBuZycKICAgICAgbGluay5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChpbWFnZUJsb2IpCiAgICAgIC8vIOWFvOWuueeBq+eLkAogICAgICBsaW5rLmRpc3BhdGNoRXZlbnQobmV3IE1vdXNlRXZlbnQoJ2NsaWNrJywgeyBidWJibGVzOiB0cnVlLCBjYW5jZWxhYmxlOiB0cnVlLCB2aWV3OiB3aW5kb3cgfSkpCiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["ImageCompress.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ImageCompress.vue","sourceRoot":"src/views/image","sourcesContent":["<template>\n  <div class=\"image-compress\">\n    <Hints>\n      <template slot=\"hintName\">图片压缩</template>\n      <template slot=\"hintInfo\">\n        <p>纯JS实现对图片的等比压缩和放大的功能，并对图片进行下载</p>\n      </template>\n    </Hints>\n    <el-row :gutter=\"20\">\n      <el-col :span=\"16\">\n        <el-card shadow=\"always\">\n          <div slot=\"header\" class=\"title\">图片区域</div>\n          <div class=\"box-wrapper\">\n            <div class=\"image-container\" :style=\"imageStyle\" />\n          </div>\n        </el-card>\n      </el-col>\n      <el-col :span=\"8\">\n        <el-card shadow=\"always\">\n          <div slot=\"header\" class=\"title\">设置区域</div>\n          <div class=\"box-content\">\n            <el-form label-width=\"82px\" label-position=\"left\">\n              <el-form-item label=\"选择图片：\">\n                <UploadImage class=\"select-image\" btn-name=\"选择图片\" @on-success=\"handleSuccess\" />\n              </el-form-item>\n              <el-form-item label=\"图片尺寸：\">\n                <div class=\"ratio-size\">\n                  <el-input v-model.number=\"imageObj.width\" @keyup.native=\"bindInput('h')\" />\n                  <i class=\"vue-dsn-icon-edit-img-size-locking icon-link\" />\n                  <el-input v-model.number=\"imageObj.height\" @keyup.native=\"bindInput('w')\" />\n                  <ul class=\"ratio-type clearfix\">\n                    <li>宽</li>\n                    <li>高</li>\n                  </ul>\n                </div>\n              </el-form-item>\n              <el-form-item label=\"压缩比例：\" class=\"item-ratio\">\n                <el-input v-model.number=\"imageObj.ratio\" disabled />\n              </el-form-item>\n              <el-form-item label=\"图片质量：\">\n                <el-select v-model=\"imageObj.quality\" placeholder=\"请选择\">\n                  <el-option\n                    v-for=\"item in qualityOptions\"\n                    :key=\"item.value\"\n                    :label=\"item.label\"\n                    :value=\"item.value\"\n                  />\n                </el-select>\n              </el-form-item>\n              <div>\n                <el-button class=\"btn-compress\" type=\"primary\" @click=\"compressImage\">压缩图片</el-button>\n              </div>\n            </el-form>\n          </div>\n        </el-card>\n      </el-col>\n    </el-row>\n  </div>\n</template>\n\n<script>\nimport Hints from '../../components/Hints'\nimport UploadImage from '../../components/UploadImage'\nimport { base64toBlob, calcImageSize } from '../../utils'\nconst qualityOptions = [\n  { label: 100, value: 1 },\n  { label: 90, value: 0.9 },\n  { label: 80, value: 0.8 },\n  { label: 70, value: 0.7 },\n  { label: 60, value: 0.6 },\n  { label: 50, value: 0.5 }\n]\n\nexport default {\n  name: 'ImageCompress',\n  components: { Hints, UploadImage },\n  data() {\n    return {\n      // 图片对象\n      image: {\n        width: 1920,\n        height: 1080,\n        src: 'https://cdn.jsdelivr.net/gh/baimingxuan/media-store/images/img03.jpg'\n      },\n      // 图片显示对象\n      imageShow: {\n        width: 0,\n        height: 0,\n        imgSrc: ''\n      },\n      // 图片压缩的值对象\n      imageObj: {\n        width: 0,\n        height: 0,\n        ratio: 100 + '%',\n        quality: 1\n      },\n      qualityOptions\n    }\n  },\n  computed: {\n    // 图片显示区样式\n    imageStyle() {\n      return {\n        width: this.imageShow.width + 'px',\n        height: this.imageShow.height + 'px',\n        backgroundImage: 'url(\\'' + this.imageShow.imgSrc + '\\')'\n      }\n    },\n    // 图片宽高比率\n    imageRatio() {\n      return this.image.width / this.image.height\n    }\n  },\n  watch: {\n    image: {\n      handler(val) {\n        this.getDragContainerSize(val.width, val.height)\n        this.imageShow.imgSrc = val.src\n        this.imageObj.width = val.width\n        this.imageObj.height = val.height\n        this.imageObj.ratio = 100 + '%'\n        this.imageObj.quality = 1\n      },\n      deep: true\n    }\n  },\n  created() {\n    this.getDragContainerSize(this.image.width, this.image.height)\n    this.imageShow.imgSrc = this.image.src\n    this.imageObj.width = this.image.width\n    this.imageObj.height = this.image.height\n  },\n  methods: {\n    // 输入宽高关联\n    bindInput(type) {\n      if (type === 'h') {\n        this.imageObj.height = Math.round(this.imageObj.width / this.imageRatio).toFixed(0)\n      } else if (type === 'w') {\n        this.imageObj.width = Math.round(this.imageObj.height * this.imageRatio).toFixed(0)\n      }\n      this.imageObj.ratio = (this.imageObj.width / this.image.width * 100).toFixed(2) + '%'\n    },\n    // 计算图片显示宽高\n    getDragContainerSize(imageW, imageH) {\n      const [showAreaW, showAreaH] = [850, 550]\n      const sizeObj = calcImageSize(imageW, imageH, showAreaW, showAreaH)\n      // 更新图片展示区宽高\n      this.imageShow.width = sizeObj.width\n      this.imageShow.height = sizeObj.height\n    },\n    handleSuccess(data) {\n      this.image.src = data\n      const image = new Image()\n      image.src = data\n      image.onload = () => {\n        this.image.width = image.width\n        this.image.height = image.height\n      }\n    },\n    // 图片压缩\n    compressImage() {\n      const width = this.imageObj.width\n      const height = this.imageObj.height\n      const quality = this.imageObj.quality\n      const img = new Image()\n      img.src = this.image.src\n      img.onload = () => {\n        // 创建canvas\n        const canvas = document.createElement('canvas')\n        const ctx = canvas.getContext('2d')\n        // 创建属性节点\n        const anw = document.createAttribute('width')\n        anw.nodeValue = width\n        const anh = document.createAttribute('height')\n        anh.nodeValue = height\n        canvas.setAttributeNode(anw)\n        canvas.setAttributeNode(anh)\n        // 绘制图片\n        ctx.fillRect(0, 0, width, height)\n        ctx.drawImage(img, 0, 0, width, height)\n        // 生成base64图片\n        const imageBase64 = canvas.toDataURL('image/png', quality)\n        this.downloadImage(imageBase64)\n      }\n    },\n    // 下载压缩的图片\n    downloadImage(imageBase64) {\n      const imageBlob = base64toBlob(imageBase64)\n      const link = document.createElement('a')\n      const event = document.createEvent('HTMLEvents')\n      // initEvent 不加后两个参数会在火狐下报错 事件类型，是否冒泡，是否阻止浏览器的默认行为\n      event.initEvent('click', true, true)\n      link.download = 'image.png'\n      link.href = URL.createObjectURL(imageBlob)\n      // 兼容火狐\n      link.dispatchEvent(new MouseEvent('click', { bubbles: true, cancelable: true, view: window }))\n    }\n  }\n}\n</script>\n\n<style lang=\"less\">\n@import \"../../assets/less/image-compress\";\n</style>\n"]}]}