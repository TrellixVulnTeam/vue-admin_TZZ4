{"remainingRequest":"/home/mengy/Documents/iwork/kafo/vue-admin-design/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/mengy/Documents/iwork/kafo/vue-admin-design/src/components/TextSetting/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/mengy/Documents/iwork/kafo/vue-admin-design/src/components/TextSetting/index.vue","mtime":1624500048821},{"path":"/home/mengy/Documents/iwork/kafo/vue-admin-design/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/mengy/Documents/iwork/kafo/vue-admin-design/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/mengy/Documents/iwork/kafo/vue-admin-design/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/mengy/Documents/iwork/kafo/vue-admin-design/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGJhc2U2NHRvQmxvYiB9IGZyb20gJy4uLy4uL3V0aWxzJwppbXBvcnQgSW1hZ2VSaWNoVGV4dCBmcm9tICcuLi9JbWFnZVJpY2hUZXh0JwoKY29uc3QgZm9udEZhbWlseURhdGEgPSBbCiAgeyB2YWx1ZTogJ+m7keS9kycgfSwKICB7IHZhbHVlOiAn5a6L5L2TJyB9LAogIHsgdmFsdWU6ICfku7/lrosnIH0sCiAgeyB2YWx1ZTogJ+alt+S9kycgfSwKICB7IHZhbHVlOiAn6Zq25LmmJyB9LAogIHsgdmFsdWU6ICflvq7ova/pm4Xpu5EnIH0sCiAgeyB2YWx1ZTogJ+aWueato+WnmuS9kycgfQpdCmNvbnN0IGZvbnRTaXplRGF0YSA9IFsKICB7IHZhbHVlOiAnMTJweCcgfSwKICB7IHZhbHVlOiAnMTRweCcgfSwKICB7IHZhbHVlOiAnMTZweCcgfSwKICB7IHZhbHVlOiAnMThweCcgfSwKICB7IHZhbHVlOiAnMjRweCcgfSwKICB7IHZhbHVlOiAnMzJweCcgfSwKICB7IHZhbHVlOiAnNDhweCcgfQpdCgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ1RleHRTZXR0aW5nJywKICBjb21wb25lbnRzOiB7IEltYWdlUmljaFRleHQgfSwKICBwcm9wczogewogICAgYWN0aXZlRWxlVGV4dDogewogICAgICB0eXBlOiBPYmplY3QsCiAgICAgIGRlZmF1bHQ6ICgpID0+IHt9CiAgICB9CiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZm9udEZhbWlseURhdGEsCiAgICAgIGZvbnRTaXplRGF0YQogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC8vIOWtl+S9k+aYr+WQpuWKoOeylwogICAgZm9udFdlaWdodCgpIHsKICAgICAgaWYgKCt0aGlzLmFjdGl2ZUVsZVRleHQuc3R5bGUuZm9udFdlaWdodCA9PT0gNDAwKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRydWUKICAgICAgfQogICAgfQogIH0sCiAgd2F0Y2g6IHsKICAgIC8vIOaWh+Wtl+Wkp+Wwj+WPmOWMluaXtuihjOmrmOS4gOi1t+WPmOWMlgogICAgYWN0aXZlRWxlVGV4dDogewogICAgICBoYW5kbGVyKHZhbCkgewogICAgICAgIHRoaXMuYWN0aXZlRWxlVGV4dC5zdHlsZS5saW5lSGVpZ2h0ID0gdmFsLnN0eWxlLmZvbnRTaXplCiAgICAgIH0sCiAgICAgIGRlZXA6IHRydWUKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIC8vIOiuvue9rueyl+S9kwogICAgc2V0Rm9udFdlaWdodCgpIHsKICAgICAgaWYgKCt0aGlzLmFjdGl2ZUVsZVRleHQuc3R5bGUuZm9udFdlaWdodCA9PT0gNDAwKSB7CiAgICAgICAgdGhpcy5hY3RpdmVFbGVUZXh0LnN0eWxlLmZvbnRXZWlnaHQgPSA2MDAKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFjdGl2ZUVsZVRleHQuc3R5bGUuZm9udFdlaWdodCA9IDQwMAogICAgICB9CiAgICB9LAogICAgLy8g6K6+572u5a+56b2QCiAgICBoYW5kbGVDb21tYW5kKGNvbW1hbmQpIHsKICAgICAgdGhpcy5hY3RpdmVFbGVUZXh0LnN0eWxlLnRleHRBbGlnbiA9IGNvbW1hbmQKICAgIH0sCiAgICAvLyDlvZPliY3lr7npvZDmlrnlvI8KICAgIHNldEFsaWduQWN0aXZlKHR5cGUpIHsKICAgICAgaWYgKHRoaXMuYWN0aXZlRWxlVGV4dC5zdHlsZS50ZXh0QWxpZ24gPT09IHR5cGUpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzQwOWVmZicsCiAgICAgICAgICBjb2xvcjogJyNmZmYnCiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcnLAogICAgICAgICAgY29sb3I6ICcjMzMzJwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIC8vIOaWh+acrOeUn+aIkOWbvueJhwogICAgdGV4dEJlY29tZUltZyhvYmopIHsKICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJykKICAgICAgY2FudmFzLndpZHRoID0gb2JqLncKICAgICAgY2FudmFzLmhlaWdodCA9IG9iai5oCiAgICAgIGNvbnN0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKQogICAgICAvLyDnu5jliLblrZfkvZPot53nprtjYW52YXPpobbpg6jliJ3lp4vnmoTpq5jluqYKICAgICAgY29uc3QgaW5pdFRvcCA9IDQKICAgICAgY29uc3QgaW5pdExlZnQgPSA4CiAgICAgIC8vIOiuvue9ruiDjOaZr+iJsgogICAgICBjb250ZXh0LmZpbGxTdHlsZSA9IG9iai5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgfHwgJ3RyYW5zcGFyZW50JwogICAgICBjb250ZXh0LmZpbGxSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCkKICAgICAgLy8g6K6+572u5paH5pys5qC35byPCiAgICAgIGNvbnRleHQuZmlsbFN0eWxlID0gb2JqLnN0eWxlLmNvbG9yCiAgICAgIGNvbnRleHQuZm9udCA9IG9iai5zdHlsZS5mb250V2VpZ2h0ICsgJyAnICsgb2JqLnN0eWxlLmZvbnRTaXplICsgJyAnICsgb2JqLnN0eWxlLmZvbnRGYW1pbHkKICAgICAgY29udGV4dC50ZXh0QmFzZWxpbmUgPSAndG9wJwogICAgICAvLyDorr7nva7mlofmnKzlr7npvZDmlrnlvI8KICAgICAgY29udGV4dC50ZXh0QWxpZ24gPSBvYmouc3R5bGUudGV4dEFsaWduCgogICAgICBjb25zdCB0ZXh0QXJyID0gb2JqLnRleHQuc3BsaXQoJycpCiAgICAgIGxldCB0ZW1wU3RyID0gJycKICAgICAgY29uc3Qgcm93QXJyID0gW10KICAgICAgY29uc3QgbWF4VGV4dFdpZHRoID0gY2FudmFzLndpZHRoIC0gMiAqIGluaXRMZWZ0CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRleHRBcnIubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoY29udGV4dC5tZWFzdXJlVGV4dCh0ZW1wU3RyKS53aWR0aCA8IG1heFRleHRXaWR0aCAmJiBjb250ZXh0Lm1lYXN1cmVUZXh0KHRlbXBTdHIgKyAodGV4dEFycltpXSkpLndpZHRoIDw9IG1heFRleHRXaWR0aCkgewogICAgICAgICAgdGVtcFN0ciArPSB0ZXh0QXJyW2ldCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJvd0Fyci5wdXNoKHRlbXBTdHIpCiAgICAgICAgICB0ZW1wU3RyID0gdGV4dEFycltpXQogICAgICAgIH0KICAgICAgfQogICAgICByb3dBcnIucHVzaCh0ZW1wU3RyKQoKICAgICAgbGV0IGRyYXdMZWZ0CiAgICAgIGlmIChjb250ZXh0LnRleHRBbGlnbiA9PT0gJ2xlZnQnKSB7CiAgICAgICAgZHJhd0xlZnQgPSBpbml0TGVmdAogICAgICB9IGVsc2UgaWYgKGNvbnRleHQudGV4dEFsaWduID09PSAnY2VudGVyJykgewogICAgICAgIGRyYXdMZWZ0ID0gbWF4VGV4dFdpZHRoIC8gMgogICAgICB9IGVsc2UgaWYgKGNvbnRleHQudGV4dEFsaWduID09PSAncmlnaHQnKSB7CiAgICAgICAgZHJhd0xlZnQgPSBtYXhUZXh0V2lkdGgKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByb3dBcnIubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb250ZXh0LmZpbGxUZXh0KHJvd0FycltpXSwgZHJhd0xlZnQsIChwYXJzZUludChvYmouc3R5bGUuZm9udFNpemUpICogaSArIGluaXRUb3ApLCBtYXhUZXh0V2lkdGgpCiAgICAgIH0KCiAgICAgIHJldHVybiBjYW52YXMudG9EYXRhVVJMKCdpbWFnZS9wbmcnKQogICAgfSwKICAgIC8vIOS4i+i9veeUn+aIkOeahOWbvueJhwogICAgZG93bmxvYWRJbWFnZSgpIHsKICAgICAgY29uc3QgaW1hZ2VCYXNlNjQgPSB0aGlzLnRleHRCZWNvbWVJbWcodGhpcy5hY3RpdmVFbGVUZXh0KQogICAgICBjb25zdCBpbWFnZUJsb2IgPSBiYXNlNjR0b0Jsb2IoaW1hZ2VCYXNlNjQpCiAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJykKICAgICAgY29uc3QgZXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnSFRNTEV2ZW50cycpCiAgICAgIC8vIGluaXRFdmVudCDkuI3liqDlkI7kuKTkuKrlj4LmlbDkvJrlnKjngavni5DkuIvmiqXplJkg5LqL5Lu257G75Z6L77yM5piv5ZCm5YaS5rOh77yM5piv5ZCm6Zi75q2i5rWP6KeI5Zmo55qE6buY6K6k6KGM5Li6CiAgICAgIGV2ZW50LmluaXRFdmVudCgnY2xpY2snLCB0cnVlLCB0cnVlKQogICAgICBsaW5rLmRvd25sb2FkID0gJ2ltYWdlLnBuZycKICAgICAgbGluay5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChpbWFnZUJsb2IpCiAgICAgIC8vIOWFvOWuueeBq+eLkAogICAgICBsaW5rLmRpc3BhdGNoRXZlbnQobmV3IE1vdXNlRXZlbnQoJ2NsaWNrJywgeyBidWJibGVzOiB0cnVlLCBjYW5jZWxhYmxlOiB0cnVlLCB2aWV3OiB3aW5kb3cgfSkpCiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/TextSetting","sourcesContent":["<template>\n  <div class=\"text-setting-wrapper\">\n    <el-form label-width=\"70px\">\n      <!--文本-->\n      <el-form-item label=\"文本\">\n        <ImageRichText v-model=\"activeEleText.text\" class=\"text-editable\" :active-ele-text=\"activeEleText\" />\n      </el-form-item>\n      <!--字体-->\n      <el-form-item label=\"字体\">\n        <el-select v-model=\"activeEleText.style.fontFamily\" size=\"small\">\n          <el-option\n            v-for=\"item in fontFamilyData\"\n            :key=\"item.value\"\n            :label=\"item.value\"\n            :value=\"item.value\"\n            :style=\"{'fontFamily': item.value}\"\n          />\n        </el-select>\n      </el-form-item>\n      <!--字号-->\n      <el-form-item label=\"字号\">\n        <el-select\n          v-model=\"activeEleText.style.fontSize\"\n          size=\"small\"\n        >\n          <el-option\n            v-for=\"item in fontSizeData\"\n            :key=\"item.value\"\n            :label=\"item.value\"\n            :value=\"item.value\"\n          />\n        </el-select>\n      </el-form-item>\n      <!--颜色-->\n      <el-form-item label=\"颜色\">\n        <!-- 字体颜色 -->\n        <div class=\"color-box\">\n          <i class=\"vue-dsn-icon-wenzise color-icon\" :style=\"{'color': activeEleText.style.color}\" />\n          <el-color-picker v-model=\"activeEleText.style.color\" />\n        </div>\n        <!-- 背景颜色 -->\n        <div class=\"color-box\">\n          <i class=\"vue-dsn-icon-beijingse color-icon icon-bg\" :style=\"{'color': activeEleText.style.backgroundColor}\" />\n          <el-color-picker v-model=\"activeEleText.style.backgroundColor\" />\n        </div>\n        <div class=\"style-box\">\n          <!-- 加粗 -->\n          <span :class=\"['style-item', fontWeight ? 'active' : '']\" @click=\"setFontWeight\">\n            <i class=\"vue-dsn-icon-jiacu style-icon\" />\n          </span>\n          <!-- 对齐 -->\n          <div class=\"style-item\">\n            <el-dropdown trigger=\"click\" @command=\"handleCommand\">\n              <i class=\"vue-dsn-icon-duiqi style-icon\" />\n              <el-dropdown-menu slot=\"dropdown\">\n                <el-dropdown-item command=\"left\" :style=\"setAlignActive('left')\">左对齐</el-dropdown-item>\n                <el-dropdown-item command=\"center\" :style=\"setAlignActive('center')\">居中</el-dropdown-item>\n                <el-dropdown-item command=\"right\" :style=\"setAlignActive('right')\">右对齐</el-dropdown-item>\n              </el-dropdown-menu>\n            </el-dropdown>\n          </div>\n        </div>\n      </el-form-item>\n      <el-form-item>\n        <el-button type=\"primary\" @click=\"downloadImage\">文本生成图片</el-button>\n      </el-form-item>\n    </el-form>\n  </div>\n</template>\n\n<script>\nimport { base64toBlob } from '../../utils'\nimport ImageRichText from '../ImageRichText'\n\nconst fontFamilyData = [\n  { value: '黑体' },\n  { value: '宋体' },\n  { value: '仿宋' },\n  { value: '楷体' },\n  { value: '隶书' },\n  { value: '微软雅黑' },\n  { value: '方正姚体' }\n]\nconst fontSizeData = [\n  { value: '12px' },\n  { value: '14px' },\n  { value: '16px' },\n  { value: '18px' },\n  { value: '24px' },\n  { value: '32px' },\n  { value: '48px' }\n]\n\nexport default {\n  name: 'TextSetting',\n  components: { ImageRichText },\n  props: {\n    activeEleText: {\n      type: Object,\n      default: () => {}\n    }\n  },\n  data() {\n    return {\n      fontFamilyData,\n      fontSizeData\n    }\n  },\n  computed: {\n    // 字体是否加粗\n    fontWeight() {\n      if (+this.activeEleText.style.fontWeight === 400) {\n        return false\n      } else {\n        return true\n      }\n    }\n  },\n  watch: {\n    // 文字大小变化时行高一起变化\n    activeEleText: {\n      handler(val) {\n        this.activeEleText.style.lineHeight = val.style.fontSize\n      },\n      deep: true\n    }\n  },\n  methods: {\n    // 设置粗体\n    setFontWeight() {\n      if (+this.activeEleText.style.fontWeight === 400) {\n        this.activeEleText.style.fontWeight = 600\n      } else {\n        this.activeEleText.style.fontWeight = 400\n      }\n    },\n    // 设置对齐\n    handleCommand(command) {\n      this.activeEleText.style.textAlign = command\n    },\n    // 当前对齐方式\n    setAlignActive(type) {\n      if (this.activeEleText.style.textAlign === type) {\n        return {\n          backgroundColor: '#409eff',\n          color: '#fff'\n        }\n      } else {\n        return {\n          backgroundColor: '',\n          color: '#333'\n        }\n      }\n    },\n    // 文本生成图片\n    textBecomeImg(obj) {\n      const canvas = document.createElement('canvas')\n      canvas.width = obj.w\n      canvas.height = obj.h\n      const context = canvas.getContext('2d')\n      // 绘制字体距离canvas顶部初始的高度\n      const initTop = 4\n      const initLeft = 8\n      // 设置背景色\n      context.fillStyle = obj.style.backgroundColor || 'transparent'\n      context.fillRect(0, 0, canvas.width, canvas.height)\n      // 设置文本样式\n      context.fillStyle = obj.style.color\n      context.font = obj.style.fontWeight + ' ' + obj.style.fontSize + ' ' + obj.style.fontFamily\n      context.textBaseline = 'top'\n      // 设置文本对齐方式\n      context.textAlign = obj.style.textAlign\n\n      const textArr = obj.text.split('')\n      let tempStr = ''\n      const rowArr = []\n      const maxTextWidth = canvas.width - 2 * initLeft\n\n      for (let i = 0; i < textArr.length; i++) {\n        if (context.measureText(tempStr).width < maxTextWidth && context.measureText(tempStr + (textArr[i])).width <= maxTextWidth) {\n          tempStr += textArr[i]\n        } else {\n          rowArr.push(tempStr)\n          tempStr = textArr[i]\n        }\n      }\n      rowArr.push(tempStr)\n\n      let drawLeft\n      if (context.textAlign === 'left') {\n        drawLeft = initLeft\n      } else if (context.textAlign === 'center') {\n        drawLeft = maxTextWidth / 2\n      } else if (context.textAlign === 'right') {\n        drawLeft = maxTextWidth\n      }\n\n      for (let i = 0; i < rowArr.length; i++) {\n        context.fillText(rowArr[i], drawLeft, (parseInt(obj.style.fontSize) * i + initTop), maxTextWidth)\n      }\n\n      return canvas.toDataURL('image/png')\n    },\n    // 下载生成的图片\n    downloadImage() {\n      const imageBase64 = this.textBecomeImg(this.activeEleText)\n      const imageBlob = base64toBlob(imageBase64)\n      const link = document.createElement('a')\n      const event = document.createEvent('HTMLEvents')\n      // initEvent 不加后两个参数会在火狐下报错 事件类型，是否冒泡，是否阻止浏览器的默认行为\n      event.initEvent('click', true, true)\n      link.download = 'image.png'\n      link.href = URL.createObjectURL(imageBlob)\n      // 兼容火狐\n      link.dispatchEvent(new MouseEvent('click', { bubbles: true, cancelable: true, view: window }))\n    }\n  }\n}\n</script>\n\n<style lang=\"less\">\n@import \"../../assets/less/text-setting\";\n</style>\n"]}]}